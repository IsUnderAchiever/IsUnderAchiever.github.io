<!DOCTYPE html>

<html lang="zh-CN">

<head>
    
    <title>表单校验+异常处理 - 折影轻梦</title>
    <meta charset="UTF-8">
    <meta name="keywords" content="折影轻梦,Mixcm,轻惋,觅漫者,小舒同学,Xiaoshu,Nexmoe,产品,Meteor,探索者小舒,伴学OS1,Theme,Design,Product">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5">
    
    <link rel="shortcut icon" href="/img/favicon.ico" type="image/x-icon" />
    <meta name="description" content="表单校验JSR303 &lt;dependency&gt;   &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;    &lt;artifactId&gt;spring-boot-starter-validation&lt;&#x2F;artifactId&gt;&lt;&#x2F;dependency&gt;  给Bean添加校验注解如@Email 标注">
<meta property="og:type" content="article">
<meta property="og:title" content="表单校验+异常处理">
<meta property="og:url" content="https://isunderachiever.github.io/bian-cheng-yu-yan/java/xue-xi/kuang-jia/springboot/biao-dan-xiao-yan-yi-chang-chu-li.html">
<meta property="og:site_name" content="折影轻梦">
<meta property="og:description" content="表单校验JSR303 &lt;dependency&gt;   &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;    &lt;artifactId&gt;spring-boot-starter-validation&lt;&#x2F;artifactId&gt;&lt;&#x2F;dependency&gt;  给Bean添加校验注解如@Email 标注">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/202302181408949.png">
<meta property="og:image" content="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/202302181409557.png">
<meta property="og:image" content="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/202302181430162.png">
<meta property="og:image" content="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/202302181430912.png">
<meta property="og:image" content="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/202302181432950.png">
<meta property="og:image" content="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/202302181436807.png">
<meta property="og:image" content="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/202302181448835.png">
<meta property="og:image" content="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/202302181508917.png">
<meta property="og:image" content="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/202302181523120.png">
<meta property="og:image" content="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/202302181534110.png">
<meta property="og:image" content="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/202302181535976.png">
<meta property="og:image" content="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/202302181536074.png">
<meta property="og:image" content="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/202302181536000.png">
<meta property="og:image" content="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/202302181554598.png">
<meta property="og:image" content="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/202302181612517.png">
<meta property="og:image" content="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/202302181612589.png">
<meta property="og:image" content="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/202302181613521.png">
<meta property="og:image" content="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/202302181620912.png">
<meta property="og:image" content="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/202302181625320.png">
<meta property="og:image" content="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/202302181645029.png">
<meta property="article:published_time" content="2023-02-18T09:12:00.000Z">
<meta property="article:modified_time" content="2024-06-01T14:32:53.429Z">
<meta property="article:author" content="折影轻梦">
<meta property="article:tag" content="折影轻梦,Mixcm,轻惋,觅漫者,小舒同学,Xiaoshu,Nexmoe,产品,Meteor,探索者小舒,伴学OS1,Theme,Design,Product">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/202302181408949.png">
    
<link rel="stylesheet" href="/lib/fancybox/fancybox.css">
<link rel="stylesheet" href="/lib/mdui_043tiny/mdui.css">


    <link rel="stylesheet" href="/lib/iconfont/iconfont.css?v=1717340472362">
    
    <link rel="stylesheet" href="/css/style.css?v=1717340472362">

    
        
            <link rel="stylesheet" href="/custom.css?v=1717340472362">
        
    

    
<script src="/lib/mdui_043tiny/mdui.js" async></script>
<script src="/lib/fancybox/fancybox.umd.js" async></script>


    <script async src="/js/app.js?v=1717340472362"></script>
    
     

    <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-4D4ZJ9G024"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag("js", new Date());

  gtag("config", "G-4D4ZJ9G024");
</script>

<meta name="generator" content="Hexo 6.3.0"></head>

<body class="mdui-drawer-body-left">
    <div id="nexmoe-background">
        <div class="nexmoe-bg" 
            style="background-image: url(https://raw.githubusercontent.com/IsUnderAchiever/blog-img/master/about/202309161102206.jpg)"
        ></div>
        <div class="mdui-appbar mdui-shadow-0">
            <div class="mdui-toolbar">
                <a mdui-drawer="{target: '#drawer', swipe: true}" title="menu" class="mdui-btn mdui-btn-icon mdui-ripple"><i class="mdui-icon nexmoefont icon-menu"></i></a>
                <div class="mdui-toolbar-spacer"></div>
                <!--<a href="javascript:;" class="mdui-btn mdui-btn-icon"><i class="mdui-icon material-icons">search</i></a>-->
                <a href="/" title="折影轻梦" class="mdui-btn mdui-btn-icon"><img src="https://raw.githubusercontent.com/IsUnderAchiever/blog-img/master/about/202309161102017.jpg" alt="折影轻梦"></a>
            </div>
        </div>
    </div>
    <div id="nexmoe-header">
        <div class="nexmoe-drawer mdui-drawer" id="drawer">
    <div class="nexmoe-avatar mdui-ripple">
        <a href="/" title="折影轻梦">
            <img src="https://raw.githubusercontent.com/IsUnderAchiever/blog-img/master/about/202309161102017.jpg" alt="折影轻梦" alt="折影轻梦">
        </a>
    </div>
    <div class="nexmoe-count">
        <div><span>文章</span>169</div>
        <div><span>标签</span>62</div>
        <div><span>分类</span>63</div>
    </div>
    <div class="nexmoe-list mdui-list" mdui-collapse="{accordion: true}">
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple false" href="/" title="回到首页">
            <i class="mdui-list-item-icon nexmoefont icon-home"></i>
            <div class="mdui-list-item-content">
                回到首页
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple false" href="/archive.html" title="文章归档">
            <i class="mdui-list-item-icon nexmoefont icon-container"></i>
            <div class="mdui-list-item-content">
                文章归档
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple false" href="/life.html" title="我的生活">
            <i class="mdui-list-item-icon nexmoefont icon-unorderedlist"></i>
            <div class="mdui-list-item-content">
                我的生活
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple false" href="/about.html" title="关于博主">
            <i class="mdui-list-item-icon nexmoefont icon-info-circle"></i>
            <div class="mdui-list-item-content">
                关于博主
            </div>
        </a>
        
    </div>
    <aside id="nexmoe-sidebar">
        
            
            <div class="nexmoe-widget-wrap">
    <div class="nexmoe-widget nexmoe-search">
        
            <form id="search_form">
                <label><input class="st-default-search-input" id="search_value" name="q" type="search" placeholder="搜索" style="
                    font-size: 15px !important;
                    height: 56px !important;
                    background-image: none;
                "></label>
            </form>
         
    </div>
</div>


	<script async src="/js/search.js?v=1717340472362"></script>



        
            
            <div class="nexmoe-widget-wrap">
	<div class="nexmoe-widget nexmoe-social">
		<a
			class="mdui-ripple"
			href="https://github.com/IsUnderAchiever/"
			target="_blank"
			mdui-tooltip="{content: 'QQ群'}"
			style="
				color: rgb(249, 174, 8);
				background-color: rgba(249, 174, 8, .1);
			"
		>
			<i
				class="nexmoefont icon-QQ"
			></i> </a
		><a
			class="mdui-ripple"
			href="https://space.bilibili.com/477448861/"
			target="_blank"
			mdui-tooltip="{content: '哔哩哔哩'}"
			style="
				color: rgb(231, 106, 141);
				background-color: rgba(231, 106, 141, .1);
			"
		>
			<i
				class="nexmoefont icon-bilibili"
			></i> </a
		>
	</div>
</div>

        
            
            
            
            
            
            
    </aside>
    <div class="nexmoe-copyright">
        &copy; 2024 折影轻梦
        Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
        & <a href="https://github.com/theme-nexmoe/hexo-theme-nexmoe" target="_blank">Nexmoe</a>
        
    </div>
</div><!-- .nexmoe-drawer -->
    </div>
    <div id="nexmoe-content">
        <div class="nexmoe-primary">
    <div class="nexmoe-post">
  <article>
    
        <div class="nexmoe-post-cover"> 
            <img src="https://raw.githubusercontent.com/IsUnderAchiever/blog-img/master/about/202309161102206.jpg" alt="表单校验+异常处理" loading="lazy">
            <h1>表单校验+异常处理</h1>
        </div>
    
    
    <div class="nexmoe-post-meta">
    <div class="nexmoe-rainbow">
        <a class="nexmoefont icon-calendar-fill">2023年02月18日</a>
        
            <a class="nexmoefont icon-appstore-fill -link" href="/categories/%E8%A1%A8%E5%8D%95%E6%A0%A1%E9%AA%8C-%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86/">表单校验+异常处理</a>
        
        
    </div>
    
    
    
    
    
</div>

    <h2 id="表单校验"><a href="#表单校验" class="headerlink" title="表单校验"></a>表单校验</h2><p><code>JSR303</code></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-validation<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>
<ol>
<li><p>给Bean添加校验注解<br>如<code>@Email</code> 标注的字段为邮箱、<code>@NotNull</code> 标注的字段不能为空、<code>@Future</code> 标注的字段必须是未来的时间、<code>@Min</code>标注最小值</p>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 若不写message，则返回默认信息</span><br><span class="hljs-meta">@NotBlank(message = &quot;用户名不能为空&quot;)</span><br><span class="hljs-meta">@TableField(value = &quot;username&quot;)</span><br><span class="hljs-keyword">private</span> String username;<br></code></pre></td></tr></table></figure>
</li>
<li><p>开启校验注解<code>@Valid</code>，告知spring方法需要开启校验这些字段，上面只是标注了校验规则，标注<code>（@Valid）</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@PostMapping(&quot;/test&quot;)</span><br><span class="hljs-keyword">public</span> String <span class="hljs-title function_">test</span><span class="hljs-params">(<span class="hljs-meta">@Valid</span> <span class="hljs-meta">@RequestBody</span> User user)</span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;error1&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure></li>
<li><p>获取校验的结果，校验是否成功…，紧跟参数后面添加<code>BindingResult result</code>，示例如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@PostMapping(&quot;/test&quot;)</span><br><span class="hljs-keyword">public</span> Object <span class="hljs-title function_">test</span><span class="hljs-params">(<span class="hljs-meta">@Valid</span> <span class="hljs-meta">@RequestBody</span> User user, BindingResult result)</span>&#123;<br>    Map&lt;String, Object&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>    <span class="hljs-comment">// 如果校验出错</span><br>    <span class="hljs-keyword">if</span> (result.hasErrors())&#123;<br>        Map&lt;String, String&gt; error = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        <span class="hljs-comment">// 获取校验的错误结果</span><br>            result.getFieldErrors().forEach((item)-&gt;&#123;<br>        <span class="hljs-comment">// FieldError 获取到错误提示</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> item.getDefaultMessage();<br>        <span class="hljs-comment">// 获取错误的属性名字</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">field</span> <span class="hljs-operator">=</span> item.getField();<br>        error.put(field,message);<br>        &#125;);<br>        map.put(<span class="hljs-string">&quot;code&quot;</span>,<span class="hljs-number">500</span>);<br>        map.put(<span class="hljs-string">&quot;message&quot;</span>,error);<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-comment">// 校验未出错</span><br>        map.put(<span class="hljs-string">&quot;code&quot;</span>,<span class="hljs-number">200</span>);<br>        map.put(<span class="hljs-string">&quot;message&quot;</span>,user);<br>    &#125;<br>    <span class="hljs-keyword">return</span> map;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><img onerror="imgOnError(this);" data-fancybox="gallery" src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/202302181408949.png" alt="image-20230218140813717" data-caption="image-20230218140813717" loading="lazy"></p>
<p><img onerror="imgOnError(this);" data-fancybox="gallery" src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/202302181409557.png" alt="image-20230218140908480" data-caption="image-20230218140908480" loading="lazy"></p>
</li>
</ol>
<h3 id="自定义校验规则"><a href="#自定义校验规则" class="headerlink" title="自定义校验规则"></a>自定义校验规则</h3><figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// regexp内写 正则表达式    </span><br><span class="hljs-meta">@Pattern(regexp = &quot;/^[a-zA-Z0-9]$/&quot;,message = &quot;昵称必须是一个字母或数字&quot;)</span><br><span class="hljs-meta">@TableField(value = &quot;nick_name&quot;)</span><br><span class="hljs-keyword">private</span> String nick_name;<br></code></pre></td></tr></table></figure>
<h2 id="配置全局异常处理"><a href="#配置全局异常处理" class="headerlink" title="配置全局异常处理"></a>配置全局异常处理</h2><blockquote>
<ol>
<li><p>类添加注解</p>
<ul>
<li><p>@ControllerAdvice 如果需要返回json数据，则需要在方法上加上@ResponseBody</p>
</li>
<li><p>@RestControllerAdvice，默认返回json数据，方法不需要加@ResponseBody</p>
<p><code>区别</code>:参考@RestController和@Controller的</p>
</li>
</ul>
</li>
<li><p>方法添加处理器</p>
<ul>
<li><p>捕获全局异常，处理所有不可知异常</p>
</li>
<li><p>@ExceptionHandler(value&#x3D;Exception.class)</p>
</li>
</ul>
</li>
</ol>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.ExceptionHandler;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestControllerAdvice;<br><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@RestControllerAdvice(basePackages = &quot;com.example.exceptiontest.controller&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserExceptionControllerAdvice</span> &#123;<br>    <span class="hljs-meta">@ExceptionHandler(value = Exception.class)</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">handleValidException</span><span class="hljs-params">(Exception e)</span>&#123;<br>        HashMap&lt;String, String&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        map.put(<span class="hljs-string">&quot;message&quot;</span>,e.getMessage());<br>        map.put(<span class="hljs-string">&quot;class&quot;</span>,e.getClass().toString());<br>        log.error(<span class="hljs-string">&quot;数据校验出现异常:&#123;&#125;，异常类型:&#123;&#125;&quot;</span>,e.getMessage(),e.getClass());<br>        <span class="hljs-keyword">return</span> map;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>既然要进行异常处理，那么上方配置的校验就需要抛出异常，去掉BindingResult即可</p>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@PostMapping(&quot;/test2&quot;)</span><br><span class="hljs-keyword">public</span> Object <span class="hljs-title function_">test2</span><span class="hljs-params">(<span class="hljs-meta">@Valid</span> <span class="hljs-meta">@RequestBody</span> User user)</span>&#123;<br>    Map&lt;String, Object&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>    map.put(<span class="hljs-string">&quot;code&quot;</span>,<span class="hljs-number">200</span>);<br>    map.put(<span class="hljs-string">&quot;message&quot;</span>,user);<br>    <span class="hljs-keyword">return</span> map;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><img onerror="imgOnError(this);" data-fancybox="gallery" src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/202302181430162.png" alt="image-20230218143001936" data-caption="image-20230218143001936" loading="lazy"><br><img onerror="imgOnError(this);" data-fancybox="gallery" src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/202302181430912.png" alt="image-20230218143053836" data-caption="image-20230218143053836" loading="lazy"></p>
<blockquote>
<p>指定的异常类型需要更精确才行<br><img onerror="imgOnError(this);" data-fancybox="gallery" src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/202302181432950.png" alt="image-20230218143237871" data-caption="image-20230218143237871" loading="lazy"></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@RestControllerAdvice(basePackages = &quot;com.example.exceptiontest.controller&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserExceptionControllerAdvice</span> &#123;<br>    <span class="hljs-meta">@ExceptionHandler(value = MethodArgumentNotValidException.class)</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">handleValidException</span><span class="hljs-params">(MethodArgumentNotValidException e)</span>&#123;<br>        HashMap&lt;String, String&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        <span class="hljs-type">BindingResult</span> <span class="hljs-variable">bindingResult</span> <span class="hljs-operator">=</span> e.getBindingResult();<br>        map.put(<span class="hljs-string">&quot;code&quot;</span>,<span class="hljs-string">&quot;400&quot;</span>);<br>        bindingResult.getFieldErrors().forEach((item)-&gt;&#123;<br>            map.put(item.getField(),item.getDefaultMessage());<br>        &#125;);<br>        map.put(<span class="hljs-string">&quot;msg&quot;</span>,<span class="hljs-string">&quot;数据校验出现异常&quot;</span>);<br>        log.error(<span class="hljs-string">&quot;数据校验出现异常:&#123;&#125;，异常类型:&#123;&#125;&quot;</span>,e.getMessage(),e.getClass());<br>        <span class="hljs-keyword">return</span> map;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><img onerror="imgOnError(this);" data-fancybox="gallery" src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/202302181436807.png" alt="image-20230218143612705" data-caption="image-20230218143612705" loading="lazy"></p>
<blockquote>
<p>为了更加统一、方便地编写返回状态码，可创建一个<code>枚举类</code></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">BizCodeEnume</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 系统未知异常</span><br><span class="hljs-comment">     */</span><br>    UNKNOWN_EXCEPTION(<span class="hljs-number">10000</span>,<span class="hljs-string">&quot;系统未知异常&quot;</span>),<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 参数格式校验失败</span><br><span class="hljs-comment">     */</span><br>    VAILD_EXCEPTION(<span class="hljs-number">10001</span>,<span class="hljs-string">&quot;参数格式校验失败&quot;</span>);<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> code;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String msg;<br>    BizCodeEnume(<span class="hljs-type">int</span> code, String msg)&#123;<br>        <span class="hljs-built_in">this</span>.code = code;<br>        <span class="hljs-built_in">this</span>.msg = msg;<br>    &#125;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 获取状态码</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> int</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getCode</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> code;<br>    &#125;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 获取信息</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> &#123;<span class="hljs-doctag">@link</span> String&#125;</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getMsg</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> msg;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@RestControllerAdvice(basePackages = &quot;com.example.exceptiontest.controller&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserExceptionControllerAdvice</span> &#123;<br>    <span class="hljs-meta">@ExceptionHandler(value = MethodArgumentNotValidException.class)</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">handleValidException</span><span class="hljs-params">(MethodArgumentNotValidException e)</span>&#123;<br>        HashMap&lt;String, String&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        <span class="hljs-type">BindingResult</span> <span class="hljs-variable">bindingResult</span> <span class="hljs-operator">=</span> e.getBindingResult();<br>        map.put(<span class="hljs-string">&quot;code&quot;</span>, String.valueOf(BizCodeEnume.VAILD_EXCEPTION.getCode()));<br>        bindingResult.getFieldErrors().forEach((item)-&gt;&#123;<br>            map.put(item.getField(),item.getDefaultMessage());<br>        &#125;);<br>        map.put(<span class="hljs-string">&quot;msg&quot;</span>,BizCodeEnume.VAILD_EXCEPTION.getMsg());<br>        log.error(<span class="hljs-string">&quot;数据校验出现异常:&#123;&#125;，异常类型:&#123;&#125;&quot;</span>,e.getMessage(),e.getClass());<br>        <span class="hljs-keyword">return</span> map;<br>    &#125;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 处理最大的异常</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> e e</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> &#123;<span class="hljs-doctag">@link</span> Object&#125;</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@ExceptionHandler(value = Throwable.class)</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">handleException</span><span class="hljs-params">(Throwable e)</span>&#123;<br>        HashMap&lt;String, String&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>        map.put(<span class="hljs-string">&quot;code&quot;</span>,String.valueOf(BizCodeEnume.UNKNOWN_EXCEPTION.getCode()));<br>        map.put(<span class="hljs-string">&quot;msg&quot;</span>,BizCodeEnume.UNKNOWN_EXCEPTION.getMsg());<br>        <span class="hljs-keyword">return</span> map;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><img onerror="imgOnError(this);" data-fancybox="gallery" src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/202302181448835.png" alt="image-20230218144806627" data-caption="image-20230218144806627" loading="lazy"></p>
<h3 id="自定义异常"><a href="#自定义异常" class="headerlink" title="自定义异常"></a>自定义异常</h3><blockquote>
<p>注释掉之前写过的<code>@NotBlank(message = &quot;用户名不能为空&quot;)</code>…参数校验注解</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UsernameOrPasswordNULLException</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">RuntimeException</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">UsernameOrPasswordNULLException</span><span class="hljs-params">(String message)</span> &#123;<br>        <span class="hljs-built_in">super</span>(message);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 捕获UsernameOrPasswordNULLException异常</span><br><span class="hljs-meta">@ExceptionHandler(value = UsernameOrPasswordNULLException.class)</span><br><span class="hljs-keyword">public</span> Object <span class="hljs-title function_">usernameOrPasswordIsNull</span><span class="hljs-params">(UsernameOrPasswordNULLException e)</span>&#123;<br>    HashMap&lt;String, String&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>    <span class="hljs-comment">// 获取状态码</span><br>    map.put(<span class="hljs-string">&quot;code&quot;</span>, <span class="hljs-string">&quot;501&quot;</span>);<br>    <span class="hljs-comment">// 获取信息</span><br>    map.put(<span class="hljs-string">&quot;msg&quot;</span>,<span class="hljs-string">&quot;用户名或密码为空&quot;</span>);<br>    <span class="hljs-keyword">return</span> map;<br>&#125;<br></code></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@PostMapping(&quot;/test3&quot;)</span><br><span class="hljs-keyword">public</span> Object <span class="hljs-title function_">test3</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> User user)</span>&#123;<br>    String username=user.getUsername();<br>    String password=user.getPassword();<br>    <span class="hljs-keyword">if</span>(username==<span class="hljs-literal">null</span> || <span class="hljs-string">&quot;&quot;</span>.equals(username)||password==<span class="hljs-literal">null</span> ||<span class="hljs-string">&quot;&quot;</span>.equals(password))&#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UsernameOrPasswordNULLException</span>(<span class="hljs-string">&quot;用户名或密码不能为空&quot;</span>);<br>    &#125;<br>    Map&lt;String, Object&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>    map.put(<span class="hljs-string">&quot;code&quot;</span>,<span class="hljs-number">200</span>);<br>    map.put(<span class="hljs-string">&quot;message&quot;</span>,user);<br>    <span class="hljs-keyword">return</span> map;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><img onerror="imgOnError(this);" data-fancybox="gallery" src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/202302181508917.png" alt="image-20230218150809676" data-caption="image-20230218150809676" loading="lazy"></p>
<h2 id="分组校验"><a href="#分组校验" class="headerlink" title="分组校验"></a>分组校验</h2><blockquote>
<p>各个业务场景下的参数校验规则可能是不一样的<br>比如<code>新增用户</code>时，id字段自增，所以不需要填写，但<code>删除用户</code>时，id字段必须要填写</p>
<p>此时需要使用到<code>分组校验功能</code><br>给注解标明，何时使用A校验规则，何时使用B校验规则</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 指定组AddGroup，新建AddGroup接口，什么都不用写;DeleteGroup 也一样</span><br><span class="hljs-meta">@Null(message = &quot;新增用户时，不能指定用户id&quot;,groups = &#123;AddGroup.class&#125;)</span><br><span class="hljs-meta">@NotNull(message = &quot;删除用户时，必须指定用户id&quot;,groups = &#123;DeleteGroup.class&#125;)</span><br><span class="hljs-meta">@TableId(value = &quot;id&quot;, type = IdType.AUTO)</span><br><span class="hljs-keyword">private</span> Integer id;<br></code></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">AddGroup</span> &#123;<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">DeleteGroup</span> &#123;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><img onerror="imgOnError(this);" data-fancybox="gallery" src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/202302181523120.png" alt="image-20230218152344005" data-caption="image-20230218152344005" loading="lazy"></p>
<blockquote>
<p>将<code>@Valid</code>注解 改为 <code>@Validated</code>注解</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@PostMapping(&quot;/save&quot;)</span><br><span class="hljs-keyword">public</span> Object <span class="hljs-title function_">saveUser</span><span class="hljs-params">(<span class="hljs-meta">@Validated(&#123;AddGroup.class&#125;)</span> <span class="hljs-meta">@RequestBody</span> User user)</span> &#123;<br>    <span class="hljs-type">boolean</span> <span class="hljs-variable">saveFlag</span> <span class="hljs-operator">=</span> userService.save(user);<br>    Map&lt;String, Object&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>    map.put(<span class="hljs-string">&quot;code&quot;</span>, <span class="hljs-number">200</span>);<br>    map.put(<span class="hljs-string">&quot;message&quot;</span>, saveFlag ? <span class="hljs-string">&quot;保存成功&quot;</span> : <span class="hljs-string">&quot;保存失败&quot;</span>);<br>    <span class="hljs-keyword">return</span> map;<br>&#125;<br><span class="hljs-meta">@DeleteMapping(&quot;/delete&quot;)</span><br><span class="hljs-keyword">public</span> Object <span class="hljs-title function_">deleteUser</span><span class="hljs-params">(<span class="hljs-meta">@Validated(&#123;DeleteGroup.class&#125;)</span> <span class="hljs-meta">@RequestBody</span> User user)</span> &#123;<br>    <span class="hljs-type">boolean</span> <span class="hljs-variable">saveFlag</span> <span class="hljs-operator">=</span> userService.removeById(user.getId());<br>    Map&lt;String, Object&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>    map.put(<span class="hljs-string">&quot;code&quot;</span>, <span class="hljs-number">200</span>);<br>    map.put(<span class="hljs-string">&quot;message&quot;</span>, saveFlag ? <span class="hljs-string">&quot;删除成功&quot;</span> : <span class="hljs-string">&quot;删除失败&quot;</span>);<br>    <span class="hljs-keyword">return</span> map;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><strong>若校验注解如@NotNull不指定group，那么在执行方法时，会校验吗？</strong><br>答案是不会校验，不标注分组的校验注解是不起作用的<br><img onerror="imgOnError(this);" data-fancybox="gallery" src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/202302181534110.png" alt="image-20230218153455850" data-caption="image-20230218153455850" loading="lazy"><br><img onerror="imgOnError(this);" data-fancybox="gallery" src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/202302181535976.png" alt="image-20230218153544904" data-caption="image-20230218153544904" loading="lazy"><br><img onerror="imgOnError(this);" data-fancybox="gallery" src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/202302181536074.png" alt="image-20230218153625006" data-caption="image-20230218153625006" loading="lazy"><br><img onerror="imgOnError(this);" data-fancybox="gallery" src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/202302181536000.png" alt="image-20230218153647928" data-caption="image-20230218153647928" loading="lazy"></p>
<h2 id="自定义校验"><a href="#自定义校验" class="headerlink" title="自定义校验"></a>自定义校验</h2><blockquote>
<p>若<code>正则表达式</code>无法满足业务需求，需要自定义校验逻辑</p>
</blockquote>
<ol>
<li>编写自定义校验注解</li>
<li>编写自定义校验器</li>
<li>关联校验器和注解，让校验器来校验注解标注的字段<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@NickValue(vals=&#123;&quot;喜羊羊&quot;,&quot;灰太狼&quot;&#125;)</span><br><span class="hljs-meta">@TableField(value = &quot;nick_name&quot;)</span><br><span class="hljs-keyword">private</span> String nick_name;<br></code></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> javax.validation.Constraint;<br><span class="hljs-keyword">import</span> javax.validation.Payload;<br><span class="hljs-keyword">import</span> java.lang.annotation.*;<br><span class="hljs-meta">@Documented</span><br><span class="hljs-comment">// 这里需要指定校验器，暂时先空着，等到后面再编写校验器</span><br><span class="hljs-meta">@Constraint(</span><br><span class="hljs-meta">        validatedBy = &#123;&#125;</span><br><span class="hljs-meta">)</span><br><span class="hljs-meta">@Target(&#123;ElementType.METHOD, ElementType.FIELD, ElementType.ANNOTATION_TYPE, ElementType.CONSTRUCTOR, ElementType.PARAMETER, ElementType.TYPE_USE&#125;)</span><br><span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> NickValue &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 消息</span><br><span class="hljs-comment">     * 这里写该注解的全类名</span><br><span class="hljs-comment">     * 若校验失败，会前往ValidationMessages.properties来查询失败信息</span><br><span class="hljs-comment">     * 所以我们需要自己配置一个ValidationMessages.properties</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> &#123;<span class="hljs-doctag">@link</span> String&#125;</span><br><span class="hljs-comment">     */</span><br>    String <span class="hljs-title function_">message</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-string">&quot;&#123;com.example.exceptiontest.valid.NickValue.message&#125;&quot;</span>;<br>    Class&lt;?&gt;[] groups() <span class="hljs-keyword">default</span> &#123;&#125;;<br>    Class&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Payload</span>&gt;[] payload() <span class="hljs-keyword">default</span> &#123;&#125;;<br>    String[] vals() <span class="hljs-keyword">default</span> &#123;&#125;;<br>&#125;<br></code></pre></td></tr></table></figure>
<img onerror="imgOnError(this);" data-fancybox="gallery" src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/202302181554598.png" alt="image-20230218155417292" data-caption="image-20230218155417292" loading="lazy"><figure class="highlight properties"><table><tr><td class="code"><pre><code class="hljs properties"><span class="hljs-attr">com.example.exceptiontest.valid.NickValue.message</span>=<span class="hljs-string">昵称必须为指定的值</span><br></code></pre></td></tr></table></figure>
<strong>编写自定义校验器</strong><figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> javax.validation.ConstraintValidator;<br><span class="hljs-keyword">import</span> javax.validation.ConstraintValidatorContext;<br><span class="hljs-keyword">import</span> java.util.HashSet;<br><span class="hljs-keyword">import</span> java.util.Set;<br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 自定义昵称校验器</span><br><span class="hljs-comment"> * ConstraintValidator&lt;NickValue,String&gt; 前面为注解，后面为校验的字段类型</span><br><span class="hljs-comment"> * 如此时校验的字段是nickname，它的类型是String</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> tong</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@date</span> 2023/02/18</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NickValueConstraintValidator</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ConstraintValidator</span>&lt;NickValue,String&gt; &#123;<br>    <span class="hljs-keyword">private</span> Set&lt;String&gt; set=<span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&lt;String&gt;();<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 初始化</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> constraintAnnotation 约束注释</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initialize</span><span class="hljs-params">(NickValue constraintAnnotation)</span> &#123;<br>        String[] vals = constraintAnnotation.vals();<br>        <span class="hljs-keyword">for</span> (String val : vals) &#123;<br>            set.add(val);<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 是否校验成功</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> s                          昵称</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> constraintValidatorContext 约束验证器上下文</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> boolean</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isValid</span><span class="hljs-params">(String s, ConstraintValidatorContext constraintValidatorContext)</span> &#123;<br>        <span class="hljs-keyword">if</span>(set.contains(s))&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<blockquote>
<p>别忘了在注解上添加对应的校验器</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Documented</span><br><span class="hljs-comment">// 添加对应的校验器</span><br><span class="hljs-meta">@Constraint(</span><br><span class="hljs-meta">        validatedBy = &#123;NickValueConstraintValidator.class&#125;</span><br><span class="hljs-meta">)</span><br><span class="hljs-meta">@Target(&#123;ElementType.METHOD, ElementType.FIELD, ElementType.ANNOTATION_TYPE, ElementType.CONSTRUCTOR, ElementType.PARAMETER, ElementType.TYPE_USE&#125;)</span><br><span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> NickValue &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 消息</span><br><span class="hljs-comment">     * 这里写该注解的全类名</span><br><span class="hljs-comment">     * 若校验失败，会前往ValidationMessages.properties来查询失败信息</span><br><span class="hljs-comment">     * 所以我们需要自己配置一个ValidationMessages.properties</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> &#123;<span class="hljs-doctag">@link</span> String&#125;</span><br><span class="hljs-comment">     */</span><br>    String <span class="hljs-title function_">message</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-string">&quot;&#123;com.example.exceptiontest.valid.NickValue.message&#125;&quot;</span>;<br>    Class&lt;?&gt;[] groups() <span class="hljs-keyword">default</span> &#123;&#125;;<br>    Class&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Payload</span>&gt;[] payload() <span class="hljs-keyword">default</span> &#123;&#125;;<br>    String[] vals() <span class="hljs-keyword">default</span> &#123;&#125;;<br>&#125;<br></code></pre></td></tr></table></figure>
<blockquote>
<p>打印一下错误信息</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@ExceptionHandler(value = Throwable.class)</span><br><span class="hljs-keyword">public</span> Object <span class="hljs-title function_">handleException</span><span class="hljs-params">(Throwable e)</span>&#123;<br>    <span class="hljs-comment">// 打印错误信息</span><br>    log.error(<span class="hljs-string">&quot;错误:&quot;</span>,e);<br>    HashMap&lt;String, String&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>    <span class="hljs-comment">// 获取状态码</span><br>    map.put(<span class="hljs-string">&quot;code&quot;</span>,String.valueOf(BizCodeEnume.UNKNOWN_EXCEPTION.getCode()));<br>    <span class="hljs-comment">// 获取信息</span><br>    map.put(<span class="hljs-string">&quot;msg&quot;</span>,BizCodeEnume.UNKNOWN_EXCEPTION.getMsg());<br>    <span class="hljs-keyword">return</span> map;<br>&#125;<br></code></pre></td></tr></table></figure>
<blockquote>
<p>指定分组</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@NickValue(vals=&#123;&quot;喜羊羊&quot;,&quot;灰太狼&quot;&#125;,groups = &#123;AddGroup.class, DeleteGroup.class&#125;)</span><br><span class="hljs-meta">@TableField(value = &quot;nick_name&quot;)</span><br><span class="hljs-keyword">private</span> String nick_name;<br></code></pre></td></tr></table></figure>
<img onerror="imgOnError(this);" data-fancybox="gallery" src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/202302181612517.png" alt="image-20230218161238324" data-caption="image-20230218161238324" loading="lazy"><br><img onerror="imgOnError(this);" data-fancybox="gallery" src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/202302181612589.png" alt="image-20230218161251523" data-caption="image-20230218161251523" loading="lazy"><br><img onerror="imgOnError(this);" data-fancybox="gallery" src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/202302181613521.png" alt="image-20230218161306450" data-caption="image-20230218161306450" loading="lazy"><blockquote>
<p>校验注解指定多个校验器</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 这里可以添加多个校验器</span><br><span class="hljs-meta">@Constraint(</span><br><span class="hljs-meta">        validatedBy = &#123;NickValueConstraintValidator.class&#125;</span><br><span class="hljs-meta">)</span><br></code></pre></td></tr></table></figure>
<blockquote>
<p>此步骤参考<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_37020594/article/details/122777649">博客</a></p>
<p>按住ctrl+H<br><img onerror="imgOnError(this);" data-fancybox="gallery" src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/202302181620912.png" alt="image-20230218162021761" data-caption="image-20230218162021761" loading="lazy"><br>可以看到存在很多校验器<br>需要注意的<code>问题</code>如下<br><strong>User</strong><br><img onerror="imgOnError(this);" data-fancybox="gallery" src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/202302181625320.png" alt="image-20230218162537252" data-caption="image-20230218162537252" loading="lazy"><br><strong>UserController</strong><br><img onerror="imgOnError(this);" data-fancybox="gallery" src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/202302181645029.png" alt="image-20230218164538925" data-caption="image-20230218164538925" loading="lazy"><br>在修改用户的时候，我们是需要传入<code>密码</code>和<code>昵称</code>的</p>
<p>但是实际在个人主页修改个人昵称的时候，如果前端传递的user对象里只包含<code>用户id</code>和<code>昵称</code>而不包含密码，那么此时的校验无法通过<br>因为在<code>修改方法</code>内并未传入<code>密码</code><br>但是也无法删除<code>密码</code>注解的UpdateGroup，否则修改密码的时候如果不传入<code>密码</code>也能通过校验</p>
<p>原因是修改昵称和修改密码调用的是<code>同一个修改方法</code>和<code>同一个UpdateGroup</code></p>
<p>解决方法：<code>修改方法分开编写</code>，不要合并成同一个方法；同时创建一个新的修改分组，如<code>UpdateNiceNameGroup</code></p>
</blockquote>
</li>
</ol>

    
  </article>

  
      
    <div class="nexmoe-post-copyright">
        <strong>本文作者：</strong>折影轻梦<br>
        <strong>本文链接：</strong><a href="https://isunderachiever.github.io/bian-cheng-yu-yan/java/xue-xi/kuang-jia/springboot/biao-dan-xiao-yan-yi-chang-chu-li.html" title="https:&#x2F;&#x2F;isunderachiever.github.io&#x2F;bian-cheng-yu-yan&#x2F;java&#x2F;xue-xi&#x2F;kuang-jia&#x2F;springboot&#x2F;biao-dan-xiao-yan-yi-chang-chu-li.html" target="_blank" rel="noopener">https:&#x2F;&#x2F;isunderachiever.github.io&#x2F;bian-cheng-yu-yan&#x2F;java&#x2F;xue-xi&#x2F;kuang-jia&#x2F;springboot&#x2F;biao-dan-xiao-yan-yi-chang-chu-li.html</a><br>
        
            <strong>版权声明：</strong>本文采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/cn/deed.zh" target="_blank">CC BY-NC-SA 3.0 CN</a> 协议进行许可

        
    </div>


  
  
  <div class="nexmoe-post-meta nexmoe-rainbow">
   
    
</div>
  
  

  
      <div class="nexmoe-post-footer">
          <script src="https://giscus.app/client.js"
    data-repo="nexmoe/nexmoe.com"
    data-repo-id="R_kgDOJI1XUA"
    data-category="General"
    data-category-id="DIC_kwDOJI1XUM4CU1nn"
    data-mapping="pathname"
    data-strict="0"
    data-reactions-enabled="1"
    data-emit-metadata="0"
    data-input-position="top"
    data-theme="preferred_color_scheme"
    data-lang="en"
    data-loading="lazy"
    crossorigin="anonymous"
    async>
</script>

      </div>
  
</div>
</div>
        <div class="nexmoe-post-right">
              <div class="nexmoe-fixed">
                  <div class="nexmoe-tool"> 
                    
                      
                        
                          
                          
                              <button class="mdui-fab catalog" style="overflow:unset;">
                                  <i class="nexmoefont icon-i-catalog"></i>
                                  <div class="nexmoe-toc">
                                      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A1%A8%E5%8D%95%E6%A0%A1%E9%AA%8C"><span class="toc-number">1.</span> <span class="toc-text">表单校验</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%A0%A1%E9%AA%8C%E8%A7%84%E5%88%99"><span class="toc-number">1.1.</span> <span class="toc-text">自定义校验规则</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E5%85%A8%E5%B1%80%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86"><span class="toc-number">2.</span> <span class="toc-text">配置全局异常处理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%BC%82%E5%B8%B8"><span class="toc-number">2.1.</span> <span class="toc-text">自定义异常</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E7%BB%84%E6%A0%A1%E9%AA%8C"><span class="toc-number">3.</span> <span class="toc-text">分组校验</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%A0%A1%E9%AA%8C"><span class="toc-number">4.</span> <span class="toc-text">自定义校验</span></a></li></ol>
                                  </div>
                              </button>
                          
                          
                      
                    
                      <a href="#nexmoe-content" class="toc-link" aria-label="Back To Top" title="top"><button class="mdui-fab mdui-ripple"><i class="nexmoefont icon-caret-top"></i></button></a>
                  </div>
              </div>
            </div>
    </div>
    <div id="nexmoe-search-space">
	<div class="search-container">
		<div class="search-header">
			<div class="search-input-container">
				<input
					class="search-input"
					type="text"
					placeholder="搜索"
					oninput="sinput();"
				/>
			</div>
			<a class="search-close" onclick="sclose();">×</a>
		</div>
		<div class="search-body"></div>
	</div>
</div>

    
    
</body>

</html>
