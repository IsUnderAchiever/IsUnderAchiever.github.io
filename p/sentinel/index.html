<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="Sentinel">
<title>Sentinel</title>

<link rel='canonical' href='https://IsUnderAchiever.github.io/p/sentinel/'>

<link rel="stylesheet" href="/scss/style.min.b85f3de2f132c41bcf65396d29447bd98774c1cff192b74d7f75bc7b72545eb8.css"><meta property='og:title' content="Sentinel">
<meta property='og:description' content="Sentinel">
<meta property='og:url' content='https://IsUnderAchiever.github.io/p/sentinel/'>
<meta property='og:site_name' content='æ·±æµ·ç«é”…åº—'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:published_time' content='2024-04-10T00:00:00&#43;00:00'/><meta property='article:modified_time' content='2024-04-10T00:00:00&#43;00:00'/><meta property='og:image' content='https://IsUnderAchiever.github.io/p/sentinel/202412212132620.png' />
<meta name="twitter:title" content="Sentinel">
<meta name="twitter:description" content="Sentinel"><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='https://IsUnderAchiever.github.io/p/sentinel/202412212132620.png' />
    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="åˆ‡æ¢èœå•">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/header_hu16240087013746809388.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">ğŸ˜</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">æ·±æµ·ç«é”…åº—</a></h1>
            <h2 class="site-description">è®°å½•æˆ‘çš„æˆé•¿å²</h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://space.bilibili.com/477448861'
                        target="_blank"
                        title="Bilibili"
                        rel="me"
                    >
                        
                        
                            <?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg t="1734756297204" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4471" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><path d="M685.21 117.15c6.63-9.41 21.12-11.52 30.21-4.47 9.06 6.34 11.49 19.96 5.35 29.12-35.44 51.91-70.81 103.88-106.31 155.76-0.63 1.02-1.16 2.09-1.7 3.16 86.41 0.03 172.82 0.01 259.22 0.02 10.3-0.39 19.61 8.97 19.11 19.28 0.08 172.65 0.18 345.31 0.23 517.97 0.29 9.97-8.32 19.2-18.33 19.35-21.78 0.24-43.56-0.17-65.32 0.19-1.96 17.65-9.87 34.97-23.27 46.85-12.92 12-31.5 17.75-48.9 14.36-28.92-5.43-48.64-33.26-51.72-61.39-109.19 0.08-218.38 0.08-327.57 0-2.33 18.48-10.77 36.55-25.23 48.6-15.66 13.62-39.03 17.75-58.17 9.42-23.11-9.58-37.95-33.47-40.48-57.84-27.1-0.36-54.23 0.06-81.33-0.21-9.8-0.41-18.09-9.49-17.73-19.28 0.06-170.34 0.08-340.69 0.12-511.04 0.1-4.55-0.51-9.27 1.09-13.64 2.49-7.28 9.81-12.67 17.54-12.61 91.71-0.09 183.42 0.12 275.13-0.11-50.14-27.95-100.88-54.9-151.14-82.66-10.46-5.79-13.59-20.94-6.66-30.59 5.82-9.13 18.87-12.17 28.25-6.87 69.04 37.58 138.06 75.18 207.1 112.76 3.52 1.62 5.91 4.67 8.61 7.31 15.47 0.33 30.96 0.05 46.45 0.15 41.94-61.11 83.59-122.43 125.45-183.59M169.87 336.87c-0.09 161.25 0.16 322.48 0.35 483.72 228.11-0.17 456.22-0.07 684.33-0.05-0.02-161.22 0.22-322.46 0.07-483.68-228.25 0.01-456.5-0.02-684.75 0.01M271 857.38c2.22 11.33 10.44 23.52 23 24.07 12.45-0.26 21.53-12.56 22.95-24.07-15.32 0.05-30.64 0.02-45.95 0m452.05 0c1.42 11.5 10.51 23.79 22.95 24.07 12.54-0.55 20.85-12.71 22.99-24.06-15.31 0.01-30.63 0.04-45.94-0.01z" fill="#454545" p-id="4472"></path><path d="M221.28 374.37c3.83-0.94 7.81-0.61 11.72-0.65 188.33 0.01 376.65-0.01 564.98 0.01 10.85-0.43 20.67 9.41 20.08 20.27 0.14 123.33-0.02 246.66 0.16 369.99 0.13 8.3-5.4 16.35-13.29 19-4.14 1.52-8.61 1.18-12.93 1.19-188.67-0.04-377.35 0.06-566.02-0.04-12.39 0.23-21.58-12.32-19.69-24.15 0.06-122.01 0.04-244.03 0.11-366.04-0.24-8.92 6.15-17.52 14.88-19.58M243 410.18c-0.38 112.4 0.15 224.81 0.11 337.21 179.44 0.13 358.89 0.09 538.34 0.02 0.01-112.43 0.4-224.89-0.09-337.3-179.45 0.14-358.91-0.01-538.36 0.07z" fill="#454545" p-id="4473"></path><path d="M600.4 471.55c5.06-1.37 10.69-0.78 15.28 1.8 35.65 21.33 71.26 42.72 106.91 64.07 4.92 2.83 10.29 5.72 13.05 10.95 4.45 7.6 3.2 17.98-3.01 24.24-6.32 7.05-17.67 8.31-25.62 3.34-37.26-22.4-74.56-44.75-111.83-67.13-6.4-3.83-10.36-11.35-9.78-18.79 0.31-8.57 6.75-16.33 15-18.48zM405.42 481.48c8.67-1.08 17.67 4.03 21.1 12.09 4.57 9.77-0.18 22.57-10.12 26.85-33.02 15.3-66.04 30.58-99.07 45.84-9.66 4.53-22.34-0.1-26.68-9.87-4.95-9.45-0.72-22.17 8.73-26.97 30.72-14.34 61.56-28.44 92.31-42.72 4.46-1.98 8.79-4.61 13.73-5.22zM407.29 596.31c8.9-3.09 19.57 1.06 24.09 9.31 4.37 7.1 1.79 15.88 4.5 23.51 3.44 13.44 14.3 26.79 29.14 27.09 13.98 0.07 24.84-11.84 28.91-24.34 2.31-6.05 2.52-12.54 2.96-18.9 1.17-11.04 12.56-19.47 23.46-17.43 9.81 1.3 17.53 10.53 17.35 20.37-0.08 15.28 7.21 32.12 21.92 38.44 8.4 3.65 18.6 1.7 25.5-4.2 10.37-8.44 15.16-22.11 15.17-35.21 0.14-10.37 9.36-19.53 19.73-19.62 10.15-0.64 19.85 7.53 21.03 17.62 2.16 35.45-20.4 73.22-55.9 82.28-24.72 6.92-51.53-3.48-68.08-22.38-10.45 11.74-24.48 20.62-40.07 23.39-17.51 3.32-36.18-1.22-50.48-11.76-21.88-15.69-33.94-42.91-33.43-69.55 0.28-8.35 6.19-16.17 14.2-18.62z" fill="#454545" p-id="4474"></path></svg>
                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://github.com/IsUnderAchiever'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>ä¸»é¡µ</span>
            </a>
        </li>
        
        
        <li >
            <a href='/%E5%85%B3%E4%BA%8E/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>å…³äº</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>å½’æ¡£</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>æœç´¢</span>
            </a>
        </li>
        
        
        <li >
            <a href='/%E9%93%BE%E6%8E%A5/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>é“¾æ¥</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">
                    
                        <li id="i18n-switch">  
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M4 5h7" />
  <path d="M9 3v2c0 4.418 -2.239 8 -5 8" />
  <path d="M5 9c-.003 2.144 2.952 3.908 6.7 4" />
  <path d="M12 20l4 -9l4 9" />
  <path d="M19.1 18h-6.2" />
</svg>



                            <select name="language" title="language" onchange="window.location.href = this.selectedOptions[0].value">
                                
                                    <option value="https://IsUnderAchiever.github.io/en/" >English</option>
                                
                                    <option value="https://IsUnderAchiever.github.io/" selected>ä¸­æ–‡</option>
                                
                            </select>
                        </li>
                    
                

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>æš—è‰²æ¨¡å¼</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">ç›®å½•</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#åˆè¯†sentinel">åˆè¯†Sentinel</a>
      <ol>
        <li><a href="#é›ªå´©é—®é¢˜">é›ªå´©é—®é¢˜</a></li>
        <li><a href="#æŠ€æœ¯é€‰å‹">æŠ€æœ¯é€‰å‹</a></li>
        <li><a href="#å®‰è£…sentinel">å®‰è£…Sentinel</a></li>
      </ol>
    </li>
    <li><a href="#åˆ›å»ºé¡¹ç›®">åˆ›å»ºé¡¹ç›®</a></li>
    <li><a href="#ç°‡ç‚¹é“¾è·¯">ç°‡ç‚¹é“¾è·¯</a></li>
    <li><a href="#æµæ§æ¨¡å¼">æµæ§æ¨¡å¼</a>
      <ol>
        <li><a href="#å…³è”æ¨¡å¼">å…³è”æ¨¡å¼</a></li>
        <li><a href="#é“¾è·¯æ¨¡å¼">é“¾è·¯æ¨¡å¼</a></li>
      </ol>
    </li>
    <li><a href="#æµæ§æ•ˆæœ">æµæ§æ•ˆæœ</a>
      <ol>
        <li><a href="#æ¦‚å¿µ">æ¦‚å¿µ</a></li>
        <li><a href="#é¢„çƒ­æ¨¡å¼warm-up">é¢„çƒ­æ¨¡å¼warm up</a></li>
        <li><a href="#æ’é˜Ÿç­‰å¾…">æ’é˜Ÿç­‰å¾…</a></li>
        <li><a href="#æ€»ç»“">æ€»ç»“</a></li>
      </ol>
    </li>
    <li><a href="#çƒ­ç‚¹å‚æ•°é™æµ">çƒ­ç‚¹å‚æ•°é™æµ</a></li>
    <li><a href="#éš”ç¦»å’Œé™çº§">éš”ç¦»å’Œé™çº§</a></li>
    <li><a href="#çº¿ç¨‹éš”ç¦»">çº¿ç¨‹éš”ç¦»</a></li>
    <li><a href="#ç†”æ–­é™çº§">ç†”æ–­é™çº§</a>
      <ol>
        <li><a href="#æ¦‚å¿µ-1">æ¦‚å¿µ</a></li>
        <li><a href="#ç†”æ–­ç­–ç•¥--æ…¢è°ƒç”¨">ç†”æ–­ç­–ç•¥&ndash;æ…¢è°ƒç”¨</a></li>
        <li><a href="#ç†”æ–­ç­–ç•¥--å¼‚å¸¸æ¯”ä¾‹å¼‚å¸¸æ•°">ç†”æ–­ç­–ç•¥&ndash;å¼‚å¸¸æ¯”ä¾‹ã€å¼‚å¸¸æ•°</a></li>
        <li><a href="#æ€»ç»“-1">æ€»ç»“</a></li>
      </ol>
    </li>
    <li><a href="#æˆæƒè§„åˆ™">æˆæƒè§„åˆ™</a></li>
    <li><a href="#è‡ªå®šä¹‰å¼‚å¸¸ç»“æœ">è‡ªå®šä¹‰å¼‚å¸¸ç»“æœ</a></li>
    <li><a href="#è§„åˆ™æŒä¹…åŒ–">è§„åˆ™æŒä¹…åŒ–</a>
      <ol>
        <li><a href="#æ¦‚å¿µ-2">æ¦‚å¿µ</a>
          <ol>
            <li><a href="#pullæ¨¡å¼">pullæ¨¡å¼</a></li>
            <li><a href="#pushæ¨¡å¼">pushæ¨¡å¼</a></li>
            <li><a href="#æ€»ç»“-2">æ€»ç»“</a></li>
          </ol>
        </li>
        <li><a href="#å®ç°pushæ¨¡å¼">å®ç°pushæ¨¡å¼</a></li>
      </ol>
    </li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="has-image main-article">
    <header class="article-header">
    <div class="article-image">
        <a href="/p/sentinel/">
            <img src="/p/sentinel/202412212132620_hu701254416230554796.png" srcset="/p/sentinel/202412212132620_hu701254416230554796.png 800w, /p/sentinel/202412212132620_hu13517439120624731598.png 1600w"  width="800"
                height="419" loading="lazy" alt="Featured image of post Sentinel" />
            
        </a>
    </div>
    

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/sentinel/" style="background-color: #2a9d8f; color: #fff;">
                Sentinel
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/sentinel/">Sentinel</a>
        </h2>
    
        
        <h3 class="article-subtitle">
            Sentinel
        </h3>
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">2024-04-10</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    é˜…è¯»æ—¶é•¿: 20 åˆ†é’Ÿ
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
<script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>


    <section class="article-content">
    
    
    <h1 id="sentinel">Sentinel
</h1><h2 id="åˆè¯†sentinel">åˆè¯†Sentinel
</h2><h3 id="é›ªå´©é—®é¢˜">é›ªå´©é—®é¢˜
</h3><blockquote>
<p>æ•…éšœçš„æœåŠ¡Dï¼Œä¼šå¯¼è‡´æœåŠ¡Açš„tomcatèµ„æºè€—å°½</p>
<p>å¾®æœåŠ¡è°ƒç”¨é“¾è·¯ä¸­çš„æŸä¸ªæœåŠ¡æ•…éšœï¼Œå¼•èµ·æ•´ä¸ªé“¾è·¯ä¸­çš„æ‰€æœ‰å¾®æœåŠ¡éƒ½ä¸å¯ç”¨ï¼Œè¿™å°±æ˜¯<code>é›ªå´©</code>ã€‚

<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240403074558194.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240403074558194.png" alt="image-20240403074558194"  />
	</a>
</div>

<strong>è§£å†³é›ªå´©é—®é¢˜çš„å¸¸è§æ–¹å¼æœ‰å››ç§:</strong></p>
</blockquote>
<ol>
<li>è¶…æ—¶å¤„ç†:è®¾å®šè¶…æ—¶æ—¶é—´ï¼Œè¯·æ±‚è¶…è¿‡-å®šæ—¶é—´æ²¡æœ‰å“åº”å°±è¿”å›é”™è¯¯ä¿¡æ¯ï¼Œä¸ä¼šæ— ä¼‘æ­¢ç­‰å¾…</li>
<li>èˆ±å£æ¨¡å¼:é™å®šæ¯ä¸ªä¸šåŠ¡èƒ½ä½¿ç”¨çš„çº¿ç¨‹æ•°,é¿å…è€—å°½æ•´ä¸ªtomcatçš„èµ„æºï¼Œå› æ­¤ä¹Ÿå«çº¿ç¨‹éš”ç¦»ã€‚</li>
<li>ç†”æ–­é™çº§:ç”±æ–­è·¯å™¨ç»Ÿè®¡ä¸šåŠ¡æ‰§è¡Œçš„å¼‚å¸¸æ¯”ä¾‹ï¼Œå¦‚æœè¶…å‡ºé˜ˆå€¼åˆ™ä¼šç†”æ–­è¯¥ä¸šåŠ¡ï¼Œæ‹¦æˆªè®¿é—®è¯¥ä¸šåŠ¡çš„ä¸€åˆ‡è¯·æ±‚ã€‚</li>
<li>æµé‡æ§åˆ¶:é™åˆ¶ä¸šåŠ¡è®¿é—®çš„QPSï¼Œé¿å…æœåŠ¡å› æµé‡çš„çªå¢è€Œæ•…éšœã€‚</li>
</ol>
<h3 id="æŠ€æœ¯é€‰å‹">æŠ€æœ¯é€‰å‹
</h3><p>
<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240403075332866.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240403075332866.png" alt="image-20240403075332866"  />
	</a>
</div>
</p>
<blockquote>
<p>åŒç±»å‹çš„æ¡†æ¶è¿˜æœ‰<code>Resilience4j</code>ã€<code>Polly</code>ã€<code>Envoy</code>ç­‰</p>
</blockquote>
<h3 id="å®‰è£…sentinel">å®‰è£…Sentinel
</h3><p><a class="link" href="https://github.com/alibaba/Sentinel/releases"  target="_blank" rel="noopener" >Sentinelä¸‹è½½åœ°å€</a>ï¼Œé€‰æ‹©<code>sentinel-dashboard-xxx.jar</code>ï¼Œè‡ªå·±æ–°å»ºä¸€ä¸ª<code>startup.txt</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">java -jar sentinel-dashboard-1.8.5.jar
</span></span></code></pre></td></tr></table>
</div>
</div><p>
<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240403080118647.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240403080118647.png" alt="image-20240403080118647"  />
	</a>
</div>
</p>
<blockquote>
<p>ç„¶åå°†<code>startup.txt</code>åç¼€æ”¹ä¸º<code>bat</code>ï¼ŒåŒå‡»è¿è¡Œ</p>
<p>æˆ–è€…è‡ªå®šä¹‰å¯åŠ¨ç«¯å£å·</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">java -Dserver.port<span class="o">=</span><span class="m">8718</span> -jar sentinel-dashboard-1.8.5.jar
</span></span></code></pre></td></tr></table>
</div>
</div><p>
<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240403080917682.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240403080917682.png" alt="image-20240403080917682"  />
	</a>
</div>
</p>
<blockquote>
<p>è´¦å·å¯†ç é»˜è®¤æ˜¯<code>sentinel</code>

<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240403081023548.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240403081023548.png" alt="image-20240403081023548"  />
	</a>
</div>

<strong>é…ç½®å¼€æœºè‡ªå¯åŠ¨</strong>
<a class="link" href="https://blog.csdn.net/qq_52288743/article/details/131084881#:~:text=Win%20%2B%20R%20%E8%BE%93%E5%85%A5%E4%BB%A5%E4%B8%8B%E5%91%BD%E4%BB%A4%20%E5%9B%9E%E8%BD%A6%20shell%3ACommon%20Startup%20%E9%99%84%E5%8A%A0%EF%BC%9A%E5%A6%82%E9%9C%80%E6%9A%82%E5%81%9C%E8%87%AA%E5%90%AF%E5%8A%A8%E5%8F%AF%E4%BB%A5%E5%9C%A8%E4%BB%BB%E5%8A%A1%E7%AE%A1%E7%90%86%E5%99%A8%E8%BF%9B%E8%A1%8C%E5%85%B3%E9%97%AD,%E5%9C%A8%20%E5%90%AF%E5%8A%A8%20%E5%90%8E%EF%BC%8C%E6%82%A8%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87%E8%AE%BF%E9%97%AE%20Sentinel%20%E7%9A%84%E6%8E%A7%E5%88%B6%E5%8F%B0%E6%9D%A5%E6%9F%A5%E7%9C%8B%E7%9B%91%E6%8E%A7%E6%95%B0%E6%8D%AE%E5%92%8C%E9%85%8D%E7%BD%AE%E4%BF%A1%E6%81%AF%E3%80%82%20%E9%BB%98%E8%AE%A4%E6%83%85%E5%86%B5%E4%B8%8B%EF%BC%8C%20Sentinel%20%E7%9A%84%E6%8E%A7%E5%88%B6%E5%8F%B0%E5%9C%B0%E5%9D%80%E4%B8%BA%EF%BC%9Ahttp%3A%2F%2Flocalhost%3A8080%E3%80%82"  target="_blank" rel="noopener" >åšå®¢é“¾æ¥</a></p>
</blockquote>
<h2 id="åˆ›å»ºé¡¹ç›®">åˆ›å»ºé¡¹ç›®
</h2><blockquote>
<p>åœ¨<code>order</code>æœåŠ¡å¯¼å…¥<code>sentinel</code>ä¾èµ–ï¼Œå¹¶é…ç½®<code>application.properties</code>
ç„¶åè®¿é—®ä¸€ä¸‹<code>order</code>æœåŠ¡çš„<code>controller</code> http://localhost:8090/order/1</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl">        <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;groupId&gt;</span>com.alibaba.cloud<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-alibaba-sentinel<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/dependency&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-properties" data-lang="properties"><span class="line"><span class="cl"><span class="c1"># é…ç½®æ§åˆ¶å°åœ°å€</span>
</span></span><span class="line"><span class="cl"><span class="na">spring.cloud.sentinel.transport.dashboard</span><span class="o">=</span><span class="s">localhost:8089</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>
<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240407204039706.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240407204039706.png" alt="image-20240407204039706"  />
	</a>
</div>
</p>
<blockquote>
<p>sentinelä¸»è¦é‡‡ç”¨<code>çº¿ç¨‹æ± éš”ç¦»</code>ã€<code>ç†”æ–­é™çº§</code>ã€<code>æµé‡æ§åˆ¶</code>çš„æ–¹å¼æ¥è§£å†³é›ªå´©é—®é¢˜</p>
</blockquote>
<h2 id="ç°‡ç‚¹é“¾è·¯">ç°‡ç‚¹é“¾è·¯
</h2><p>ç°‡ç‚¹é“¾è·¯:å°±æ˜¯é¡¹ç›®å†…çš„è°ƒç”¨é“¾è·¯,é“¾è·¯ä¸­è¢«ç›‘æ§çš„æ¯ä¸ªæ¥å£å°±æ˜¯ä¸€ä¸ªèµ„æºã€‚ é»˜è®¤æƒ…å†µä¸‹sentinelä¼šç›‘æ§SpringMVCçš„æ¯ä¸€ä¸ªç«¯ç‚¹(Endpoint) ï¼Œå› æ­¤SpringMVCçš„æ¯ä¸€ä¸ªç«¯ç‚¹(Endpoint)å°±æ˜¯è°ƒç”¨é“¾è·¯ä¸­çš„ä¸€-ä¸ªèµ„æºã€‚
æµæ§ã€ç†”æ–­ç­‰éƒ½æ˜¯é’ˆå¯¹ç°‡ç‚¹é“¾è·¯ä¸­çš„èµ„æºæ¥è®¾ç½®çš„ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ç‚¹å‡»å¯¹åº”èµ„æºåé¢çš„æŒ‰é’®æ¥è®¾ç½®è§„åˆ™:
<strong>éœ€æ±‚</strong>:ç»™/order/{orderld}è¿™ä¸ªèµ„æºè®¾ç½®æµæ§è§„åˆ™ï¼ŒQPSä¸èƒ½è¶…è¿‡5ã€‚ç„¶åè¿›è¡Œå‹åŠ›æµ‹è¯•ã€‚

<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240407205129957.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240407205129957.png" alt="image-20240407205129957"  />
	</a>
</div>


<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240407210436655.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240407210436655.png" alt="image-20240407210436655"  />
	</a>
</div>


<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240407210503016.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240407210503016.png" alt="image-20240407210503016"  />
	</a>
</div>
</p>
<h2 id="æµæ§æ¨¡å¼">æµæ§æ¨¡å¼
</h2><blockquote>
<p>åœ¨æ·»åŠ é™æµè§„åˆ™æ—¶ï¼Œç‚¹å‡»é«˜çº§é€‰é¡¹ï¼Œå¯ä»¥é€‰æ‹©ä¸‰ç§æµæ§æ¨¡å¼:</p>
</blockquote>
<ol>
<li><code>ç›´æ¥</code>:ç»Ÿè®¡å½“å‰èµ„æºçš„è¯·æ±‚ï¼Œè§¦å‘é˜ˆå€¼æ—¶å¯¹å½“å‰èµ„æºç›´æ¥é™æµï¼Œä¹Ÿæ˜¯é»˜è®¤çš„æ¨¡å¼</li>
<li><code>å…³è”</code>:ç»Ÿè®¡ä¸å½“å‰èµ„æºç›¸å…³çš„å¦ä¸€ä¸€ä¸ªèµ„æºï¼Œè§¦å‘é˜ˆå€¼æ—¶ï¼Œå¯¹å½“å‰èµ„æºé™æµ</li>
<li><code>é“¾è·¯</code>:ç»Ÿè®¡ä»æŒ‡å®šé“¾è·¯è®¿é—®åˆ°æœ¬èµ„æºçš„è¯·æ±‚ï¼Œè§¦å‘é˜ˆå€¼æ—¶,å¯¹æŒ‡å®šé“¾è·¯é™æµ</li>
</ol>
<h3 id="å…³è”æ¨¡å¼">å…³è”æ¨¡å¼
</h3><p>ç»Ÿè®¡ä¸å½“å‰èµ„æºç›¸å…³çš„å¦ä¸€ä¸ªèµ„æºï¼Œè§¦å‘é˜ˆå€¼æ—¶ï¼Œå¯¹å½“å‰èµ„æºé™æµ
ä½¿ç”¨åœºæ™¯:æ¯”å¦‚ç”¨æˆ·æ”¯ä»˜æ—¶éœ€è¦ä¿®æ”¹è®¢å•çŠ¶æ€ï¼ŒåŒæ—¶ç”¨æˆ·è¦æŸ¥è¯¢è®¢å•ã€‚æŸ¥è¯¢å’Œä¿®æ”¹æ“ä½œä¼šäº‰æŠ¢æ•°æ®åº“é”,äº§ç”Ÿç«äº‰ã€‚ä¸šåŠ¡éœ€æ±‚æ˜¯æœ‰é™æ”¯ä»˜å’Œæ›´æ–°è®¢å•çš„ä¸šåŠ¡,å› æ­¤å½“ä¿®æ”¹è®¢å•ä¸šåŠ¡è§¦å‘é˜ˆå€¼æ—¶ï¼Œéœ€è¦å¯¹æŸ¥è¯¢è®¢å•ä¸šåŠ¡é™æµï¼Œé˜²æ­¢å½±å“åˆ°æ›´æ–°è®¢å•çš„ä¸šåŠ¡ã€‚

<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240407210759266.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240407210759266.png" alt="image-20240407210759266"  />
	</a>
</div>

<strong>éœ€æ±‚</strong></p>
<ol>
<li>åœ¨OrderControlleræ–°å»ºä¸¤ä¸ªç«¯ç‚¹: <code>/order/query</code>å’Œ<code>/order/update</code>, æ— éœ€å®ç°ä¸šåŠ¡</li>
<li>é…ç½®æµæ§è§„åˆ™ï¼Œå½“<code>/order/update</code>èµ„æºè¢«è®¿é—®çš„QPSè¶…è¿‡5æ—¶ï¼Œå¯¹<code>/order/query</code>è¯·æ±‚é™æµ</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RefreshScope</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@RestController</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&#34;order&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">OrdersController</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Autowired</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">OrdersService</span><span class="w"> </span><span class="n">ordersService</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Autowired</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">UserFeignClient</span><span class="w"> </span><span class="n">userFeignClient</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/{id}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Orders</span><span class="w"> </span><span class="nf">findOne</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Orders</span><span class="w"> </span><span class="n">orders</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ordersService</span><span class="p">.</span><span class="na">getById</span><span class="p">(</span><span class="n">id</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">userFeignClient</span><span class="p">.</span><span class="na">findOne</span><span class="p">(</span><span class="n">orders</span><span class="p">.</span><span class="na">getUserId</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">orders</span><span class="p">.</span><span class="na">setUser</span><span class="p">(</span><span class="n">user</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">orders</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/query&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">query</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;æŸ¥è¯¢è®¢å•æˆåŠŸ&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/update&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">update</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;æ›´æ–°è®¢å•æˆåŠŸ&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>ç„¶åè®¿é—®ä¸€ä¸‹ http://localhost:8090/order/query å’Œ http://localhost:8090/order/updateã€</p>
<p>å¯¹<code>/order/query</code>æ·»åŠ æµæ§

<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240407211433491.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240407211433491.png" alt="image-20240407211433491"  />
	</a>
</div>


<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240407211555637.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240407211555637.png" alt="image-20240407211555637"  />
	</a>
</div>


<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240407211548557.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240407211548557.png" alt="image-20240407211548557"  />
	</a>
</div>

å¯¹<code>update</code>å‹åŠ›æµ‹è¯•ï¼Œé™æµ<code>query</code></p>
<p>æ»¡è¶³ä¸‹é¢æ¡ä»¶å¯ä»¥ä½¿ç”¨å…³è”æ¨¡å¼:</p>
<ol>
<li>ä¸¤ä¸ªæœ‰ç«äº‰å…³ç³»çš„èµ„æº</li>
<li>ä¸€ä¸ª<code>ä¼˜å…ˆçº§è¾ƒé«˜</code>ï¼Œä¸€ä¸ª<code>ä¼˜å…ˆçº§è¾ƒä½</code>ï¼Œæˆ‘ä»¬å¸Œæœ›å½“<code>ä¼˜å…ˆçº§é«˜</code>çš„<code>è§¦å‘é˜ˆå€¼</code>æ—¶ï¼Œå¯¹<code>ä¼˜å…ˆçº§ä½</code>çš„è¿›è¡Œ<code>é™æµ</code></li>
</ol>
</blockquote>
<h3 id="é“¾è·¯æ¨¡å¼">é“¾è·¯æ¨¡å¼
</h3><p>é“¾è·¯æ¨¡å¼:åªé’ˆå¯¹ä»æŒ‡å®šé“¾è·¯è®¿é—®åˆ°æœ¬èµ„æºçš„è¯·æ±‚åšç»Ÿè®¡ï¼Œåˆ¤æ–­æ˜¯å¦è¶…è¿‡é˜ˆå€¼ã€‚
ä¾‹å¦‚æœ‰ä¸¤æ¡è¯·æ±‚é“¾è·¯:
/test1 -&gt; /common
/test2 -&gt; /common
å¦‚æœåªå¸Œæœ›ç»Ÿè®¡ä»/test2è¿›å…¥åˆ°/commonçš„è¯·æ±‚ï¼Œåˆ™å¯ä»¥è¿™æ ·é…ç½®:

<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240407211931646.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240407211931646.png" alt="image-20240407211931646"  />
	</a>
</div>

<strong>éœ€æ±‚</strong>:æœ‰æŸ¥è¯¢è®¢å•å’Œåˆ›å»ºè®¢å•ä¸šåŠ¡,ä¸¤è€…éƒ½éœ€è¦æŸ¥è¯¢å•†å“ã€‚é’ˆå¯¹ä»æŸ¥è¯¢è®¢å•è¿›å…¥åˆ°æŸ¥è¯¢å•†å“çš„è¯·æ±‚ç»Ÿè®¡å¹¶è®¾ç½®é™æµã€‚
æ­¥éª¤:</p>
<ol>
<li>åœ¨OrderService ä¸­æ·»åŠ ä¸€ä¸ªqueryGoodsæ–¹æ³•ï¼Œä¸ç”¨å®ç°ä¸šåŠ¡</li>
<li>åœ¨OrderControllerä¸­ ï¼Œæ”¹é€ /order/queryç«¯ç‚¹ï¼Œè°ƒç”¨OrderServiceä¸­çš„queryGoodsæ–¹æ³•</li>
<li>åœ¨OrderControllerä¸­ æ·»åŠ ä¸€ä¸ª/order/saveçš„ç«¯ ç‚¹,è°ƒç”¨OrderServiceçš„queryGoodsæ–¹æ³•</li>
<li>ç»™queryGoodsè®¾ ç½®é™æµè§„åˆ™,ä»/order/queryè¿› å…¥queryGoodsçš„æ–¹æ³•é™åˆ¶QPSå¿…é¡»å°äº2</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">OrdersServiceImpl</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">ServiceImpl</span><span class="o">&lt;</span><span class="n">OrdersMapper</span><span class="p">,</span><span class="w"> </span><span class="n">Orders</span><span class="o">&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">implements</span><span class="w"> </span><span class="n">OrdersService</span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">queryGoods</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;æŸ¥è¯¢å•†å“æˆåŠŸ&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RefreshScope</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@RestController</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&#34;order&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">OrdersController</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Autowired</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">OrdersService</span><span class="w"> </span><span class="n">ordersService</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Autowired</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">UserFeignClient</span><span class="w"> </span><span class="n">userFeignClient</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/{id}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Orders</span><span class="w"> </span><span class="nf">findOne</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Orders</span><span class="w"> </span><span class="n">orders</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ordersService</span><span class="p">.</span><span class="na">getById</span><span class="p">(</span><span class="n">id</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">userFeignClient</span><span class="p">.</span><span class="na">findOne</span><span class="p">(</span><span class="n">orders</span><span class="p">.</span><span class="na">getUserId</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">orders</span><span class="p">.</span><span class="na">setUser</span><span class="p">(</span><span class="n">user</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">orders</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/query&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">query</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ordersService</span><span class="p">.</span><span class="na">queryGoods</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;æŸ¥è¯¢è®¢å•æˆåŠŸ&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/update&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">update</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;æ›´æ–°è®¢å•æˆåŠŸ&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/save&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">save</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">ordersService</span><span class="p">.</span><span class="na">queryGoods</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;åˆ›å»ºè®¢å•æˆåŠŸ&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>è€Œ<code>service</code>ä¸­çš„<code>queryGoods()</code>å¹¶æ²¡æœ‰è¢«<code>sentinel</code>ç›‘æ§ï¼Œæ— æ³•é…ç½®é™æµè§„åˆ™ï¼Œæ‰€ä»¥åº”è¯¥å¯¹å…¶è¿›è¡Œç›‘æ§
Sentinelé»˜è®¤åªæ ‡è®°Controllerä¸­çš„æ–¹æ³•ä¸ºèµ„æºï¼Œå¦‚æœè¦æ ‡è®°å…¶å®ƒæ–¹æ³•ï¼Œéœ€è¦åˆ©ç”¨<code>@SentinelResource</code>æ³¨è§£</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">OrdersServiceImpl</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">ServiceImpl</span><span class="o">&lt;</span><span class="n">OrdersMapper</span><span class="p">,</span><span class="w"> </span><span class="n">Orders</span><span class="o">&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">implements</span><span class="w"> </span><span class="n">OrdersService</span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@SentinelResource</span><span class="p">(</span><span class="s">&#34;goods&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">queryGoods</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;æŸ¥è¯¢å•†å“æˆåŠŸ&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Sentinelé»˜è®¤ä¼šå°†Controlleræ–¹æ³•åšcontextæ•´åˆ,å¯¼è‡´é“¾è·¯æ¨¡å¼çš„æµæ§å¤±æ•ˆ
å½“ Sentinel é»˜è®¤å¼€å¯ <code>web-context-unify</code> æ—¶ï¼Œä¼šå°†æ‰€æœ‰ Controller æ–¹æ³•çš„ä¸Šä¸‹æ–‡è·¯å¾„è¿›è¡Œæ•´åˆï¼Œè¿™æ„å‘³ç€æ‰€æœ‰é€šè¿‡ Controller çš„è°ƒç”¨éƒ½ä¼šè¢«è§†ä½œä¸€ä¸ªç»Ÿä¸€çš„èµ„æºè·¯å¾„ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´é“¾è·¯æ¨¡å¼ä¸‹çš„æµæ§è§„åˆ™å¤±æ•ˆã€‚
å…·ä½“æ¥è¯´ï¼Œå‡è®¾ä½ æœ‰ä¸€ä¸ªæœåŠ¡å†…éƒ¨æœ‰å¤šä¸ªæ¥å£ç›¸äº’è°ƒç”¨å½¢æˆäº†ä¸€æ¡è°ƒç”¨é“¾è·¯ï¼Œå¦‚ <code>/save -&gt; /goods</code> å’Œ <code>/query -&gt; /goods</code>ï¼Œå¦‚æœä½ æƒ³è¦é’ˆå¯¹ <code>/query </code> è°ƒç”¨åˆ° <code>/goods</code> çš„è¿™æ¡ç‰¹å®šè°ƒç”¨é“¾è·¯è®¾ç½®æµé‡æ§åˆ¶ï¼Œé‚£ä¹ˆåœ¨ context æ•´åˆçš„æƒ…å†µä¸‹ï¼ŒSentinel æ— æ³•åŒºåˆ†è¿™ä¸¤ä¸ªä¸åŒçš„è°ƒç”¨é“¾è·¯ï¼Œå› ä¸ºå®ƒä»¬åœ¨ä¸Šä¸‹æ–‡è·¯å¾„ä¸Šéƒ½è¢«è§†ä¸ºåŒä¸€ä¸ªèµ„æºã€‚
éœ€è¦ä¿®æ”¹<code>application.properties</code>,æ·»åŠ é…ç½®</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-properties" data-lang="properties"><span class="line"><span class="cl"><span class="c1"># é…ç½®æ§åˆ¶å°åœ°å€</span>
</span></span><span class="line"><span class="cl"><span class="na">spring.cloud.sentinel.transport.dashboard</span><span class="o">=</span><span class="s">localhost:8089</span>
</span></span><span class="line"><span class="cl"><span class="c1"># å…³é—­ context æ•´åˆ</span>
</span></span><span class="line"><span class="cl"><span class="na">spring.cloud.sentinel.web-context-unify</span><span class="o">=</span><span class="s">false</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>å¦‚æœä¸å…³é—­<code>contextæ•´åˆ</code>ï¼Œæ‰€æœ‰çš„<code>controller</code>ä¼šè¢«è®¤ä¸ºæ˜¯åŒä¸€ä¸ªæ ¹é“¾è·¯å‘å±•è€Œæ¥çš„å­é“¾è·¯</p>
<p>è®¿é—®ä¸€ä¸‹ http://localhost:8090/order/query å’Œ http://localhost:8090/order/save

<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240407212903207.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240407212903207.png" alt="image-20240407212903207"  />
	</a>
</div>


<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240407213029296.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240407213029296.png" alt="image-20240407213029296"  />
	</a>
</div>

åˆ é™¤å…¶ä»–çš„æµæ§è§„åˆ™

<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240407213116501.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240407213116501.png" alt="image-20240407213116501"  />
	</a>
</div>

ä½¿ç”¨<code>Jmeter</code>è¿›è¡Œå‹åŠ›æµ‹è¯•
<strong>/order/save</strong>

<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240407213258792.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240407213258792.png" alt="image-20240407213258792"  />
	</a>
</div>

<strong>/order/query</strong>

<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240407213305172.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240407213305172.png" alt="image-20240407213305172"  />
	</a>
</div>

<strong>æ€»ç»“</strong>
ç›´æ¥:å¯¹å½“å‰èµ„æºé™æµ
å…³è”:é«˜ä¼˜å…ˆçº§èµ„æºè§¦å‘é˜ˆå€¼ï¼Œå¯¹ä½ä¼˜å…ˆçº§èµ„æºé™æµã€‚
é“¾è·¯:é˜ˆå€¼ç»Ÿè®¡æ—¶ï¼Œåªç»Ÿè®¡ä»æŒ‡å®šèµ„æºè¿›å…¥å½“å‰èµ„æºçš„è¯·æ±‚æ˜¯å¯¹è¯·æ±‚æ¥æºçš„é™æµ</p>
</blockquote>
<h2 id="æµæ§æ•ˆæœ">æµæ§æ•ˆæœ
</h2><h3 id="æ¦‚å¿µ">æ¦‚å¿µ
</h3><p>æµæ§æ•ˆæœæ˜¯æŒ‡è¯·æ±‚è¾¾åˆ°æµæ§é˜ˆå€¼æ—¶åº”è¯¥é‡‡å–çš„æªæ–½ï¼ŒåŒ…æ‹¬ä¸‰ç§:</p>
<ol>
<li><code>å¿«é€Ÿå¤±è´¥</code>:è¾¾åˆ°é˜ˆå€¼åï¼Œæ–°çš„è¯·æ±‚ä¼šè¢«ç«‹å³æ‹’ç»å¹¶æ‹‹å‡ºFlowExceptionå¼‚å¸¸ã€‚æ˜¯é»˜è®¤çš„å¤„ç†æ–¹å¼ã€‚</li>
<li><code>warm up</code>:é¢„çƒ­æ¨¡å¼ï¼Œå¯¹è¶…å‡ºé˜ˆå€¼çš„è¯·æ±‚åŒæ ·æ˜¯æ‹’ç»å¹¶æŠ›å‡ºå¼‚å¸¸ã€‚ä½†è¿™ç§æ¨¡å¼é˜ˆå€¼ä¼šåŠ¨æ€å˜åŒ–ï¼Œä»ä¸€-ä¸ªè¾ƒå°å€¼é€æ¸å¢åŠ åˆ°æœ€å¤§é˜ˆå€¼ã€‚</li>
<li><code>æ’é˜Ÿç­‰å¾…</code>:è®©æ‰€æœ‰çš„è¯·æ±‚æŒ‰ç…§å…ˆåæ¬¡åºæ’é˜Ÿæ‰§è¡Œï¼Œä¸¤ä¸ªè¯·æ±‚çš„é—´éš”ä¸èƒ½å°äºæŒ‡å®šæ—¶é•¿</li>
</ol>
<h3 id="é¢„çƒ­æ¨¡å¼warm-up">é¢„çƒ­æ¨¡å¼warm up
</h3><p>warm upä¹Ÿå«é¢„çƒ­æ¨¡å¼ï¼Œæ˜¯åº”å¯¹æœåŠ¡å†·å¯åŠ¨çš„ä¸€ç§æ–¹æ¡ˆã€‚<code>threshold</code>ä¸ºæœ€å¤§é˜ˆå€¼ï¼Œ<code>coldFactor</code>ä¸ºå†·å¯åŠ¨å› å­ï¼Œè¯·æ±‚é˜ˆå€¼åˆå§‹å€¼æ˜¯<code>threshold/coldFactor</code>,æŒç»­æŒ‡å®šæ—¶é•¿åï¼Œé€æ¸æé«˜åˆ°<code>threshold</code>å€¼ã€‚è€Œ<code>coldFactor</code>çš„é»˜è®¤å€¼æ˜¯3.
ä¾‹å¦‚ï¼Œæˆ‘è®¾ç½®QPSçš„<code>threshold</code>ä¸º10ï¼Œé¢„çƒ­æ—¶é—´ä¸º5ç§’,é‚£ä¹ˆ<code>åˆå§‹é˜ˆå€¼</code>å°±æ˜¯<code>10/3</code>ï¼Œä¹Ÿå°±æ˜¯3,ç„¶ååœ¨5ç§’åé€æ¸å¢é•¿åˆ°10

<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240408064325063.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240408064325063.png" alt="image-20240408064325063"  />
	</a>
</div>

<strong>éœ€æ±‚</strong>
ç»™<code>/order/{id}</code>è¿™ä¸ªèµ„æºè®¾ç½®é™æµ,æœ€å¤§QPSä¸º10,åˆ©ç”¨warm upæ•ˆæœ,é¢„çƒ­æ—¶é•¿ä¸º5ç§’

<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240408065105430.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240408065105430.png" alt="image-20240408065105430"  />
	</a>
</div>


<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240408065329162.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240408065329162.png" alt="image-20240408065329162"  />
	</a>
</div>


<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240408065457513.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240408065457513.png" alt="image-20240408065457513"  />
	</a>
</div>


<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240408065517390.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240408065517390.png" alt="image-20240408065517390"  />
	</a>
</div>
</p>
<h3 id="æ’é˜Ÿç­‰å¾…">æ’é˜Ÿç­‰å¾…
</h3><p>å½“è¯·æ±‚è¶…è¿‡QPSé˜ˆå€¼æ—¶ï¼Œå¿«é€Ÿå¤±è´¥å’Œwarm upä¼šæ‹’ç»æ–°çš„è¯·æ±‚å¹¶æŠ›å‡ºå¼‚å¸¸ã€‚è€Œæ’é˜Ÿç­‰å¾…åˆ™æ˜¯è®©æ‰€æœ‰è¯·æ±‚è¿›å…¥ä¸€ä¸ªé˜Ÿåˆ—ä¸­,ç„¶åæŒ‰ç…§é˜ˆå€¼å…è®¸çš„æ—¶é—´é—´éš”ä¾æ¬¡æ‰§è¡Œã€‚åæ¥çš„è¯·æ±‚å¿…é¡»ç­‰å¾…å‰é¢æ‰§è¡Œå®Œæˆï¼Œå¦‚æœè¯·æ±‚é¢„æœŸçš„ç­‰å¾…æ—¶é—´è¶…å‡ºæœ€å¤§æ—¶é•¿,åˆ™ä¼šè¢«æ‹’ç»ã€‚
ä¾‹å¦‚: QPS=5,æ„å‘³ç€æ¯<code>200ms</code>å¤„ç†ä¸€ä¸ªé˜Ÿåˆ—ä¸­çš„è¯·æ±‚; timeout = 2000ï¼Œ æ„å‘³ç€é¢„æœŸç­‰å¾…è¶…è¿‡2000msçš„è¯·æ±‚ä¼šè¢«æ‹’ç»å¹¶æŠ›å‡ºå¼‚å¸¸

<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240408065759385.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240408065759385.png" alt="image-20240408065759385"  />
	</a>
</div>


<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240408065827751.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240408065827751.png" alt="image-20240408065827751"  />
	</a>
</div>

<strong>éœ€æ±‚</strong>
ç»™<code>/order/{id}</code>è¿™ä¸ªèµ„æºè®¾ç½®é™æµï¼Œæœ€å¤§QPSä¸º10ï¼Œ åˆ©ç”¨æ’é˜Ÿçš„æµæ§æ•ˆæœï¼Œè¶…æ—¶æ—¶é•¿è®¾ç½®ä¸º5s

<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240408070509839.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240408070509839.png" alt="image-20240408070509839"  />
	</a>
</div>
</p>
<blockquote>
<p>è€Œ<code>Jmeter</code>é…ç½®çš„<code>QPS</code>æ˜¯15ï¼Œå¦‚æœæŒ‰ç…§ä¹‹å‰çš„æƒ…å†µï¼ˆç›´æ¥å¤±è´¥ï¼‰ï¼Œåˆ™ä¼šæœ‰<code>5</code>ä¸ª<code>QPS</code>æ— æ³•å¤„ç†

<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240408070703747.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240408070703747.png" alt="image-20240408070703747"  />
	</a>
</div>


<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240408070729937.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240408070729937.png" alt="image-20240408070729937"  />
	</a>
</div>

åˆ°åé¢è¯·æ±‚è¶…æ—¶åˆ™ä¼šç›´æ¥å¤±è´¥

<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240408070746902.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240408070746902.png" alt="image-20240408070746902"  />
	</a>
</div>


<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240408070809963.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240408070809963.png" alt="image-20240408070809963"  />
	</a>
</div>
</p>
</blockquote>
<h3 id="æ€»ç»“">æ€»ç»“
</h3><p>æµæ§æ•ˆæœæœ‰å“ªäº›ï¼Ÿ</p>
<ol>
<li>å¿«é€Ÿå¤±è´¥: QPSè¶…è¿‡é˜ˆå€¼æ—¶ï¼Œæ‹’ç»æ–°çš„è¯·æ±‚</li>
<li>warm up: QPSè¶…è¿‡é˜ˆå€¼æ—¶ï¼Œæ‹’ç»æ–°çš„è¯·æ±‚; QPSé˜ˆå€¼æ˜¯é€æ¸æå‡çš„ï¼Œå¯ä»¥é¿å…å†·å¯åŠ¨æ—¶é«˜å¹¶å‘å¯¼è‡´æœåŠ¡å®•æœºã€‚</li>
<li>æ’é˜Ÿç­‰å¾…:è¯·æ±‚ä¼šè¿›å…¥é˜Ÿåˆ—ï¼ŒæŒ‰ç…§é˜ˆå€¼å…è®¸çš„æ—¶é—´é—´éš”ä¾æ¬¡æ‰§è¡Œè¯·æ±‚;å¦‚æœè¯·æ±‚é¢„æœŸç­‰å¾…æ—¶é•¿å¤§äºè¶…æ—¶æ—¶é—´ï¼Œç›´æ¥æ‹’ç»</li>
</ol>
<h2 id="çƒ­ç‚¹å‚æ•°é™æµ">çƒ­ç‚¹å‚æ•°é™æµ
</h2><blockquote>
<p>ä¹‹å‰çš„é™æµæ˜¯ç»Ÿè®¡è®¿é—®æŸä¸ªèµ„æºçš„æ‰€æœ‰è¯·æ±‚ï¼Œåˆ¤æ–­æ˜¯å¦è¶…è¿‡QPSé˜ˆå€¼ã€‚è€Œçƒ­ç‚¹å‚æ•°é™æµæ˜¯åˆ†åˆ«ç»Ÿè®¡<code>å‚æ•°å€¼ç›¸åŒ</code>çš„è¯·æ±‚,åˆ¤æ–­æ˜¯å¦è¶…è¿‡QPSé˜ˆå€¼ã€‚

<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240408071109096.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240408071109096.png" alt="image-20240408071109096"  />
	</a>
</div>

<strong>æ¡ˆä¾‹</strong></p>
<p>ç»™<code>/order/{id}</code>è¿™ä¸ªèµ„æºæ·»åŠ çƒ­ç‚¹å‚æ•°é™æµï¼Œè§„åˆ™å¦‚ä¸‹:</p>
<ol>
<li>é»˜è®¤çš„çƒ­ç‚¹å‚æ•°è§„åˆ™æ˜¯æ¯1ç§’è¯·æ±‚é‡ä¸è¶…è¿‡<code>2</code></li>
<li>ç»™1è¿™ä¸ªå‚æ•°è®¾ç½®ä¾‹å¤–:æ¯1ç§’è¯·æ±‚é‡ä¸è¶…è¿‡<code>4</code></li>
<li>ç»™2è¿™ä¸ªå‚æ•°è®¾ç½®ä¾‹å¤–:æ¯1ç§’è¯·æ±‚é‡ä¸è¶…è¿‡<code>10</code></li>
</ol>
<p>éœ€è¦<code>æ³¨æ„</code>çš„æ˜¯<code>çƒ­ç‚¹å‚æ•°é™æµ</code>å¯¹é»˜è®¤çš„SpringMVCèµ„æºæ— æ•ˆï¼Œåªæœ‰é€šè¿‡<code>@SentinelResource</code>æ³¨è§£å£°æ˜çš„èµ„æºæ‰èƒ½ç”Ÿæ•ˆ</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RefreshScope</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@RestController</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&#34;order&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">OrdersController</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Autowired</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">OrdersService</span><span class="w"> </span><span class="n">ordersService</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Autowired</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">UserFeignClient</span><span class="w"> </span><span class="n">userFeignClient</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@SentinelResource</span><span class="p">(</span><span class="s">&#34;hot&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/{id}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Orders</span><span class="w"> </span><span class="nf">findOne</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Orders</span><span class="w"> </span><span class="n">orders</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ordersService</span><span class="p">.</span><span class="na">getById</span><span class="p">(</span><span class="n">id</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">userFeignClient</span><span class="p">.</span><span class="na">findOne</span><span class="p">(</span><span class="n">orders</span><span class="p">.</span><span class="na">getUserId</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">orders</span><span class="p">.</span><span class="na">setUser</span><span class="p">(</span><span class="n">user</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">orders</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>
<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240408072009011.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240408072009011.png" alt="image-20240408072009011"  />
	</a>
</div>
</p>
<blockquote>
<p>å¯ä»¥çœ‹åˆ°<code>/order/1</code>çš„<code>QPS</code>æ˜¯4

<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240408072731930.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240408072731930.png" alt="image-20240408072731930"  />
	</a>
</div>

å¯ä»¥çœ‹åˆ°<code>/order/2</code>çš„<code>QPS</code>æ˜¯10ï¼Œå…¨éƒ¨é€šè¿‡

<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240408072739726.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240408072739726.png" alt="image-20240408072739726"  />
	</a>
</div>

å¯ä»¥çœ‹åˆ°<code>/order/3</code>çš„<code>QPS</code>æ˜¯é»˜è®¤é˜ˆå€¼ï¼Œå³<code>2</code>

<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240408072747154.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240408072747154.png" alt="image-20240408072747154"  />
	</a>
</div>
</p>
</blockquote>
<h2 id="éš”ç¦»å’Œé™çº§">éš”ç¦»å’Œé™çº§
</h2><blockquote>
<p><strong>è™½ç„¶é™æµå¯ä»¥å°½é‡é¿å…å› é«˜å¹¶å‘è€Œå¼•èµ·çš„æœåŠ¡æ•…éšœï¼Œä½†æœåŠ¡è¿˜ä¼šå› ä¸ºå…¶å®ƒåŸå› è€Œæ•…éšœã€‚è€Œè¦å°†è¿™äº›æ•…éšœæ§åˆ¶åœ¨ä¸€å®šèŒƒå›´ï¼Œé¿å…é›ªå´©ï¼Œå°±è¦é çº¿ç¨‹éš”ç¦»(èˆ±å£æ¨¡å¼)å’Œç†”æ–­é™çº§æ‰‹æ®µäº†ã€‚</strong></p>
<p>ä¸ç®¡æ˜¯çº¿ç¨‹éš”ç¦»è¿˜æ˜¯ç†”æ–­é™çº§,éƒ½æ˜¯å¯¹<code>å®¢æˆ·ç«¯(è°ƒç”¨æ–¹ï¼Œç¤ºä¾‹ä¸­çš„æœåŠ¡A)</code>çš„ä¿æŠ¤ã€‚

<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240408073136305.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240408073136305.png" alt="image-20240408073136305"  />
	</a>
</div>

SpringCloudä¸­ï¼Œå¾®æœåŠ¡è°ƒç”¨éƒ½æ˜¯é€šè¿‡Feignæ¥å®ç°çš„ï¼Œå› æ­¤åšå®¢æˆ·ç«¯ä¿æŠ¤å¿…é¡»æ•´åˆFeignå’ŒSentinelã€‚</p>
</blockquote>
<ol>
<li>ä¿®æ”¹OrderServiceçš„<code>application.properties</code>æ–‡ä»¶ï¼Œå¼€å¯Feignçš„SentinelåŠŸèƒ½</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-properties" data-lang="properties"><span class="line"><span class="cl"><span class="na">feign.sentinel.enabled</span><span class="o">=</span><span class="s">true</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>ç»™FeignClientç¼–å†™å¤±è´¥åçš„é™çº§é€»è¾‘ï¼Œä½†è°ƒç”¨çš„æœåŠ¡å¼‚å¸¸æ—¶ï¼Œè¿”å›<code>å¤‡ç”¨</code>æ–¹æ¡ˆ
<ul>
<li>æ–¹å¼ä¸€: FallbackClass,æ— æ³•å¯¹è¿œç¨‹è°ƒç”¨çš„å¼‚å¸¸åšå¤„ç†</li>
<li>æ–¹å¼äºŒ: FallbackFactory,å¯ä»¥å¯¹è¿œç¨‹è°ƒç”¨çš„å¼‚å¸¸åšå¤„ç†ï¼Œæˆ‘ä»¬é€‰æ‹©è¿™ç§</li>
</ul>
</li>
<li>åœ¨<code>feign-api</code>é¡¹ç›®ä¸­å®šä¹‰ç±»ï¼Œå®ç°<code>FallbackFactory</code></li>
</ol>
<blockquote>
<p>ä¸å°‘æ•™ç¨‹å¯¼å…¥çš„æ˜¯<code>hystrix</code>åŒ…ä¸‹çš„<code>FallbackFactory</code>ï¼Œä½†æ˜¯<code>sentinel</code>å·²ç»ä¸å†ä½¿ç”¨<code>hystrix</code>ä¾èµ–äº†ï¼Œè€Œ<code>openfeign</code>åŒ…ä¸‹ä¹Ÿæœ‰ä¸€ä¸ª<code>FallbackFactory</code></p>
<p>ä¸ç¡®å®šæ˜¯ä¸æ˜¯è¿™ä¸ªåŸå› å¯¼è‡´åæ–‡æŠ¥é”™</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Slf4j</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">UserClientFallbackFactory</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">FallbackFactory</span><span class="o">&lt;</span><span class="n">UserFeignClient</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">UserFeignClient</span><span class="w"> </span><span class="nf">create</span><span class="p">(</span><span class="n">Throwable</span><span class="w"> </span><span class="n">cause</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">UserFeignClient</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="kd">public</span><span class="w"> </span><span class="n">User</span><span class="w"> </span><span class="nf">findOne</span><span class="p">(</span><span class="n">Integer</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&#34;findOneæ–¹æ³•å¼‚å¸¸ï¼Œæ‰§è¡Œé™çº§é€»è¾‘&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">User</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>åœ¨<code>feign-api</code>é¡¹ç›®ä¸­å°†<code>UserClientFallbackFactory</code>æ³¨å†Œä¸ºä¸€ä¸ªBean:
è¿™é‡Œæ²¡æœ‰åŠ <code>@Configuration</code>æ³¨è§£æ˜¯å› ä¸ºåœ¨<code>OrderApplication</code>é…ç½®äº†<code>@EnableFeignClients</code></li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">FeignClientConfiguration</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Bean</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Logger</span><span class="p">.</span><span class="na">Level</span><span class="w"> </span><span class="nf">feignLogLevel</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Logger</span><span class="p">.</span><span class="na">Level</span><span class="p">.</span><span class="na">BASIC</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Bean</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">UserClientFallbackFactory</span><span class="w"> </span><span class="nf">userClientFallbackFactory</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">UserClientFallbackFactory</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@EnableFeignClients</span><span class="p">(</span><span class="n">defaultConfiguration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FeignClientConfiguration</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">basePackageClasses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">UserFeignClient</span><span class="p">.</span><span class="na">class</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">})</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@EnableDiscoveryClient</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@MapperScan</span><span class="p">(</span><span class="s">&#34;com.example.order.mapper&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@SpringBootApplication</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">OrderApplication</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">SpringApplication</span><span class="p">.</span><span class="na">run</span><span class="p">(</span><span class="n">OrderApplication</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">args</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ol start="3">
<li>åœ¨<code>feign-api</code>é¡¹ç›®ä¸­çš„<code>UserClient</code>æ¥å£ä¸­ä½¿ç”¨<code>UserClientFallbackFactory</code>:</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@FeignClient</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;user-service&#34;</span><span class="p">,</span><span class="n">fallbackFactory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UserClientFallbackFactory</span><span class="p">.</span><span class="na">class</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">UserFeignClient</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/user/{id}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">User</span><span class="w"> </span><span class="nf">findOne</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;id&#34;</span><span class="p">)</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">id</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">org</span><span class="p">.</span><span class="na">springframework</span><span class="p">.</span><span class="na">beans</span><span class="p">.</span><span class="na">factory</span><span class="p">.</span><span class="na">UnsatisfiedDependencyException</span><span class="p">:</span><span class="w"> </span><span class="n">Error</span><span class="w"> </span><span class="n">creating</span><span class="w"> </span><span class="n">bean</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="err">&#39;</span><span class="n">consumerController</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="n">Unsatisfied</span><span class="w"> </span><span class="n">dependency</span><span class="w"> </span><span class="n">expressed</span><span class="w"> </span><span class="n">through</span><span class="w"> </span><span class="n">field</span><span class="w"> </span><span class="err">&#39;</span><span class="n">providerClient</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="n">Error</span><span class="w"> </span><span class="n">creating</span><span class="w"> </span><span class="n">bean</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="err">&#39;</span><span class="n">feignSentinelBuilder</span><span class="err">&#39;</span><span class="w"> </span><span class="n">defined</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="kd">class</span> <span class="nc">path</span><span class="w"> </span><span class="n">resource</span><span class="w"> </span><span class="o">[</span><span class="n">com</span><span class="o">/</span><span class="n">alibaba</span><span class="o">/</span><span class="n">cloud</span><span class="o">/</span><span class="n">sentinel</span><span class="o">/</span><span class="n">feign</span><span class="o">/</span><span class="n">SentinelFeignAutoConfiguration</span><span class="p">.</span><span class="na">class</span><span class="o">]</span><span class="p">:</span><span class="w"> </span><span class="n">Post</span><span class="o">-</span><span class="n">processing</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">merged</span><span class="w"> </span><span class="n">bean</span><span class="w"> </span><span class="n">definition</span><span class="w"> </span><span class="n">failed</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Caused</span><span class="w"> </span><span class="n">by</span><span class="p">:</span><span class="w"> </span><span class="n">org</span><span class="p">.</span><span class="na">springframework</span><span class="p">.</span><span class="na">beans</span><span class="p">.</span><span class="na">factory</span><span class="p">.</span><span class="na">BeanCreationException</span><span class="p">:</span><span class="w"> </span><span class="n">Error</span><span class="w"> </span><span class="n">creating</span><span class="w"> </span><span class="n">bean</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="err">&#39;</span><span class="n">feignSentinelBuilder</span><span class="err">&#39;</span><span class="w"> </span><span class="n">defined</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="kd">class</span> <span class="nc">path</span><span class="w"> </span><span class="n">resource</span><span class="w"> </span><span class="o">[</span><span class="n">com</span><span class="o">/</span><span class="n">alibaba</span><span class="o">/</span><span class="n">cloud</span><span class="o">/</span><span class="n">sentinel</span><span class="o">/</span><span class="n">feign</span><span class="o">/</span><span class="n">SentinelFeignAutoConfiguration</span><span class="p">.</span><span class="na">class</span><span class="o">]</span><span class="p">:</span><span class="w"> </span><span class="n">Post</span><span class="o">-</span><span class="n">processing</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">merged</span><span class="w"> </span><span class="n">bean</span><span class="w"> </span><span class="n">definition</span><span class="w"> </span><span class="n">failed</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Caused</span><span class="w"> </span><span class="n">by</span><span class="p">:</span><span class="w"> </span><span class="n">java</span><span class="p">.</span><span class="na">lang</span><span class="p">.</span><span class="na">IllegalStateException</span><span class="p">:</span><span class="w"> </span><span class="n">Failed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">introspect</span><span class="w"> </span><span class="n">Class</span><span class="w"> </span><span class="o">[</span><span class="n">com</span><span class="p">.</span><span class="na">alibaba</span><span class="p">.</span><span class="na">cloud</span><span class="p">.</span><span class="na">sentinel</span><span class="p">.</span><span class="na">feign</span><span class="p">.</span><span class="na">SentinelFeign$Builder</span><span class="o">]</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">ClassLoader</span><span class="w"> </span><span class="o">[</span><span class="n">jdk</span><span class="p">.</span><span class="na">internal</span><span class="p">.</span><span class="na">loader</span><span class="p">.</span><span class="na">ClassLoaders$AppClassLoader</span><span class="nd">@63947c6b</span><span class="o">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Caused</span><span class="w"> </span><span class="n">by</span><span class="p">:</span><span class="w"> </span><span class="n">java</span><span class="p">.</span><span class="na">lang</span><span class="p">.</span><span class="na">NoClassDefFoundError</span><span class="p">:</span><span class="w"> </span><span class="n">org</span><span class="o">/</span><span class="n">springframework</span><span class="o">/</span><span class="n">cloud</span><span class="o">/</span><span class="n">openfeign</span><span class="o">/</span><span class="n">FeignClientFactory</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Caused</span><span class="w"> </span><span class="n">by</span><span class="p">:</span><span class="w"> </span><span class="n">java</span><span class="p">.</span><span class="na">lang</span><span class="p">.</span><span class="na">ClassNotFoundException</span><span class="p">:</span><span class="w"> </span><span class="n">org</span><span class="p">.</span><span class="na">springframework</span><span class="p">.</span><span class="na">cloud</span><span class="p">.</span><span class="na">openfeign</span><span class="p">.</span><span class="na">FeignClientFactory</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="n">at</span><span class="w"> </span><span class="n">java</span><span class="p">.</span><span class="na">base</span><span class="o">/</span><span class="n">jdk</span><span class="p">.</span><span class="na">internal</span><span class="p">.</span><span class="na">loader</span><span class="p">.</span><span class="na">BuiltinClassLoader</span><span class="p">.</span><span class="na">loadClass</span><span class="p">(</span><span class="n">BuiltinClassLoader</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="n">641</span><span class="p">)</span><span class="w"> </span><span class="o">~[</span><span class="n">na</span><span class="p">:</span><span class="n">na</span><span class="o">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="n">at</span><span class="w"> </span><span class="n">java</span><span class="p">.</span><span class="na">base</span><span class="o">/</span><span class="n">jdk</span><span class="p">.</span><span class="na">internal</span><span class="p">.</span><span class="na">loader</span><span class="p">.</span><span class="na">ClassLoaders$AppClassLoader</span><span class="p">.</span><span class="na">loadClass</span><span class="p">(</span><span class="n">ClassLoaders</span><span class="p">.</span><span class="na">java</span><span class="p">:</span><span class="n">188</span><span class="p">)</span><span class="w"> </span><span class="o">~[</span><span class="n">na</span><span class="p">:</span><span class="n">na</span><span class="o">]</span><span class="w">    
</span></span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>è¿™é‡Œæ•´åˆfeignå„ç§æŠ¥é”™ï¼Œä¼°è®¡æ˜¯ç‰ˆæœ¬åŸå› </p>
<p>æˆ‘å°è¯•ä½¿ç”¨<code>2.3.12.RELEASE</code>çš„springbootæ˜¯å¯ä»¥å®ç°<code>feign + nacos + sentinel</code>çš„(è¿˜æ˜¯jdk17)</p>
<p>demoé“¾æ¥æ”¾åˆ°githubä¸Šäº†ï¼Œ<a class="link" href="https://github.com/IsUnderAchiever/sentinel-demo"  target="_blank" rel="noopener" >é“¾æ¥</a></p>
<p>åšäº†ä¸ª<code>springboot3ã€nacosã€openfeignã€sentinel</code>çš„demoï¼Œè¿˜æ˜¯ä¸Šé¢çš„è¿™ä¸ªé“¾æ¥ï¼Œè¯·åˆ‡æ¢<code>boot3</code>ç‰ˆæœ¬</p>
<p>springboot3æŠ¥é”™è§£å†³ï¼Œä¸ä½¿ç”¨<code>UserClientFallbackFactory</code>ï¼Œåˆ é™¤è¯¥æ–‡ä»¶ï¼Œ<code>feign.sentinel.enabled</code>é…ç½®ä¹Ÿåˆ é™¤</p>
<p>ä½¿ç”¨<code>@SentinelResource</code>é…åˆ<code>blockHandler</code>å±æ€§
<strong>åœ¨æœåŠ¡è¢«è°ƒç”¨æ–¹æ–°å¢</strong></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RestController</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&#34;provider&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ProviderController</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@SentinelResource</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;providerQuery&#34;</span><span class="p">,</span><span class="n">blockHandler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;blockHandler&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/query&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">query</span><span class="p">(){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;query...&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">blockHandler</span><span class="p">(</span><span class="n">BlockException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;è¯·ç¨åå†è¯•ï¼&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>æ·»åŠ æµæ§è§„åˆ™</strong>

<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240410075355925.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240410075355925.png" alt="image-20240410075355925"  />
	</a>
</div>

<strong>è®¿é—®provideræœåŠ¡</strong>

<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240410075433734.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240410075433734.png" alt="image-20240410075433734"  />
	</a>
</div>
</p>
<blockquote>
<p>è®¿é—®<code>provider</code>è‡ªç„¶æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œå…³é”®æ˜¯<code>consumer</code>é‚£è¾¹æ€ä¹ˆæ ·

<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240410075510088.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240410075510088.png" alt="image-20240410075510088"  />
	</a>
</div>

å¯ä»¥ï¼Œä¹Ÿè¢«é™æµäº†</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯<code>blockHandler</code>æŒ‡å®šçš„æ–¹æ³•è¿”å›å€¼è¦å’Œ<code>è¢«æ ‡è®°@SentinelResource</code>çš„æ–¹æ³•<code>(è¿™é‡Œæ˜¯query)</code>ä¿æŒä¸€è‡´ï¼Œå¾—æ˜¯<code>String</code></p>
<p>å¦åˆ™ä¼šæŠ¥é”™å¦‚ä¸‹</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">com.alibaba.csp.sentinel.slots.block.flow.FlowException: null
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p><strong>æˆ‘ä»¬å¸Œæœ›èƒ½åŒæ„æ¥é…ç½®</strong>ï¼Œè€Œä¸æ˜¯æ¯ä¸ªç±»éƒ½å†™ä¸€ä¸ªå•ç‹¬çš„é™æµæ–¹æ³•</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * å…¨å±€é™æµå¤„ç†
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @author: ä¸æ˜¯èœç‹—çˆ±ç¼–ç¨‹
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @date: 2024/04/10/7:27
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @description:
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">GlobeBlockException</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">blockHandler</span><span class="p">(</span><span class="n">BlockException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;æ‚¨è®¿é—®å¤ªé¢‘ç¹äº†ï¼Œè¯·ç¨åå†è¯•ï¼&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RestController</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&#34;provider&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ProviderController</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@SentinelResource</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;providerQuery&#34;</span><span class="p">,</span><span class="n">blockHandlerClass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GlobeBlockException</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="n">blockHandler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;blockHandler&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/query&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">query</span><span class="p">(){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;query...&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>ä»¥ä¸Šä»£ç åœ¨githubä¸­ï¼Œ<a class="link" href="https://github.com/IsUnderAchiever/sentinel-demo"  target="_blank" rel="noopener" >é“¾æ¥</a></p>
<p><strong>æ³¨æ„åˆ‡æ¢boot3åˆ†æ”¯ï¼Œmainåˆ†æ”¯ä½¿ç”¨çš„æ˜¯2.3.12.RELEASEç‰ˆæœ¬springbootï¼Œ<code>2.3.12.RELEASEç‰ˆæœ¬springboot</code>å¯ä»¥æ­£å¸¸ä½¿ç”¨è‡ªå®šä¹‰<code>FallbackFactory</code>ç±»</strong></p>
<p>ä»¥ä¸Šæ˜¯å…³äºå¤§æ¦‚çš„è§£æ³•ï¼Œä¸‹é¢å±•ç¤º<code>order</code>å’Œ<code>user</code>æ¨¡å—çš„å†™æ³•
<strong>useræ¨¡å—</strong>
æ³¨æ„è¿™é‡Œè®¾ç½®çš„<code>blockHandler</code>æ–¹æ³•å‚æ•°è¦æ¯”<code>@SentinelResource</code>æ ‡è®°çš„æ–¹æ³•å‚æ•°å¤šä¸€ä¸ª<code>BlockException</code>ï¼Œå…¶å®ƒå‚æ•°ä¿æŒä¸€è‡´</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">GlobeBlockException</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">User</span><span class="w"> </span><span class="nf">blockHandler</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="n">BlockException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">User</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RestController</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&#34;user&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">UserController</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Autowired</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">UserService</span><span class="w"> </span><span class="n">userService</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@SentinelResource</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;userQueryById&#34;</span><span class="p">,</span><span class="n">blockHandlerClass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GlobeBlockException</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="n">blockHandler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;blockHandler&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/{id}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">User</span><span class="w"> </span><span class="nf">findOne</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">userService</span><span class="p">.</span><span class="na">getById</span><span class="p">(</span><span class="n">id</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>
<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240410081054018.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240410081054018.png" alt="image-20240410081054018"  />
	</a>
</div>
</p>
<blockquote>
<p>åˆå‡ºç°ä¸€ä¸ªé—®é¢˜ï¼Œspringbootå¯åŠ¨å¤šä¸ªuserå®ä¾‹ï¼Œä½†æ˜¯sentinelè®¾ç½®é™æµè§„åˆ™ååªå¯¹å…¶ä¸­ä¸€ä¸ªå®ä¾‹æœ‰æ•ˆ

<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240410081722803.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240410081722803.png" alt="image-20240410081722803"  />
	</a>
</div>


<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240410081732670.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240410081732670.png" alt="image-20240410081732670"  />
	</a>
</div>

çœ‹<code>sentinel</code>ç•Œé¢</p>
<p>åœ¨è¿™é‡Œè®¾ç½®å¤šä¸ªå³å¯

<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240410081809138.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240410081809138.png" alt="image-20240410081809138"  />
	</a>
</div>


<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240410081841313.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240410081841313.png" alt="image-20240410081841313"  />
	</a>
</div>

orderä¹Ÿæœ‰æ•ˆ

<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240410081915014.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240410081915014.png" alt="image-20240410081915014"  />
	</a>
</div>
</p>
</blockquote>
<h2 id="çº¿ç¨‹éš”ç¦»">çº¿ç¨‹éš”ç¦»
</h2><blockquote>
<p>å·¦ä¾§æ˜¯<code>çº¿ç¨‹éš”ç¦»</code>ï¼Œå³ä¾§æ˜¯<code>ä¿¡å·é‡éš”ç¦»</code>

<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240409073319242.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240409073319242.png" alt="image-20240409073319242"  />
	</a>
</div>

å¯¹æ¯”

<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240409073605422.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240409073605422.png" alt="image-20240409073605422"  />
	</a>
</div>

å°†åŸæœ¬çš„<code>QPS</code>æ¢æˆ<code>çº¿ç¨‹æ•°</code>å³å¯
<strong>éœ€æ±‚</strong>
ç»™UserClientçš„æŸ¥è¯¢ç”¨æˆ·æ¥å£è®¾ç½®æµæ§è§„åˆ™ï¼Œçº¿ç¨‹æ•°ä¸èƒ½è¶…è¿‡2ã€‚ç„¶ååˆ©ç”¨jemeteræµ‹è¯•ã€‚

<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240410082119553.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240410082119553.png" alt="image-20240410082119553"  />
	</a>
</div>


<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240410082637264.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240410082637264.png" alt="image-20240410082637264"  />
	</a>
</div>

è¿™é‡Œçš„è¯·æ±‚éƒ½æ˜¯æ­£å¸¸ï¼Œå› ä¸ºä¹‹å‰é…ç½®äº†é™çº§çš„é€»è¾‘ï¼Œæ‰€ä»¥ä¼šç›´æ¥è¿”å›ä¸€ä¸ª<code>ç©ºçš„userå¯¹è±¡</code>ï¼Œè€Œä¸æ˜¯æŠ¥é”™</p>
</blockquote>
<h2 id="ç†”æ–­é™çº§">ç†”æ–­é™çº§
</h2><h3 id="æ¦‚å¿µ-1">æ¦‚å¿µ
</h3><p>ç†”æ–­é™çº§æ˜¯è§£å†³é›ªå´©é—®é¢˜çš„é‡è¦æ‰‹æ®µã€‚å…¶æ€è·¯æ˜¯ç”±æ–­è·¯å™¨ç»Ÿè®¡æœåŠ¡è°ƒç”¨çš„å¼‚å¸¸æ¯”ä¾‹ã€æ…¢è¯·æ±‚æ¯”ä¾‹ï¼Œå¦‚æœè¶…å‡ºé˜ˆå€¼åˆ™ä¼šç†”æ–­è¯¥æœåŠ¡ã€‚å³æ‹¦æˆªè®¿é—®è¯¥æœåŠ¡çš„ä¸€åˆ‡è¯·æ±‚;è€Œå½“æœåŠ¡æ¢å¤æ—¶,æ–­è·¯å™¨ä¼šæ”¾è¡Œè®¿é—®è¯¥æœåŠ¡çš„è¯·æ±‚ã€‚

<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240409074149240.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240409074149240.png" alt="image-20240409074149240"  />
	</a>
</div>
</p>
<h3 id="ç†”æ–­ç­–ç•¥--æ…¢è°ƒç”¨">ç†”æ–­ç­–ç•¥&ndash;æ…¢è°ƒç”¨
</h3><p>æ–­è·¯å™¨ç†”æ–­ç­–ç•¥æœ‰ä¸‰ç§:<code>æ…¢è°ƒç”¨</code>ã€<code>å¼‚å¸¸æ¯”ä¾‹</code>ã€<code>å¼‚å¸¸æ•°</code>
æ…¢è°ƒç”¨:ä¸šåŠ¡çš„å“åº”æ—¶é•¿(RT)å¤§äºæŒ‡å®šæ—¶é•¿çš„è¯·æ±‚è®¤å®šä¸ºæ…¢è°ƒç”¨è¯·æ±‚ã€‚åœ¨æŒ‡å®šæ—¶é—´å†…ï¼Œå¦‚æœè¯·æ±‚æ•°é‡è¶…è¿‡è®¾å®šçš„æœ€å°æ•°é‡ï¼Œæ…¢è°ƒç”¨æ¯”ä¾‹å¤§äºè®¾å®šçš„é˜ˆå€¼ï¼Œåˆ™è§¦å‘ç†”æ–­ã€‚ä¾‹å¦‚:

<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240409074310444.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240409074310444.png" alt="image-20240409074310444"  />
	</a>
</div>

<strong>è§£è¯»</strong>: RTè¶…è¿‡500msçš„è°ƒç”¨æ˜¯æ…¢è°ƒç”¨ï¼Œç»Ÿè®¡æœ€è¿‘10000mså†…çš„è¯·æ±‚ï¼Œå¦‚æœè¯·æ±‚é‡è¶…è¿‡10æ¬¡,å¹¶ä¸”æ…¢è°ƒç”¨æ¯”ä¾‹ä¸ä½äº0.5åˆ™è§¦å‘ç†”æ–­ï¼Œç†”æ–­æ—¶é•¿ä¸º5ç§’ã€‚ç„¶åè¿›å…¥half-opençŠ¶æ€,æ”¾è¡Œä¸€æ¬¡è¯·æ±‚åšæµ‹è¯•ã€‚
<strong>éœ€æ±‚</strong></p>
<blockquote>
<p>ç»™UserClientçš„æŸ¥è¯¢ç”¨æˆ·æ¥å£è®¾ç½®é™çº§è§„åˆ™ï¼Œæ…¢è°ƒç”¨çš„RTé˜ˆå€¼ä¸º50ms,ç»Ÿè®¡æ—¶é—´ä¸º1ç§’ï¼Œæœ€å°è¯·æ±‚æ•°é‡ä¸º5ï¼Œå¤±è´¥é˜ˆå€¼æ¯”ä¾‹ä¸º0.4,ç†”æ–­æ—¶é•¿ä¸º5</p>
<p>ä¸ºäº†å¢åŠ ä¸šåŠ¡è€—æ—¶ï¼Œå¯ä»¥è®¾ç½®<code>Thread.sleep(60)</code>

<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240410083103666.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240410083103666.png" alt="image-20240410083103666"  />
	</a>
</div>
</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RestController</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&#34;user&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">UserController</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Autowired</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">UserService</span><span class="w"> </span><span class="n">userService</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@SentinelResource</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;userQueryById&#34;</span><span class="p">,</span><span class="n">blockHandlerClass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GlobeBlockException</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="n">blockHandler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;blockHandler&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/{id}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">User</span><span class="w"> </span><span class="nf">findOne</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">Thread</span><span class="p">.</span><span class="na">sleep</span><span class="p">(</span><span class="n">60</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">InterruptedException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RuntimeException</span><span class="p">(</span><span class="n">e</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">userService</span><span class="p">.</span><span class="na">getById</span><span class="p">(</span><span class="n">id</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>æ­¤æ—¶æˆ‘ä»¬æ­£å¸¸çš„å“åº”æ—¶é—´æ˜¯<code>71ms</code>

<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240410083240454.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240410083240454.png" alt="image-20240410083240454"  />
	</a>
</div>

å¿«é€Ÿè®¿é—®å¤šæ¬¡åç†”æ–­ï¼Œç†”æ–­ä¹‹åå·²ç»ä¸å†å»å°è¯•äº†ï¼Œè€Œæ˜¯ç›´æ¥è¿”å›å¤±è´¥ç»“æœï¼Œè¿™é‡Œçš„æ—¶é—´ä¸º<code>4ms</code>

<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240410083454593.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240410083454593.png" alt="image-20240410083454593"  />
	</a>
</div>

æœåŠ¡çš„è°ƒç”¨æ–¹å“åº”å¦‚ä¸‹

<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240410083623355.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240410083623355.png" alt="image-20240410083623355"  />
	</a>
</div>

é’ˆå¯¹å¤šå®ä¾‹ä¹Ÿæœ‰æ•ˆ

<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240410084150507.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240410084150507.png" alt="image-20240410084150507"  />
	</a>
</div>
</p>
</blockquote>
<h3 id="ç†”æ–­ç­–ç•¥--å¼‚å¸¸æ¯”ä¾‹å¼‚å¸¸æ•°">ç†”æ–­ç­–ç•¥&ndash;å¼‚å¸¸æ¯”ä¾‹ã€å¼‚å¸¸æ•°
</h3><p>å¼‚å¸¸æ¯”ä¾‹æˆ–å¼‚å¸¸æ•°:ç»Ÿè®¡æŒ‡å®šæ—¶é—´å†…çš„è°ƒç”¨ï¼Œå¦‚æœè°ƒç”¨æ¬¡æ•°è¶…è¿‡æŒ‡å®šè¯·æ±‚æ•°ï¼Œå¹¶ä¸”å‡ºç°å¼‚å¸¸çš„æ¯”ä¾‹è¾¾åˆ°è®¾å®šçš„æ¯”ä¾‹é˜ˆå€¼(æˆ–è¶…è¿‡æŒ‡å®šå¼‚å¸¸æ•°) ,åˆ™è§¦å‘ç†”æ–­ã€‚ä¾‹å¦‚:

<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240409074723270.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240409074723270.png" alt="image-20240409074723270"  />
	</a>
</div>


<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240409074746502.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240409074746502.png" alt="image-20240409074746502"  />
	</a>
</div>

<strong>è§£è¯»</strong>:ç»Ÿè®¡æœ€è¿‘1000mså†…çš„è¯·æ±‚ï¼Œå¦‚æœè¯·æ±‚é‡è¶…è¿‡10æ¬¡ï¼Œå¹¶ä¸”å¼‚å¸¸æ¯”ä¾‹ä¸ä½äº0.5,åˆ™è§¦å‘ç†”æ–­ï¼Œç†”æ–­æ—¶é•¿ä¸º5ç§’ã€‚ç„¶åè¿›å…¥half-opençŠ¶æ€ï¼Œæ”¾è¡Œä¸€æ¬¡ è¯·æ±‚åšæµ‹è¯•ã€‚</p>
<blockquote>
<p>æ•…æ„æŠ›å‡ºå¼‚å¸¸å³å¯

<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240410210541628.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240410210541628.png" alt="image-20240410210541628"  />
	</a>
</div>
</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RestController</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&#34;user&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">UserController</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Autowired</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">UserService</span><span class="w"> </span><span class="n">userService</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@SentinelResource</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;userQueryById&#34;</span><span class="p">,</span><span class="n">blockHandlerClass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GlobeBlockException</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="n">blockHandler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;blockHandler&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/{id}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">User</span><span class="w"> </span><span class="nf">findOne</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">id</span><span class="o">==</span><span class="n">2</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RuntimeException</span><span class="p">(</span><span class="s">&#34;æŠ›å‡ºå¼‚å¸¸äº†&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">userService</span><span class="p">.</span><span class="na">getById</span><span class="p">(</span><span class="n">id</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>
<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240410210729986.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240410210729986.png" alt="image-20240410210729986"  />
	</a>
</div>
</p>
<blockquote>
<p>å¦‚æœè§‰å¾—ç›´æ¥è¿”å›æŠ¥é”™ä¸å¤ªå‹å¥½ï¼Œå¯ä»¥ä½¿ç”¨<code>@RestControllerAdvice</code>æ¥è¿›è¡Œç»Ÿä¸€çš„å¼‚å¸¸å¤„ç†ï¼Œè¿™é‡Œä¸è¿‡å¤šä»‹ç»è¿™ä¸ªæ³¨è§£ï¼Œå…ˆçœ‹çœ‹ç†”æ–­æ˜¯å¦ç”Ÿæ•ˆ

<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240410210916311.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240410210916311.png" alt=""  />
	</a>
</div>

å†çœ‹çœ‹<code>order</code>æœåŠ¡è°ƒç”¨æ˜¯å¦æ­£å¸¸

<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240410211017304.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240410211017304.png" alt="image-20240410211017304"  />
	</a>
</div>
</p>
</blockquote>
<h3 id="æ€»ç»“-1">æ€»ç»“
</h3><p>Sentinelç†”æ–­é™çº§çš„ç­–ç•¥æœ‰å“ªäº›?
æ…¢è°ƒç”¨æ¯”ä¾‹:è¶…è¿‡æŒ‡å®šæ—¶é•¿çš„è°ƒç”¨ä¸ºæ…¢è°ƒç”¨ï¼Œç»Ÿè®¡å•ä½æ—¶é•¿å†…æ…¢è°ƒç”¨çš„æ¯”ä¾‹ï¼Œè¶…è¿‡é˜ˆå€¼åˆ™ç†”æ–­
å¼‚å¸¸æ¯”ä¾‹:ç»Ÿè®¡å•ä½æ—¶é•¿å†…å¼‚å¸¸è°ƒç”¨çš„æ¯”ä¾‹ï¼Œè¶…è¿‡é˜ˆå€¼åˆ™ç†”æ–­
å¼‚å¸¸æ•°:ç»Ÿè®¡å•ä½æ—¶é•¿å†…å¼‚å¸¸è°ƒç”¨çš„æ¬¡æ•°,è¶…è¿‡é˜ˆå€¼åˆ™ç†”æ–­</p>
<h2 id="æˆæƒè§„åˆ™">æˆæƒè§„åˆ™
</h2><blockquote>
<p>å½“æ—¶åœ¨<code>gateway</code>ç½‘å…³çš„æ—¶å€™æœ‰åšè¿‡<code>è¿‡æ»¤</code>ï¼Œå¯ä»¥é˜»æ­¢æŸäº›è¯·æ±‚é€šè¿‡<code>ç½‘å…³</code>è·¯ç”±åˆ°<code>å¾®æœåŠ¡</code></p>
<p>ä½†å¦‚æœæœ‰ä¸€å¤©<code>å¾®æœåŠ¡</code>çš„åœ°å€åŠç«¯å£è¢«æ³„éœ²å‡ºå»äº†ï¼Œè¯·æ±‚å°±å¯èƒ½ä¸é€šè¿‡ç½‘å…³ï¼Œç›´æ¥è®¿é—®æœåŠ¡çš„çš„åœ°å€ï¼Œè¿™ä¸ªæ—¶å€™<code>å¾®æœåŠ¡</code>å°±å¾ˆå±é™©äº†
æˆæƒè§„åˆ™å¯ä»¥å¯¹è°ƒç”¨æ–¹çš„æ¥æºåšæ§åˆ¶ï¼Œæœ‰ç™½åå•å’Œé»‘åå•ä¸¤ç§æ–¹å¼ã€‚
ç™½åå•:æ¥æº(origin) åœ¨ç™½åå•å†…çš„è°ƒç”¨è€…å…è®¸è®¿é—®
é»‘åå•:æ¥æº(origin)åœ¨é»‘åå•å†…çš„è°ƒç”¨è€…ä¸å…è®¸è®¿é—®

<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240409075531220.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240409075531220.png" alt="image-20240409075531220"  />
	</a>
</div>

ä¾‹å¦‚ï¼Œæˆ‘ä»¬é™å®šåªå…è®¸ä»ç½‘å…³æ¥çš„è¯·æ±‚è®¿é—®<code>order-service</code>ï¼Œä¸å…è®¸æµè§ˆå™¨æ¥ç›´æ¥è®¿é—®,é‚£ä¹ˆæµæ§åº”ç”¨ä¸­å°±å¡«å†™ç½‘å…³çš„åç§°.
è¿™é‡Œçš„<code>æµæ§åº”ç”¨</code>å…¶å®ä¸æ˜¯æŒ‡çš„<code>ç½‘å…³æœåŠ¡</code>çš„åç§°ï¼Œè€Œæ˜¯æŒ‡çš„<code>orign</code>è¯·æ±‚æ¥æºçš„åç§°
Sentinelæ˜¯é€šè¿‡<code>RequestOriginParser</code>è¿™ä¸ªæ¥å£çš„parseOriginæ¥è·å–è¯·æ±‚çš„æ¥æºçš„ã€‚
è€Œ<code>sentinel</code>é»˜è®¤æƒ…å†µä¸‹ï¼Œä»<code>gateway</code>å’Œ<code>æµè§ˆå™¨</code>åˆ°è¾¾çš„<code>orign</code>åç§°éƒ½æ˜¯<code>default</code>ï¼Œæ— æ³•å¯¹<code>ç½‘å…³</code>å’Œ<code>æµè§ˆå™¨è¿›è¡ŒåŒºåˆ†</code>
æ‰€ä»¥éœ€è¦å®ç°<code>RequestOriginParser</code>è¯¥æ¥å£æ¥è‡ªå®šä¹‰å®ç°ï¼Œæ¯”å¦‚</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Component</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">HeaderOriginParser</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">RequestOriginParser</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">parse0rigin</span><span class="p">(</span><span class="n">HttpServletRequest</span><span class="w"> </span><span class="n">request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">origin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="w"> </span><span class="nf">getHeader</span><span class="p">(</span><span class="s">&#34;origin&#34;</span><span class="p">)</span><span class="w"> </span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">Str</span><span class="w"> </span><span class="n">ingUtils</span><span class="p">.</span><span class="w"> </span><span class="nf">isEmpty</span><span class="p">(</span><span class="n">origin</span><span class="p">)){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;blank&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">origin</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>ä½†ç°å®æ˜¯<code>ç½‘å…³</code>å’Œ<code>æµè§ˆå™¨</code>é»˜è®¤éƒ½æ²¡æœ‰<code>origin</code>è¯·æ±‚å¤´ï¼Œè€Œæˆ‘ä»¬ç»™<code>ç½‘å…³</code>æ¥çš„è¯·æ±‚æ·»åŠ ä¸Š<code>origin</code>å³å¯</p>
<p>ç½‘å…³è¿‡æ»¤å™¨<code>AddRequestHeader</code>å¯ä»¥å®ç°ï¼Œè¿™é‡Œç›´æ¥å†™æˆ<code>é»˜è®¤è¿‡æ»¤å™¨</code>ï¼Œæ‰€æœ‰ç»è¿‡<code>ç½‘å…³</code>çš„è¯·æ±‚éƒ½æ·»åŠ ä¸Š<code>origin</code>å¤´</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">spring</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">cloud</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">gateway</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">default-filters</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="c">#æ·»åŠ åä¸ºoriginçš„è¯·æ±‚å¤´ï¼Œå€¼ä¸ºgateway</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span>-<span class="l">AddRequestHeader=origin,gateway </span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>æ‰€ä»¥<code>æµæ§åº”ç”¨</code>å°±å¡«<code>gateway</code>ï¼Œæ³¨æ„è¿™é‡Œçš„å€¼ï¼Œå³<code>gateway</code>ä¸è¦æš´éœ²äº†
<strong>ç†è®ºç»“æŸï¼Œå®è·µå¼€å§‹</strong>
orderæœåŠ¡</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Slf4j</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@Component</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">HeadOriginParser</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">RequestOriginParser</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">parseOrigin</span><span class="p">(</span><span class="n">HttpServletRequest</span><span class="w"> </span><span class="n">httpServletRequest</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// è·å–è¯·æ±‚å¤´</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">origin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">httpServletRequest</span><span class="p">.</span><span class="na">getHeader</span><span class="p">(</span><span class="s">&#34;origin&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// åˆ¤ç©º</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">StringUtils</span><span class="p">.</span><span class="na">hasLength</span><span class="p">(</span><span class="n">origin</span><span class="p">)){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">// originä¸ºç©º</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">origin</span><span class="o">=</span><span class="s">&#34;blank&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&#34;å½“å‰è¯·æ±‚:{},originè¯·æ±‚å¤´:{}&#34;</span><span class="p">,</span><span class="n">httpServletRequest</span><span class="p">.</span><span class="na">getRequestURI</span><span class="p">(),</span><span class="n">origin</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">origin</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>ç½‘å…³æœåŠ¡é…ç½®ï¼Œä¸»è¦æ˜¯<code>- AddRequestHeader=origin,gateway</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">spring</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">application</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">gateway-service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">cloud</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">nacos</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">config</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">server-addr</span><span class="p">:</span><span class="w"> </span><span class="l">localhost:8848</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">d2455f6d-ed00-41ba-9915-09021bc0df6c</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">import-check</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">discovery</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">server-addr</span><span class="p">:</span><span class="w"> </span><span class="l">localhost:8848</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">d2455f6d-ed00-41ba-9915-09021bc0df6c</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">gateway</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># ç½‘å…³è·¯ç”±é…ç½®</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">routes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c"># è·¯ç”±idï¼Œè‡ªå®šä¹‰å”¯ä¸€å³å¯</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l">user-service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="c"># ç›®æ ‡è·¯ç”±åœ°å€ï¼Œè¿™ç§æ–¹å¼ç”¨çš„è¾ƒå°‘</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="c"># uri: http://localhost:8080</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="c"># lbå°±æ˜¯LoadBalancerï¼Œè´Ÿè½½å‡è¡¡çš„æ„æ€ï¼Œåé¢æ˜¯æœåŠ¡åç§°</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">uri</span><span class="p">:</span><span class="w"> </span><span class="l">lb://user-service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="c"># è·¯ç”±æ–­è¨€ï¼Œåˆ¤æ–­è¯·æ±‚æ˜¯å¦ç¬¦åˆè·¯ç”±è§„åˆ™æ¡ä»¶</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">predicates</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c"># è·¯å¾„åŒ¹é…ã€‚åŒ¹é…ä»¥/user/å¼€å¤´çš„è·¯ç”±</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="l">Path=/user/**</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l">order-service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">uri</span><span class="p">:</span><span class="w"> </span><span class="l">lb://order-service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">predicates</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="l">Path=/order/**</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">default-filters</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#        - AddRequestHeader=color,this is red</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="l">AddRequestHeader=origin,gateway</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>
<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240410220549522.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240410220549522.png" alt="image-20240410220549522"  />
	</a>
</div>
</p>
<blockquote>
<p>é€šè¿‡ç½‘å…³æœåŠ¡è®¿é—®

<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240410220636398.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240410220636398.png" alt="image-20240410220636398"  />
	</a>
</div>

ç›´æ¥è®¿é—®

<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240410220652041.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240410220652041.png" alt="image-20240410220652041"  />
	</a>
</div>
</p>
</blockquote>
<h2 id="è‡ªå®šä¹‰å¼‚å¸¸ç»“æœ">è‡ªå®šä¹‰å¼‚å¸¸ç»“æœ
</h2><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå‘ç”Ÿé™æµã€é™çº§ã€æˆæƒæ‹¦æˆªæ—¶ï¼Œéƒ½ä¼šæŠ›å‡ºå¼‚å¸¸åˆ°è°ƒç”¨æ–¹ã€‚å¦‚æœè¦è‡ªå®šä¹‰å¼‚å¸¸æ—¶çš„è¿”å›ç»“æœï¼Œéœ€è¦å®ç°<code>BlockExceptionHandler</code>æ¥å£

<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240409081053921.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240409081053921.png" alt="image-20240409081053921"  />
	</a>
</div>
</p>
<blockquote>
<p>åˆ¤æ–­è¿™é‡Œå¼‚å¸¸çš„ç±»å‹ï¼Œç„¶åè¿”å›è‡ªå®šä¹‰ç»“æœ
<strong>è€Œ<code>BlockException</code>åŒ…å«å¾ˆå¤šä¸ªå­ç±»ï¼Œåˆ†åˆ«å¯¹åº”ä¸åŒçš„åœºæ™¯:</strong>

<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240409081138373.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240409081138373.png" alt="image-20240409081138373"  />
	</a>
</div>

å…·ä½“å†™æ³•å¯å‚è€ƒ

<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240409081246546.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240409081246546.png" alt="image-20240409081246546"  />
	</a>
</div>

orderæœåŠ¡</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Component</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SentinelBlockHandler</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">BlockExceptionHandler</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">handle</span><span class="p">(</span><span class="n">HttpServletRequest</span><span class="w"> </span><span class="n">httpServletRequest</span><span class="p">,</span><span class="w"> </span><span class="n">HttpServletResponse</span><span class="w"> </span><span class="n">httpServletResponse</span><span class="p">,</span><span class="w"> </span><span class="n">BlockException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;æœªçŸ¥å¼‚å¸¸&#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">429</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">FlowException</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;è¯·æ±‚è¢«é™æµäº†! &#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">DegradeException</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;è¯·æ±‚è¢«é™çº§äº†! &#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">ParamFlowException</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;çƒ­ç‚¹å‚æ•°é™æµ! &#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">AuthorityException</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;è¯·æ±‚æ²¡æœ‰æƒé™! &#34;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">401</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">httpServletResponse</span><span class="p">.</span><span class="na">setContentType</span><span class="p">(</span><span class="s">&#34;application/json;charset=utf-8&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">httpServletResponse</span><span class="p">.</span><span class="na">setStatus</span><span class="p">(</span><span class="n">status</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">httpServletResponse</span><span class="p">.</span><span class="na">getWriter</span><span class="p">().</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;{\&#34;message\&#34;: \&#34;&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">msg</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34;\&#34;ï¼Œ \&#34;status\&#34;: &#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34;}&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>é‡å¯æœåŠ¡åæ–°å»ºæˆæƒè§„åˆ™

<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240410221758019.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240410221758019.png" alt="image-20240410221758019"  />
	</a>
</div>

ä¹Ÿå¯ä»¥ä½¿ç”¨<code>@SentinelResource</code>æ³¨è§£æ–¹å¼</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RestController</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&#34;order&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">OrdersController</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Autowired</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">OrdersService</span><span class="w"> </span><span class="n">ordersService</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@SentinelResource</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;orderFindOne&#34;</span><span class="p">,</span><span class="n">blockHandlerClass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GlobeBlockException</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="n">blockHandler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;blockHandler&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/{id}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Orders</span><span class="w"> </span><span class="nf">findOne</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ordersService</span><span class="p">.</span><span class="na">queryByOrderId</span><span class="p">(</span><span class="n">id</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Slf4j</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">GlobeBlockException</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">Orders</span><span class="w"> </span><span class="nf">blockHandler</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">BlockException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">log</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="s">&#34;å½“å‰æœåŠ¡ç¹å¿™ï¼Œè¯·ç¨åå†è¯•&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Orders</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>é…ç½®æˆæƒè§„åˆ™

<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240410222328041.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240410222328041.png" alt="image-20240410222328041"  />
	</a>
</div>

è™½ç„¶åªèƒ½è¿”å›ä¸ä½¿ç”¨<code>@SentinelResource</code>æ³¨è§£æ ‡æ³¨çš„æ–¹æ³•<code>ç›¸åŒ</code>çš„<code>è¿”å›å€¼ç±»å‹</code>ï¼Œä½†æ˜¯åœ¨<code>springboot</code>çš„<code>restful</code>é£æ ¼çš„apiä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šç»Ÿä¸€è¿”å›ç»“æœ
å¦‚<code>JsonData</code>æˆ–è€…<code>R</code>ç­‰ç»Ÿä¸€è¿”å›å€¼ç±»å‹</p>
</blockquote>
<h2 id="è§„åˆ™æŒä¹…åŒ–">è§„åˆ™æŒä¹…åŒ–
</h2><h3 id="æ¦‚å¿µ-2">æ¦‚å¿µ
</h3><p>Sentinelçš„æ§åˆ¶å°è§„åˆ™ç®¡ç†æœ‰ä¸‰ç§æ¨¡å¼:</p>
<ol>
<li>åŸå§‹æ¨¡å¼: Sentinelçš„é»˜è®¤æ¨¡å¼ï¼Œå°†è§„åˆ™ä¿å­˜åœ¨å†…å­˜,é‡å¯æœåŠ¡ä¼šä¸¢å¤±ã€‚</li>
<li>pullæ¨¡å¼</li>
<li>pushæ¨¡å¼</li>
</ol>
<h4 id="pullæ¨¡å¼">pullæ¨¡å¼
</h4><p>pullæ¨¡å¼:æ§åˆ¶å°å°†é…ç½®çš„è§„åˆ™æ¨é€åˆ°Sentinelå®¢æˆ·ç«¯,è€Œå®¢æˆ·ç«¯ä¼šå°†é…ç½®è§„åˆ™ä¿å­˜åœ¨æœ¬åœ°æ–‡ä»¶æˆ–æ•°æ®åº“ä¸­ã€‚ä»¥åä¼šå®šæ—¶å»æœ¬åœ°æ–‡ä»¶æˆ–æ•°æ®åº“ä¸­æŸ¥è¯¢ï¼Œæ›´æ–°æœ¬åœ°è§„åˆ™ã€‚

<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240409081715561.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240409081715561.png" alt="image-20240409081715561"  />
	</a>
</div>
</p>
<blockquote>
<p>ç”±äºæ˜¯å®šæ—¶è½®è¯¢è¯»å–ï¼Œæ‰€ä»¥å­˜åœ¨<code>æ—¶æ•ˆæ€§</code>é—®é¢˜ï¼Œå¯¼è‡´äº†æœåŠ¡ä¸­<code>è§„åˆ™</code>ä¸ä¸€è‡´çš„é—®é¢˜</p>
</blockquote>
<h4 id="pushæ¨¡å¼">pushæ¨¡å¼
</h4><p>pushæ¨¡å¼:æ§åˆ¶å°å°†é…ç½®è§„åˆ™æ¨é€åˆ°è¿œç¨‹é…ç½®ä¸­å¿ƒï¼Œä¾‹å¦‚Nacosã€‚Sentinelå®¢æˆ· ç«¯ç›‘å¬Nacos,è·å–é…ç½®å˜æ›´çš„æ¨é€æ¶ˆæ¯ï¼Œå®Œæˆæœ¬åœ°é…ç½®æ›´æ–°ã€‚

<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240409081844429.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240409081844429.png" alt="image-20240409081844429"  />
	</a>
</div>
</p>
<h4 id="æ€»ç»“-2">æ€»ç»“
</h4><p>Sentinelçš„ä¸‰ç§é…ç½®ç®¡ç†æ¨¡å¼æ˜¯ä»€ä¹ˆ?</p>
<ol>
<li>åŸå§‹æ¨¡å¼:ä¿å­˜åœ¨å†…å­˜</li>
<li>pullæ¨¡å¼:ä¿å­˜åœ¨æœ¬åœ°æ–‡ä»¶æˆ–æ•°æ®åº“ï¼Œå®šæ—¶å»è¯»å–</li>
<li>pushæ¨¡å¼:ä¿å­˜åœ¨nacosï¼Œç›‘å¬å˜æ›´å®æ—¶æ›´æ–°</li>
</ol>
<h3 id="å®ç°pushæ¨¡å¼">å®ç°pushæ¨¡å¼
</h3><blockquote>
<p>å‚è€ƒ<a class="link" href="https://blog.csdn.net/qq_36763419/article/details/121560105"  target="_blank" rel="noopener" >åšå®¢</a>
pushæ¨¡å¼å®ç°æœ€ä¸ºå¤æ‚ï¼Œä¾èµ–äºnacos,å¹¶ä¸”éœ€è¦ä¿®æ”¹Sentinelæ§åˆ¶å°æºç ã€‚
<strong>å¼•å…¥ä¾èµ–</strong></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>com.alibaba.csp<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>sentinel-datasource-nacos<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>com.alibaba.cloud<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>spring-cloud-alibaba-sentinel-datasource<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>é…ç½®nacosåœ°å€</strong></p>
<blockquote>
<p>ç¤ºä¾‹å¦‚ä¸‹</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">spring</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">cloud</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">sentinel</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">datasource</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="nt">flow</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="nt">nacos</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    	</span><span class="c"># nacosåœ°å€</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="nt">server-addr</span><span class="p">:</span><span class="w"> </span><span class="l">localhost:8848 </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="nt">dataId</span><span class="p">:</span><span class="w"> </span><span class="l">orderservice-flow-rules</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="nt">groupId</span><span class="p">:</span><span class="w"> </span><span class="l">SENTINEL_GROUP</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="c">#è¿˜å¯ä»¥æ˜¯: degrade(é™çº§)ã€authority(æˆæƒ)ã€ param-flow(å‚æ•°é™æµ)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="nt">rule-type</span><span class="p">:</span><span class="w"> </span><span class="l">flow </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">				</span><span class="c"># å¦‚æœéœ€è¦å¤šä¸ªé…ç½®ï¼Œç»§ç»­æ·»åŠ å³å¯ï¼Œå¦‚ä¸‹æ‰€ç¤º</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="nt">degrade</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="nt">nacos</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="nt">server-addr</span><span class="p">:</span><span class="w"> </span><span class="l">localhost:8848 </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="nt">dataId</span><span class="p">:</span><span class="w"> </span><span class="l">orderservice-degrade-rules</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="nt">groupId</span><span class="p">:</span><span class="w"> </span><span class="l">SENTINEL_GROUP</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                        </span><span class="nt">rule-type</span><span class="p">:</span><span class="w"> </span><span class="l">degrade </span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>ä»¥ä¸Šæ˜¯é…ç½®æ ¼å¼ï¼Œæ¥ä¸‹æ¥æ­£å¼é…ç½®<code>user</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">server</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">8080</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spring</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">application</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">user-service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">cloud</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">nacos</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">config</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">file-extension</span><span class="p">:</span><span class="w"> </span><span class="l">properties</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">d2455f6d-ed00-41ba-9915-09021bc0df6c</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">prefix</span><span class="p">:</span><span class="w"> </span><span class="l">${spring.application.name}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">server-addr</span><span class="p">:</span><span class="w"> </span><span class="l">localhost:8848</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">discovery</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">cluster-name</span><span class="p">:</span><span class="w"> </span><span class="l">JS</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">ephemeral</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">d2455f6d-ed00-41ba-9915-09021bc0df6c</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">server-addr</span><span class="p">:</span><span class="w"> </span><span class="l">localhost:8848</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">sentinel</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">transport</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">dashboard</span><span class="p">:</span><span class="w"> </span><span class="l">localhost:8089</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">web-context-unify</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">datasource</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">flow</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">nacos</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">server-addr</span><span class="p">:</span><span class="w"> </span><span class="l">localhost:8848</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">d2455f6d-ed00-41ba-9915-09021bc0df6c</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">data-id</span><span class="p">:</span><span class="w"> </span><span class="l">user-service-sentinel</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">group-id</span><span class="p">:</span><span class="w"> </span><span class="l">DEFAULT_GROUP</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">data-type</span><span class="p">:</span><span class="w"> </span><span class="l">json</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c">#è¿˜å¯ä»¥æ˜¯: degrade(é™çº§)ã€authority(æˆæƒ)ã€ param-flow(å‚æ•°é™æµ)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">rule-type</span><span class="p">:</span><span class="w"> </span><span class="l">flow</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">config</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">import</span><span class="p">:</span><span class="w"> </span><span class="l">nacos:${spring.cloud.nacos.config.prefix}-${spring.profiles.active}.${spring.cloud.nacos.config.file-extension}?refresh=true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">profiles</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">active</span><span class="p">:</span><span class="w"> </span><span class="l">dev</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>ä¸Šé¢é…ç½®ä¸­ï¼Œsentinelè§„åˆ™é…ç½®åˆ°nacos dataIdä¸º<code>user-service-sentinel</code>çš„é…ç½®ä¸­äº†</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">[</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;resource&#34;</span><span class="p">:</span> <span class="s2">&#34;userQueryById&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;controlBehavior&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;count&#34;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;grade&#34;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;limitApp&#34;</span><span class="p">:</span> <span class="s2">&#34;default&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;strategy&#34;</span><span class="p">:</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>
<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240410214414971.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240410214414971.png" alt="image-20240410214414971"  />
	</a>
</div>
</p>
<blockquote>
<p>ä»¥ä¸Šé…ç½®æ˜¯æŒ‡</p>
<p>resourceï¼šèµ„æºåã€‚
limitAppï¼šæ¥æºåº”ç”¨ã€‚
gradeï¼šé˜ˆå€¼ç±»å‹ã€‚0 è¡¨ç¤ºçº¿ç¨‹æ•°ï¼Œ1 è¡¨ç¤ºæ˜¯QPSã€‚
countï¼šå•æœºé˜ˆå€¼ã€‚
strategyï¼šæµæ§æ¨¡å¼ã€‚0 è¡¨ç¤ºç›´æ¥ï¼Œ1 è¡¨ç¤ºå…³è”ï¼Œ2 è¡¨ç¤ºé“¾è·¯ã€‚
controlBehaviorï¼šæµæ§æ•ˆæœã€‚0 è¡¨ç¤ºå¿«é€Ÿå¤±è´¥ï¼Œ1 è¡¨ç¤ºWarm upï¼Œ2 è¡¨ç¤ºæ’é˜Ÿç­‰å¾…ã€‚
clusterModeï¼šæ˜¯å¦é›†ç¾¤ã€‚false è¡¨ç¤ºå¦ï¼Œtrue è¡¨ç¤ºæ˜¯ã€‚
<strong>è¿™é‡Œé€‰æ‹©<code>resource</code>ä¸º<code>userQueryById</code></strong>ï¼Œå› ä¸º<code>@SentinelResource</code>æ ‡è®°èµ„æºä¸º<code>userQueryById</code>è¿˜è®°å¾—å—ï¼Ÿ</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RestController</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">&#34;user&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">UserController</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Autowired</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">UserService</span><span class="w"> </span><span class="n">userService</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@SentinelResource</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;userQueryById&#34;</span><span class="p">,</span><span class="n">blockHandlerClass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GlobeBlockException</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="n">blockHandler</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;blockHandler&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@GetMapping</span><span class="p">(</span><span class="s">&#34;/{id}&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">User</span><span class="w"> </span><span class="nf">findOne</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">id</span><span class="o">==</span><span class="n">2</span><span class="p">){</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RuntimeException</span><span class="p">(</span><span class="s">&#34;æŠ›å‡ºå¼‚å¸¸äº†&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">userService</span><span class="p">.</span><span class="na">getById</span><span class="p">(</span><span class="n">id</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>æµ‹è¯•ä¸€ä¸‹æ˜¯å¦å¯è¡Œ

<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240410214733973.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240410214733973.png" alt="image-20240410214733973"  />
	</a>
</div>

orderä¹Ÿæ²¡é—®é¢˜

<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240410214813076.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240410214813076.png" alt="image-20240410214813076"  />
	</a>
</div>

é‡å¯æœåŠ¡ï¼ŒæŸ¥çœ‹<code>sentinel</code>æ§åˆ¶å°ï¼Œè§„åˆ™æ˜¯å¦è¿˜å­˜åœ¨

<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240410214914582.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/image-20240410214914582.png" alt="image-20240410214914582"  />
	</a>
</div>

ä½†æ˜¯æœ‰ä¸ªéœ€è¦æ³¨æ„çš„ç‚¹ï¼Œè¿™æ˜¯<code>sentinel</code>è¯»<code>nacos</code>é…ç½®çš„è§„åˆ™ï¼Œè€Œåœ¨<code>sentinel</code>ä¸­é…ç½®çš„è§„åˆ™ï¼Œä¸èƒ½åŒæ­¥åˆ°<code>nacos</code></p>
<p>å¦‚æœéœ€è¦è®©<code>sentinel</code>çš„é…ç½®åŒæ­¥åˆ°<code>nacos</code>ï¼Œ<code>nacos</code>ä¿®æ”¹çš„é…ç½®<code>sentinel</code>ä¹Ÿèƒ½è·å–åˆ°ï¼Œåˆ™éœ€è¦ä¿®æ”¹<code>sentinel-dashboard.jar</code>çš„æºç äº†</p>
<p>ç½‘ä¸Šä¹Ÿæœ‰æ•™ç¨‹</p>
</blockquote>

</section>


    <footer class="article-footer">
    

    </footer>


    
</article>

    

    

     
    
        
    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2020 - 
        
        2025 æ·±æµ·ç«é”…åº—
    </section>
    
    <section class="powerby">
        ä½¿ç”¨ <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> æ„å»º <br />
        ä¸»é¢˜ <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.29.0">Stack</a></b> ç”± <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> è®¾è®¡
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
