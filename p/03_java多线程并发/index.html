<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="03_Javaå¤šçº¿ç¨‹å¹¶å‘">
<title>03_Javaå¤šçº¿ç¨‹å¹¶å‘</title>

<link rel='canonical' href='https://IsUnderAchiever.github.io/p/03_java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%B9%B6%E5%8F%91/'>

<link rel="stylesheet" href="/scss/style.min.b85f3de2f132c41bcf65396d29447bd98774c1cff192b74d7f75bc7b72545eb8.css"><meta property='og:title' content="03_Javaå¤šçº¿ç¨‹å¹¶å‘">
<meta property='og:description' content="03_Javaå¤šçº¿ç¨‹å¹¶å‘">
<meta property='og:url' content='https://IsUnderAchiever.github.io/p/03_java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%B9%B6%E5%8F%91/'>
<meta property='og:site_name' content='æ·±æµ·ç«é”…åº—'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:published_time' content='2022-12-17T00:00:00&#43;00:00'/><meta property='article:modified_time' content='2022-12-17T00:00:00&#43;00:00'/><meta property='og:image' content='https://IsUnderAchiever.github.io/p/03_java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%B9%B6%E5%8F%91/202412212036798.png' />
<meta name="twitter:title" content="03_Javaå¤šçº¿ç¨‹å¹¶å‘">
<meta name="twitter:description" content="03_Javaå¤šçº¿ç¨‹å¹¶å‘"><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='https://IsUnderAchiever.github.io/p/03_java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%B9%B6%E5%8F%91/202412212036798.png' />
    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="åˆ‡æ¢èœå•">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/header_hu16240087013746809388.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">ğŸ˜</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">æ·±æµ·ç«é”…åº—</a></h1>
            <h2 class="site-description">è®°å½•æˆ‘çš„æˆé•¿å²</h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://space.bilibili.com/477448861'
                        target="_blank"
                        title="Bilibili"
                        rel="me"
                    >
                        
                        
                            <?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg t="1734756297204" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4471" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><path d="M685.21 117.15c6.63-9.41 21.12-11.52 30.21-4.47 9.06 6.34 11.49 19.96 5.35 29.12-35.44 51.91-70.81 103.88-106.31 155.76-0.63 1.02-1.16 2.09-1.7 3.16 86.41 0.03 172.82 0.01 259.22 0.02 10.3-0.39 19.61 8.97 19.11 19.28 0.08 172.65 0.18 345.31 0.23 517.97 0.29 9.97-8.32 19.2-18.33 19.35-21.78 0.24-43.56-0.17-65.32 0.19-1.96 17.65-9.87 34.97-23.27 46.85-12.92 12-31.5 17.75-48.9 14.36-28.92-5.43-48.64-33.26-51.72-61.39-109.19 0.08-218.38 0.08-327.57 0-2.33 18.48-10.77 36.55-25.23 48.6-15.66 13.62-39.03 17.75-58.17 9.42-23.11-9.58-37.95-33.47-40.48-57.84-27.1-0.36-54.23 0.06-81.33-0.21-9.8-0.41-18.09-9.49-17.73-19.28 0.06-170.34 0.08-340.69 0.12-511.04 0.1-4.55-0.51-9.27 1.09-13.64 2.49-7.28 9.81-12.67 17.54-12.61 91.71-0.09 183.42 0.12 275.13-0.11-50.14-27.95-100.88-54.9-151.14-82.66-10.46-5.79-13.59-20.94-6.66-30.59 5.82-9.13 18.87-12.17 28.25-6.87 69.04 37.58 138.06 75.18 207.1 112.76 3.52 1.62 5.91 4.67 8.61 7.31 15.47 0.33 30.96 0.05 46.45 0.15 41.94-61.11 83.59-122.43 125.45-183.59M169.87 336.87c-0.09 161.25 0.16 322.48 0.35 483.72 228.11-0.17 456.22-0.07 684.33-0.05-0.02-161.22 0.22-322.46 0.07-483.68-228.25 0.01-456.5-0.02-684.75 0.01M271 857.38c2.22 11.33 10.44 23.52 23 24.07 12.45-0.26 21.53-12.56 22.95-24.07-15.32 0.05-30.64 0.02-45.95 0m452.05 0c1.42 11.5 10.51 23.79 22.95 24.07 12.54-0.55 20.85-12.71 22.99-24.06-15.31 0.01-30.63 0.04-45.94-0.01z" fill="#454545" p-id="4472"></path><path d="M221.28 374.37c3.83-0.94 7.81-0.61 11.72-0.65 188.33 0.01 376.65-0.01 564.98 0.01 10.85-0.43 20.67 9.41 20.08 20.27 0.14 123.33-0.02 246.66 0.16 369.99 0.13 8.3-5.4 16.35-13.29 19-4.14 1.52-8.61 1.18-12.93 1.19-188.67-0.04-377.35 0.06-566.02-0.04-12.39 0.23-21.58-12.32-19.69-24.15 0.06-122.01 0.04-244.03 0.11-366.04-0.24-8.92 6.15-17.52 14.88-19.58M243 410.18c-0.38 112.4 0.15 224.81 0.11 337.21 179.44 0.13 358.89 0.09 538.34 0.02 0.01-112.43 0.4-224.89-0.09-337.3-179.45 0.14-358.91-0.01-538.36 0.07z" fill="#454545" p-id="4473"></path><path d="M600.4 471.55c5.06-1.37 10.69-0.78 15.28 1.8 35.65 21.33 71.26 42.72 106.91 64.07 4.92 2.83 10.29 5.72 13.05 10.95 4.45 7.6 3.2 17.98-3.01 24.24-6.32 7.05-17.67 8.31-25.62 3.34-37.26-22.4-74.56-44.75-111.83-67.13-6.4-3.83-10.36-11.35-9.78-18.79 0.31-8.57 6.75-16.33 15-18.48zM405.42 481.48c8.67-1.08 17.67 4.03 21.1 12.09 4.57 9.77-0.18 22.57-10.12 26.85-33.02 15.3-66.04 30.58-99.07 45.84-9.66 4.53-22.34-0.1-26.68-9.87-4.95-9.45-0.72-22.17 8.73-26.97 30.72-14.34 61.56-28.44 92.31-42.72 4.46-1.98 8.79-4.61 13.73-5.22zM407.29 596.31c8.9-3.09 19.57 1.06 24.09 9.31 4.37 7.1 1.79 15.88 4.5 23.51 3.44 13.44 14.3 26.79 29.14 27.09 13.98 0.07 24.84-11.84 28.91-24.34 2.31-6.05 2.52-12.54 2.96-18.9 1.17-11.04 12.56-19.47 23.46-17.43 9.81 1.3 17.53 10.53 17.35 20.37-0.08 15.28 7.21 32.12 21.92 38.44 8.4 3.65 18.6 1.7 25.5-4.2 10.37-8.44 15.16-22.11 15.17-35.21 0.14-10.37 9.36-19.53 19.73-19.62 10.15-0.64 19.85 7.53 21.03 17.62 2.16 35.45-20.4 73.22-55.9 82.28-24.72 6.92-51.53-3.48-68.08-22.38-10.45 11.74-24.48 20.62-40.07 23.39-17.51 3.32-36.18-1.22-50.48-11.76-21.88-15.69-33.94-42.91-33.43-69.55 0.28-8.35 6.19-16.17 14.2-18.62z" fill="#454545" p-id="4474"></path></svg>
                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://github.com/IsUnderAchiever'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>ä¸»é¡µ</span>
            </a>
        </li>
        
        
        <li >
            <a href='/%E5%85%B3%E4%BA%8E/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>å…³äº</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>å½’æ¡£</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>æœç´¢</span>
            </a>
        </li>
        
        
        <li >
            <a href='/%E9%93%BE%E6%8E%A5/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>é“¾æ¥</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">
                    
                        <li id="i18n-switch">  
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M4 5h7" />
  <path d="M9 3v2c0 4.418 -2.239 8 -5 8" />
  <path d="M5 9c-.003 2.144 2.952 3.908 6.7 4" />
  <path d="M12 20l4 -9l4 9" />
  <path d="M19.1 18h-6.2" />
</svg>



                            <select name="language" title="language" onchange="window.location.href = this.selectedOptions[0].value">
                                
                                    <option value="https://IsUnderAchiever.github.io/en/" >English</option>
                                
                                    <option value="https://IsUnderAchiever.github.io/" selected>ä¸­æ–‡</option>
                                
                            </select>
                        </li>
                    
                

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>æš—è‰²æ¨¡å¼</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">ç›®å½•</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#javaå¤šçº¿ç¨‹å¹¶å‘">Javaå¤šçº¿ç¨‹å¹¶å‘</a>
      <ol>
        <li><a href="#javaçº¿ç¨‹å®ç°åˆ›å»ºæ–¹å¼">Javaçº¿ç¨‹å®ç°/åˆ›å»ºæ–¹å¼</a></li>
        <li><a href="#ç»§æ‰¿threadç±»">ç»§æ‰¿Threadç±»</a></li>
        <li><a href="#å®ç°runnableæ¥å£">å®ç°Runnableæ¥å£</a></li>
        <li><a href="#å®ç°callableæ¥å£">å®ç°Callableæ¥å£</a></li>
        <li><a href="#åŸºäºçº¿ç¨‹æ± çš„æ–¹å¼">åŸºäºçº¿ç¨‹æ± çš„æ–¹å¼</a></li>
        <li><a href="#4ç§çº¿ç¨‹æ± ">4ç§çº¿ç¨‹æ± </a></li>
        <li><a href="#newcachedthreadpool">newCachedThreadPool</a></li>
        <li><a href="#newfixedthreadpool">newFixedThreadPool</a></li>
        <li><a href="#newscheduledthreadpool">newScheduledThreadPool</a></li>
        <li><a href="#newsinglethreadexecutor">newSingleThreadExecutor</a></li>
        <li><a href="#çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸçŠ¶æ€">çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸï¼ˆçŠ¶æ€ï¼‰</a></li>
        <li><a href="#æ–°å»ºçŠ¶æ€new">æ–°å»ºçŠ¶æ€ï¼ˆnewï¼‰</a></li>
        <li><a href="#å°±ç»ªçŠ¶æ€runnable">å°±ç»ªçŠ¶æ€ï¼ˆrunnableï¼‰</a></li>
        <li><a href="#è¿è¡ŒçŠ¶æ€running">è¿è¡ŒçŠ¶æ€ï¼ˆrunningï¼‰</a></li>
        <li><a href="#é˜»å¡çŠ¶æ€blocked">é˜»å¡çŠ¶æ€ï¼ˆblockedï¼‰</a></li>
        <li><a href="#çº¿ç¨‹æ­»äº¡dead">çº¿ç¨‹æ­»äº¡ï¼ˆdeadï¼‰</a></li>
        <li><a href="#ç»ˆæ­¢çº¿ç¨‹çš„4ç§æ–¹å¼">ç»ˆæ­¢çº¿ç¨‹çš„4ç§æ–¹å¼</a></li>
        <li><a href="#æ­£å¸¸è¿è¡Œç»“æŸ">æ­£å¸¸è¿è¡Œç»“æŸ</a></li>
        <li><a href="#ä½¿ç”¨é€€å‡ºæ ‡å¿—é€€å‡ºçº¿ç¨‹">ä½¿ç”¨é€€å‡ºæ ‡å¿—é€€å‡ºçº¿ç¨‹</a></li>
        <li><a href="#interruptæ–¹æ³•ç»“æŸçº¿ç¨‹">interruptæ–¹æ³•ç»“æŸçº¿ç¨‹</a></li>
        <li><a href="#stopæ–¹æ³•ç»ˆæ­¢çº¿ç¨‹çº¿ç¨‹ä¸å®‰å…¨">stopæ–¹æ³•ç»ˆæ­¢çº¿ç¨‹ï¼ˆçº¿ç¨‹ä¸å®‰å…¨ï¼‰</a></li>
        <li><a href="#sleepä¸waitåŒºåˆ«">sleepä¸waitåŒºåˆ«</a></li>
        <li><a href="#startä¸runåŒºåˆ«">startä¸runåŒºåˆ«</a></li>
        <li><a href="#javaåå°çº¿ç¨‹">Javaåå°çº¿ç¨‹</a></li>
        <li><a href="#javaé”">Javaé”</a></li>
        <li><a href="#ä¹è§‚é”">ä¹è§‚é”</a></li>
        <li><a href="#æ‚²è§‚é”">æ‚²è§‚é”</a></li>
        <li><a href="#è‡ªæ—‹é”">è‡ªæ—‹é”</a></li>
        <li><a href="#synchronizedåŒæ­¥é”">SynchronizedåŒæ­¥é”</a></li>
        <li><a href="#reentranlock">ReentranLock</a></li>
        <li><a href="#semaphoreä¿¡å·é‡">Semaphoreä¿¡å·é‡</a></li>
        <li><a href="#atomicinteger">AtomicInteger</a></li>
        <li><a href="#å¯é‡å…¥é”é€’å½’é”">å¯é‡å…¥é”ï¼ˆé€’å½’é”ï¼‰</a></li>
        <li><a href="#å…¬å¹³é”ä¸éå…¬å¹³é”">å…¬å¹³é”ä¸éå…¬å¹³é”</a></li>
        <li><a href="#readwritelockè¯»å†™é”">ReadWriteLockè¯»å†™é”</a></li>
        <li><a href="#å…±äº«é”-å’Œ-ç‹¬å é”">å…±äº«é” å’Œ ç‹¬å é”</a></li>
        <li><a href="#é‡é‡çº§é”mutex-lock">é‡é‡çº§é”ï¼ˆMutex Lockï¼‰</a></li>
        <li><a href="#è½»é‡çº§é”">è½»é‡çº§é”</a></li>
        <li><a href="#åå‘é”">åå‘é”</a></li>
        <li><a href="#åˆ†æ®µé”">åˆ†æ®µé”</a></li>
        <li><a href="#é”ä¼˜åŒ–">é”ä¼˜åŒ–</a></li>
        <li><a href="#çº¿ç¨‹åŸºæœ¬æ–¹æ³•">çº¿ç¨‹åŸºæœ¬æ–¹æ³•</a></li>
        <li><a href="#çº¿ç¨‹ç­‰å¾…wait">çº¿ç¨‹ç­‰å¾…ï¼ˆwaitï¼‰</a></li>
        <li><a href="#çº¿ç¨‹ç¡çœ sleep">çº¿ç¨‹ç¡çœ ï¼ˆsleepï¼‰</a></li>
        <li><a href="#çº¿ç¨‹è®©æ­¥yield">çº¿ç¨‹è®©æ­¥ï¼ˆyieldï¼‰</a></li>
        <li><a href="#çº¿ç¨‹ä¸­æ–­interrupt">çº¿ç¨‹ä¸­æ–­ï¼ˆinterruptï¼‰</a></li>
        <li><a href="#joinç­‰å¾…å…¶ä»–çº¿ç¨‹ç»ˆæ­¢">Joinç­‰å¾…å…¶ä»–çº¿ç¨‹ç»ˆæ­¢</a></li>
        <li><a href="#ä¸ºä»€ä¹ˆè¦ç”¨joinæ–¹æ³•">ä¸ºä»€ä¹ˆè¦ç”¨join()æ–¹æ³•</a></li>
        <li><a href="#çº¿ç¨‹å”¤é†’notify">çº¿ç¨‹å”¤é†’ï¼ˆnotifyï¼‰</a></li>
        <li><a href="#å…¶ä»–æ–¹æ³•">å…¶ä»–æ–¹æ³•</a></li>
        <li><a href="#çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢">çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢</a></li>
        <li><a href="#è¿›ç¨‹">è¿›ç¨‹</a></li>
        <li><a href="#ä¸Šä¸‹æ–‡">ä¸Šä¸‹æ–‡</a></li>
        <li><a href="#å¯„å­˜å™¨">å¯„å­˜å™¨</a></li>
        <li><a href="#ç¨‹åºè®¡æ•°å™¨">ç¨‹åºè®¡æ•°å™¨</a></li>
        <li><a href="#pcb-åˆ‡æ¢å¸§">PCB-â€œåˆ‡æ¢å¸§â€</a></li>
        <li><a href="#ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ´»åŠ¨">ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ´»åŠ¨</a></li>
        <li><a href="#å¼•èµ·çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢çš„åŸå› ">å¼•èµ·çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢çš„åŸå› </a></li>
        <li><a href="#åŒæ­¥é”-ä¸-æ­»é”">åŒæ­¥é” ä¸ æ­»é”</a></li>
        <li><a href="#åŒæ­¥é”">åŒæ­¥é”</a></li>
        <li><a href="#æ­»é”">æ­»é”</a></li>
        <li><a href="#çº¿ç¨‹æ± åŸç†">çº¿ç¨‹æ± åŸç†</a></li>
        <li><a href="#çº¿ç¨‹å¤ç”¨">çº¿ç¨‹å¤ç”¨</a></li>
        <li><a href="#çº¿ç¨‹æ± ç»„æˆ">çº¿ç¨‹æ± ç»„æˆ</a></li>
        <li><a href="#æ‹’ç»ç­–ç•¥">æ‹’ç»ç­–ç•¥</a></li>
        <li><a href="#javaçº¿ç¨‹æ± å·¥ä½œè¿‡ç¨‹">Javaçº¿ç¨‹æ± å·¥ä½œè¿‡ç¨‹</a></li>
        <li><a href="#é˜»å¡é˜Ÿåˆ—åŸç†">é˜»å¡é˜Ÿåˆ—åŸç†</a></li>
        <li><a href="#é˜»å¡é˜Ÿåˆ—çš„ä¸»è¦æ–¹æ³•">é˜»å¡é˜Ÿåˆ—çš„ä¸»è¦æ–¹æ³•</a></li>
        <li><a href="#javaä¸­çš„é˜»å¡é˜Ÿåˆ—">Javaä¸­çš„é˜»å¡é˜Ÿåˆ—</a></li>
        <li><a href="#arrayblockingqueueå…¬å¹³éå…¬å¹³">ArrayBlockingQueueï¼ˆå…¬å¹³ã€éå…¬å¹³ï¼‰</a></li>
        <li><a href="#linkedblockingqueueä¸¤ä¸ªç‹¬ç«‹é”æé«˜å¹¶å‘">LinkedBlockingQueueï¼ˆä¸¤ä¸ªç‹¬ç«‹é”æé«˜å¹¶å‘ï¼‰</a></li>
        <li><a href="#priorityblockingqueuecompare-toæ’åºå®ç°ä¼˜å…ˆ">PriorityBlockingQueueï¼ˆcompare toæ’åºå®ç°ä¼˜å…ˆï¼‰</a></li>
        <li><a href="#delayqueueç¼“å­˜å¤±æ•ˆå®šæ—¶ä»»åŠ¡">DelayQueueï¼ˆç¼“å­˜å¤±æ•ˆã€å®šæ—¶ä»»åŠ¡ï¼‰</a></li>
        <li><a href="#synchronousqueueä¸å­˜å‚¨æ•°æ®å¯ç”¨äºä¼ é€’æ•°æ®">SynchronousQueueï¼ˆä¸å­˜å‚¨æ•°æ®ã€å¯ç”¨äºä¼ é€’æ•°æ®ï¼‰</a></li>
        <li><a href="#linkedtransferqueue">LinkedTransferQueue</a></li>
        <li><a href="#linkedblockingdeque">LinkedBlockingDeque</a></li>
        <li><a href="#cyclicbarriercountdownlatchsemaphoreç”¨æ³•">CyclicBarrierã€CountDownLatchã€Semaphoreç”¨æ³•</a></li>
        <li><a href="#countdownlatchçº¿ç¨‹è®¡æ•°å™¨">CountDownLatchï¼ˆçº¿ç¨‹è®¡æ•°å™¨ï¼‰</a></li>
        <li><a href="#cyclibarrierå›ç¯æ …æ -ç­‰å¾…è‡³barrierçŠ¶æ€å†å…¨éƒ¨åŒæ—¶æ‰§è¡Œ">CycliBarrierï¼ˆå›ç¯æ …æ -ç­‰å¾…è‡³barrierçŠ¶æ€å†å…¨éƒ¨åŒæ—¶æ‰§è¡Œï¼‰</a></li>
        <li><a href="#semaphoreä¿¡å·é‡-æ§åˆ¶åŒæ—¶è®¿é—®çš„çº¿ç¨‹ä¸ªæ•°">Semaphoreï¼ˆä¿¡å·é‡-æ§åˆ¶åŒæ—¶è®¿é—®çš„çº¿ç¨‹ä¸ªæ•°ï¼‰</a></li>
        <li><a href="#volatileå…³é”®å­—çš„ä½œç”¨å˜é‡å¯è§æ€§ç¦æ­¢é‡æ’åº">volatileå…³é”®å­—çš„ä½œç”¨ï¼ˆå˜é‡å¯è§æ€§ã€ç¦æ­¢é‡æ’åºï¼‰</a></li>
        <li><a href="#å¦‚ä½•åœ¨ä¸¤ä¸ªçº¿ç¨‹ä¹‹é—´å…±äº«æ•°æ®">å¦‚ä½•åœ¨ä¸¤ä¸ªçº¿ç¨‹ä¹‹é—´å…±äº«æ•°æ®</a></li>
        <li><a href="#threadlocalä½œç”¨çº¿æ€§æœ¬åœ°å­˜å‚¨">ThreadLocalä½œç”¨ï¼ˆçº¿æ€§æœ¬åœ°å­˜å‚¨ï¼‰</a></li>
        <li><a href="#synchronized-å’Œ-reentrantlock-çš„åŒºåˆ«">Synchronized å’Œ ReentrantLock çš„åŒºåˆ«</a></li>
        <li><a href="#ä¸¤è€…çš„å…±åŒç‚¹">ä¸¤è€…çš„å…±åŒç‚¹</a></li>
        <li><a href="#ä¸¤è€…çš„ä¸åŒç‚¹">ä¸¤è€…çš„ä¸åŒç‚¹</a></li>
        <li><a href="#concurrenthashmapå¹¶å‘">ConcurrentHashMapå¹¶å‘</a></li>
        <li><a href="#å‡å°é”ç²’åº¦">å‡å°é”ç²’åº¦</a></li>
        <li><a href="#concurrenthashmapåˆ†æ®µé”">ConcurrentHashMapåˆ†æ®µé”</a></li>
        <li><a href="#javaä¸­ç”¨åˆ°çš„çº¿ç¨‹è°ƒåº¦">Javaä¸­ç”¨åˆ°çš„çº¿ç¨‹è°ƒåº¦</a></li>
        <li><a href="#æŠ¢å å¼è°ƒåº¦">æŠ¢å å¼è°ƒåº¦</a></li>
        <li><a href="#ååŒå¼è°ƒåº¦">ååŒå¼è°ƒåº¦</a></li>
        <li><a href="#jvmçš„çº¿ç¨‹è°ƒåº¦å®ç°æŠ¢å å¼è°ƒåº¦">jvmçš„çº¿ç¨‹è°ƒåº¦å®ç°ï¼ˆæŠ¢å å¼è°ƒåº¦ï¼‰</a></li>
        <li><a href="#çº¿ç¨‹è®©å‡ºcpuçš„æƒ…å†µ">çº¿ç¨‹è®©å‡ºCPUçš„æƒ…å†µ</a></li>
        <li><a href="#è¿›ç¨‹è°ƒåº¦ç®—æ³•">è¿›ç¨‹è°ƒåº¦ç®—æ³•</a></li>
        <li><a href="#ä¼˜å…ˆè°ƒåº¦ç®—æ³•">ä¼˜å…ˆè°ƒåº¦ç®—æ³•</a></li>
        <li><a href="#é«˜ä¼˜å…ˆæƒä¼˜å…ˆè°ƒåº¦ç®—æ³•">é«˜ä¼˜å…ˆæƒä¼˜å…ˆè°ƒåº¦ç®—æ³•</a></li>
        <li><a href="#åŸºäºæ—¶é—´ç‰‡çš„è½®è½¬è°ƒåº¦ç®—æ³•">åŸºäºæ—¶é—´ç‰‡çš„è½®è½¬è°ƒåº¦ç®—æ³•</a></li>
        <li><a href="#ä»€ä¹ˆæ˜¯casæ¯”è¾ƒå¹¶äº¤æ¢-ä¹è§‚é”æœºåˆ¶-é”è‡ªæ—‹">ä»€ä¹ˆæ˜¯CASï¼ˆæ¯”è¾ƒå¹¶äº¤æ¢-ä¹è§‚é”æœºåˆ¶-é”è‡ªæ—‹ï¼‰</a></li>
        <li><a href="#æ¦‚å¿µåŠç‰¹æ€§">æ¦‚å¿µåŠç‰¹æ€§</a></li>
        <li><a href="#åŸå­åŒ…javautilconcurrentatomicé”è‡ªæ—‹">åŸå­åŒ…java.util.concurrent.atomicï¼ˆé”è‡ªæ—‹ï¼‰</a></li>
        <li><a href="#abaé—®é¢˜">ABAé—®é¢˜</a></li>
        <li><a href="#ä»€ä¹ˆæ˜¯aqsæŠ½è±¡çš„é˜Ÿåˆ—åŒæ­¥å™¨">ä»€ä¹ˆæ˜¯AQSï¼ˆæŠ½è±¡çš„é˜Ÿåˆ—åŒæ­¥å™¨ï¼‰</a></li>
      </ol>
    </li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="has-image main-article">
    <header class="article-header">
    <div class="article-image">
        <a href="/p/03_java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%B9%B6%E5%8F%91/">
            <img src="/p/03_java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%B9%B6%E5%8F%91/202412212036798_hu18039036192235098014.png" srcset="/p/03_java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%B9%B6%E5%8F%91/202412212036798_hu18039036192235098014.png 800w, /p/03_java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%B9%B6%E5%8F%91/202412212036798_hu4878295368521336578.png 1600w"  width="800"
                height="231" loading="lazy" alt="Featured image of post 03_Javaå¤šçº¿ç¨‹å¹¶å‘" />
            
        </a>
    </div>
    

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/java/" style="background-color: #2a9d8f; color: #fff;">
                Java
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/03_java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%B9%B6%E5%8F%91/">03_Javaå¤šçº¿ç¨‹å¹¶å‘</a>
        </h2>
    
        
        <h3 class="article-subtitle">
            03_Javaå¤šçº¿ç¨‹å¹¶å‘
        </h3>
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">2022-12-17</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    é˜…è¯»æ—¶é•¿: 60 åˆ†é’Ÿ
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
<script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>


    <section class="article-content">
    
    
    <h2 id="javaå¤šçº¿ç¨‹å¹¶å‘">Javaå¤šçº¿ç¨‹å¹¶å‘
</h2><h3 id="javaçº¿ç¨‹å®ç°åˆ›å»ºæ–¹å¼">Javaçº¿ç¨‹å®ç°/åˆ›å»ºæ–¹å¼
</h3><h3 id="ç»§æ‰¿threadç±»">ç»§æ‰¿Threadç±»
</h3><blockquote>
<p>Thread ç±»æœ¬è´¨ä¸Šæ˜¯å®ç°äº† Runnable æ¥å£çš„ä¸€ä¸ªå®ä¾‹ï¼Œä»£è¡¨ä¸€ä¸ªçº¿ç¨‹çš„å®ä¾‹ã€‚å¯åŠ¨çº¿ç¨‹çš„å”¯ä¸€æ–¹æ³•å°±æ˜¯é€šè¿‡ Thread ç±»çš„ start()å®ä¾‹æ–¹æ³•ã€‚start()æ–¹æ³•æ˜¯ä¸€ä¸ª native æ–¹æ³•ï¼Œå®ƒå°†å¯åŠ¨ä¸€ä¸ªæ–°çº¿ç¨‹ï¼Œå¹¶æ‰§è¡Œ run()æ–¹æ³•ã€‚</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MyThread</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">Thread</span><span class="w"> </span><span class="p">{</span><span class="w">   
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">   
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;MyThread.run()&#34;</span><span class="p">);</span><span class="w">   
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">   
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">   
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">MyThread</span><span class="w"> </span><span class="n">myThread1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">MyThread</span><span class="p">();</span><span class="w">   
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">myThreadstart</span><span class="p">();</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="å®ç°runnableæ¥å£">å®ç°Runnableæ¥å£
</h3><blockquote>
<p>å¦‚æœè‡ªå·±çš„ç±»å·²ç» extends å¦ä¸€ä¸ªç±»ï¼Œå°±æ— æ³•ç›´æ¥ extends Threadï¼Œæ­¤æ—¶ï¼Œå¯ä»¥å®ç°ä¸€ä¸ªRunnable æ¥å£ã€‚</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MyThread</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">OtherClass</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Runnable</span><span class="w"> </span><span class="p">{</span><span class="w">   
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">   
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;MyThread.run()&#34;</span><span class="p">);</span><span class="w">   
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">   
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">   
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">//å¯åŠ¨ MyThreadï¼Œéœ€è¦é¦–å…ˆå®ä¾‹åŒ–ä¸€ä¸ª Threadï¼Œå¹¶ä¼ å…¥è‡ªå·±çš„ MyThread å®ä¾‹ï¼š  </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">MyThread</span><span class="w"> </span><span class="n">myThread</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">MyThread</span><span class="p">();</span><span class="w">   
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Thread</span><span class="w"> </span><span class="n">thread</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Thread</span><span class="p">(</span><span class="n">myThread</span><span class="p">);</span><span class="w">   
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">thread</span><span class="p">.</span><span class="na">start</span><span class="p">();</span><span class="w">   
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">//äº‹å®ä¸Šï¼Œå½“ä¼ å…¥ä¸€ä¸ª Runnable target å‚æ•°ç»™ Thread åï¼ŒThread çš„ run()æ–¹æ³•å°±ä¼šè°ƒç”¨  </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">target</span><span class="p">.</span><span class="na">run</span><span class="p">()</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">   
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">target</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">   
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">target</span><span class="p">.</span><span class="na">run</span><span class="p">();</span><span class="w">   
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">   
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="å®ç°callableæ¥å£">å®ç°Callableæ¥å£
</h3><blockquote>
<p>æœ‰è¿”å›å€¼çš„ä»»åŠ¡å¿…é¡»å®ç° Callable æ¥å£ï¼Œç±»ä¼¼çš„ï¼Œæ— è¿”å›å€¼çš„ä»»åŠ¡å¿…é¡»å®ç° Runnable æ¥å£ã€‚<br>
æ‰§è¡ŒCallable ä»»åŠ¡åï¼Œå¯ä»¥è·å–ä¸€ä¸ª Future çš„å¯¹è±¡ï¼Œåœ¨è¯¥å¯¹è±¡ä¸Šè°ƒç”¨ get å°±å¯ä»¥è·å–åˆ° Callable ä»»åŠ¡è¿”å›çš„ Object äº†ï¼Œå†ç»“åˆçº¿ç¨‹æ± æ¥å£ ExecutorService å°±å¯ä»¥å®ç°ä¼ è¯´ä¸­æœ‰è¿”å›ç»“æœçš„å¤šçº¿ç¨‹äº†ã€‚</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">//åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ±   </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">ExecutorService</span><span class="w"> </span><span class="n">pool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Executors</span><span class="p">.</span><span class="na">newFixedThreadPool</span><span class="p">(</span><span class="n">taskSize</span><span class="p">);</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// åˆ›å»ºå¤šä¸ªæœ‰è¿”å›å€¼çš„ä»»åŠ¡  </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">List</span><span class="o">&lt;</span><span class="n">Future</span><span class="o">&gt;</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Future</span><span class="o">&gt;</span><span class="p">();</span><span class="w">   
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">taskSize</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">   
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Callable</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">MyCallable</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34; &#34;</span><span class="p">);</span><span class="w">   
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// æ‰§è¡Œä»»åŠ¡å¹¶è·å– Future å¯¹è±¡  </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Future</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pool</span><span class="p">.</span><span class="na">submit</span><span class="p">(</span><span class="n">c</span><span class="p">);</span><span class="w">   
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">list</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">f</span><span class="p">);</span><span class="w">   
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">   
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// å…³é—­çº¿ç¨‹æ±   </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">pool</span><span class="p">.</span><span class="na">shutdown</span><span class="p">();</span><span class="w">   
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// è·å–æ‰€æœ‰å¹¶å‘ä»»åŠ¡çš„è¿è¡Œç»“æœ  </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">Future</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">list</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">   
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// ä» Future å¯¹è±¡ä¸Šè·å–ä»»åŠ¡çš„è¿”å›å€¼ï¼Œå¹¶è¾“å‡ºåˆ°æ§åˆ¶å°  </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;resï¼š&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="na">get</span><span class="p">().</span><span class="na">toString</span><span class="p">());</span><span class="w">   
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="åŸºäºçº¿ç¨‹æ± çš„æ–¹å¼">åŸºäºçº¿ç¨‹æ± çš„æ–¹å¼
</h3><blockquote>
<p>çº¿ç¨‹å’Œæ•°æ®åº“è¿æ¥è¿™äº›èµ„æºéƒ½æ˜¯éå¸¸å®è´µçš„èµ„æºã€‚é‚£ä¹ˆæ¯æ¬¡éœ€è¦çš„æ—¶å€™åˆ›å»ºï¼Œä¸éœ€è¦çš„æ—¶å€™é”€æ¯ï¼Œæ˜¯éå¸¸æµªè´¹èµ„æºçš„ã€‚é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ç¼“å­˜çš„ç­–ç•¥ï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨çº¿ç¨‹æ± ã€‚</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// åˆ›å»ºçº¿ç¨‹æ±   </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">ExecutorService</span><span class="w"> </span><span class="n">threadPool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Executors</span><span class="p">.</span><span class="na">newFixedThreadPool</span><span class="p">(</span><span class="n">10</span><span class="p">);</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">while</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">threadPool</span><span class="p">.</span><span class="na">execute</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Runnable</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// æäº¤å¤šä¸ªçº¿ç¨‹ä»»åŠ¡ï¼Œå¹¶æ‰§è¡Œ  </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nd">@Override</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">().</span><span class="na">getName</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34; is running ..&#34;</span><span class="p">);</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">Thread</span><span class="p">.</span><span class="na">sleep</span><span class="p">(</span><span class="n">3000</span><span class="p">);</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">InterruptedException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">});</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="4ç§çº¿ç¨‹æ± ">4ç§çº¿ç¨‹æ± 
</h3><blockquote>
<p>Java é‡Œé¢çº¿ç¨‹æ± çš„é¡¶çº§æ¥å£æ˜¯ Executorï¼Œä½†æ˜¯ä¸¥æ ¼æ„ä¹‰ä¸Šè®² Executor å¹¶ä¸æ˜¯ä¸€ä¸ªçº¿ç¨‹æ± ï¼Œè€Œåªæ˜¯ä¸€ä¸ªæ‰§è¡Œçº¿ç¨‹çš„å·¥å…·ã€‚çœŸæ­£çš„çº¿ç¨‹æ± æ¥å£æ˜¯ ExecutorServiceã€‚</p>
</blockquote>
<h3 id="newcachedthreadpool">newCachedThreadPool
</h3><blockquote>
<p>åˆ›å»ºä¸€ä¸ªå¯æ ¹æ®éœ€è¦åˆ›å»ºæ–°çº¿ç¨‹çš„çº¿ç¨‹æ± ï¼Œä½†æ˜¯åœ¨ä»¥å‰æ„é€ çš„çº¿ç¨‹å¯ç”¨æ—¶å°†é‡ç”¨å®ƒä»¬ã€‚å¯¹äºæ‰§è¡Œå¾ˆå¤šçŸ­æœŸå¼‚æ­¥ä»»åŠ¡çš„ç¨‹åºè€Œè¨€ï¼Œè¿™äº›çº¿ç¨‹æ± é€šå¸¸å¯æé«˜ç¨‹åºæ€§èƒ½ã€‚è°ƒç”¨ execute å°†é‡ç”¨ä»¥å‰æ„é€ çš„çº¿ç¨‹ï¼ˆå¦‚æœçº¿ç¨‹å¯ç”¨ï¼‰ã€‚å¦‚æœç°æœ‰çº¿ç¨‹æ²¡æœ‰å¯ç”¨çš„ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹å¹¶æ·»åŠ åˆ°æ± ä¸­ã€‚ç»ˆæ­¢å¹¶ä»ç¼“å­˜ä¸­ç§»é™¤é‚£äº›å·²æœ‰ 60 ç§’é’Ÿæœªè¢«ä½¿ç”¨çš„çº¿ç¨‹ã€‚å› æ­¤ï¼Œé•¿æ—¶é—´ä¿æŒç©ºé—²çš„çº¿ç¨‹æ± ä¸ä¼šä½¿ç”¨ä»»ä½•èµ„æºã€‚</p>
</blockquote>
<h3 id="newfixedthreadpool">newFixedThreadPool
</h3><blockquote>
<p>åˆ›å»ºä¸€ä¸ªå¯é‡ç”¨å›ºå®šçº¿ç¨‹æ•°çš„çº¿ç¨‹æ± ï¼Œä»¥å…±äº«çš„æ— ç•Œé˜Ÿåˆ—æ–¹å¼æ¥è¿è¡Œè¿™äº›çº¿ç¨‹ã€‚åœ¨ä»»æ„ç‚¹ï¼Œåœ¨å¤§å¤šæ•° nThreads çº¿ç¨‹ä¼šå¤„äºå¤„ç†ä»»åŠ¡çš„æ´»åŠ¨çŠ¶æ€ã€‚å¦‚æœåœ¨æ‰€æœ‰çº¿ç¨‹å¤„äºæ´»åŠ¨çŠ¶æ€æ—¶æäº¤é™„åŠ ä»»åŠ¡ï¼Œåˆ™åœ¨æœ‰å¯ç”¨çº¿ç¨‹ä¹‹å‰ï¼Œé™„åŠ ä»»åŠ¡å°†åœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…ã€‚å¦‚æœåœ¨å…³é—­å‰çš„æ‰§è¡ŒæœŸé—´ç”±äºå¤±è´¥è€Œå¯¼è‡´ä»»ä½•çº¿ç¨‹ç»ˆæ­¢ï¼Œé‚£ä¹ˆä¸€ä¸ªæ–°çº¿ç¨‹å°†ä»£æ›¿å®ƒæ‰§è¡Œåç»­çš„ä»»åŠ¡ï¼ˆå¦‚æœéœ€è¦ï¼‰ã€‚åœ¨æŸä¸ªçº¿ç¨‹è¢«æ˜¾å¼åœ°å…³é—­ä¹‹å‰ï¼Œæ± ä¸­çš„çº¿ç¨‹å°†ä¸€ç›´å­˜åœ¨ã€‚</p>
</blockquote>
<h3 id="newscheduledthreadpool">newScheduledThreadPool
</h3><blockquote>
<p>åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± ï¼Œå®ƒå¯å®‰æ’åœ¨ç»™å®šå»¶è¿Ÿåè¿è¡Œå‘½ä»¤æˆ–è€…å®šæœŸåœ°æ‰§è¡Œã€‚</p>
<div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>è¡¨å¤´</th>
          <th>è¡¨å¤´</th>
      </tr>
  </thead>
  <tbody>
  </tbody>
</table></div>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">ScheduledExecutorService</span><span class="w"> </span><span class="n">scheduledThreadPool</span><span class="o">=</span><span class="w"> </span><span class="n">Executors</span><span class="p">.</span><span class="na">newScheduledThreadPool</span><span class="p">(</span><span class="n">3</span><span class="p">);</span><span class="w">   
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">scheduledThreadPool</span><span class="p">.</span><span class="na">schedule</span><span class="p">(</span><span class="n">newRunnable</span><span class="p">(){</span><span class="w">   
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">   
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;å»¶è¿Ÿä¸‰ç§’&#34;</span><span class="p">);</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">},</span><span class="w"> </span><span class="n">3</span><span class="p">,</span><span class="w"> </span><span class="n">TimeUnit</span><span class="p">.</span><span class="na">SECONDS</span><span class="p">);</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">scheduledThreadPool</span><span class="p">.</span><span class="na">scheduleAtFixedRate</span><span class="p">(</span><span class="n">newRunnable</span><span class="p">(){</span><span class="w">   
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">   
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;å»¶è¿Ÿ 1 ç§’åæ¯ä¸‰ç§’æ‰§è¡Œä¸€æ¬¡&#34;</span><span class="p">);</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">},</span><span class="n">1</span><span class="p">,</span><span class="n">3</span><span class="p">,</span><span class="n">TimeUnit</span><span class="p">.</span><span class="na">SECONDS</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="newsinglethreadexecutor">newSingleThreadExecutor
</h3><blockquote>
<p>Executors.newSingleThreadExecutor()è¿”å›ä¸€ä¸ªçº¿ç¨‹æ± ï¼ˆè¿™ä¸ªçº¿ç¨‹æ± åªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼‰,è¿™ä¸ªçº¿ç¨‹æ± å¯ä»¥åœ¨çº¿ç¨‹æ­»åï¼ˆæˆ–å‘ç”Ÿå¼‚å¸¸æ—¶ï¼‰é‡æ–°å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹æ¥æ›¿ä»£åŸæ¥çš„çº¿ç¨‹ç»§ç»­æ‰§è¡Œä¸‹å»ã€‚</p>
</blockquote>
<h3 id="çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸçŠ¶æ€">çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸï¼ˆçŠ¶æ€ï¼‰
</h3><blockquote>
<p>å½“çº¿ç¨‹è¢«åˆ›å»ºå¹¶å¯åŠ¨ä»¥åï¼Œå®ƒæ—¢ä¸æ˜¯ä¸€å¯åŠ¨å°±è¿›å…¥äº†æ‰§è¡ŒçŠ¶æ€ï¼Œä¹Ÿä¸æ˜¯ä¸€ç›´å¤„äºæ‰§è¡ŒçŠ¶æ€ã€‚åœ¨çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œå®ƒè¦ç»è¿‡æ–°å»º(New)ã€å°±ç»ªï¼ˆRunnableï¼‰ã€è¿è¡Œï¼ˆRunningï¼‰ã€é˜»å¡(Blocked)å’Œæ­»äº¡(Dead)5 ç§çŠ¶æ€ã€‚å°¤å…¶æ˜¯å½“çº¿ç¨‹å¯åŠ¨ä»¥åï¼Œå®ƒä¸å¯èƒ½ä¸€ç›´éœ¸å ç€ CPU ç‹¬è‡ªè¿è¡Œï¼Œæ‰€ä»¥ CPU éœ€è¦åœ¨å¤šæ¡çº¿ç¨‹ä¹‹é—´åˆ‡æ¢ï¼Œäºæ˜¯çº¿ç¨‹çŠ¶æ€ä¹Ÿä¼šå¤šæ¬¡åœ¨è¿è¡Œã€é˜»å¡ä¹‹é—´åˆ‡æ¢ã€‚</p>
</blockquote>
<h3 id="æ–°å»ºçŠ¶æ€new">æ–°å»ºçŠ¶æ€ï¼ˆnewï¼‰
</h3><blockquote>
<p>å½“ç¨‹åºä½¿ç”¨ new å…³é”®å­—åˆ›å»ºäº†ä¸€ä¸ªçº¿ç¨‹ä¹‹åï¼Œè¯¥çº¿ç¨‹å°±å¤„äºæ–°å»ºçŠ¶æ€ï¼Œæ­¤æ—¶ä»…ç”± JVM ä¸ºå…¶åˆ†é…å†…å­˜ï¼Œå¹¶åˆå§‹åŒ–å…¶æˆå‘˜å˜é‡çš„å€¼ã€‚</p>
</blockquote>
<h3 id="å°±ç»ªçŠ¶æ€runnable">å°±ç»ªçŠ¶æ€ï¼ˆrunnableï¼‰
</h3><blockquote>
<p>å½“çº¿ç¨‹å¯¹è±¡è°ƒç”¨äº† start()æ–¹æ³•ä¹‹åï¼Œè¯¥çº¿ç¨‹å¤„äºå°±ç»ªçŠ¶æ€ã€‚Java è™šæ‹Ÿæœºä¼šä¸ºå…¶åˆ›å»ºæ–¹æ³•è°ƒç”¨æ ˆå’Œç¨‹åºè®¡æ•°å™¨ï¼Œç­‰å¾…è°ƒåº¦è¿è¡Œã€‚</p>
</blockquote>
<h3 id="è¿è¡ŒçŠ¶æ€running">è¿è¡ŒçŠ¶æ€ï¼ˆrunningï¼‰
</h3><blockquote>
<p>å¦‚æœå¤„äºå°±ç»ªçŠ¶æ€çš„çº¿ç¨‹è·å¾—äº† CPUï¼Œå¼€å§‹æ‰§è¡Œ run()æ–¹æ³•çš„çº¿ç¨‹æ‰§è¡Œä½“ï¼Œåˆ™è¯¥çº¿ç¨‹å¤„äºè¿è¡ŒçŠ¶æ€ã€‚</p>
</blockquote>
<h3 id="é˜»å¡çŠ¶æ€blocked">é˜»å¡çŠ¶æ€ï¼ˆblockedï¼‰
</h3><blockquote>
<p>é˜»å¡çŠ¶æ€æ˜¯æŒ‡çº¿ç¨‹å› ä¸ºæŸç§åŸå› æ”¾å¼ƒäº† cpu ä½¿ç”¨æƒï¼Œä¹Ÿå³è®©å‡ºäº† cpu timesliceï¼Œæš‚æ—¶åœæ­¢è¿è¡Œã€‚ç›´åˆ°çº¿ç¨‹è¿›å…¥å¯è¿è¡Œ(runnable)çŠ¶æ€ï¼Œæ‰æœ‰æœºä¼šå†æ¬¡è·å¾— cpu timeslice è½¬åˆ°è¿è¡Œ(running)çŠ¶æ€ã€‚é˜»å¡çš„æƒ…å†µåˆ†ä¸‰ç§ï¼š</p>
</blockquote>
<ol>
<li>
<blockquote>
<p>ç­‰å¾…é˜»å¡ï¼ˆo.wait-&gt;ç­‰å¾…å¯¹åˆ—ï¼‰
è¿è¡Œ(running)çš„çº¿ç¨‹æ‰§è¡Œ o.wait()æ–¹æ³•ï¼ŒJVM ä¼šæŠŠè¯¥çº¿ç¨‹æ”¾å…¥ç­‰å¾…é˜Ÿåˆ—(waitting queue)ä¸­ã€‚</p>
</blockquote>
</li>
<li>
<blockquote>
<p>åŒæ­¥é˜»å¡(lock-&gt;é”æ± )
è¿è¡Œ(running)çš„çº¿ç¨‹åœ¨è·å–å¯¹è±¡çš„åŒæ­¥é”æ—¶ï¼Œè‹¥è¯¥åŒæ­¥é”è¢«åˆ«çš„çº¿ç¨‹å ç”¨ï¼Œåˆ™ JVM ä¼šæŠŠè¯¥çº¿ç¨‹æ”¾å…¥é”æ± (lock pool)ä¸­ã€‚</p>
</blockquote>
</li>
<li>
<blockquote>
<p>å…¶ä»–é˜»å¡(sleep/join)
è¿è¡Œ(running)çš„çº¿ç¨‹æ‰§è¡Œ Thread.sleep(long ms)æˆ– t.join()æ–¹æ³•ï¼Œæˆ–è€…å‘å‡ºäº† I/O è¯·æ±‚æ—¶ï¼ŒJVM ä¼šæŠŠè¯¥çº¿ç¨‹ç½®ä¸ºé˜»å¡çŠ¶æ€ã€‚å½“ sleep()çŠ¶æ€è¶…æ—¶ã€join()ç­‰å¾…çº¿ç¨‹ç»ˆæ­¢æˆ–è€…è¶…æ—¶ã€æˆ–è€… I/Oå¤„ç†å®Œæ¯•æ—¶ï¼Œçº¿ç¨‹é‡æ–°è½¬å…¥å¯è¿è¡Œ(runnable)çŠ¶æ€ã€‚</p>
</blockquote>
</li>
</ol>
<h3 id="çº¿ç¨‹æ­»äº¡dead">çº¿ç¨‹æ­»äº¡ï¼ˆdeadï¼‰
</h3><blockquote>
<p>çº¿ç¨‹ä¼šä»¥ä¸‹é¢ä¸‰ç§æ–¹å¼ç»“æŸï¼Œç»“æŸåå°±æ˜¯æ­»äº¡çŠ¶æ€ã€‚<br>
æ­£å¸¸ç»“æŸï¼šrun()æˆ– call()æ–¹æ³•æ‰§è¡Œå®Œæˆï¼Œçº¿ç¨‹æ­£å¸¸ç»“æŸã€‚
å¼‚å¸¸ç»“æŸï¼šçº¿ç¨‹æŠ›å‡ºä¸€ä¸ªæœªæ•è·çš„ Exception æˆ– Errorã€‚
è°ƒç”¨ stopï¼šç›´æ¥è°ƒç”¨è¯¥çº¿ç¨‹çš„ stop()æ–¹æ³•æ¥ç»“æŸè¯¥çº¿ç¨‹â€”è¯¥æ–¹æ³•é€šå¸¸å®¹æ˜“å¯¼è‡´æ­»é”ï¼Œä¸æ¨èä½¿ç”¨ã€‚

<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/202301201940930.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo01/202301201940930.png" alt="çº¿ç¨‹çŠ¶æ€è½¬æ¢"  />
	</a>
</div>
</p>
</blockquote>
<h3 id="ç»ˆæ­¢çº¿ç¨‹çš„4ç§æ–¹å¼">ç»ˆæ­¢çº¿ç¨‹çš„4ç§æ–¹å¼
</h3><h3 id="æ­£å¸¸è¿è¡Œç»“æŸ">æ­£å¸¸è¿è¡Œç»“æŸ
</h3><blockquote>
<p>ç¨‹åºè¿è¡Œç»“æŸï¼Œçº¿ç¨‹è‡ªåŠ¨ç»“æŸã€‚</p>
</blockquote>
<h3 id="ä½¿ç”¨é€€å‡ºæ ‡å¿—é€€å‡ºçº¿ç¨‹">ä½¿ç”¨é€€å‡ºæ ‡å¿—é€€å‡ºçº¿ç¨‹
</h3><blockquote>
<p>ä¸€èˆ¬ run()æ–¹æ³•æ‰§è¡Œå®Œï¼Œçº¿ç¨‹å°±ä¼šæ­£å¸¸ç»“æŸï¼Œç„¶è€Œï¼Œå¸¸å¸¸æœ‰äº›çº¿ç¨‹æ˜¯ä¼ºæœçº¿ç¨‹ã€‚å®ƒä»¬éœ€è¦é•¿æ—¶é—´çš„è¿è¡Œï¼Œåªæœ‰åœ¨å¤–éƒ¨æŸäº›æ¡ä»¶æ»¡è¶³çš„æƒ…å†µä¸‹ï¼Œæ‰èƒ½å…³é—­è¿™äº›çº¿ç¨‹ã€‚ ä½¿ç”¨ä¸€ä¸ªå˜é‡æ¥æ§åˆ¶å¾ªç¯ï¼Œä¾‹å¦‚ï¼šæœ€ç›´æ¥çš„æ–¹æ³•å°±æ˜¯è®¾ä¸€ä¸ª boolean ç±»å‹çš„æ ‡å¿—ï¼Œå¹¶é€šè¿‡è®¾ç½®è¿™ä¸ªæ ‡å¿—ä¸º true æˆ– false æ¥æ§åˆ¶ whileå¾ªç¯æ˜¯å¦é€€å‡ºï¼Œä»£ç ç¤ºä¾‹ï¼š</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ThreadSafe</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">Thread</span><span class="w"> </span><span class="p">{</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">volatile</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">exit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w">   
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">   
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">exit</span><span class="p">){</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">//do something  </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">   
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>å®šä¹‰äº†ä¸€ä¸ªé€€å‡ºæ ‡å¿— exitï¼Œå½“ exit ä¸º true æ—¶ï¼Œwhile å¾ªç¯é€€å‡ºï¼Œexit çš„é»˜è®¤å€¼ä¸º false.åœ¨å®šä¹‰ exitæ—¶ï¼Œä½¿ç”¨äº†ä¸€ä¸ª Java å…³é”®å­— volatile ï¼Œè¿™ä¸ªå…³é”®å­—çš„ç›®çš„æ˜¯ä½¿ exit åŒæ­¥ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨åŒä¸€æ—¶åˆ»åªèƒ½ç”±ä¸€ä¸ªçº¿ç¨‹æ¥ä¿®æ”¹ exit çš„å€¼ã€‚</p>
</blockquote>
<h3 id="interruptæ–¹æ³•ç»“æŸçº¿ç¨‹">interruptæ–¹æ³•ç»“æŸçº¿ç¨‹
</h3><blockquote>
<p>ä½¿ç”¨ interrupt()æ–¹æ³•æ¥ä¸­æ–­çº¿ç¨‹æœ‰ä¸¤ç§æƒ…å†µï¼š</p>
</blockquote>
<ol>
<li>çº¿ç¨‹å¤„äºé˜»å¡çŠ¶æ€ï¼šå¦‚ä½¿ç”¨äº† sleep,åŒæ­¥é”çš„ wait,socket ä¸­çš„ receiver,accept ç­‰æ–¹æ³•æ—¶ï¼Œä¼šä½¿çº¿ç¨‹å¤„äºé˜»å¡çŠ¶æ€ã€‚å½“è°ƒç”¨çº¿ç¨‹çš„ interrupt()æ–¹æ³•æ—¶ï¼Œä¼šæŠ›å‡º InterruptException å¼‚å¸¸ã€‚é˜»å¡ä¸­çš„é‚£ä¸ªæ–¹æ³•æŠ›å‡ºè¿™ä¸ªå¼‚å¸¸ï¼Œé€šè¿‡ä»£ç æ•è·è¯¥å¼‚å¸¸ï¼Œç„¶å break è·³å‡ºå¾ªç¯çŠ¶æ€ï¼Œä»è€Œè®©æˆ‘ä»¬æœ‰æœºä¼šç»“æŸè¿™ä¸ªçº¿ç¨‹çš„æ‰§è¡Œã€‚é€šå¸¸å¾ˆå¤šäººè®¤ä¸ºåªè¦è°ƒç”¨ interrupt æ–¹æ³•çº¿ç¨‹å°±ä¼šç»“æŸï¼Œå®é™…ä¸Šæ˜¯é”™çš„ï¼Œ ä¸€å®šè¦å…ˆæ•è· InterruptedException å¼‚å¸¸ä¹‹åé€šè¿‡ break æ¥è·³å‡ºå¾ªç¯ï¼Œæ‰èƒ½æ­£å¸¸ç»“æŸ run æ–¹æ³•</li>
<li>çº¿ç¨‹æœªå¤„äºé˜»å¡çŠ¶æ€ï¼šä½¿ç”¨ isInterrupted()åˆ¤æ–­çº¿ç¨‹çš„ä¸­æ–­æ ‡å¿—æ¥é€€å‡ºå¾ªç¯ã€‚å½“ä½¿ç”¨interrupt()æ–¹æ³•æ—¶ï¼Œä¸­æ–­æ ‡å¿—å°±ä¼šç½® trueï¼Œå’Œä½¿ç”¨è‡ªå®šä¹‰çš„æ ‡å¿—æ¥æ§åˆ¶å¾ªç¯æ˜¯ä¸€æ ·çš„é“ç†ã€‚
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ThreadSafe</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">Thread</span><span class="w"> </span><span class="p">{</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">   
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">isInterrupted</span><span class="p">()){</span><span class="w"> </span><span class="c1">//éé˜»å¡è¿‡ç¨‹ä¸­é€šè¿‡åˆ¤æ–­ä¸­æ–­æ ‡å¿—æ¥é€€å‡º  </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">try</span><span class="p">{</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">Thread</span><span class="p">.</span><span class="na">sleep</span><span class="p">(</span><span class="n">5</span><span class="o">*</span><span class="n">1000</span><span class="p">);</span><span class="c1">//é˜»å¡è¿‡ç¨‹æ•è·ä¸­æ–­å¼‚å¸¸æ¥é€€å‡º  </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="n">InterruptedException</span><span class="w"> </span><span class="n">e</span><span class="p">){</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">break</span><span class="p">;</span><span class="c1">//æ•è·åˆ°å¼‚å¸¸ä¹‹åï¼Œæ‰§è¡Œ break è·³å‡ºå¾ªç¯  </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">   
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div></li>
</ol>
<h3 id="stopæ–¹æ³•ç»ˆæ­¢çº¿ç¨‹çº¿ç¨‹ä¸å®‰å…¨">stopæ–¹æ³•ç»ˆæ­¢çº¿ç¨‹ï¼ˆçº¿ç¨‹ä¸å®‰å…¨ï¼‰
</h3><blockquote>
<p>ç¨‹åºä¸­å¯ä»¥ç›´æ¥ä½¿ç”¨ thread.stop()æ¥å¼ºè¡Œç»ˆæ­¢çº¿ç¨‹ï¼Œä½†æ˜¯ stop æ–¹æ³•æ˜¯å¾ˆå±é™©çš„ï¼Œå°±è±¡çªç„¶å…³é—­è®¡ç®—æœºç”µæºï¼Œè€Œä¸æ˜¯æŒ‰æ­£å¸¸ç¨‹åºå…³æœºä¸€æ ·ï¼Œå¯èƒ½ä¼šäº§ç”Ÿä¸å¯é¢„æ–™çš„ç»“æœï¼Œä¸å®‰å…¨ä¸»è¦æ˜¯ï¼šthread.stop()è°ƒç”¨ä¹‹åï¼Œåˆ›å»ºå­çº¿ç¨‹çš„çº¿ç¨‹å°±ä¼šæŠ›å‡º ThreadDeatherror çš„é”™è¯¯ï¼Œå¹¶ä¸”ä¼šé‡Šæ”¾å­çº¿ç¨‹æ‰€æŒæœ‰çš„æ‰€æœ‰é”ã€‚ä¸€èˆ¬ä»»ä½•è¿›è¡ŒåŠ é”çš„ä»£ç å—ï¼Œéƒ½æ˜¯ä¸ºäº†ä¿æŠ¤æ•°æ®çš„ä¸€è‡´æ€§ï¼Œå¦‚æœåœ¨è°ƒç”¨thread.stop()åå¯¼è‡´äº†è¯¥çº¿ç¨‹æ‰€æŒæœ‰çš„æ‰€æœ‰é”çš„çªç„¶é‡Šæ”¾(ä¸å¯æ§åˆ¶) ï¼Œé‚£ä¹ˆè¢«ä¿æŠ¤æ•°æ®å°±æœ‰å¯èƒ½å‘ˆç°ä¸ä¸€è‡´æ€§ï¼Œå…¶ä»–çº¿ç¨‹åœ¨ä½¿ç”¨è¿™äº›è¢«ç ´åçš„æ•°æ®æ—¶ï¼Œæœ‰å¯èƒ½å¯¼è‡´ä¸€äº›å¾ˆå¥‡æ€ªçš„åº”ç”¨ç¨‹åºé”™è¯¯ã€‚å› æ­¤ï¼Œå¹¶ä¸æ¨èä½¿ç”¨ stop æ–¹æ³•æ¥ç»ˆæ­¢çº¿ç¨‹ã€‚</p>
</blockquote>
<h3 id="sleepä¸waitåŒºåˆ«">sleepä¸waitåŒºåˆ«
</h3><ol>
<li>å¯¹äº sleep()æ–¹æ³•ï¼Œæˆ‘ä»¬é¦–å…ˆè¦çŸ¥é“è¯¥æ–¹æ³•æ˜¯å±äº Thread ç±»ä¸­çš„ã€‚è€Œ wait()æ–¹æ³•ï¼Œåˆ™æ˜¯å±äºObject ç±»ä¸­çš„ã€‚</li>
<li>sleep()æ–¹æ³•å¯¼è‡´äº†ç¨‹åºæš‚åœæ‰§è¡ŒæŒ‡å®šçš„æ—¶é—´ï¼Œè®©å‡º cpu è¯¥å…¶ä»–çº¿ç¨‹ï¼Œä½†æ˜¯ä»–çš„ç›‘æ§çŠ¶æ€ä¾ç„¶ä¿æŒç€ï¼Œå½“æŒ‡å®šçš„æ—¶é—´åˆ°äº†åˆä¼šè‡ªåŠ¨æ¢å¤è¿è¡ŒçŠ¶æ€ã€‚</li>
<li>åœ¨è°ƒç”¨ sleep()æ–¹æ³•çš„è¿‡ç¨‹ä¸­ï¼Œçº¿ç¨‹ä¸ä¼šé‡Šæ”¾å¯¹è±¡é”ã€‚</li>
<li>è€Œå½“è°ƒç”¨ wait()æ–¹æ³•çš„æ—¶å€™ï¼Œçº¿ç¨‹ä¼šæ”¾å¼ƒå¯¹è±¡é”ï¼Œè¿›å…¥ç­‰å¾…æ­¤å¯¹è±¡çš„ç­‰å¾…é”å®šæ± ï¼Œåªæœ‰é’ˆå¯¹æ­¤å¯¹è±¡è°ƒç”¨ notify()æ–¹æ³•åæœ¬çº¿ç¨‹æ‰è¿›å…¥å¯¹è±¡é”å®šæ± å‡†å¤‡è·å–å¯¹è±¡é”è¿›å…¥è¿è¡ŒçŠ¶æ€ã€‚</li>
</ol>
<h3 id="startä¸runåŒºåˆ«">startä¸runåŒºåˆ«
</h3><ol>
<li>startï¼ˆï¼‰æ–¹æ³•æ¥å¯åŠ¨çº¿ç¨‹ï¼ŒçœŸæ­£å®ç°äº†å¤šçº¿ç¨‹è¿è¡Œã€‚è¿™æ—¶æ— éœ€ç­‰å¾… run æ–¹æ³•ä½“ä»£ç æ‰§è¡Œå®Œæ¯•ï¼Œå¯ä»¥ç›´æ¥ç»§ç»­æ‰§è¡Œä¸‹é¢çš„ä»£ç ã€‚</li>
<li>é€šè¿‡è°ƒç”¨ Thread ç±»çš„ start()æ–¹æ³•æ¥å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹ï¼Œ è¿™æ—¶æ­¤çº¿ç¨‹æ˜¯å¤„äºå°±ç»ªçŠ¶æ€ï¼Œ å¹¶æ²¡æœ‰è¿è¡Œã€‚</li>
<li>æ–¹æ³• run()ç§°ä¸ºçº¿ç¨‹ä½“ï¼Œå®ƒåŒ…å«äº†è¦æ‰§è¡Œçš„è¿™ä¸ªçº¿ç¨‹çš„å†…å®¹ï¼Œçº¿ç¨‹å°±è¿›å…¥äº†è¿è¡ŒçŠ¶æ€ï¼Œå¼€å§‹è¿è¡Œ run å‡½æ•°å½“ä¸­çš„ä»£ç ã€‚ Run æ–¹æ³•è¿è¡Œç»“æŸï¼Œ æ­¤çº¿ç¨‹ç»ˆæ­¢ã€‚ç„¶å CPU å†è°ƒåº¦å…¶å®ƒçº¿ç¨‹ã€‚</li>
<li>åœ¨æœ¬è´¨ä¸Šrunæ–¹æ³•å¹¶æ²¡æœ‰å®ç°å¤šçº¿ç¨‹ï¼Œç›´æ¥æ‰§è¡Œ run() æ–¹æ³•ï¼Œä¼šæŠŠ run() æ–¹æ³•å½“æˆä¸€ä¸ª main çº¿ç¨‹ä¸‹çš„æ™®é€šæ–¹æ³•å»æ‰§è¡Œï¼Œå¹¶ä¸ä¼šåœ¨æŸä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œå®ƒï¼Œæ‰€ä»¥è¿™å¹¶ä¸æ˜¯å¤šçº¿ç¨‹å·¥ä½œã€‚</li>
</ol>
<h3 id="javaåå°çº¿ç¨‹">Javaåå°çº¿ç¨‹
</h3><ol>
<li>å®šä¹‰ï¼šå®ˆæŠ¤çº¿ç¨‹â€“ä¹Ÿç§°â€œæœåŠ¡çº¿ç¨‹â€ï¼Œä»–æ˜¯åå°çº¿ç¨‹ï¼Œå®ƒæœ‰ä¸€ä¸ªç‰¹æ€§ï¼Œå³ä¸ºç”¨æˆ·çº¿ç¨‹ æä¾› å…¬å…±æœåŠ¡ï¼Œåœ¨æ²¡æœ‰ç”¨æˆ·çº¿ç¨‹å¯æœåŠ¡æ—¶ä¼šè‡ªåŠ¨ç¦»å¼€ã€‚</li>
<li>ä¼˜å…ˆçº§ï¼šå®ˆæŠ¤çº¿ç¨‹çš„ä¼˜å…ˆçº§æ¯”è¾ƒä½ï¼Œç”¨äºä¸ºç³»ç»Ÿä¸­çš„å…¶å®ƒå¯¹è±¡å’Œçº¿ç¨‹æä¾›æœåŠ¡ã€‚</li>
<li>è®¾ç½®ï¼šé€šè¿‡ setDaemon(true)æ¥è®¾ç½®çº¿ç¨‹ä¸ºâ€œå®ˆæŠ¤çº¿ç¨‹â€ï¼›å°†ä¸€ä¸ªç”¨æˆ·çº¿ç¨‹è®¾ç½®ä¸ºå®ˆæŠ¤çº¿ç¨‹çš„æ–¹å¼æ˜¯åœ¨ çº¿ç¨‹å¯¹è±¡åˆ›å»º ä¹‹å‰ ç”¨çº¿ç¨‹å¯¹è±¡çš„ setDaemon æ–¹æ³•ã€‚</li>
<li>åœ¨ Daemon çº¿ç¨‹ä¸­äº§ç”Ÿçš„æ–°çº¿ç¨‹ä¹Ÿæ˜¯ Daemon çš„ã€‚</li>
<li>çº¿ç¨‹åˆ™æ˜¯ JVM çº§åˆ«çš„ï¼Œä»¥ Tomcat ä¸ºä¾‹ï¼Œå¦‚æœä½ åœ¨ Web åº”ç”¨ä¸­å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹ï¼Œè¿™ä¸ªçº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸå¹¶ä¸ä¼šå’Œ Web åº”ç”¨ç¨‹åºä¿æŒåŒæ­¥ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå³ä½¿ä½ åœæ­¢äº† Web åº”ç”¨ï¼Œè¿™ä¸ªçº¿ç¨‹ä¾æ—§æ˜¯æ´»è·ƒçš„ã€‚</li>
<li>example: åƒåœ¾å›æ”¶çº¿ç¨‹å°±æ˜¯ä¸€ä¸ªç»å…¸çš„å®ˆæŠ¤çº¿ç¨‹ï¼Œå½“æˆ‘ä»¬çš„ç¨‹åºä¸­ä¸å†æœ‰ä»»ä½•è¿è¡Œçš„Thread,ç¨‹åºå°±ä¸ä¼šå†äº§ç”Ÿåƒåœ¾ï¼Œåƒåœ¾å›æ”¶å™¨ä¹Ÿå°±æ— äº‹å¯åšï¼Œæ‰€ä»¥å½“åƒåœ¾å›æ”¶çº¿ç¨‹æ˜¯ JVM ä¸Šä»…å‰©çš„çº¿ç¨‹æ—¶ï¼Œåƒåœ¾å›æ”¶çº¿ç¨‹ä¼šè‡ªåŠ¨ç¦»å¼€ã€‚å®ƒå§‹ç»ˆåœ¨ä½çº§åˆ«çš„çŠ¶æ€ä¸­è¿è¡Œï¼Œç”¨äºå®æ—¶ç›‘æ§å’Œç®¡ç†ç³»ç»Ÿä¸­çš„å¯å›æ”¶èµ„æºã€‚</li>
<li>ç”Ÿå‘½å‘¨æœŸï¼šå®ˆæŠ¤è¿›ç¨‹ï¼ˆDaemonï¼‰æ˜¯è¿è¡Œåœ¨åå°çš„ä¸€ç§ç‰¹æ®Šè¿›ç¨‹ã€‚å®ƒç‹¬ç«‹äºæ§åˆ¶ç»ˆç«¯å¹¶ä¸”å‘¨æœŸæ€§åœ°æ‰§è¡ŒæŸç§ä»»åŠ¡æˆ–ç­‰å¾…å¤„ç†æŸäº›å‘ç”Ÿçš„äº‹ä»¶ã€‚ä¹Ÿå°±æ˜¯è¯´å®ˆæŠ¤çº¿ç¨‹ä¸ä¾èµ–äºç»ˆç«¯ï¼Œä½†æ˜¯ä¾èµ–äºç³»ç»Ÿï¼Œä¸ç³»ç»Ÿâ€œåŒç”Ÿå…±æ­»â€ã€‚å½“ JVM ä¸­æ‰€æœ‰çš„çº¿ç¨‹éƒ½æ˜¯å®ˆæŠ¤çº¿ç¨‹çš„æ—¶å€™ï¼ŒJVM å°±å¯ä»¥é€€å‡ºäº†ï¼›å¦‚æœè¿˜æœ‰ä¸€ä¸ªæˆ–ä»¥ä¸Šçš„éå®ˆæŠ¤çº¿ç¨‹åˆ™ JVM ä¸ä¼šé€€å‡ºã€‚</li>
</ol>
<h3 id="javaé”">Javaé”
</h3><h3 id="ä¹è§‚é”">ä¹è§‚é”
</h3><blockquote>
<p>ä¹è§‚é”æ˜¯ä¸€ç§ä¹è§‚æ€æƒ³ï¼Œå³è®¤ä¸ºè¯»å¤šå†™å°‘ï¼Œé‡åˆ°å¹¶å‘å†™çš„å¯èƒ½æ€§ä½ï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¸ä¼šä¿®æ”¹ï¼Œæ‰€ä»¥ä¸ä¼šä¸Šé”ï¼Œä½†æ˜¯åœ¨æ›´æ–°çš„æ—¶å€™ä¼šåˆ¤æ–­ä¸€ä¸‹åœ¨æ­¤æœŸé—´åˆ«äººæœ‰æ²¡æœ‰å»æ›´æ–°è¿™ä¸ªæ•°æ® ï¼Œé‡‡å–åœ¨å†™æ—¶å…ˆè¯»å‡ºå½“å‰ç‰ˆæœ¬å·ï¼Œç„¶ååŠ é”æ“ä½œï¼ˆæ¯”è¾ƒè·Ÿä¸Šä¸€æ¬¡çš„ç‰ˆæœ¬å·ï¼Œå¦‚æœä¸€æ ·åˆ™æ›´æ–°ï¼‰ï¼Œå¦‚æœå¤±è´¥åˆ™è¦é‡å¤è¯»-æ¯”è¾ƒ-å†™çš„æ“ä½œã€‚<br>
java ä¸­çš„ä¹è§‚é”åŸºæœ¬éƒ½æ˜¯é€šè¿‡ CAS æ“ä½œå®ç°çš„ï¼ŒCAS æ˜¯ä¸€ç§æ›´æ–°çš„åŸå­æ“ä½œï¼Œæ¯”è¾ƒå½“å‰å€¼è·Ÿä¼ å…¥å€¼æ˜¯å¦ä¸€æ ·ï¼Œä¸€æ ·åˆ™æ›´æ–°ï¼Œå¦åˆ™å¤±è´¥ã€‚</p>
</blockquote>
<h3 id="æ‚²è§‚é”">æ‚²è§‚é”
</h3><blockquote>
<p>æ‚²è§‚é”æ˜¯å°±æ˜¯æ‚²è§‚æ€æƒ³ï¼Œå³è®¤ä¸ºå†™å¤šï¼Œé‡åˆ°å¹¶å‘å†™çš„å¯èƒ½æ€§é«˜ï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¼šä¿®æ”¹ï¼Œæ‰€ä»¥æ¯æ¬¡åœ¨è¯»å†™æ•°æ®çš„æ—¶å€™éƒ½ä¼šä¸Šé”ï¼Œè¿™æ ·åˆ«äººæƒ³è¯»å†™è¿™ä¸ªæ•°æ®å°±ä¼š block ç›´åˆ°æ‹¿åˆ°é”ã€‚javaä¸­çš„æ‚²è§‚é”å°±æ˜¯Synchronized,AQSæ¡†æ¶ä¸‹çš„é”åˆ™æ˜¯å…ˆå°è¯•casä¹è§‚é”å»è·å–é”ï¼Œè·å–ä¸åˆ°ï¼Œæ‰ä¼šè½¬æ¢ä¸ºæ‚²è§‚é”ï¼Œå¦‚ RetreenLockã€‚</p>
</blockquote>
<h3 id="è‡ªæ—‹é”">è‡ªæ—‹é”
</h3><blockquote>
<p>è‡ªæ—‹é”åŸç†éå¸¸ç®€å•ï¼Œå¦‚æœæŒæœ‰é”çš„çº¿ç¨‹èƒ½åœ¨å¾ˆçŸ­æ—¶é—´å†…é‡Šæ”¾é”èµ„æºï¼Œé‚£ä¹ˆé‚£äº›ç­‰å¾…ç«äº‰é”çš„çº¿ç¨‹å°±ä¸éœ€è¦åšå†…æ ¸æ€å’Œç”¨æˆ·æ€ä¹‹é—´çš„åˆ‡æ¢è¿›å…¥é˜»å¡æŒ‚èµ·çŠ¶æ€ï¼Œå®ƒä»¬åªéœ€è¦ç­‰ä¸€ç­‰ï¼ˆè‡ªæ—‹ï¼‰ï¼Œç­‰æŒæœ‰é”çš„çº¿ç¨‹é‡Šæ”¾é”åå³å¯ç«‹å³è·å–é”ï¼Œè¿™æ ·å°±é¿å…ç”¨æˆ·çº¿ç¨‹å’Œå†…æ ¸çš„åˆ‡æ¢çš„æ¶ˆè€—ã€‚<br>
çº¿ç¨‹è‡ªæ—‹æ˜¯éœ€è¦æ¶ˆè€— cup çš„ï¼Œè¯´ç™½äº†å°±æ˜¯è®© cup åœ¨åšæ— ç”¨åŠŸï¼Œå¦‚æœä¸€ç›´è·å–ä¸åˆ°é”ï¼Œé‚£çº¿ç¨‹ä¹Ÿä¸èƒ½ä¸€ç›´å ç”¨ cup è‡ªæ—‹åšæ— ç”¨åŠŸï¼Œæ‰€ä»¥éœ€è¦è®¾å®šä¸€ä¸ªè‡ªæ—‹ç­‰å¾…çš„æœ€å¤§æ—¶é—´ã€‚<br>
å¦‚æœæŒæœ‰é”çš„çº¿ç¨‹æ‰§è¡Œçš„æ—¶é—´è¶…è¿‡è‡ªæ—‹ç­‰å¾…çš„æœ€å¤§æ—¶é—´æ‰”æ²¡æœ‰é‡Šæ”¾é”ï¼Œå°±ä¼šå¯¼è‡´å…¶å®ƒäº‰ç”¨é”çš„çº¿ç¨‹åœ¨æœ€å¤§ç­‰å¾…æ—¶é—´å†…è¿˜æ˜¯è·å–ä¸åˆ°é”ï¼Œè¿™æ—¶äº‰ç”¨çº¿ç¨‹ä¼šåœæ­¢è‡ªæ—‹è¿›å…¥é˜»å¡çŠ¶æ€ã€‚<br>
<code>è‡ªæ—‹é”çš„ä¼˜ç¼ºç‚¹</code><br>
è‡ªæ—‹é”å°½å¯èƒ½çš„å‡å°‘çº¿ç¨‹çš„é˜»å¡ï¼Œè¿™å¯¹äºé”çš„ç«äº‰ä¸æ¿€çƒˆï¼Œä¸”å ç”¨é”æ—¶é—´éå¸¸çŸ­çš„ä»£ç å—æ¥è¯´æ€§èƒ½èƒ½å¤§å¹…åº¦çš„æå‡ï¼Œå› ä¸ºè‡ªæ—‹çš„æ¶ˆè€—ä¼šå°äºçº¿ç¨‹é˜»å¡æŒ‚èµ·å†å”¤é†’çš„æ“ä½œçš„æ¶ˆè€—ï¼Œè¿™äº›æ“ä½œä¼šå¯¼è‡´çº¿ç¨‹å‘ç”Ÿä¸¤æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼<br>
ä½†æ˜¯å¦‚æœé”çš„ç«äº‰æ¿€çƒˆï¼Œæˆ–è€…æŒæœ‰é”çš„çº¿ç¨‹éœ€è¦é•¿æ—¶é—´å ç”¨é”æ‰§è¡ŒåŒæ­¥å—ï¼Œè¿™æ—¶å€™å°±ä¸é€‚åˆä½¿ç”¨è‡ªæ—‹é”äº†ï¼Œå› ä¸ºè‡ªæ—‹é”åœ¨è·å–é”å‰ä¸€ç›´éƒ½æ˜¯å ç”¨ cpu åšæ— ç”¨åŠŸï¼Œå ç€ XX ä¸ XXï¼ŒåŒæ—¶æœ‰å¤§é‡çº¿ç¨‹åœ¨ç«äº‰ä¸€ä¸ªé”ï¼Œä¼šå¯¼è‡´è·å–é”çš„æ—¶é—´å¾ˆé•¿ï¼Œçº¿ç¨‹è‡ªæ—‹çš„æ¶ˆè€—å¤§äºçº¿ç¨‹é˜»å¡æŒ‚èµ·æ“ä½œçš„æ¶ˆè€—ï¼Œå…¶å®ƒéœ€è¦ cup çš„çº¿ç¨‹åˆä¸èƒ½è·å–åˆ° cpuï¼Œé€ æˆ cpu çš„æµªè´¹ã€‚æ‰€ä»¥è¿™ç§æƒ…å†µä¸‹æˆ‘ä»¬è¦å…³é—­è‡ªæ—‹é”ï¼›<br>
<code>è‡ªæ—‹é”æ—¶é—´é˜ˆå€¼</code>ï¼ˆ1.6 å¼•å…¥äº†é€‚åº”æ€§è‡ªæ—‹é”ï¼‰<br>
è‡ªæ—‹é”çš„ç›®çš„æ˜¯ä¸ºäº†å ç€ CPU çš„èµ„æºä¸é‡Šæ”¾ï¼Œç­‰åˆ°è·å–åˆ°é”ç«‹å³è¿›è¡Œå¤„ç†ã€‚ä½†æ˜¯å¦‚ä½•å»é€‰æ‹©è‡ªæ—‹çš„æ‰§è¡Œæ—¶é—´å‘¢ï¼Ÿå¦‚æœè‡ªæ—‹æ‰§è¡Œæ—¶é—´å¤ªé•¿ï¼Œä¼šæœ‰å¤§é‡çš„çº¿ç¨‹å¤„äºè‡ªæ—‹çŠ¶æ€å ç”¨ CPU èµ„æºï¼Œè¿›è€Œä¼šå½±å“æ•´ä½“ç³»ç»Ÿçš„æ€§èƒ½ã€‚å› æ­¤è‡ªæ—‹çš„å‘¨æœŸé€‰çš„é¢å¤–é‡è¦ï¼<br>
JVM å¯¹äºè‡ªæ—‹å‘¨æœŸçš„é€‰æ‹©ï¼Œjdk1.5 è¿™ä¸ªé™åº¦æ˜¯ä¸€å®šçš„å†™æ­»çš„ï¼Œåœ¨ 1.6 å¼•å…¥äº†é€‚åº”æ€§è‡ªæ—‹é”ï¼Œé€‚åº”æ€§è‡ªæ—‹é”æ„å‘³ç€è‡ªæ—‹çš„æ—¶é—´ä¸åœ¨æ˜¯å›ºå®šçš„äº†ï¼Œè€Œæ˜¯ç”±å‰ä¸€æ¬¡åœ¨åŒä¸€ä¸ªé”ä¸Šçš„è‡ªæ—‹æ—¶é—´ä»¥åŠé”çš„æ‹¥æœ‰è€…çš„çŠ¶æ€æ¥å†³å®šï¼ŒåŸºæœ¬è®¤ä¸ºä¸€ä¸ªçº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ—¶é—´æ˜¯æœ€ä½³çš„ä¸€ä¸ªæ—¶é—´ï¼ŒåŒæ—¶ JVM è¿˜é’ˆå¯¹å½“å‰ CPU çš„è´Ÿè·æƒ…å†µåšäº†è¾ƒå¤šçš„ä¼˜åŒ–ï¼Œå¦‚æœå¹³å‡è´Ÿè½½å°äº CPUs åˆ™ä¸€ç›´è‡ªæ—‹ï¼Œå¦‚æœæœ‰è¶…è¿‡(CPUs/2)ä¸ªçº¿ç¨‹æ­£åœ¨è‡ªæ—‹ï¼Œåˆ™åæ¥çº¿ç¨‹ç›´æ¥é˜»å¡ï¼Œå¦‚æœæ­£åœ¨è‡ªæ—‹çš„çº¿ç¨‹å‘ç° Owner å‘ç”Ÿäº†å˜åŒ–åˆ™å»¶è¿Ÿè‡ªæ—‹æ—¶é—´ï¼ˆè‡ªæ—‹è®¡æ•°ï¼‰æˆ–è¿›å…¥é˜»å¡ï¼Œå¦‚æœ CPU å¤„äºèŠ‚ç”µæ¨¡å¼åˆ™åœæ­¢è‡ªæ—‹ï¼Œè‡ªæ—‹æ—¶é—´çš„æœ€åæƒ…å†µæ˜¯ CPUçš„å­˜å‚¨å»¶è¿Ÿï¼ˆCPU A å­˜å‚¨äº†ä¸€ä¸ªæ•°æ®ï¼Œåˆ° CPU B å¾—çŸ¥è¿™ä¸ªæ•°æ®ç›´æ¥çš„æ—¶é—´å·®ï¼‰ï¼Œè‡ªæ—‹æ—¶ä¼šé€‚å½“æ”¾å¼ƒçº¿ç¨‹ä¼˜å…ˆçº§ä¹‹é—´çš„å·®å¼‚ã€‚
<code>è‡ªæ—‹é”çš„å¼€å¯</code><br>
JDK1.6 ä¸­-XX:+UseSpinning å¼€å¯ï¼›<br>
-XX:PreBlockSpin=10 ä¸ºè‡ªæ—‹æ¬¡æ•°ï¼›<br>
JDK1.7 åï¼Œå»æ‰æ­¤å‚æ•°ï¼Œç”± jvm æ§åˆ¶ï¼›</p>
</blockquote>
<h3 id="synchronizedåŒæ­¥é”">SynchronizedåŒæ­¥é”
</h3><blockquote>
<p>synchronized å®ƒå¯ä»¥æŠŠä»»æ„ä¸€ä¸ªé NULL çš„å¯¹è±¡å½“ä½œé”ã€‚ä»–å±äºç‹¬å å¼çš„æ‚²è§‚é”ï¼ŒåŒæ—¶å±äºå¯é‡å…¥é”ã€‚<br>
<code>synchronized ä½œç”¨èŒƒå›´</code></p>
</blockquote>
<ol>
<li>ä½œç”¨äºæ–¹æ³•æ—¶ï¼Œé”ä½çš„æ˜¯å¯¹è±¡çš„å®ä¾‹(this)ï¼›</li>
<li>å½“ä½œç”¨äºé™æ€æ–¹æ³•æ—¶ï¼Œé”ä½çš„æ˜¯Classå®ä¾‹ï¼Œåˆå› ä¸ºClassçš„ç›¸å…³æ•°æ®å­˜å‚¨åœ¨æ°¸ä¹…å¸¦PermGenï¼ˆjdk1.8 åˆ™æ˜¯ metaspaceï¼‰ï¼Œæ°¸ä¹…å¸¦æ˜¯å…¨å±€å…±äº«çš„ï¼Œå› æ­¤é™æ€æ–¹æ³•é”ç›¸å½“äºç±»çš„ä¸€ä¸ªå…¨å±€é”ï¼Œä¼šé”æ‰€æœ‰è°ƒç”¨è¯¥æ–¹æ³•çš„çº¿ç¨‹ï¼›</li>
<li>synchronized ä½œç”¨äºä¸€ä¸ªå¯¹è±¡å®ä¾‹æ—¶ï¼Œé”ä½çš„æ˜¯æ‰€æœ‰ä»¥è¯¥å¯¹è±¡ä¸ºé”çš„ä»£ç å—ã€‚å®ƒæœ‰å¤šä¸ªé˜Ÿåˆ—ï¼Œå½“å¤šä¸ªçº¿ç¨‹ä¸€èµ·è®¿é—®æŸä¸ªå¯¹è±¡ç›‘è§†å™¨çš„æ—¶å€™ï¼Œå¯¹è±¡ç›‘è§†å™¨ä¼šå°†è¿™äº›çº¿ç¨‹å­˜å‚¨åœ¨ä¸åŒçš„å®¹å™¨ä¸­ã€‚</li>
</ol>
<blockquote>
<p><code>Synchronized æ ¸å¿ƒç»„ä»¶</code></p>
</blockquote>
<ol>
<li>Wait Setï¼šå“ªäº›è°ƒç”¨ wait æ–¹æ³•è¢«é˜»å¡çš„çº¿ç¨‹è¢«æ”¾ç½®åœ¨è¿™é‡Œï¼›</li>
<li>Contention Listï¼šç«äº‰é˜Ÿåˆ—ï¼Œæ‰€æœ‰è¯·æ±‚é”çš„çº¿ç¨‹é¦–å…ˆè¢«æ”¾åœ¨è¿™ä¸ªç«äº‰é˜Ÿåˆ—ä¸­ï¼›</li>
<li>Entry Listï¼šContention List ä¸­é‚£äº›æœ‰èµ„æ ¼æˆä¸ºå€™é€‰èµ„æºçš„çº¿ç¨‹è¢«ç§»åŠ¨åˆ° Entry List ä¸­ï¼›</li>
<li>OnDeckï¼šä»»æ„æ—¶åˆ»ï¼Œæœ€å¤šåªæœ‰ä¸€ä¸ªçº¿ç¨‹æ­£åœ¨ç«äº‰é”èµ„æºï¼Œè¯¥çº¿ç¨‹è¢«æˆä¸º OnDeckï¼›</li>
<li>Ownerï¼šå½“å‰å·²ç»è·å–åˆ°æ‰€èµ„æºçš„çº¿ç¨‹è¢«ç§°ä¸º Ownerï¼›</li>
<li>!Ownerï¼šå½“å‰é‡Šæ”¾é”çš„çº¿ç¨‹ã€‚</li>
</ol>
<blockquote>
<p><code>Synchronized å®ç°</code></p>
</blockquote>
<ol>
<li>JVM æ¯æ¬¡ä»é˜Ÿåˆ—çš„å°¾éƒ¨å–å‡ºä¸€ä¸ªæ•°æ®ç”¨äºé”ç«äº‰å€™é€‰è€…ï¼ˆOnDeckï¼‰ï¼Œä½†æ˜¯å¹¶å‘æƒ…å†µä¸‹ï¼ŒContentionList ä¼šè¢«å¤§é‡çš„å¹¶å‘çº¿ç¨‹è¿›è¡Œ CAS è®¿é—®ï¼Œä¸ºäº†é™ä½å¯¹å°¾éƒ¨å…ƒç´ çš„ç«äº‰ï¼ŒJVM ä¼šå°†ä¸€éƒ¨åˆ†çº¿ç¨‹ç§»åŠ¨åˆ° EntryList ä¸­ä½œä¸ºå€™é€‰ç«äº‰çº¿ç¨‹ã€‚</li>
<li>Owner çº¿ç¨‹ä¼šåœ¨ unlock æ—¶ï¼Œå°† ContentionList ä¸­çš„éƒ¨åˆ†çº¿ç¨‹è¿ç§»åˆ° EntryList ä¸­ï¼Œå¹¶æŒ‡å®šEntryList ä¸­çš„æŸä¸ªçº¿ç¨‹ä¸º OnDeck çº¿ç¨‹ï¼ˆä¸€èˆ¬æ˜¯æœ€å…ˆè¿›å»çš„é‚£ä¸ªçº¿ç¨‹ï¼‰ã€‚</li>
<li>Owner çº¿ç¨‹å¹¶ä¸ç›´æ¥æŠŠé”ä¼ é€’ç»™ OnDeck çº¿ç¨‹ï¼Œè€Œæ˜¯æŠŠé”ç«äº‰çš„æƒåˆ©äº¤ç»™ OnDeckï¼ŒOnDeck éœ€è¦é‡æ–°ç«äº‰é”ã€‚è¿™æ ·è™½ç„¶ç‰ºç‰²äº†ä¸€äº›å…¬å¹³æ€§ï¼Œä½†æ˜¯èƒ½æå¤§çš„æå‡ç³»ç»Ÿçš„ååé‡ï¼Œåœ¨JVM ä¸­ï¼Œä¹ŸæŠŠè¿™ç§é€‰æ‹©è¡Œä¸ºç§°ä¹‹ä¸ºâ€œç«äº‰åˆ‡æ¢â€ã€‚</li>
<li>OnDeck çº¿ç¨‹è·å–åˆ°é”èµ„æºåä¼šå˜ä¸º Owner çº¿ç¨‹ï¼Œè€Œæ²¡æœ‰å¾—åˆ°é”èµ„æºçš„ä»ç„¶åœç•™åœ¨ EntryListä¸­ã€‚å¦‚æœ Owner çº¿ç¨‹è¢« wait æ–¹æ³•é˜»å¡ï¼Œåˆ™è½¬ç§»åˆ° WaitSet é˜Ÿåˆ—ä¸­ï¼Œç›´åˆ°æŸä¸ªæ—¶åˆ»é€šè¿‡ notifyæˆ–è€… notifyAll å”¤é†’ï¼Œä¼šé‡æ–°è¿›å» EntryList ä¸­ã€‚</li>
<li>å¤„äº ContentionListã€EntryListã€WaitSet ä¸­çš„çº¿ç¨‹éƒ½å¤„äºé˜»å¡çŠ¶æ€ï¼Œè¯¥é˜»å¡æ˜¯ç”±æ“ä½œç³»ç»Ÿæ¥å®Œæˆçš„ï¼ˆLinux å†…æ ¸ä¸‹é‡‡ç”¨ pthread_mutex_lock å†…æ ¸å‡½æ•°å®ç°çš„ï¼‰</li>
<li>Synchronized æ˜¯éå…¬å¹³é”ã€‚ Synchronized åœ¨çº¿ç¨‹è¿›å…¥ ContentionList æ—¶ï¼Œç­‰å¾…çš„çº¿ç¨‹ä¼šå…ˆå°è¯•è‡ªæ—‹è·å–é”ï¼Œå¦‚æœè·å–ä¸åˆ°å°±è¿›å…¥ ContentionListï¼Œè¿™æ˜æ˜¾å¯¹äºå·²ç»è¿›å…¥é˜Ÿåˆ—çš„çº¿ç¨‹æ˜¯ä¸å…¬å¹³çš„ï¼Œè¿˜æœ‰ä¸€ä¸ªä¸å…¬å¹³çš„äº‹æƒ…å°±æ˜¯è‡ªæ—‹è·å–é”çš„çº¿ç¨‹è¿˜å¯èƒ½ç›´æ¥æŠ¢å  OnDeck çº¿ç¨‹çš„é”èµ„æºã€‚</li>
<li>æ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸ª monitor å¯¹è±¡ï¼ŒåŠ é”å°±æ˜¯åœ¨ç«äº‰ monitor å¯¹è±¡ï¼Œä»£ç å—åŠ é”æ˜¯åœ¨å‰ååˆ†åˆ«åŠ ä¸Š monitorenter å’Œ monitorexit æŒ‡ä»¤æ¥å®ç°çš„ï¼Œæ–¹æ³•åŠ é”æ˜¯é€šè¿‡ä¸€ä¸ªæ ‡è®°ä½æ¥åˆ¤æ–­çš„</li>
<li>synchronized æ˜¯ä¸€ä¸ªé‡é‡çº§æ“ä½œï¼Œéœ€è¦è°ƒç”¨æ“ä½œç³»ç»Ÿç›¸å…³æ¥å£ï¼Œæ€§èƒ½æ˜¯ä½æ•ˆçš„ï¼Œæœ‰å¯èƒ½ç»™çº¿ç¨‹åŠ é”æ¶ˆè€—çš„æ—¶é—´æ¯”æœ‰ç”¨æ“ä½œæ¶ˆè€—çš„æ—¶é—´æ›´å¤šã€‚</li>
<li>Java1.6ï¼Œsynchronized è¿›è¡Œäº†å¾ˆå¤šçš„ä¼˜åŒ–ï¼Œæœ‰é€‚åº”è‡ªæ—‹ã€é”æ¶ˆé™¤ã€é”ç²—åŒ–ã€è½»é‡çº§é”åŠåå‘é”ç­‰ï¼Œæ•ˆç‡æœ‰äº†æœ¬è´¨ä¸Šçš„æé«˜ã€‚åœ¨ä¹‹åæ¨å‡ºçš„ Java1.7 ä¸ 1.8 ä¸­ï¼Œå‡å¯¹è¯¥å…³é”®å­—çš„å®ç°æœºç†åšäº†ä¼˜åŒ–ã€‚å¼•å…¥äº†åå‘é”å’Œè½»é‡çº§é”ã€‚éƒ½æ˜¯åœ¨å¯¹è±¡å¤´ä¸­æœ‰æ ‡è®°ä½ï¼Œä¸éœ€è¦ç»è¿‡æ“ä½œç³»ç»ŸåŠ é”ã€‚</li>
<li>é”å¯ä»¥ä»åå‘é”å‡çº§åˆ°è½»é‡çº§é”ï¼Œå†å‡çº§åˆ°é‡é‡çº§é”ã€‚è¿™ç§å‡çº§è¿‡ç¨‹å«åšé”è†¨èƒ€ï¼›</li>
<li>JDK 1.6 ä¸­é»˜è®¤æ˜¯å¼€å¯åå‘é”å’Œè½»é‡çº§é”ï¼Œå¯ä»¥é€šè¿‡-XX:-UseBiasedLocking æ¥ç¦ç”¨åå‘é”ã€‚</li>
</ol>
<h3 id="reentranlock">ReentranLock
</h3><blockquote>
<p>ReentantLock ç»§æ‰¿æ¥å£ Lock å¹¶å®ç°äº†æ¥å£ä¸­å®šä¹‰çš„æ–¹æ³•ï¼Œä»–æ˜¯ä¸€ç§å¯é‡å…¥é”ï¼Œé™¤äº†èƒ½å®Œæˆ synchronized æ‰€èƒ½å®Œæˆçš„æ‰€æœ‰å·¥ä½œå¤–ï¼Œè¿˜æä¾›äº†è¯¸å¦‚å¯å“åº”ä¸­æ–­é”ã€å¯è½®è¯¢é”è¯·æ±‚ã€å®šæ—¶é”ç­‰é¿å…å¤šçº¿ç¨‹æ­»é”çš„æ–¹æ³•ã€‚
Lock æ¥å£çš„ä¸»è¦æ–¹æ³•</p>
</blockquote>
<ol>
<li>void lock(): æ‰§è¡Œæ­¤æ–¹æ³•æ—¶, å¦‚æœé”å¤„äºç©ºé—²çŠ¶æ€, å½“å‰çº¿ç¨‹å°†è·å–åˆ°é”. ç›¸å, å¦‚æœé”å·²ç»è¢«å…¶ä»–çº¿ç¨‹æŒæœ‰, å°†ç¦ç”¨å½“å‰çº¿ç¨‹, ç›´åˆ°å½“å‰çº¿ç¨‹è·å–åˆ°é”.</li>
<li>boolean tryLock()ï¼šå¦‚æœé”å¯ç”¨, åˆ™è·å–é”, å¹¶ç«‹å³è¿”å› true, å¦åˆ™è¿”å› false. è¯¥æ–¹æ³•å’Œlock()çš„åŒºåˆ«åœ¨äº, tryLock()åªæ˜¯â€è¯•å›¾â€è·å–é”, å¦‚æœé”ä¸å¯ç”¨, ä¸ä¼šå¯¼è‡´å½“å‰çº¿ç¨‹è¢«ç¦ç”¨, å½“å‰çº¿ç¨‹ä»ç„¶ç»§ç»­å¾€ä¸‹æ‰§è¡Œä»£ç . è€Œ lock()æ–¹æ³•åˆ™æ˜¯ä¸€å®šè¦è·å–åˆ°é”, å¦‚æœé”ä¸å¯ç”¨, å°±ä¸€ç›´ç­‰å¾…, åœ¨æœªè·å¾—é”ä¹‹å‰,å½“å‰çº¿ç¨‹å¹¶ä¸ç»§ç»­å‘ä¸‹æ‰§è¡Œ.</li>
<li>void unlock()ï¼šæ‰§è¡Œæ­¤æ–¹æ³•æ—¶, å½“å‰çº¿ç¨‹å°†é‡Šæ”¾æŒæœ‰çš„é”. é”åªèƒ½ç”±æŒæœ‰è€…é‡Šæ”¾, å¦‚æœçº¿ç¨‹å¹¶ä¸æŒæœ‰é”, å´æ‰§è¡Œè¯¥æ–¹æ³•, å¯èƒ½å¯¼è‡´å¼‚å¸¸çš„å‘ç”Ÿ.</li>
<li>Condition newCondition()ï¼šæ¡ä»¶å¯¹è±¡ï¼Œè·å–ç­‰å¾…é€šçŸ¥ç»„ä»¶ã€‚è¯¥ç»„ä»¶å’Œå½“å‰çš„é”ç»‘å®šï¼Œå½“å‰çº¿ç¨‹åªæœ‰è·å–äº†é”ï¼Œæ‰èƒ½è°ƒç”¨è¯¥ç»„ä»¶çš„ await()æ–¹æ³•ï¼Œè€Œè°ƒç”¨åï¼Œå½“å‰çº¿ç¨‹å°†ç¼©æ”¾é”ã€‚</li>
<li>getHoldCount() ï¼šæŸ¥è¯¢å½“å‰çº¿ç¨‹ä¿æŒæ­¤é”çš„æ¬¡æ•°ï¼Œä¹Ÿå°±æ˜¯æ‰§è¡Œæ­¤çº¿ç¨‹æ‰§è¡Œ lock æ–¹æ³•çš„æ¬¡æ•°ã€‚</li>
<li>getQueueLengthï¼ˆï¼‰ï¼šè¿”å›æ­£ç­‰å¾…è·å–æ­¤é”çš„çº¿ç¨‹ä¼°è®¡æ•°ï¼Œæ¯”å¦‚å¯åŠ¨ 10 ä¸ªçº¿ç¨‹ï¼Œ1 ä¸ªçº¿ç¨‹è·å¾—é”ï¼Œæ­¤æ—¶è¿”å›çš„æ˜¯ 9</li>
<li>getWaitQueueLengthï¼šï¼ˆCondition conditionï¼‰è¿”å›ç­‰å¾…ä¸æ­¤é”ç›¸å…³çš„ç»™å®šæ¡ä»¶çš„çº¿ç¨‹ä¼°è®¡æ•°ã€‚æ¯”å¦‚ 10 ä¸ªçº¿ç¨‹ï¼Œç”¨åŒä¸€ä¸ª condition å¯¹è±¡ï¼Œå¹¶ä¸”æ­¤æ—¶è¿™ 10 ä¸ªçº¿ç¨‹éƒ½æ‰§è¡Œäº†condition å¯¹è±¡çš„ await æ–¹æ³•ï¼Œé‚£ä¹ˆæ­¤æ—¶æ‰§è¡Œæ­¤æ–¹æ³•è¿”å› 10</li>
<li>hasWaiters(Condition condition)ï¼šæŸ¥è¯¢æ˜¯å¦æœ‰çº¿ç¨‹ç­‰å¾…ä¸æ­¤é”æœ‰å…³çš„ç»™å®šæ¡ä»¶(condition)ï¼Œå¯¹äºæŒ‡å®š contidion å¯¹è±¡ï¼Œæœ‰å¤šå°‘çº¿ç¨‹æ‰§è¡Œäº† condition.await æ–¹æ³•</li>
<li>hasQueuedThread(Thread thread)ï¼šæŸ¥è¯¢ç»™å®šçº¿ç¨‹æ˜¯å¦ç­‰å¾…è·å–æ­¤é”</li>
<li>hasQueuedThreads()ï¼šæ˜¯å¦æœ‰çº¿ç¨‹ç­‰å¾…æ­¤é”</li>
<li>isFair()ï¼šè¯¥é”æ˜¯å¦å…¬å¹³é”</li>
<li>isHeldByCurrentThread()ï¼š å½“å‰çº¿ç¨‹æ˜¯å¦ä¿æŒé”é”å®šï¼Œçº¿ç¨‹çš„æ‰§è¡Œ lock æ–¹æ³•çš„å‰ååˆ†åˆ«æ˜¯ false å’Œ true</li>
<li>isLock()ï¼šæ­¤é”æ˜¯å¦æœ‰ä»»æ„çº¿ç¨‹å ç”¨</li>
<li>lockInterruptiblyï¼ˆï¼‰ï¼šå¦‚æœå½“å‰çº¿ç¨‹æœªè¢«ä¸­æ–­ï¼Œè·å–é”</li>
<li>tryLockï¼ˆï¼‰ï¼šå°è¯•è·å¾—é”ï¼Œä»…åœ¨è°ƒç”¨æ—¶é”æœªè¢«çº¿ç¨‹å ç”¨ï¼Œè·å¾—é”</li>
<li>tryLock(long timeout TimeUnit unit)ï¼šå¦‚æœé”åœ¨ç»™å®šç­‰å¾…æ—¶é—´å†…æ²¡æœ‰è¢«å¦ä¸€ä¸ªçº¿ç¨‹ä¿æŒï¼Œåˆ™è·å–è¯¥é”</li>
</ol>
<blockquote>
<p><code>éå…¬å¹³é”</code><br>
JVM æŒ‰éšæœºã€å°±è¿‘åŸåˆ™åˆ†é…é”çš„æœºåˆ¶åˆ™ç§°ä¸ºä¸å…¬å¹³é”ï¼ŒReentrantLock åœ¨æ„é€ å‡½æ•°ä¸­æä¾›äº†æ˜¯å¦å…¬å¹³é”çš„åˆå§‹åŒ–æ–¹å¼ï¼Œé»˜è®¤ä¸ºéå…¬å¹³é”ã€‚éå…¬å¹³é”å®é™…æ‰§è¡Œçš„æ•ˆç‡è¦è¿œè¿œè¶…å‡ºå…¬å¹³é”ï¼Œé™¤éç¨‹åºæœ‰ç‰¹æ®Šéœ€è¦ï¼Œå¦åˆ™æœ€å¸¸ç”¨éå…¬å¹³é”çš„åˆ†é…æœºåˆ¶ã€‚
<code>å…¬å¹³é”</code><br>
å…¬å¹³é”æŒ‡çš„æ˜¯é”çš„åˆ†é…æœºåˆ¶æ˜¯å…¬å¹³çš„ï¼Œé€šå¸¸å…ˆå¯¹é”æå‡ºè·å–è¯·æ±‚çš„çº¿ç¨‹ä¼šå…ˆè¢«åˆ†é…åˆ°é”ï¼ŒReentrantLock åœ¨æ„é€ å‡½æ•°ä¸­æä¾›äº†æ˜¯å¦å…¬å¹³é”çš„åˆå§‹åŒ–æ–¹å¼æ¥å®šä¹‰å…¬å¹³é”ã€‚
ReentrantLock ä¸ synchronized</p>
</blockquote>
<ol>
<li>ReentrantLock é€šè¿‡æ–¹æ³• lock()ä¸ unlock()æ¥è¿›è¡ŒåŠ é”ä¸è§£é”æ“ä½œï¼Œä¸ synchronized ä¼šè¢« JVM è‡ªåŠ¨è§£é”æœºåˆ¶ä¸åŒï¼ŒReentrantLock åŠ é”åéœ€è¦æ‰‹åŠ¨è¿›è¡Œè§£é”ã€‚ä¸ºäº†é¿å…ç¨‹åºå‡ºç°å¼‚å¸¸è€Œæ— æ³•æ­£å¸¸è§£é”çš„æƒ…å†µï¼Œä½¿ç”¨ ReentrantLock å¿…é¡»åœ¨ finally æ§åˆ¶å—ä¸­è¿›è¡Œè§£é”æ“ä½œã€‚</li>
<li>ReentrantLock ç›¸æ¯” synchronized çš„ä¼˜åŠ¿æ˜¯å¯ä¸­æ–­ã€å…¬å¹³é”ã€å¤šä¸ªé”ã€‚è¿™ç§æƒ…å†µä¸‹éœ€è¦ä½¿ç”¨ ReentrantLockã€‚</li>
</ol>
<blockquote>
<p>`ReentrantLock å®ç°</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MyService</span><span class="w"> </span><span class="p">{</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Lock</span><span class="w"> </span><span class="n">lock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ReentrantLock</span><span class="p">();</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//Lock lock=new ReentrantLock(true);//å…¬å¹³é”  </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">//Lock lock=new ReentrantLock(false);//éå…¬å¹³é”  </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Condition</span><span class="w"> </span><span class="n">condition</span><span class="o">=</span><span class="n">lock</span><span class="p">.</span><span class="na">newCondition</span><span class="p">();</span><span class="c1">//åˆ›å»º Condition  </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">testMethod</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">lock</span><span class="p">.</span><span class="na">lock</span><span class="p">();</span><span class="c1">//lock åŠ é”  </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">//1ï¼šwait æ–¹æ³•ç­‰å¾…ï¼š  </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">//System.out.println(&#34;å¼€å§‹ wait&#34;);  </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">condition</span><span class="p">.</span><span class="na">await</span><span class="p">();</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">//é€šè¿‡åˆ›å»º Condition å¯¹è±¡æ¥ä½¿çº¿ç¨‹ waitï¼Œå¿…é¡»å…ˆæ‰§è¡Œ lock.lock æ–¹æ³•è·å¾—é”  </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="c1">//:2ï¼šsignal æ–¹æ³•å”¤é†’  </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">condition</span><span class="p">.</span><span class="na">signal</span><span class="p">();</span><span class="c1">//condition å¯¹è±¡çš„ signal æ–¹æ³•å¯ä»¥å”¤é†’ wait çº¿ç¨‹  </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">5</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;ThreadName=&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">().</span><span class="na">getName</span><span class="p">()</span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="s">&#34; &#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">1</span><span class="p">)));</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">InterruptedException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">finally</span><span class="p">{</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">lock</span><span class="p">.</span><span class="na">unlock</span><span class="p">();</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p><code>Condition ç±»å’Œ Object ç±»é”æ–¹æ³• åŒºåˆ«</code></p>
</blockquote>
<ol>
<li>Condition ç±»çš„ awiat æ–¹æ³•å’Œ Object ç±»çš„ wait æ–¹æ³•ç­‰æ•ˆ</li>
<li>Condition ç±»çš„ signal æ–¹æ³•å’Œ Object ç±»çš„ notify æ–¹æ³•ç­‰æ•ˆ</li>
<li>Condition ç±»çš„ signalAll æ–¹æ³•å’Œ Object ç±»çš„ notifyAll æ–¹æ³•ç­‰æ•ˆ</li>
<li>ReentrantLock ç±»å¯ä»¥å”¤é†’æŒ‡å®šæ¡ä»¶çš„çº¿ç¨‹ï¼Œè€Œ object çš„å”¤é†’æ˜¯éšæœºçš„</li>
</ol>
<blockquote>
<p><code>tryLock å’Œ lock å’Œ lockInterruptibly çš„åŒºåˆ«</code></p>
</blockquote>
<ol>
<li>tryLock èƒ½è·å¾—é”å°±è¿”å› trueï¼Œä¸èƒ½å°±ç«‹å³è¿”å› falseï¼ŒtryLock(long timeout,TimeUnit unit)ï¼Œå¯ä»¥å¢åŠ æ—¶é—´é™åˆ¶ï¼Œå¦‚æœè¶…è¿‡è¯¥æ—¶é—´æ®µè¿˜æ²¡è·å¾—é”ï¼Œè¿”å› false</li>
<li>lock èƒ½è·å¾—é”å°±è¿”å› trueï¼Œä¸èƒ½çš„è¯ä¸€ç›´ç­‰å¾…è·å¾—é”</li>
<li>lock å’Œ lockInterruptiblyï¼Œå¦‚æœä¸¤ä¸ªçº¿ç¨‹åˆ†åˆ«æ‰§è¡Œè¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œä½†æ­¤æ—¶ä¸­æ–­è¿™ä¸¤ä¸ªçº¿ç¨‹ï¼Œlock ä¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œè€Œ lockInterruptibly ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</li>
</ol>
<h3 id="semaphoreä¿¡å·é‡">Semaphoreä¿¡å·é‡
</h3><blockquote>
<p>Semaphore æ˜¯ä¸€ç§åŸºäºè®¡æ•°çš„ä¿¡å·é‡ã€‚å®ƒå¯ä»¥è®¾å®šä¸€ä¸ªé˜ˆå€¼ï¼ŒåŸºäºæ­¤ï¼Œå¤šä¸ªçº¿ç¨‹ç«äº‰è·å–è®¸å¯ä¿¡å·ï¼Œåšå®Œè‡ªå·±çš„ç”³è¯·åå½’è¿˜ï¼Œè¶…è¿‡é˜ˆå€¼åï¼Œçº¿ç¨‹ç”³è¯·è®¸å¯ä¿¡å·å°†ä¼šè¢«é˜»å¡ã€‚Semaphore å¯ä»¥ç”¨æ¥æ„å»ºä¸€äº›å¯¹è±¡æ± ï¼Œèµ„æºæ± ä¹‹ç±»çš„ï¼Œæ¯”å¦‚æ•°æ®åº“è¿æ¥æ± 
<code>å®ç°äº’æ–¥é”</code>ï¼ˆè®¡æ•°å™¨ä¸º 1ï¼‰<br>
æˆ‘ä»¬ä¹Ÿå¯ä»¥åˆ›å»ºè®¡æ•°ä¸º 1 çš„ Semaphoreï¼Œå°†å…¶ä½œä¸ºä¸€ç§ç±»ä¼¼äº’æ–¥é”çš„æœºåˆ¶ ï¼Œè¿™ä¹Ÿå«äºŒå…ƒä¿¡å·é‡ï¼Œè¡¨ç¤ºä¸¤ç§äº’æ–¥çŠ¶æ€ã€‚
`ä»£ç å®ç°</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// åˆ›å»ºä¸€ä¸ªè®¡æ•°é˜ˆå€¼ä¸º 5 çš„ä¿¡å·é‡å¯¹è±¡  </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// åªèƒ½ 5 ä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®  </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Semaphore</span><span class="w"> </span><span class="n">semp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Semaphore</span><span class="p">(</span><span class="n">5</span><span class="p">);</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// ç”³è¯·è®¸å¯  </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">semp</span><span class="p">.</span><span class="na">acquire</span><span class="p">();</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// ä¸šåŠ¡é€»è¾‘  </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">finally</span><span class="w"> </span><span class="p">{</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// é‡Šæ”¾è®¸å¯  </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">semp</span><span class="p">.</span><span class="na">release</span><span class="p">();</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">InterruptedException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p><code>Semaphore ä¸ ReentrantLock</code><br>
Semaphore åŸºæœ¬èƒ½å®Œæˆ ReentrantLock çš„æ‰€æœ‰å·¥ä½œï¼Œä½¿ç”¨æ–¹æ³•ä¹Ÿä¸ä¹‹ç±»ä¼¼ï¼Œé€šè¿‡ acquire()ä¸release()æ–¹æ³•æ¥è·å¾—å’Œé‡Šæ”¾ä¸´ç•Œèµ„æºã€‚ç»å®æµ‹ï¼ŒSemaphone.acquire()æ–¹æ³•é»˜è®¤ä¸ºå¯å“åº”ä¸­æ–­é”ï¼Œä¸ ReentrantLock.lockInterruptibly()ä½œç”¨æ•ˆæœä¸€è‡´ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨ç­‰å¾…ä¸´ç•Œèµ„æºçš„è¿‡ç¨‹ä¸­å¯ä»¥è¢«Thread.interrupt()æ–¹æ³•ä¸­æ–­ã€‚<br>
æ­¤å¤–ï¼ŒSemaphore ä¹Ÿå®ç°äº†å¯è½®è¯¢çš„é”è¯·æ±‚ä¸å®šæ—¶é”çš„åŠŸèƒ½ ï¼Œé™¤äº†æ–¹æ³•å tryAcquire ä¸ tryLockä¸åŒï¼Œå…¶ä½¿ç”¨æ–¹æ³•ä¸ ReentrantLock å‡ ä¹ä¸€è‡´ã€‚Semaphore ä¹Ÿæä¾›äº†å…¬å¹³ä¸éå…¬å¹³é”çš„æœºåˆ¶ï¼Œä¹Ÿå¯åœ¨æ„é€ å‡½æ•°ä¸­è¿›è¡Œè®¾å®šã€‚<br>
Semaphore çš„é”é‡Šæ”¾æ“ä½œä¹Ÿç”±æ‰‹åŠ¨è¿›è¡Œï¼Œå› æ­¤ä¸ ReentrantLock ä¸€æ ·ï¼Œä¸ºé¿å…çº¿ç¨‹å› æŠ›å‡ºå¼‚å¸¸è€Œæ— æ³•æ­£å¸¸é‡Šæ”¾é”çš„æƒ…å†µå‘ç”Ÿï¼Œé‡Šæ”¾é”çš„æ“ä½œä¹Ÿå¿…é¡»åœ¨ finally ä»£ç å—ä¸­å®Œæˆã€‚</p>
</blockquote>
<h3 id="atomicinteger">AtomicInteger
</h3><blockquote>
<p>é¦–å…ˆè¯´æ˜ï¼Œæ­¤å¤„ AtomicInteger ï¼Œä¸€ä¸ªæä¾›åŸå­æ“ä½œçš„ Integer çš„ç±»ï¼Œå¸¸è§çš„è¿˜æœ‰AtomicBooleanã€AtomicIntegerã€AtomicLongã€AtomicReference ç­‰ï¼Œä»–ä»¬çš„å®ç°åŸç†ç›¸åŒï¼ŒåŒºåˆ«åœ¨ä¸è¿ç®—å¯¹è±¡ç±»å‹çš„ä¸åŒã€‚ä»¤äººå…´å¥‹åœ°ï¼Œè¿˜å¯ä»¥é€šè¿‡ AtomicReferenceå°†ä¸€ä¸ªå¯¹è±¡çš„æ‰€æœ‰æ“ä½œè½¬åŒ–æˆåŸå­æ“ä½œã€‚<br>
æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨å¤šçº¿ç¨‹ç¨‹åºä¸­ï¼Œè¯¸å¦‚++i æˆ– i++ç­‰è¿ç®—ä¸å…·æœ‰åŸå­æ€§ï¼Œæ˜¯ä¸å®‰å…¨çš„çº¿ç¨‹æ“ä½œä¹‹ä¸€ã€‚é€šå¸¸æˆ‘ä»¬ä¼šä½¿ç”¨ synchronized å°†è¯¥æ“ä½œå˜æˆä¸€ä¸ªåŸå­æ“ä½œï¼Œä½† JVM ä¸ºæ­¤ç±»æ“ä½œç‰¹æ„æä¾›äº†ä¸€äº›åŒæ­¥ç±»ï¼Œä½¿å¾—ä½¿ç”¨æ›´æ–¹ä¾¿ï¼Œä¸”ä½¿ç¨‹åºè¿è¡Œæ•ˆç‡å˜å¾—æ›´é«˜ã€‚é€šè¿‡ç›¸å…³èµ„æ–™æ˜¾ç¤ºï¼Œé€šå¸¸AtomicIntegerçš„æ€§èƒ½æ˜¯ ReentantLock çš„å¥½å‡ å€ã€‚</p>
</blockquote>
<h3 id="å¯é‡å…¥é”é€’å½’é”">å¯é‡å…¥é”ï¼ˆé€’å½’é”ï¼‰
</h3><blockquote>
<p>æœ¬æ–‡é‡Œé¢è®²çš„æ˜¯å¹¿ä¹‰ä¸Šçš„å¯é‡å…¥é”ï¼Œè€Œä¸æ˜¯å•æŒ‡ JAVA ä¸‹çš„ ReentrantLockã€‚å¯é‡å…¥é”ï¼Œä¹Ÿå«åšé€’å½’é”ï¼ŒæŒ‡çš„æ˜¯åŒä¸€çº¿ç¨‹ å¤–å±‚å‡½æ•°è·å¾—é”ä¹‹å ï¼Œå†…å±‚é€’å½’å‡½æ•°ä»ç„¶æœ‰è·å–è¯¥é”çš„ä»£ç ï¼Œä½†ä¸å—å½±å“ã€‚åœ¨ JAVA ç¯å¢ƒä¸‹ ReentrantLock å’Œ synchronized éƒ½æ˜¯ å¯é‡å…¥é”ã€‚</p>
</blockquote>
<h3 id="å…¬å¹³é”ä¸éå…¬å¹³é”">å…¬å¹³é”ä¸éå…¬å¹³é”
</h3><blockquote>
<p><code>å…¬å¹³é”ï¼ˆFairï¼‰</code><br>
åŠ é”å‰æ£€æŸ¥æ˜¯å¦æœ‰æ’é˜Ÿç­‰å¾…çš„çº¿ç¨‹ï¼Œä¼˜å…ˆæ’é˜Ÿç­‰å¾…çš„çº¿ç¨‹ï¼Œå…ˆæ¥å…ˆå¾—
<code>éå…¬å¹³é”ï¼ˆNonfairï¼‰</code><br>
åŠ é”æ—¶ä¸è€ƒè™‘æ’é˜Ÿç­‰å¾…é—®é¢˜ï¼Œç›´æ¥å°è¯•è·å–é”ï¼Œè·å–ä¸åˆ°è‡ªåŠ¨åˆ°é˜Ÿå°¾ç­‰å¾…</p>
</blockquote>
<ol>
<li>éå…¬å¹³é”æ€§èƒ½æ¯”å…¬å¹³é”é«˜ 5~10 å€ï¼Œå› ä¸ºå…¬å¹³é”éœ€è¦åœ¨å¤šæ ¸çš„æƒ…å†µä¸‹ç»´æŠ¤ä¸€ä¸ªé˜Ÿåˆ—</li>
<li>Java ä¸­çš„ synchronized æ˜¯éå…¬å¹³é”ï¼ŒReentrantLock é»˜è®¤çš„ lock()æ–¹æ³•é‡‡ç”¨çš„æ˜¯éå…¬å¹³é”ã€‚</li>
</ol>
<h3 id="readwritelockè¯»å†™é”">ReadWriteLockè¯»å†™é”
</h3><blockquote>
<p>ä¸ºäº†æé«˜æ€§èƒ½ï¼ŒJava æä¾›äº†è¯»å†™é”ï¼Œåœ¨è¯»çš„åœ°æ–¹ä½¿ç”¨è¯»é”ï¼Œåœ¨å†™çš„åœ°æ–¹ä½¿ç”¨å†™é”ï¼Œçµæ´»æ§åˆ¶ï¼Œå¦‚æœæ²¡æœ‰å†™é”çš„æƒ…å†µä¸‹ï¼Œè¯»æ˜¯æ— é˜»å¡çš„,åœ¨ä¸€å®šç¨‹åº¦ä¸Šæé«˜äº†ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡ã€‚è¯»å†™é”åˆ†ä¸ºè¯»é”å’Œå†™é”ï¼Œå¤šä¸ªè¯»é”ä¸äº’æ–¥ï¼Œè¯»é”ä¸å†™é”äº’æ–¥ï¼Œè¿™æ˜¯ç”± jvm è‡ªå·±æ§åˆ¶çš„ï¼Œä½ åªè¦ä¸Šå¥½ç›¸åº”çš„é”å³å¯ã€‚<br>
<code>è¯»é”</code><br>
å¦‚æœä½ çš„ä»£ç åªè¯»æ•°æ®ï¼Œå¯ä»¥å¾ˆå¤šäººåŒæ—¶è¯»ï¼Œä½†ä¸èƒ½åŒæ—¶å†™ï¼Œé‚£å°±ä¸Šè¯»é”<br>
<code>å†™é”</code><br>
å¦‚æœä½ çš„ä»£ç ä¿®æ”¹æ•°æ®ï¼Œåªèƒ½æœ‰ä¸€ä¸ªäººåœ¨å†™ï¼Œä¸”ä¸èƒ½åŒæ—¶è¯»å–ï¼Œé‚£å°±ä¸Šå†™é”ã€‚æ€»ä¹‹ï¼Œè¯»çš„æ—¶å€™ä¸Šè¯»é”ï¼Œå†™çš„æ—¶å€™ä¸Šå†™é”ï¼Java ä¸­ è¯» å†™ é” æœ‰ ä¸ª æ¥ å£ java.util.concurrent.locks.ReadWriteLock ï¼Œ ä¹Ÿ æœ‰ å…· ä½“ çš„ å® ç°ReentrantReadWriteLockã€‚</p>
</blockquote>
<h3 id="å…±äº«é”-å’Œ-ç‹¬å é”">å…±äº«é” å’Œ ç‹¬å é”
</h3><blockquote>
<p>java å¹¶å‘åŒ…æä¾›çš„åŠ é”æ¨¡å¼åˆ†ä¸ºç‹¬å é”å’Œå…±äº«é”ã€‚<br>
<code>ç‹¬å é”</code><br>
ç‹¬å é”æ¨¡å¼ä¸‹ï¼Œæ¯æ¬¡åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½æŒæœ‰é”ï¼ŒReentrantLock å°±æ˜¯ä»¥ç‹¬å æ–¹å¼å®ç°çš„äº’æ–¥é”ã€‚ç‹¬å é”æ˜¯ä¸€ç§æ‚²è§‚ä¿å®ˆçš„åŠ é”ç­–ç•¥ï¼Œå®ƒé¿å…äº†è¯»/è¯»å†²çªï¼Œå¦‚æœæŸä¸ªåªè¯»çº¿ç¨‹è·å–é”ï¼Œåˆ™å…¶ä»–è¯»çº¿ç¨‹éƒ½åªèƒ½ç­‰å¾…ï¼Œè¿™ç§æƒ…å†µä¸‹å°±é™åˆ¶äº†ä¸å¿…è¦çš„å¹¶å‘æ€§ï¼Œå› ä¸ºè¯»æ“ä½œå¹¶ä¸ä¼šå½±å“æ•°æ®çš„ä¸€è‡´æ€§ã€‚
<code>å…±äº«é”</code><br>
å…±äº«é”åˆ™å…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶è·å–é”ï¼Œå¹¶å‘è®¿é—® å…±äº«èµ„æºï¼Œå¦‚ï¼šReadWriteLockã€‚å…±äº«é”åˆ™æ˜¯ä¸€ç§ä¹è§‚é”ï¼Œå®ƒæ”¾å®½äº†åŠ é”ç­–ç•¥ï¼Œå…è®¸å¤šä¸ªæ‰§è¡Œè¯»æ“ä½œçš„çº¿ç¨‹åŒæ—¶è®¿é—®å…±äº«èµ„æºã€‚</p>
</blockquote>
<ol>
<li>AQS çš„å†…éƒ¨ç±» Node å®šä¹‰äº†ä¸¤ä¸ªå¸¸é‡ SHARED å’Œ EXCLUSIVEï¼Œä»–ä»¬åˆ†åˆ«æ ‡è¯† AQS é˜Ÿåˆ—ä¸­ç­‰å¾…çº¿ç¨‹çš„é”è·å–æ¨¡å¼ã€‚</li>
<li>java çš„å¹¶å‘åŒ…ä¸­æä¾›äº† ReadWriteLockï¼Œè¯»-å†™é”ã€‚å®ƒå…è®¸ä¸€ä¸ªèµ„æºå¯ä»¥è¢«å¤šä¸ªè¯»æ“ä½œè®¿é—®ï¼Œæˆ–è€…è¢«ä¸€ä¸ª å†™æ“ä½œè®¿é—®ï¼Œä½†ä¸¤è€…ä¸èƒ½åŒæ—¶è¿›è¡Œã€‚</li>
</ol>
<h3 id="é‡é‡çº§é”mutex-lock">é‡é‡çº§é”ï¼ˆMutex Lockï¼‰
</h3><blockquote>
<p>Synchronized æ˜¯é€šè¿‡å¯¹è±¡å†…éƒ¨çš„ä¸€ä¸ªå«åšç›‘è§†å™¨é”ï¼ˆmonitorï¼‰æ¥å®ç°çš„ã€‚ä½†æ˜¯ç›‘è§†å™¨é”æœ¬è´¨åˆæ˜¯ä¾èµ–äºåº•å±‚çš„æ“ä½œç³»ç»Ÿçš„ Mutex Lock æ¥å®ç°çš„ã€‚è€Œæ“ä½œç³»ç»Ÿå®ç°çº¿ç¨‹ä¹‹é—´çš„åˆ‡æ¢è¿™å°±éœ€è¦ä»ç”¨æˆ·æ€è½¬æ¢åˆ°æ ¸å¿ƒæ€ï¼Œè¿™ä¸ªæˆæœ¬éå¸¸é«˜ï¼ŒçŠ¶æ€ä¹‹é—´çš„è½¬æ¢éœ€è¦ç›¸å¯¹æ¯”è¾ƒé•¿çš„æ—¶é—´ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆSynchronized æ•ˆç‡ä½çš„åŸå› ã€‚å› æ­¤ï¼Œè¿™ç§ä¾èµ–äºæ“ä½œç³»ç»Ÿ Mutex Lock æ‰€å®ç°çš„é”æˆ‘ä»¬ç§°ä¹‹ä¸ºé‡é‡çº§é”ã€‚JDK ä¸­å¯¹ Synchronized åšçš„ç§ç§ä¼˜åŒ–ï¼Œå…¶æ ¸å¿ƒéƒ½æ˜¯ä¸ºäº†å‡å°‘è¿™ç§é‡é‡çº§é”çš„ä½¿ç”¨ã€‚JDK1.6 ä»¥åï¼Œä¸ºäº†å‡å°‘è·å¾—é”å’Œé‡Šæ”¾é”æ‰€å¸¦æ¥çš„æ€§èƒ½æ¶ˆè€—ï¼Œæé«˜æ€§èƒ½ï¼Œå¼•å…¥äº†è½»é‡çº§é”å’Œåå‘é”</p>
</blockquote>
<h3 id="è½»é‡çº§é”">è½»é‡çº§é”
</h3><blockquote>
<p>é”çš„çŠ¶æ€æ€»å…±æœ‰å››ç§ï¼šæ— é”çŠ¶æ€ã€åå‘é”ã€è½»é‡çº§é”å’Œé‡é‡çº§é”ã€‚<br>
<code>é”å‡çº§</code><br>
éšç€é”çš„ç«äº‰ï¼Œé”å¯ä»¥ä»åå‘é”å‡çº§åˆ°è½»é‡çº§é”ï¼Œå†å‡çº§çš„é‡é‡çº§é”ï¼ˆä½†æ˜¯é”çš„å‡çº§æ˜¯å•å‘çš„ï¼Œä¹Ÿå°±æ˜¯è¯´åªèƒ½ä»ä½åˆ°é«˜å‡çº§ï¼Œä¸ä¼šå‡ºç°é”çš„é™çº§ï¼‰ã€‚è½»é‡çº§æ˜¯ç›¸å¯¹äºä½¿ç”¨æ“ä½œç³»ç»Ÿäº’æ–¥é‡æ¥å®ç°çš„ä¼ ç»Ÿé”è€Œè¨€çš„ã€‚ä½†æ˜¯ï¼Œé¦–å…ˆéœ€è¦å¼ºè°ƒä¸€ç‚¹çš„æ˜¯ï¼Œè½»é‡çº§é”å¹¶ä¸æ˜¯ç”¨æ¥ä»£æ›¿é‡é‡çº§é”çš„ï¼Œå®ƒçš„æœ¬æ„æ˜¯åœ¨æ²¡æœ‰å¤šçº¿ç¨‹ç«äº‰çš„å‰æä¸‹ï¼Œå‡å°‘ä¼ ç»Ÿçš„é‡é‡çº§é”ä½¿ç”¨äº§ç”Ÿçš„æ€§èƒ½æ¶ˆè€—ã€‚åœ¨è§£é‡Šè½»é‡çº§é”çš„æ‰§è¡Œè¿‡ç¨‹ä¹‹å‰ï¼Œå…ˆæ˜ç™½ä¸€ç‚¹ï¼Œè½»é‡çº§é”æ‰€é€‚åº”çš„åœºæ™¯æ˜¯çº¿ç¨‹äº¤æ›¿æ‰§è¡ŒåŒæ­¥å—çš„æƒ…å†µï¼Œå¦‚æœå­˜åœ¨åŒä¸€æ—¶é—´è®¿é—®åŒä¸€é”çš„æƒ…å†µï¼Œå°±ä¼šå¯¼è‡´è½»é‡çº§é”è†¨èƒ€ä¸ºé‡é‡çº§é”ã€‚</p>
</blockquote>
<h3 id="åå‘é”">åå‘é”
</h3><blockquote>
<p>Hotspot çš„ä½œè€…ç»è¿‡ä»¥å¾€çš„ç ”ç©¶å‘ç°å¤§å¤šæ•°æƒ…å†µä¸‹é”ä¸ä»…ä¸å­˜åœ¨å¤šçº¿ç¨‹ç«äº‰ï¼Œè€Œä¸”æ€»æ˜¯ç”±åŒä¸€çº¿ç¨‹å¤šæ¬¡è·å¾—ã€‚åå‘é”çš„ç›®çš„æ˜¯åœ¨æŸä¸ªçº¿ç¨‹è·å¾—é”ä¹‹åï¼Œæ¶ˆé™¤è¿™ä¸ªçº¿ç¨‹é”é‡å…¥ï¼ˆCASï¼‰çš„å¼€é”€ï¼Œçœ‹èµ·æ¥è®©è¿™ä¸ªçº¿ç¨‹å¾—åˆ°äº†åæŠ¤ã€‚å¼•å…¥åå‘é”æ˜¯ä¸ºäº†åœ¨æ— å¤šçº¿ç¨‹ç«äº‰çš„æƒ…å†µä¸‹å°½é‡å‡å°‘ä¸å¿…è¦çš„è½»é‡çº§é”æ‰§è¡Œè·¯å¾„ï¼Œå› ä¸ºè½»é‡çº§é”çš„è·å–åŠé‡Šæ”¾ä¾èµ–å¤šæ¬¡ CAS åŸå­æŒ‡ä»¤ï¼Œè€Œåå‘é”åªéœ€è¦åœ¨ç½®æ¢ThreadID çš„æ—¶å€™ä¾èµ–ä¸€æ¬¡ CAS åŸå­æŒ‡ä»¤ï¼ˆç”±äºä¸€æ—¦å‡ºç°å¤šçº¿ç¨‹ç«äº‰çš„æƒ…å†µå°±å¿…é¡»æ’¤é”€åå‘é”ï¼Œæ‰€ä»¥åå‘é”çš„æ’¤é”€æ“ä½œçš„æ€§èƒ½æŸè€—å¿…é¡»å°äºèŠ‚çœä¸‹æ¥çš„ CAS åŸå­æŒ‡ä»¤çš„æ€§èƒ½æ¶ˆè€—ï¼‰ã€‚ä¸Šé¢è¯´è¿‡ï¼Œè½»é‡çº§é”æ˜¯ä¸ºäº†åœ¨çº¿ç¨‹äº¤æ›¿æ‰§è¡ŒåŒæ­¥å—æ—¶æé«˜æ€§èƒ½ï¼Œè€Œåå‘é”åˆ™æ˜¯åœ¨åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡ŒåŒæ­¥å—æ—¶è¿›ä¸€æ­¥æé«˜æ€§èƒ½ã€‚</p>
</blockquote>
<h3 id="åˆ†æ®µé”">åˆ†æ®µé”
</h3><blockquote>
<p>åˆ†æ®µé”ä¹Ÿå¹¶éä¸€ç§å®é™…çš„é”ï¼Œè€Œæ˜¯ä¸€ç§æ€æƒ³ ConcurrentHashMap æ˜¯å­¦ä¹ åˆ†æ®µé”çš„æœ€å¥½å®è·µã€‚</p>
</blockquote>
<h3 id="é”ä¼˜åŒ–">é”ä¼˜åŒ–
</h3><blockquote>
<p><code>å‡å°‘é”æŒæœ‰æ—¶é—´</code><br>
åªç”¨åœ¨æœ‰çº¿ç¨‹å®‰å…¨è¦æ±‚çš„ç¨‹åºä¸ŠåŠ é”<br>
<code>å‡å°é”ç²’åº¦</code><br>
å°†å¤§å¯¹è±¡ï¼ˆè¿™ä¸ªå¯¹è±¡å¯èƒ½ä¼šè¢«å¾ˆå¤šçº¿ç¨‹è®¿é—®ï¼‰ï¼Œæ‹†æˆå°å¯¹è±¡ï¼Œå¤§å¤§å¢åŠ å¹¶è¡Œåº¦ï¼Œé™ä½é”ç«äº‰ã€‚é™ä½äº†é”çš„ç«äº‰ï¼Œåå‘é”ï¼Œè½»é‡çº§é”æˆåŠŸç‡æ‰ä¼šæé«˜ã€‚æœ€æœ€å…¸å‹çš„å‡å°é”ç²’åº¦çš„æ¡ˆä¾‹å°±æ˜¯ConcurrentHashMapã€‚<br>
<code>é”åˆ†ç¦»</code><br>
æœ€å¸¸è§çš„é”åˆ†ç¦»å°±æ˜¯è¯»å†™é” ReadWriteLockï¼Œæ ¹æ®åŠŸèƒ½è¿›è¡Œåˆ†ç¦»æˆè¯»é”å’Œå†™é”ï¼Œè¿™æ ·è¯»è¯»ä¸äº’æ–¥ï¼Œè¯»å†™äº’æ–¥ï¼Œå†™å†™äº’æ–¥ï¼Œå³ä¿è¯äº†çº¿ç¨‹å®‰å…¨ï¼Œåˆæé«˜äº†æ€§èƒ½ã€‚JDK å¹¶å‘åŒ…ï¼Œè¯»å†™åˆ†ç¦»æ€æƒ³å¯ä»¥å»¶ä¼¸ï¼Œåªè¦æ“ä½œäº’ä¸å½±å“ï¼Œé”å°±å¯ä»¥åˆ†ç¦»ã€‚æ¯”LinkedBlockingQueue ä»å¤´éƒ¨å–å‡ºï¼Œä»å°¾éƒ¨æ”¾æ•°æ®<br>
<code>é”ç²—åŒ–</code><br>
é€šå¸¸æƒ…å†µä¸‹ï¼Œä¸ºäº†ä¿è¯å¤šçº¿ç¨‹é—´çš„æœ‰æ•ˆå¹¶å‘ï¼Œä¼šè¦æ±‚æ¯ä¸ªçº¿ç¨‹æŒæœ‰é”çš„æ—¶é—´å°½é‡çŸ­ï¼Œå³åœ¨ä½¿ç”¨å®Œå…¬å…±èµ„æºåï¼Œåº”è¯¥ç«‹å³é‡Šæ”¾é”ã€‚ä½†æ˜¯ï¼Œå‡¡äº‹éƒ½æœ‰ä¸€ä¸ªåº¦ï¼Œå¦‚æœå¯¹åŒä¸€ä¸ªé”ä¸åœçš„è¿›è¡Œè¯·æ±‚ã€åŒæ­¥å’Œé‡Šæ”¾ï¼Œå…¶æœ¬èº«ä¹Ÿä¼šæ¶ˆè€—ç³»ç»Ÿå®è´µçš„èµ„æºï¼Œåè€Œä¸åˆ©äºæ€§èƒ½çš„ä¼˜åŒ–ã€‚<br>
<code>é”æ¶ˆé™¤</code><br>
é”æ¶ˆé™¤æ˜¯åœ¨ç¼–è¯‘å™¨çº§åˆ«çš„äº‹æƒ…ã€‚åœ¨å³æ—¶ç¼–è¯‘å™¨æ—¶ï¼Œå¦‚æœå‘ç°ä¸å¯èƒ½è¢«å…±äº«çš„å¯¹è±¡ï¼Œåˆ™å¯ä»¥æ¶ˆé™¤è¿™äº›å¯¹è±¡çš„é”æ“ä½œï¼Œå¤šæ•°æ˜¯å› ä¸ºç¨‹åºå‘˜ç¼–ç ä¸è§„èŒƒå¼•èµ·ã€‚</p>
</blockquote>
<h3 id="çº¿ç¨‹åŸºæœ¬æ–¹æ³•">çº¿ç¨‹åŸºæœ¬æ–¹æ³•
</h3><blockquote>
<p>çº¿ç¨‹ç›¸å…³çš„åŸºæœ¬æ–¹æ³•æœ‰ waitï¼Œnotifyï¼ŒnotifyAllï¼Œsleepï¼Œjoinï¼Œyield ç­‰ã€‚</p>
</blockquote>
<h3 id="çº¿ç¨‹ç­‰å¾…wait">çº¿ç¨‹ç­‰å¾…ï¼ˆwaitï¼‰
</h3><blockquote>
<p>è°ƒç”¨è¯¥æ–¹æ³•çš„çº¿ç¨‹è¿›å…¥ WAITING çŠ¶æ€ï¼Œåªæœ‰ç­‰å¾…å¦å¤–çº¿ç¨‹çš„é€šçŸ¥æˆ–è¢«ä¸­æ–­æ‰ä¼šè¿”å›ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯è°ƒç”¨ wait()æ–¹æ³•åï¼Œä¼šé‡Šæ”¾å¯¹è±¡çš„é”ã€‚å› æ­¤ï¼Œwait æ–¹æ³•ä¸€èˆ¬ç”¨åœ¨åŒæ­¥æ–¹æ³•æˆ–åŒæ­¥ä»£ç å—ä¸­ã€‚</p>
</blockquote>
<h3 id="çº¿ç¨‹ç¡çœ sleep">çº¿ç¨‹ç¡çœ ï¼ˆsleepï¼‰
</h3><blockquote>
<p>sleep å¯¼è‡´å½“å‰çº¿ç¨‹ä¼‘çœ ï¼Œä¸ wait æ–¹æ³•ä¸åŒçš„æ˜¯ sleep ä¸ä¼šé‡Šæ”¾å½“å‰å æœ‰çš„é”,sleep(long)ä¼šå¯¼è‡´çº¿ç¨‹è¿›å…¥ TIMED-WATING çŠ¶æ€ï¼Œè€Œ wait()æ–¹æ³•ä¼šå¯¼è‡´å½“å‰çº¿ç¨‹è¿›å…¥ WATING çŠ¶æ€ã€‚</p>
</blockquote>
<h3 id="çº¿ç¨‹è®©æ­¥yield">çº¿ç¨‹è®©æ­¥ï¼ˆyieldï¼‰
</h3><blockquote>
<p>yield ä¼šä½¿å½“å‰çº¿ç¨‹è®©å‡º CPU æ‰§è¡Œæ—¶é—´ç‰‡ï¼Œä¸å…¶ä»–çº¿ç¨‹ä¸€èµ·é‡æ–°ç«äº‰ CPU æ—¶é—´ç‰‡ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¼˜å…ˆçº§é«˜çš„çº¿ç¨‹æœ‰æ›´å¤§çš„å¯èƒ½æ€§æˆåŠŸç«äº‰å¾—åˆ° CPU æ—¶é—´ç‰‡ï¼Œä½†è¿™åˆä¸æ˜¯ç»å¯¹çš„ï¼Œæœ‰çš„æ“ä½œç³»ç»Ÿå¯¹çº¿ç¨‹ä¼˜å…ˆçº§å¹¶ä¸æ•æ„Ÿã€‚</p>
</blockquote>
<h3 id="çº¿ç¨‹ä¸­æ–­interrupt">çº¿ç¨‹ä¸­æ–­ï¼ˆinterruptï¼‰
</h3><blockquote>
<p>ä¸­æ–­ä¸€ä¸ªçº¿ç¨‹ï¼Œå…¶æœ¬æ„æ˜¯ç»™è¿™ä¸ªçº¿ç¨‹ä¸€ä¸ªé€šçŸ¥ä¿¡å·ï¼Œä¼šå½±å“è¿™ä¸ªçº¿ç¨‹å†…éƒ¨çš„ä¸€ä¸ªä¸­æ–­æ ‡è¯†ä½ã€‚è¿™ä¸ªçº¿ç¨‹æœ¬èº«å¹¶ä¸ä¼šå› æ­¤è€Œæ”¹å˜çŠ¶æ€(å¦‚é˜»å¡ï¼Œç»ˆæ­¢ç­‰)ã€‚</p>
</blockquote>
<ol>
<li>è°ƒç”¨ interrupt()æ–¹æ³•å¹¶ä¸ä¼šä¸­æ–­ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹ã€‚ä¹Ÿå°±æ˜¯è¯´å¤„äº Running çŠ¶æ€çš„çº¿ç¨‹å¹¶ä¸ä¼šå› ä¸ºè¢«ä¸­æ–­è€Œè¢«ç»ˆæ­¢ï¼Œä»…ä»…æ”¹å˜äº†å†…éƒ¨ç»´æŠ¤çš„ä¸­æ–­æ ‡è¯†ä½è€Œå·²ã€‚</li>
<li>è‹¥è°ƒç”¨ sleep()è€Œä½¿çº¿ç¨‹å¤„äº TIMED-WATING çŠ¶æ€ï¼Œè¿™æ—¶è°ƒç”¨ interrupt()æ–¹æ³•ï¼Œä¼šæŠ›å‡ºInterruptedException,ä»è€Œä½¿çº¿ç¨‹æå‰ç»“æŸ TIMED-WATING çŠ¶æ€ã€‚</li>
<li>è®¸å¤šå£°æ˜æŠ›å‡º InterruptedException çš„æ–¹æ³•(å¦‚ Thread.sleep(long mills æ–¹æ³•))ï¼ŒæŠ›å‡ºå¼‚å¸¸å‰ï¼Œéƒ½ä¼šæ¸…é™¤ä¸­æ–­æ ‡è¯†ä½ï¼Œæ‰€ä»¥æŠ›å‡ºå¼‚å¸¸åï¼Œè°ƒç”¨ isInterrupted()æ–¹æ³•å°†ä¼šè¿”å› falseã€‚</li>
<li>ä¸­æ–­çŠ¶æ€æ˜¯çº¿ç¨‹å›ºæœ‰çš„ä¸€ä¸ªæ ‡è¯†ä½ï¼Œå¯ä»¥é€šè¿‡æ­¤æ ‡è¯†ä½å®‰å…¨çš„ç»ˆæ­¢çº¿ç¨‹ã€‚æ¯”å¦‚,ä½ æƒ³ç»ˆæ­¢ä¸€ä¸ªçº¿ç¨‹ thread çš„æ—¶å€™ï¼Œå¯ä»¥è°ƒç”¨ thread.interrupt()æ–¹æ³•ï¼Œåœ¨çº¿ç¨‹çš„ run æ–¹æ³•å†…éƒ¨å¯ä»¥æ ¹æ® thread.isInterrupted()çš„å€¼æ¥ä¼˜é›…çš„ç»ˆæ­¢çº¿ç¨‹ã€‚</li>
</ol>
<h3 id="joinç­‰å¾…å…¶ä»–çº¿ç¨‹ç»ˆæ­¢">Joinç­‰å¾…å…¶ä»–çº¿ç¨‹ç»ˆæ­¢
</h3><blockquote>
<p>join() æ–¹æ³•ï¼Œç­‰å¾…å…¶ä»–çº¿ç¨‹ç»ˆæ­¢ï¼Œåœ¨å½“å‰çº¿ç¨‹ä¸­è°ƒç”¨ä¸€ä¸ªçº¿ç¨‹çš„ join() æ–¹æ³•ï¼Œåˆ™å½“å‰çº¿ç¨‹è½¬ä¸ºé˜»å¡çŠ¶æ€ï¼Œç­‰åˆ°å¦ä¸€ä¸ªçº¿ç¨‹ç»“æŸï¼Œå½“å‰çº¿ç¨‹å†ç”±é˜»å¡çŠ¶æ€å˜ä¸ºå°±ç»ªçŠ¶æ€ï¼Œç­‰å¾… cpu çš„å® å¹¸ã€‚</p>
</blockquote>
<h3 id="ä¸ºä»€ä¹ˆè¦ç”¨joinæ–¹æ³•">ä¸ºä»€ä¹ˆè¦ç”¨join()æ–¹æ³•
</h3><blockquote>
<p>å¾ˆå¤šæƒ…å†µä¸‹ï¼Œä¸»çº¿ç¨‹ç”Ÿæˆå¹¶å¯åŠ¨äº†å­çº¿ç¨‹ï¼Œéœ€è¦ç”¨åˆ°å­çº¿ç¨‹è¿”å›çš„ç»“æœï¼Œä¹Ÿå°±æ˜¯éœ€è¦ä¸»çº¿ç¨‹éœ€è¦åœ¨å­çº¿ç¨‹ç»“æŸåå†ç»“æŸï¼Œè¿™æ—¶å€™å°±è¦ç”¨åˆ° join() æ–¹æ³•ã€‚</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">().</span><span class="na">getName</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34;çº¿ç¨‹è¿è¡Œå¼€å§‹!&#34;</span><span class="p">);</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Thread6</span><span class="w"> </span><span class="n">thread1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Thread6</span><span class="p">();</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">threadsetName</span><span class="p">(</span><span class="s">&#34;çº¿ç¨‹ B&#34;</span><span class="p">);</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">threadjoin</span><span class="p">();</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;è¿™æ—¶ thread1 æ‰§è¡Œå®Œæ¯•ä¹‹åæ‰èƒ½æ‰§è¡Œä¸»çº¿ç¨‹&#34;</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="çº¿ç¨‹å”¤é†’notify">çº¿ç¨‹å”¤é†’ï¼ˆnotifyï¼‰
</h3><blockquote>
<p>Object ç±»ä¸­çš„ notify() æ–¹æ³•ï¼Œå”¤é†’åœ¨æ­¤å¯¹è±¡ç›‘è§†å™¨ä¸Šç­‰å¾…çš„å•ä¸ªçº¿ç¨‹ï¼Œå¦‚æœæ‰€æœ‰çº¿ç¨‹éƒ½åœ¨æ­¤å¯¹è±¡ä¸Šç­‰å¾…ï¼Œåˆ™ä¼šé€‰æ‹©å”¤é†’å…¶ä¸­ä¸€ä¸ªçº¿ç¨‹ï¼Œé€‰æ‹©æ˜¯ä»»æ„çš„ï¼Œå¹¶åœ¨å¯¹å®ç°åšå‡ºå†³å®šæ—¶å‘ç”Ÿï¼Œçº¿ç¨‹é€šè¿‡è°ƒç”¨å…¶ä¸­ä¸€ä¸ª wait() æ–¹æ³•ï¼Œåœ¨å¯¹è±¡çš„ç›‘è§†å™¨ä¸Šç­‰å¾…ï¼Œç›´åˆ°å½“å‰çš„çº¿ç¨‹æ”¾å¼ƒæ­¤å¯¹è±¡ä¸Šçš„é”å®šï¼Œæ‰èƒ½ç»§ç»­æ‰§è¡Œè¢«å”¤é†’çš„çº¿ç¨‹ï¼Œè¢«å”¤é†’çš„çº¿ç¨‹å°†ä»¥å¸¸è§„æ–¹å¼ä¸åœ¨è¯¥å¯¹è±¡ä¸Šä¸»åŠ¨åŒæ­¥çš„å…¶ä»–æ‰€æœ‰çº¿ç¨‹è¿›è¡Œç«äº‰ã€‚ç±»ä¼¼çš„æ–¹æ³•è¿˜æœ‰ notifyAll() ï¼Œå”¤é†’å†æ¬¡ç›‘è§†å™¨ä¸Šç­‰å¾…çš„æ‰€æœ‰çº¿ç¨‹ã€‚</p>
</blockquote>
<h3 id="å…¶ä»–æ–¹æ³•">å…¶ä»–æ–¹æ³•
</h3><ol>
<li>sleep()ï¼šå¼ºè¿«ä¸€ä¸ªçº¿ç¨‹ç¡çœ ï¼®æ¯«ç§’ã€‚</li>
<li>isAlive()ï¼š åˆ¤æ–­ä¸€ä¸ªçº¿ç¨‹æ˜¯å¦å­˜æ´»ã€‚</li>
<li>join()ï¼š ç­‰å¾…çº¿ç¨‹ç»ˆæ­¢ã€‚</li>
<li>activeCount()ï¼š ç¨‹åºä¸­æ´»è·ƒçš„çº¿ç¨‹æ•°ã€‚</li>
<li>enumerate()ï¼š æšä¸¾ç¨‹åºä¸­çš„çº¿ç¨‹ã€‚</li>
<li>currentThread()ï¼š å¾—åˆ°å½“å‰çº¿ç¨‹ã€‚</li>
<li>isDaemon()ï¼š ä¸€ä¸ªçº¿ç¨‹æ˜¯å¦ä¸ºå®ˆæŠ¤çº¿ç¨‹ã€‚</li>
<li>setDaemon()ï¼š è®¾ç½®ä¸€ä¸ªçº¿ç¨‹ä¸ºå®ˆæŠ¤çº¿ç¨‹ã€‚(ç”¨æˆ·çº¿ç¨‹å’Œå®ˆæŠ¤çº¿ç¨‹çš„åŒºåˆ«åœ¨äºï¼Œæ˜¯å¦ç­‰å¾…ä¸»çº¿ç¨‹ä¾èµ–äºä¸»çº¿ç¨‹ç»“æŸè€Œç»“æŸ)</li>
<li>setName()ï¼š ä¸ºçº¿ç¨‹è®¾ç½®ä¸€ä¸ªåç§°ã€‚</li>
<li>wait()ï¼š å¼ºè¿«ä¸€ä¸ªçº¿ç¨‹ç­‰å¾…ã€‚</li>
<li>notify()ï¼š é€šçŸ¥ä¸€ä¸ªçº¿ç¨‹ç»§ç»­è¿è¡Œã€‚</li>
<li>setPriority()ï¼š è®¾ç½®ä¸€ä¸ªçº¿ç¨‹çš„ä¼˜å…ˆçº§ã€‚</li>
<li>getPriority():ï¼šè·å¾—ä¸€ä¸ªçº¿ç¨‹çš„ä¼˜å…ˆçº§ã€‚</li>
</ol>
<h3 id="çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢">çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢
</h3><blockquote>
<p>å·§å¦™åœ°åˆ©ç”¨äº†æ—¶é—´ç‰‡è½®è½¬çš„æ–¹å¼, CPU ç»™æ¯ä¸ªä»»åŠ¡éƒ½æœåŠ¡ä¸€å®šçš„æ—¶é—´ï¼Œç„¶åæŠŠå½“å‰ä»»åŠ¡çš„çŠ¶æ€ä¿å­˜ä¸‹æ¥ï¼Œåœ¨åŠ è½½ä¸‹ä¸€ä»»åŠ¡çš„çŠ¶æ€åï¼Œç»§ç»­æœåŠ¡ä¸‹ä¸€ä»»åŠ¡ï¼Œä»»åŠ¡çš„çŠ¶æ€ä¿å­˜åŠå†åŠ è½½, è¿™æ®µè¿‡ç¨‹å°±å«åšä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚æ—¶é—´ç‰‡è½®è½¬çš„æ–¹å¼ä½¿å¤šä¸ªä»»åŠ¡åœ¨åŒä¸€ä¸ª CPU ä¸Šæ‰§è¡Œå˜æˆäº†å¯èƒ½ã€‚</p>
</blockquote>
<h3 id="è¿›ç¨‹">è¿›ç¨‹
</h3><blockquote>
<p>ï¼ˆæœ‰æ—¶å€™ä¹Ÿç§°åšä»»åŠ¡ï¼‰æ˜¯æŒ‡ä¸€ä¸ªç¨‹åºè¿è¡Œçš„å®ä¾‹ã€‚åœ¨ Linux ç³»ç»Ÿä¸­ï¼Œçº¿ç¨‹å°±æ˜¯èƒ½å¹¶è¡Œè¿è¡Œå¹¶ä¸”ä¸ä»–ä»¬çš„çˆ¶è¿›ç¨‹ï¼ˆåˆ›å»ºä»–ä»¬çš„è¿›ç¨‹ï¼‰å…±äº«åŒä¸€åœ°å€ç©ºé—´ï¼ˆä¸€æ®µå†…å­˜åŒºåŸŸï¼‰å’Œå…¶ä»–èµ„æºçš„è½»é‡çº§çš„è¿›ç¨‹ã€‚</p>
</blockquote>
<h3 id="ä¸Šä¸‹æ–‡">ä¸Šä¸‹æ–‡
</h3><blockquote>
<p>æ˜¯æŒ‡æŸä¸€æ—¶é—´ç‚¹ CPU å¯„å­˜å™¨å’Œç¨‹åºè®¡æ•°å™¨çš„å†…å®¹ã€‚</p>
</blockquote>
<h3 id="å¯„å­˜å™¨">å¯„å­˜å™¨
</h3><blockquote>
<p>æ˜¯ CPU å†…éƒ¨çš„æ•°é‡è¾ƒå°‘ä½†æ˜¯é€Ÿåº¦å¾ˆå¿«çš„å†…å­˜ï¼ˆä¸ä¹‹å¯¹åº”çš„æ˜¯ CPU å¤–éƒ¨ç›¸å¯¹è¾ƒæ…¢çš„ RAM ä¸»å†…å­˜ï¼‰ã€‚å¯„å­˜å™¨é€šè¿‡å¯¹å¸¸ç”¨å€¼ï¼ˆé€šå¸¸æ˜¯è¿ç®—çš„ä¸­é—´å€¼ï¼‰çš„å¿«é€Ÿè®¿é—®æ¥æé«˜è®¡ç®—æœºç¨‹åºè¿è¡Œçš„é€Ÿåº¦ã€‚</p>
</blockquote>
<h3 id="ç¨‹åºè®¡æ•°å™¨">ç¨‹åºè®¡æ•°å™¨
</h3><blockquote>
<p>æ˜¯ä¸€ä¸ªä¸“ç”¨çš„å¯„å­˜å™¨ï¼Œç”¨äºè¡¨æ˜æŒ‡ä»¤åºåˆ—ä¸­ CPU æ­£åœ¨æ‰§è¡Œçš„ä½ç½®ï¼Œå­˜çš„å€¼ä¸ºæ­£åœ¨æ‰§è¡Œçš„æŒ‡ä»¤çš„ä½ç½®æˆ–è€…ä¸‹ä¸€ä¸ªå°†è¦è¢«æ‰§è¡Œçš„æŒ‡ä»¤çš„ä½ç½®ï¼Œå…·ä½“ä¾èµ–äºç‰¹å®šçš„ç³»ç»Ÿã€‚</p>
</blockquote>
<h3 id="pcb-åˆ‡æ¢å¸§">PCB-â€œåˆ‡æ¢å¸§â€
</h3><blockquote>
<p>ä¸Šä¸‹æ–‡åˆ‡æ¢å¯ä»¥è®¤ä¸ºæ˜¯å†…æ ¸ï¼ˆæ“ä½œç³»ç»Ÿçš„æ ¸å¿ƒï¼‰åœ¨ CPU ä¸Šå¯¹äºè¿›ç¨‹ï¼ˆåŒ…æ‹¬çº¿ç¨‹ï¼‰è¿›è¡Œåˆ‡æ¢ï¼Œä¸Šä¸‹æ–‡åˆ‡æ¢è¿‡ç¨‹ä¸­çš„ä¿¡æ¯æ˜¯ä¿å­˜åœ¨è¿›ç¨‹æ§åˆ¶å—ï¼ˆPCB, process control blockï¼‰ä¸­çš„ã€‚PCB è¿˜ç»å¸¸è¢«ç§°ä½œåˆ‡æ¢æ¡¢ï¼ˆswitchframeï¼‰ã€‚ä¿¡æ¯ä¼šä¸€ç›´ä¿å­˜åˆ° CPU çš„å†…å­˜ä¸­ï¼Œç›´åˆ°ä»–ä»¬è¢«å†æ¬¡ä½¿ç”¨ã€‚</p>
</blockquote>
<h3 id="ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ´»åŠ¨">ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ´»åŠ¨
</h3><ol>
<li>æŒ‚èµ·ä¸€ä¸ªè¿›ç¨‹ï¼Œå°†è¿™ä¸ªè¿›ç¨‹åœ¨ CPU ä¸­çš„çŠ¶æ€ï¼ˆä¸Šä¸‹æ–‡ï¼‰å­˜å‚¨äºå†…å­˜ä¸­çš„æŸå¤„ã€‚</li>
<li>åœ¨å†…å­˜ä¸­æ£€ç´¢ä¸‹ä¸€ä¸ªè¿›ç¨‹çš„ä¸Šä¸‹æ–‡å¹¶å°†å…¶åœ¨ CPU çš„å¯„å­˜å™¨ä¸­æ¢å¤ã€‚</li>
<li>è·³è½¬åˆ°ç¨‹åºè®¡æ•°å™¨æ‰€æŒ‡å‘çš„ä½ç½®ï¼ˆå³è·³è½¬åˆ°è¿›ç¨‹è¢«ä¸­æ–­æ—¶çš„ä»£ç è¡Œï¼‰ï¼Œä»¥æ¢å¤è¯¥è¿›ç¨‹åœ¨ç¨‹åºä¸­ã€‚</li>
</ol>
<h3 id="å¼•èµ·çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢çš„åŸå› ">å¼•èµ·çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢çš„åŸå› 
</h3><ol>
<li>å½“å‰æ‰§è¡Œä»»åŠ¡çš„æ—¶é—´ç‰‡ç”¨å®Œä¹‹åï¼Œç³»ç»Ÿ CPU æ­£å¸¸è°ƒåº¦ä¸‹ä¸€ä¸ªä»»åŠ¡ï¼›</li>
<li>å½“å‰æ‰§è¡Œä»»åŠ¡ç¢°åˆ° IO é˜»å¡ï¼Œè°ƒåº¦å™¨å°†æ­¤ä»»åŠ¡æŒ‚èµ·ï¼Œç»§ç»­ä¸‹ä¸€ä»»åŠ¡ï¼›</li>
<li>å¤šä¸ªä»»åŠ¡æŠ¢å é”èµ„æºï¼Œå½“å‰ä»»åŠ¡æ²¡æœ‰æŠ¢åˆ°é”èµ„æºï¼Œè¢«è°ƒåº¦å™¨æŒ‚èµ·ï¼Œç»§ç»­ä¸‹ä¸€ä»»åŠ¡ï¼›</li>
<li>ç”¨æˆ·ä»£ç æŒ‚èµ·å½“å‰ä»»åŠ¡ï¼Œè®©å‡º CPU æ—¶é—´ï¼›</li>
<li>ç¡¬ä»¶ä¸­æ–­ï¼›</li>
</ol>
<h3 id="åŒæ­¥é”-ä¸-æ­»é”">åŒæ­¥é” ä¸ æ­»é”
</h3><h3 id="åŒæ­¥é”">åŒæ­¥é”
</h3><blockquote>
<p>å½“å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®åŒä¸€ä¸ªæ•°æ®æ—¶ï¼Œå¾ˆå®¹æ˜“å‡ºç°é—®é¢˜ã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µå‡ºç°ï¼Œæˆ‘ä»¬è¦ä¿è¯çº¿ç¨‹åŒæ­¥äº’æ–¥ ï¼Œå°±æ˜¯æŒ‡å¹¶å‘æ‰§è¡Œçš„å¤šä¸ªçº¿ç¨‹ï¼Œåœ¨åŒä¸€æ—¶é—´å†…åªå…è®¸ä¸€ä¸ªçº¿ç¨‹è®¿é—®å…±äº«æ•°æ®ã€‚ Java ä¸­å¯ä»¥ä½¿ç”¨ synchronized å…³é”®å­—æ¥å–å¾—ä¸€ä¸ªå¯¹è±¡çš„åŒæ­¥é”ã€‚</p>
</blockquote>
<h3 id="æ­»é”">æ­»é”
</h3><blockquote>
<p>ä½•ä¸ºæ­»é”ï¼Œå°±æ˜¯å¤šä¸ªçº¿ç¨‹åŒæ—¶è¢«é˜»å¡ï¼Œå®ƒä»¬ä¸­çš„ä¸€ä¸ªæˆ–è€…å…¨éƒ¨éƒ½åœ¨ç­‰å¾…æŸä¸ªèµ„æºè¢«é‡Šæ”¾ã€‚</p>
</blockquote>
<h3 id="çº¿ç¨‹æ± åŸç†">çº¿ç¨‹æ± åŸç†
</h3><blockquote>
<p>çº¿ç¨‹æ± åšçš„å·¥ä½œä¸»è¦æ˜¯æ§åˆ¶è¿è¡Œçš„çº¿ç¨‹çš„æ•°é‡ï¼Œå¤„ç†è¿‡ç¨‹ä¸­å°†ä»»åŠ¡æ”¾å…¥é˜Ÿåˆ—ï¼Œç„¶ååœ¨çº¿ç¨‹åˆ›å»ºåå¯åŠ¨è¿™äº›ä»»åŠ¡ï¼Œå¦‚æœçº¿ç¨‹æ•°é‡è¶…è¿‡äº†æœ€å¤§æ•°é‡è¶…å‡ºæ•°é‡çš„çº¿ç¨‹æ’é˜Ÿç­‰å€™ï¼Œç­‰å…¶å®ƒçº¿ç¨‹æ‰§è¡Œå®Œæ¯•ï¼Œå†ä»é˜Ÿåˆ—ä¸­å–å‡ºä»»åŠ¡æ¥æ‰§è¡Œã€‚ä»–çš„ä¸»è¦ç‰¹ç‚¹ä¸ºï¼šçº¿ç¨‹å¤ç”¨ï¼›æ§åˆ¶æœ€å¤§å¹¶å‘æ•°ï¼›ç®¡ç†çº¿ç¨‹ã€‚</p>
</blockquote>
<h3 id="çº¿ç¨‹å¤ç”¨">çº¿ç¨‹å¤ç”¨
</h3><blockquote>
<p>æ¯ä¸€ä¸ª Thread çš„ç±»éƒ½æœ‰ä¸€ä¸ª start æ–¹æ³•ã€‚ å½“è°ƒç”¨ start å¯åŠ¨çº¿ç¨‹æ—¶ Java è™šæ‹Ÿæœºä¼šè°ƒç”¨è¯¥ç±»çš„ run<br>
æ–¹æ³•ã€‚ é‚£ä¹ˆè¯¥ç±»çš„ run() æ–¹æ³•ä¸­å°±æ˜¯è°ƒç”¨äº† Runnable å¯¹è±¡çš„ run() æ–¹æ³•ã€‚ æˆ‘ä»¬å¯ä»¥ç»§æ‰¿é‡å†™Thread ç±»ï¼Œåœ¨å…¶ start æ–¹æ³•ä¸­æ·»åŠ ä¸æ–­å¾ªç¯è°ƒç”¨ä¼ é€’è¿‡æ¥çš„ Runnable å¯¹è±¡ã€‚ è¿™å°±æ˜¯çº¿ç¨‹æ± çš„å®ç°åŸç†ã€‚å¾ªç¯æ–¹æ³•ä¸­ä¸æ–­è·å– Runnable æ˜¯ç”¨ Queue å®ç°çš„ï¼Œåœ¨è·å–ä¸‹ä¸€ä¸ª Runnable ä¹‹å‰å¯ä»¥æ˜¯é˜»å¡çš„ã€‚</p>
</blockquote>
<h3 id="çº¿ç¨‹æ± ç»„æˆ">çº¿ç¨‹æ± ç»„æˆ
</h3><blockquote>
<p>ä¸€èˆ¬çš„çº¿ç¨‹æ± ä¸»è¦åˆ†ä¸ºä»¥ä¸‹ 4 ä¸ªç»„æˆéƒ¨åˆ†ï¼š</p>
</blockquote>
<ol>
<li>
<p>çº¿ç¨‹æ± ç®¡ç†å™¨ï¼šç”¨äºåˆ›å»ºå¹¶ç®¡ç†çº¿ç¨‹æ± </p>
</li>
<li>
<p>å·¥ä½œçº¿ç¨‹ï¼šçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹</p>
</li>
<li>
<p>ä»»åŠ¡æ¥å£ï¼šæ¯ä¸ªä»»åŠ¡å¿…é¡»å®ç°çš„æ¥å£ï¼Œç”¨äºå·¥ä½œçº¿ç¨‹è°ƒåº¦å…¶è¿è¡Œ</p>
</li>
<li>
<p>ä»»åŠ¡é˜Ÿåˆ—ï¼šç”¨äºå­˜æ”¾å¾…å¤„ç†çš„ä»»åŠ¡ï¼Œæä¾›ä¸€ç§ç¼“å†²æœºåˆ¶<br>
Java ä¸­çš„çº¿ç¨‹æ± æ˜¯é€šè¿‡ Executor æ¡†æ¶å®ç°çš„ï¼Œè¯¥æ¡†æ¶ä¸­ç”¨åˆ°äº† Executorï¼ŒExecutorsï¼Œ<br>
ExecutorServiceï¼ŒThreadPoolExecutor ï¼ŒCallable å’Œ Futureã€FutureTask è¿™å‡ ä¸ªç±»ã€‚<br>
ThreadPoolExecutor çš„æ„é€ æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="nf">ThreadPoolExecutor</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">corePoolSize</span><span class="p">,</span><span class="kt">int</span><span class="w"> </span><span class="n">maximumPoolSize</span><span class="p">,</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">keepAliveTime</span><span class="p">,</span><span class="n">TimeUnit</span><span class="w"> </span><span class="n">unit</span><span class="p">,</span><span class="w"> </span><span class="n">BlockingQueue</span><span class="o">&lt;</span><span class="n">Runnable</span><span class="o">&gt;</span><span class="w"> </span><span class="n">workQueue</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">this</span><span class="p">(</span><span class="n">corePoolSize</span><span class="p">,</span><span class="w"> </span><span class="n">maximumPoolSize</span><span class="p">,</span><span class="w"> </span><span class="n">keepAliveTime</span><span class="p">,</span><span class="w"> </span><span class="n">unit</span><span class="p">,</span><span class="w"> </span><span class="n">workQueue</span><span class="p">,</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Executors</span><span class="p">.</span><span class="na">defaultThreadFactory</span><span class="p">(),</span><span class="w"> </span><span class="n">defaultHandler</span><span class="p">);</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>corePoolSizeï¼šæŒ‡å®šäº†çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡ã€‚</p>
</li>
<li>
<p>maximumPoolSizeï¼šæŒ‡å®šäº†çº¿ç¨‹æ± ä¸­çš„æœ€å¤§çº¿ç¨‹æ•°é‡ã€‚</p>
</li>
<li>
<p>keepAliveTimeï¼šå½“å‰çº¿ç¨‹æ± æ•°é‡è¶…è¿‡ corePoolSize æ—¶ï¼Œå¤šä½™çš„ç©ºé—²çº¿ç¨‹çš„å­˜æ´»æ—¶é—´ï¼Œå³å¤š<br>
æ¬¡æ—¶é—´å†…ä¼šè¢«é”€æ¯ã€‚</p>
</li>
<li>
<p>unitï¼škeepAliveTime çš„å•ä½ã€‚</p>
</li>
<li>
<p>workQueueï¼šä»»åŠ¡é˜Ÿåˆ—ï¼Œè¢«æäº¤ä½†å°šæœªè¢«æ‰§è¡Œçš„ä»»åŠ¡ã€‚</p>
</li>
<li>
<p>threadFactoryï¼šçº¿ç¨‹å·¥å‚ï¼Œç”¨äºåˆ›å»ºçº¿ç¨‹ï¼Œä¸€èˆ¬ç”¨é»˜è®¤çš„å³å¯ã€‚</p>
</li>
<li>
<p>handlerï¼šæ‹’ç»ç­–ç•¥ï¼Œå½“ä»»åŠ¡å¤ªå¤šæ¥ä¸åŠå¤„ç†ï¼Œå¦‚ä½•æ‹’ç»ä»»åŠ¡ã€‚</p>
</li>
</ol>
<h3 id="æ‹’ç»ç­–ç•¥">æ‹’ç»ç­–ç•¥
</h3><blockquote>
<p>çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹å·²ç»ç”¨å®Œäº†ï¼Œæ— æ³•ç»§ç»­ä¸ºæ–°ä»»åŠ¡æœåŠ¡ï¼ŒåŒæ—¶ï¼Œç­‰å¾…é˜Ÿåˆ—ä¹Ÿå·²ç»æ’æ»¡äº†ï¼Œå†ä¹Ÿå¡ä¸ä¸‹æ–°ä»»åŠ¡äº†ã€‚è¿™æ—¶å€™æˆ‘ä»¬å°±éœ€è¦æ‹’ç»ç­–ç•¥æœºåˆ¶åˆç†çš„å¤„ç†è¿™ä¸ªé—®é¢˜ã€‚JDK å†…ç½®çš„æ‹’ç»ç­–ç•¥å¦‚ä¸‹ï¼š</p>
</blockquote>
<ol>
<li>AbortPolicy ï¼š ç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œé˜»æ­¢ç³»ç»Ÿæ­£å¸¸è¿è¡Œã€‚</li>
<li>CallerRunsPolicy ï¼š åªè¦çº¿ç¨‹æ± æœªå…³é—­ï¼Œè¯¥ç­–ç•¥ç›´æ¥åœ¨è°ƒç”¨è€…çº¿ç¨‹ä¸­ï¼Œè¿è¡Œå½“å‰è¢«ä¸¢å¼ƒçš„ä»»åŠ¡ã€‚æ˜¾ç„¶è¿™æ ·åšä¸ä¼šçœŸçš„ä¸¢å¼ƒä»»åŠ¡ï¼Œä½†æ˜¯ï¼Œä»»åŠ¡æäº¤çº¿ç¨‹çš„æ€§èƒ½ææœ‰å¯èƒ½ä¼šæ€¥å‰§ä¸‹é™ã€‚</li>
<li>DiscardOldestPolicy ï¼š ä¸¢å¼ƒæœ€è€çš„ä¸€ä¸ªè¯·æ±‚ï¼Œä¹Ÿå°±æ˜¯å³å°†è¢«æ‰§è¡Œçš„ä¸€ä¸ªä»»åŠ¡ï¼Œå¹¶å°è¯•å†æ¬¡æäº¤å½“å‰ä»»åŠ¡ã€‚</li>
<li>DiscardPolicy ï¼š è¯¥ç­–ç•¥é»˜é»˜åœ°ä¸¢å¼ƒæ— æ³•å¤„ç†çš„ä»»åŠ¡ï¼Œä¸äºˆä»»ä½•å¤„ç†ã€‚å¦‚æœå…è®¸ä»»åŠ¡ä¸¢å¤±ï¼Œè¿™æ˜¯æœ€å¥½çš„ä¸€ç§æ–¹æ¡ˆã€‚ä»¥ä¸Šå†…ç½®æ‹’ç»ç­–ç•¥å‡å®ç°äº† RejectedExecutionHandler æ¥å£ï¼Œè‹¥ä»¥ä¸Šç­–ç•¥ä»æ— æ³•æ»¡è¶³å®é™…éœ€è¦ï¼Œå®Œå…¨å¯ä»¥è‡ªå·±æ‰©å±• RejectedExecutionHandler æ¥å£ã€‚</li>
</ol>
<h3 id="javaçº¿ç¨‹æ± å·¥ä½œè¿‡ç¨‹">Javaçº¿ç¨‹æ± å·¥ä½œè¿‡ç¨‹
</h3><ol>
<li>çº¿ç¨‹æ± åˆšåˆ›å»ºæ—¶ï¼Œé‡Œé¢æ²¡æœ‰ä¸€ä¸ªçº¿ç¨‹ã€‚ä»»åŠ¡é˜Ÿåˆ—æ˜¯ä½œä¸ºå‚æ•°ä¼ è¿›æ¥çš„ã€‚ä¸è¿‡ï¼Œå°±ç®—é˜Ÿåˆ—é‡Œé¢æœ‰ä»»åŠ¡ï¼Œçº¿ç¨‹æ± ä¹Ÿä¸ä¼šé©¬ä¸Šæ‰§è¡Œå®ƒä»¬ã€‚</li>
<li>å½“è°ƒç”¨ execute() æ–¹æ³•æ·»åŠ ä¸€ä¸ªä»»åŠ¡æ—¶ï¼Œçº¿ç¨‹æ± ä¼šåšå¦‚ä¸‹åˆ¤æ–­ï¼š<br>
a) å¦‚æœæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æ•°é‡å°äº corePoolSizeï¼Œé‚£ä¹ˆé©¬ä¸Šåˆ›å»ºçº¿ç¨‹è¿è¡Œè¿™ä¸ªä»»åŠ¡ï¼›<br>
b) å¦‚æœæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æ•°é‡å¤§äºæˆ–ç­‰äº corePoolSizeï¼Œé‚£ä¹ˆå°†è¿™ä¸ªä»»åŠ¡æ”¾å…¥é˜Ÿåˆ—ï¼›<br>
c) å¦‚æœè¿™æ—¶å€™é˜Ÿåˆ—æ»¡äº†ï¼Œè€Œä¸”æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æ•°é‡å°äº maximumPoolSizeï¼Œé‚£ä¹ˆè¿˜æ˜¯è¦åˆ›å»ºéæ ¸å¿ƒçº¿ç¨‹ç«‹åˆ»è¿è¡Œè¿™ä¸ªä»»åŠ¡ï¼›<br>
d) å¦‚æœé˜Ÿåˆ—æ»¡äº†ï¼Œè€Œä¸”æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æ•°é‡å¤§äºæˆ–ç­‰äº maximumPoolSizeï¼Œé‚£ä¹ˆçº¿ç¨‹æ± ä¼šæŠ›å‡ºå¼‚å¸¸ RejectExecutionExceptionã€‚</li>
<li>å½“ä¸€ä¸ªçº¿ç¨‹å®Œæˆä»»åŠ¡æ—¶ï¼Œå®ƒä¼šä»é˜Ÿåˆ—ä¸­å–ä¸‹ä¸€ä¸ªä»»åŠ¡æ¥æ‰§è¡Œã€‚</li>
<li>å½“ä¸€ä¸ªçº¿ç¨‹æ— äº‹å¯åšï¼Œè¶…è¿‡ä¸€å®šçš„æ—¶é—´ï¼ˆkeepAliveTimeï¼‰æ—¶ï¼Œçº¿ç¨‹æ± ä¼šåˆ¤æ–­ï¼Œå¦‚æœå½“å‰è¿è¡Œçš„çº¿ç¨‹æ•°å¤§äº corePoolSizeï¼Œé‚£ä¹ˆè¿™ä¸ªçº¿ç¨‹å°±è¢«åœæ‰ã€‚æ‰€ä»¥çº¿ç¨‹æ± çš„æ‰€æœ‰ä»»åŠ¡å®Œæˆåï¼Œå®ƒæœ€ç»ˆä¼šæ”¶ç¼©åˆ° corePoolSize çš„å¤§å°ã€‚</li>
</ol>
<h3 id="é˜»å¡é˜Ÿåˆ—åŸç†">é˜»å¡é˜Ÿåˆ—åŸç†
</h3><blockquote>
<p>é˜»å¡é˜Ÿåˆ—ï¼Œå…³é”®å­—æ˜¯é˜»å¡ï¼Œå…ˆç†è§£é˜»å¡çš„å«ä¹‰ï¼Œåœ¨é˜»å¡é˜Ÿåˆ—ä¸­ï¼Œçº¿ç¨‹é˜»å¡æœ‰è¿™æ ·çš„ä¸¤ç§æƒ…å†µï¼š</p>
</blockquote>
<ol>
<li>å½“é˜Ÿåˆ—ä¸­æ²¡æœ‰æ•°æ®çš„æƒ…å†µä¸‹ï¼Œæ¶ˆè´¹è€…ç«¯çš„æ‰€æœ‰çº¿ç¨‹éƒ½ä¼šè¢«è‡ªåŠ¨é˜»å¡ï¼ˆæŒ‚èµ·ï¼‰ï¼Œç›´åˆ°æœ‰æ•°æ®æ”¾å…¥é˜Ÿã€‚</li>
<li>å½“é˜Ÿåˆ—ä¸­å¡«æ»¡æ•°æ®çš„æƒ…å†µä¸‹ï¼Œç”Ÿäº§è€…ç«¯çš„æ‰€æœ‰çº¿ç¨‹éƒ½ä¼šè¢«è‡ªåŠ¨é˜»å¡ï¼ˆæŒ‚èµ·ï¼‰ï¼Œç›´åˆ°é˜Ÿåˆ—ä¸­æœ‰ç©ºçš„ä½ç½®ï¼Œçº¿ç¨‹è¢«è‡ªåŠ¨å”¤é†’</li>
</ol>
<h3 id="é˜»å¡é˜Ÿåˆ—çš„ä¸»è¦æ–¹æ³•">é˜»å¡é˜Ÿåˆ—çš„ä¸»è¦æ–¹æ³•
</h3><ul>
<li>æŠ›å‡ºå¼‚å¸¸ï¼šæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ï¼›</li>
<li>ç‰¹æ®Šå€¼ï¼šè¿”å›ä¸€ä¸ªç‰¹æ®Šå€¼ï¼ˆnull æˆ– false,è§†æƒ…å†µè€Œå®šï¼‰</li>
<li>é˜»å¡ï¼šåœ¨æˆåŠŸæ“ä½œä¹‹å‰ï¼Œä¸€ç›´é˜»å¡çº¿ç¨‹</li>
<li>è¶…æ—¶ï¼šæ”¾å¼ƒå‰åªåœ¨æœ€å¤§çš„æ—¶é—´å†…é˜»å¡</li>
</ul>
<blockquote>
<p>æ’å…¥æ“ä½œï¼š<br>
1ï¼špublic abstract boolean add(E paramE)ï¼šå°†æŒ‡å®šå…ƒç´ æ’å…¥æ­¤é˜Ÿåˆ—ä¸­ï¼ˆå¦‚æœç«‹å³å¯è¡Œä¸”ä¸ä¼šè¿åå®¹é‡é™åˆ¶ï¼‰ï¼ŒæˆåŠŸæ—¶è¿”å› trueï¼Œå¦‚æœå½“å‰æ²¡æœ‰å¯ç”¨çš„ç©ºé—´ï¼Œåˆ™æŠ›å‡º IllegalStateExceptionã€‚å¦‚æœè¯¥å…ƒç´ æ˜¯ NULLï¼Œåˆ™ä¼šæŠ›å‡º NullPointerException å¼‚å¸¸ã€‚<br>
2ï¼špublic abstract boolean offer(E paramE)ï¼šå°†æŒ‡å®šå…ƒç´ æ’å…¥æ­¤é˜Ÿåˆ—ä¸­ï¼ˆå¦‚æœç«‹å³å¯è¡Œä¸”ä¸ä¼šè¿åå®¹é‡é™åˆ¶ï¼‰ï¼ŒæˆåŠŸæ—¶è¿”å› trueï¼Œå¦‚æœå½“å‰æ²¡æœ‰å¯ç”¨çš„ç©ºé—´ï¼Œåˆ™è¿”å› falseã€‚<br>
3ï¼špublic abstract void put(E paramE) throws InterruptedExceptionï¼š å°†æŒ‡å®šå…ƒç´ æ’å…¥æ­¤é˜Ÿåˆ—ä¸­ï¼Œå°†ç­‰å¾…å¯ç”¨çš„ç©ºé—´ï¼ˆå¦‚æœæœ‰å¿…è¦)<br>
4ï¼šoffer(E o, long timeout, TimeUnit unit)ï¼šå¯ä»¥è®¾å®šç­‰å¾…çš„æ—¶é—´ï¼Œå¦‚æœåœ¨æŒ‡å®šçš„æ—¶é—´å†…ï¼Œè¿˜ä¸èƒ½å¾€é˜Ÿåˆ—ä¸­åŠ å…¥ BlockingQueueï¼Œåˆ™è¿”å›å¤±è´¥</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">put</span><span class="p">(</span><span class="n">E</span><span class="w"> </span><span class="n">paramE</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">InterruptedException</span><span class="w"> </span><span class="p">{</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">checkNotNull</span><span class="p">(</span><span class="n">paramE</span><span class="p">);</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ReentrantLock</span><span class="w"> </span><span class="n">localReentrantLock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">lock</span><span class="p">;</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">localReentrantLock</span><span class="p">.</span><span class="na">lockInterruptibly</span><span class="p">();</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">count</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">items</span><span class="p">.</span><span class="na">length</span><span class="p">)</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">notFull</span><span class="p">.</span><span class="na">await</span><span class="p">();</span><span class="c1">//å¦‚æœé˜Ÿåˆ—æ»¡äº†ï¼Œåˆ™çº¿ç¨‹é˜»å¡ç­‰å¾…  </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">enqueue</span><span class="p">(</span><span class="n">paramE</span><span class="p">);</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">localReentrantLock</span><span class="p">.</span><span class="na">unlock</span><span class="p">();</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">finally</span><span class="w"> </span><span class="p">{</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">localReentrantLock</span><span class="p">.</span><span class="na">unlock</span><span class="p">();</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>è·å–æ•°æ®æ“ä½œï¼š<br>
1ï¼špoll(time):å–èµ° BlockingQueue é‡Œæ’åœ¨é¦–ä½çš„å¯¹è±¡,è‹¥ä¸èƒ½ç«‹å³å–å‡º,åˆ™å¯ä»¥ç­‰ time å‚æ•°è§„å®šçš„æ—¶é—´,å–ä¸åˆ°æ—¶è¿”å› null;<br>
2ï¼špoll(long timeout, TimeUnit unit)ï¼šä» BlockingQueue å–å‡ºä¸€ä¸ªé˜Ÿé¦–çš„å¯¹è±¡ï¼Œå¦‚æœåœ¨æŒ‡å®šæ—¶é—´å†…ï¼Œé˜Ÿåˆ—ä¸€æ—¦æœ‰æ•°æ®å¯å–ï¼Œåˆ™ç«‹å³è¿”å›é˜Ÿåˆ—ä¸­çš„æ•°æ®ã€‚å¦åˆ™ç›´åˆ°æ—¶é—´è¶…æ—¶è¿˜æ²¡æœ‰æ•°æ®å¯å–ï¼Œè¿”å›å¤±è´¥ã€‚<br>
3ï¼štake():å–èµ° BlockingQueue é‡Œæ’åœ¨é¦–ä½çš„å¯¹è±¡,è‹¥ BlockingQueue ä¸ºç©º,é˜»æ–­è¿›å…¥ç­‰å¾…çŠ¶æ€ç›´åˆ° BlockingQueue æœ‰æ–°çš„æ•°æ®è¢«åŠ å…¥ã€‚<br>
4.drainTo():ä¸€æ¬¡æ€§ä» BlockingQueue è·å–æ‰€æœ‰å¯ç”¨çš„æ•°æ®å¯¹è±¡ï¼ˆè¿˜å¯ä»¥æŒ‡å®šè·å–æ•°æ®çš„ä¸ªæ•°ï¼‰ï¼Œé€šè¿‡è¯¥æ–¹æ³•ï¼Œå¯ä»¥æå‡è·å–æ•°æ®æ•ˆç‡ï¼›ä¸éœ€è¦å¤šæ¬¡åˆ†æ‰¹åŠ é”æˆ–é‡Šæ”¾é”ã€‚</p>
</blockquote>
<h3 id="javaä¸­çš„é˜»å¡é˜Ÿåˆ—">Javaä¸­çš„é˜»å¡é˜Ÿåˆ—
</h3><ol>
<li>ArrayBlockingQueue ï¼šç”±æ•°ç»„ç»“æ„ç»„æˆçš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ã€‚</li>
<li>LinkedBlockingQueue ï¼šç”±é“¾è¡¨ç»“æ„ç»„æˆçš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ã€‚</li>
<li>PriorityBlockingQueue ï¼šæ”¯æŒä¼˜å…ˆçº§æ’åºçš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ã€‚</li>
<li>DelayQueueï¼šä½¿ç”¨ä¼˜å…ˆçº§é˜Ÿåˆ—å®ç°çš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ã€‚</li>
<li>SynchronousQueueï¼šä¸å­˜å‚¨å…ƒç´ çš„é˜»å¡é˜Ÿåˆ—ã€‚</li>
<li>LinkedTransferQueueï¼šç”±é“¾è¡¨ç»“æ„ç»„æˆçš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ã€‚</li>
<li>LinkedBlockingDequeï¼šç”±é“¾è¡¨ç»“æ„ç»„æˆçš„åŒå‘é˜»å¡é˜Ÿåˆ—</li>
</ol>
<h3 id="arrayblockingqueueå…¬å¹³éå…¬å¹³">ArrayBlockingQueueï¼ˆå…¬å¹³ã€éå…¬å¹³ï¼‰
</h3><blockquote>
<p>ç”¨æ•°ç»„å®ç°çš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ã€‚æ­¤é˜Ÿåˆ—æŒ‰ç…§å…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰çš„åŸåˆ™å¯¹å…ƒç´ è¿›è¡Œæ’åºã€‚é»˜è®¤æƒ…å†µä¸‹ä¸ä¿è¯è®¿é—®è€…å…¬å¹³çš„è®¿é—®é˜Ÿåˆ—ï¼Œæ‰€è°“å…¬å¹³è®¿é—®é˜Ÿåˆ—æ˜¯æŒ‡é˜»å¡çš„æ‰€æœ‰ç”Ÿäº§è€…çº¿ç¨‹æˆ–æ¶ˆè´¹è€…çº¿ç¨‹ï¼Œå½“é˜Ÿåˆ—å¯ç”¨æ—¶ï¼Œå¯ä»¥æŒ‰ç…§é˜»å¡çš„å…ˆåé¡ºåºè®¿é—®é˜Ÿåˆ—ï¼Œå³å…ˆé˜»å¡çš„ç”Ÿäº§è€…çº¿ç¨‹ï¼Œå¯ä»¥å…ˆå¾€é˜Ÿåˆ—é‡Œæ’å…¥å…ƒç´ ï¼Œå…ˆé˜»å¡çš„æ¶ˆè´¹è€…çº¿ç¨‹ï¼Œå¯ä»¥å…ˆä»é˜Ÿåˆ—é‡Œè·å–å…ƒç´ ã€‚é€šå¸¸æƒ…å†µä¸‹ä¸ºäº†ä¿è¯å…¬å¹³æ€§ä¼šé™ä½ååé‡ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»£ç åˆ›å»ºä¸€ä¸ªå…¬å¹³çš„é˜»å¡é˜Ÿåˆ—ã€‚<br>
ArrayBlockingQueue fairQueue = new ArrayBlockingQueue(1000,true);</p>
</blockquote>
<h3 id="linkedblockingqueueä¸¤ä¸ªç‹¬ç«‹é”æé«˜å¹¶å‘">LinkedBlockingQueueï¼ˆä¸¤ä¸ªç‹¬ç«‹é”æé«˜å¹¶å‘ï¼‰
</h3><blockquote>
<p>åŸºäºé“¾è¡¨çš„é˜»å¡é˜Ÿåˆ—ï¼ŒåŒ ArrayListBlockingQueue ç±»ä¼¼ï¼Œæ­¤é˜Ÿåˆ—æŒ‰ç…§å…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰çš„åŸåˆ™å¯¹å…ƒç´ è¿›è¡Œæ’åºã€‚è€Œ LinkedBlockingQueue ä¹‹æ‰€ä»¥èƒ½å¤Ÿé«˜æ•ˆçš„å¤„ç†å¹¶å‘æ•°æ®ï¼Œè¿˜å› ä¸ºå…¶å¯¹äºç”Ÿäº§è€…ç«¯å’Œæ¶ˆè´¹è€…ç«¯åˆ†åˆ«é‡‡ç”¨äº†ç‹¬ç«‹çš„é”æ¥æ§åˆ¶æ•°æ®åŒæ­¥ï¼Œè¿™ä¹Ÿæ„å‘³ç€åœ¨é«˜å¹¶å‘çš„æƒ…å†µä¸‹ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…å¯ä»¥å¹¶è¡Œåœ°æ“ä½œé˜Ÿåˆ—ä¸­çš„æ•°æ®ï¼Œä»¥æ­¤æ¥æé«˜æ•´ä¸ªé˜Ÿåˆ—çš„å¹¶å‘æ€§èƒ½ã€‚<br>
LinkedBlockingQueue ä¼šé»˜è®¤ä¸€ä¸ªç±»ä¼¼æ— é™å¤§å°çš„å®¹é‡ï¼ˆInteger.MAX_VALUEï¼‰ã€‚</p>
</blockquote>
<h3 id="priorityblockingqueuecompare-toæ’åºå®ç°ä¼˜å…ˆ">PriorityBlockingQueueï¼ˆcompare toæ’åºå®ç°ä¼˜å…ˆï¼‰
</h3><blockquote>
<p>æ˜¯ä¸€ä¸ªæ”¯æŒä¼˜å…ˆçº§çš„æ— ç•Œé˜Ÿåˆ—ã€‚é»˜è®¤æƒ…å†µä¸‹å…ƒç´ é‡‡å–è‡ªç„¶é¡ºåºå‡åºæ’åˆ—ã€‚å¯ä»¥è‡ªå®šä¹‰å®ç°compareTo()æ–¹æ³•æ¥æŒ‡å®šå…ƒç´ è¿›è¡Œæ’åºè§„åˆ™ï¼Œæˆ–è€…åˆå§‹åŒ– PriorityBlockingQueue æ—¶ï¼ŒæŒ‡å®šæ„é€ å‚æ•° Comparator æ¥å¯¹å…ƒç´ è¿›è¡Œæ’åºã€‚éœ€è¦æ³¨æ„çš„æ˜¯ä¸èƒ½ä¿è¯åŒä¼˜å…ˆçº§å…ƒç´ çš„é¡ºåºã€‚</p>
</blockquote>
<h3 id="delayqueueç¼“å­˜å¤±æ•ˆå®šæ—¶ä»»åŠ¡">DelayQueueï¼ˆç¼“å­˜å¤±æ•ˆã€å®šæ—¶ä»»åŠ¡ï¼‰
</h3><blockquote>
<p>æ˜¯ä¸€ä¸ªæ”¯æŒå»¶æ—¶è·å–å…ƒç´ çš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ã€‚é˜Ÿåˆ—ä½¿ç”¨ PriorityQueue æ¥å®ç°ã€‚é˜Ÿåˆ—ä¸­çš„å…ƒç´ å¿…é¡»å®ç° Delayed æ¥å£ï¼Œåœ¨åˆ›å»ºå…ƒç´ æ—¶å¯ä»¥æŒ‡å®šå¤šä¹…æ‰èƒ½ä»é˜Ÿåˆ—ä¸­è·å–å½“å‰å…ƒç´ ã€‚åªæœ‰åœ¨å»¶è¿ŸæœŸæ»¡æ—¶æ‰èƒ½ä»é˜Ÿåˆ—ä¸­æå–å…ƒç´ ã€‚æˆ‘ä»¬å¯ä»¥å°† DelayQueue è¿ç”¨åœ¨ä»¥ä¸‹åº”ç”¨åœºæ™¯ã€‚</p>
</blockquote>
<ol>
<li>ç¼“å­˜ç³»ç»Ÿçš„è®¾è®¡ï¼šå¯ä»¥ç”¨ DelayQueue ä¿å­˜ç¼“å­˜å…ƒç´ çš„æœ‰æ•ˆæœŸï¼Œä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹å¾ªç¯æŸ¥è¯¢DelayQueueï¼Œä¸€æ—¦èƒ½ä» DelayQueue ä¸­è·å–å…ƒç´ æ—¶ï¼Œè¡¨ç¤ºç¼“å­˜æœ‰æ•ˆæœŸåˆ°äº†ã€‚</li>
<li>å®šæ—¶ä»»åŠ¡è°ƒåº¦ï¼šä½¿ç”¨ DelayQueue ä¿å­˜å½“å¤©å°†ä¼šæ‰§è¡Œçš„ä»»åŠ¡å’Œæ‰§è¡Œæ—¶é—´ï¼Œä¸€æ—¦ä»DelayQueue ä¸­è·å–åˆ°ä»»åŠ¡å°±å¼€å§‹æ‰§è¡Œï¼Œä»æ¯”å¦‚ TimerQueue å°±æ˜¯ä½¿ç”¨ DelayQueue å®ç°çš„ã€‚</li>
</ol>
<h3 id="synchronousqueueä¸å­˜å‚¨æ•°æ®å¯ç”¨äºä¼ é€’æ•°æ®">SynchronousQueueï¼ˆä¸å­˜å‚¨æ•°æ®ã€å¯ç”¨äºä¼ é€’æ•°æ®ï¼‰
</h3><blockquote>
<p>æ˜¯ä¸€ä¸ªä¸å­˜å‚¨å…ƒç´ çš„é˜»å¡é˜Ÿåˆ—ã€‚æ¯ä¸€ä¸ª put æ“ä½œå¿…é¡»ç­‰å¾…ä¸€ä¸ª take æ“ä½œï¼Œå¦åˆ™ä¸èƒ½ç»§ç»­æ·»åŠ å…ƒç´ ã€‚SynchronousQueue å¯ä»¥çœ‹æˆæ˜¯ä¸€ä¸ªä¼ çƒæ‰‹ï¼Œè´Ÿè´£æŠŠç”Ÿäº§è€…çº¿ç¨‹å¤„ç†çš„æ•°æ®ç›´æ¥ä¼ é€’ç»™æ¶ˆè´¹è€…çº¿ç¨‹ã€‚é˜Ÿåˆ—æœ¬èº«å¹¶ä¸å­˜å‚¨ä»»ä½•å…ƒç´ ï¼Œéå¸¸é€‚åˆäºä¼ é€’æ€§åœºæ™¯,æ¯”å¦‚åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­ä½¿ç”¨çš„æ•°æ®ï¼Œä¼ é€’ç»™å¦ å¤– ä¸€ ä¸ª çº¿ ç¨‹ ä½¿ ç”¨ ï¼Œ SynchronousQueue çš„ å å é‡ é«˜ äº LinkedBlockingQueue å’ŒArrayBlockingQueueã€‚</p>
</blockquote>
<h3 id="linkedtransferqueue">LinkedTransferQueue
</h3><blockquote>
<p>æ˜¯ ä¸€ ä¸ª ç”± é“¾ è¡¨ ç»“ æ„ ç»„ æˆ çš„ æ—  ç•Œ é˜» å¡ TransferQueue é˜Ÿ åˆ— ã€‚ ç›¸ å¯¹ äº å…¶ ä»– é˜» å¡ é˜Ÿ åˆ— ï¼ŒLinkedTransferQueue å¤šäº† tryTransfer å’Œ transfer æ–¹æ³•ã€‚</p>
</blockquote>
<ol>
<li>transfer æ–¹æ³•ï¼šå¦‚æœå½“å‰æœ‰æ¶ˆè´¹è€…æ­£åœ¨ç­‰å¾…æ¥æ”¶å…ƒç´ ï¼ˆæ¶ˆè´¹è€…ä½¿ç”¨ take()æ–¹æ³•æˆ–å¸¦æ—¶é—´é™åˆ¶çš„poll()æ–¹æ³•æ—¶ï¼‰ï¼Œtransfer æ–¹æ³•å¯ä»¥æŠŠç”Ÿäº§è€…ä¼ å…¥çš„å…ƒç´ ç«‹åˆ» transferï¼ˆä¼ è¾“ï¼‰ç»™æ¶ˆè´¹è€…ã€‚å¦‚æœæ²¡æœ‰æ¶ˆè´¹è€…åœ¨ç­‰å¾…æ¥æ”¶å…ƒç´ ï¼Œtransfer æ–¹æ³•ä¼šå°†å…ƒç´ å­˜æ”¾åœ¨é˜Ÿåˆ—çš„ tail èŠ‚ç‚¹ï¼Œå¹¶ç­‰åˆ°è¯¥å…ƒç´ è¢«æ¶ˆè´¹è€…æ¶ˆè´¹äº†æ‰è¿”å›ã€‚</li>
<li>tryTransfer æ–¹æ³•ã€‚åˆ™æ˜¯ç”¨æ¥è¯•æ¢ä¸‹ç”Ÿäº§è€…ä¼ å…¥çš„å…ƒç´ æ˜¯å¦èƒ½ç›´æ¥ä¼ ç»™æ¶ˆè´¹è€…ã€‚å¦‚æœæ²¡æœ‰æ¶ˆè´¹è€…ç­‰å¾…æ¥æ”¶å…ƒç´ ï¼Œåˆ™è¿”å› falseã€‚å’Œ transfer æ–¹æ³•çš„åŒºåˆ«æ˜¯ tryTransfer æ–¹æ³•æ— è®ºæ¶ˆè´¹è€…æ˜¯å¦æ¥æ”¶ï¼Œæ–¹æ³•ç«‹å³è¿”å›ã€‚è€Œ transfer æ–¹æ³•æ˜¯å¿…é¡»ç­‰åˆ°æ¶ˆè´¹è€…æ¶ˆè´¹äº†æ‰è¿”å›ã€‚<br>
å¯¹äºå¸¦æœ‰æ—¶é—´é™åˆ¶çš„ tryTransfer(E e, long timeout, TimeUnit unit)æ–¹æ³•ï¼Œåˆ™æ˜¯è¯•å›¾æŠŠç”Ÿäº§è€…ä¼ å…¥çš„å…ƒç´ ç›´æ¥ä¼ ç»™æ¶ˆè´¹è€…ï¼Œä½†æ˜¯å¦‚æœæ²¡æœ‰æ¶ˆè´¹è€…æ¶ˆè´¹è¯¥å…ƒç´ åˆ™ç­‰å¾…æŒ‡å®šçš„æ—¶é—´å†è¿”å›ï¼Œå¦‚æœè¶…æ—¶è¿˜æ²¡æ¶ˆè´¹å…ƒç´ ï¼Œåˆ™è¿”å› falseï¼Œå¦‚æœåœ¨è¶…æ—¶æ—¶é—´å†…æ¶ˆè´¹äº†å…ƒç´ ï¼Œåˆ™è¿”å› trueã€‚</li>
</ol>
<h3 id="linkedblockingdeque">LinkedBlockingDeque
</h3><blockquote>
<p>æ˜¯ä¸€ä¸ªç”±é“¾è¡¨ç»“æ„ç»„æˆçš„åŒå‘é˜»å¡é˜Ÿåˆ—ã€‚æ‰€è°“åŒå‘é˜Ÿåˆ—æŒ‡çš„ä½ å¯ä»¥ä»é˜Ÿåˆ—çš„ä¸¤ç«¯æ’å…¥å’Œç§»å‡ºå…ƒç´ ã€‚åŒç«¯é˜Ÿåˆ—å› ä¸ºå¤šäº†ä¸€ä¸ªæ“ä½œé˜Ÿåˆ—çš„å…¥å£ï¼Œåœ¨å¤šçº¿ç¨‹åŒæ—¶å…¥é˜Ÿæ—¶ï¼Œä¹Ÿå°±å‡å°‘äº†ä¸€åŠçš„ç«äº‰ã€‚ç›¸æ¯”å…¶ä»–çš„é˜»å¡é˜Ÿåˆ—ï¼ŒLinkedBlockingDeque å¤šäº† addFirstï¼ŒaddLastï¼ŒofferFirstï¼ŒofferLastï¼ŒpeekFirstï¼ŒpeekLast ç­‰æ–¹æ³•ï¼Œä»¥ First å•è¯ç»“å°¾çš„æ–¹æ³•ï¼Œè¡¨ç¤ºæ’å…¥ï¼Œè·å–ï¼ˆpeekï¼‰æˆ–ç§»é™¤åŒç«¯é˜Ÿåˆ—çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚ä»¥ Last å•è¯ç»“å°¾çš„æ–¹æ³•ï¼Œè¡¨ç¤ºæ’å…¥ï¼Œè·å–æˆ–ç§»é™¤åŒç«¯é˜Ÿåˆ—çš„æœ€åä¸€ä¸ªå…ƒç´ ã€‚å¦å¤–æ’å…¥æ–¹æ³• add ç­‰åŒäº addLastï¼Œç§»é™¤æ–¹æ³• remove ç­‰æ•ˆäº removeFirstã€‚ä½†æ˜¯ take æ–¹æ³•å´ç­‰åŒäº takeFirstï¼Œä¸çŸ¥é“æ˜¯ä¸æ˜¯ Jdk çš„ bugï¼Œä½¿ç”¨æ—¶è¿˜æ˜¯ç”¨å¸¦æœ‰ First å’Œ Last åç¼€çš„æ–¹æ³•æ›´æ¸…æ¥šã€‚åœ¨åˆå§‹åŒ– LinkedBlockingDeque æ—¶å¯ä»¥è®¾ç½®å®¹é‡é˜²æ­¢å…¶è¿‡æ¸¡è†¨èƒ€ã€‚å¦å¤–åŒå‘é˜»å¡é˜Ÿåˆ—å¯ä»¥è¿ç”¨åœ¨å·¥ä½œçªƒå–æ¨¡å¼ä¸­ã€‚</p>
</blockquote>
<h3 id="cyclicbarriercountdownlatchsemaphoreç”¨æ³•">CyclicBarrierã€CountDownLatchã€Semaphoreç”¨æ³•
</h3><h3 id="countdownlatchçº¿ç¨‹è®¡æ•°å™¨">CountDownLatchï¼ˆçº¿ç¨‹è®¡æ•°å™¨ï¼‰
</h3><blockquote>
<p>CountDownLatch ç±»ä½äº java.util.concurrent åŒ…ä¸‹ï¼Œåˆ©ç”¨å®ƒå¯ä»¥å®ç°ç±»ä¼¼è®¡æ•°å™¨çš„åŠŸèƒ½ã€‚æ¯”å¦‚æœ‰ä¸€ä¸ªä»»åŠ¡ Aï¼Œå®ƒè¦ç­‰å¾…å…¶ä»– 4 ä¸ªä»»åŠ¡æ‰§è¡Œå®Œæ¯•ä¹‹åæ‰èƒ½æ‰§è¡Œï¼Œæ­¤æ—¶å°±å¯ä»¥åˆ©ç”¨ CountDownLatchæ¥å®ç°è¿™ç§åŠŸèƒ½äº†ã€‚</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">final</span><span class="w"> </span><span class="n">CountDownLatch</span><span class="w"> </span><span class="n">latch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CountDownLatch</span><span class="p">(</span><span class="n">2</span><span class="p">);</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">new</span><span class="w"> </span><span class="n">Thread</span><span class="p">(){</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;å­çº¿ç¨‹&#34;</span><span class="o">+</span><span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">().</span><span class="na">getName</span><span class="p">()</span><span class="o">+</span><span class="s">&#34;æ­£åœ¨æ‰§è¡Œ&#34;</span><span class="p">);</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Thread</span><span class="p">.</span><span class="na">sleep</span><span class="p">(</span><span class="n">3000</span><span class="p">);</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;å­çº¿ç¨‹&#34;</span><span class="o">+</span><span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">().</span><span class="na">getName</span><span class="p">()</span><span class="o">+</span><span class="s">&#34;æ‰§è¡Œå®Œæ¯•&#34;</span><span class="p">);</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">latch</span><span class="p">.</span><span class="na">countDown</span><span class="p">();</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">};</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}.</span><span class="na">start</span><span class="p">();</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">new</span><span class="w"> </span><span class="n">Thread</span><span class="p">(){</span><span class="w">   
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;å­çº¿ç¨‹&#34;</span><span class="o">+</span><span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">().</span><span class="na">getName</span><span class="p">()</span><span class="o">+</span><span class="s">&#34;æ­£åœ¨æ‰§è¡Œ&#34;</span><span class="p">);</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">Thread</span><span class="p">.</span><span class="na">sleep</span><span class="p">(</span><span class="n">3000</span><span class="p">);</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;å­çº¿ç¨‹&#34;</span><span class="o">+</span><span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">().</span><span class="na">getName</span><span class="p">()</span><span class="o">+</span><span class="s">&#34;æ‰§è¡Œå®Œæ¯•&#34;</span><span class="p">);</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">latch</span><span class="p">.</span><span class="na">countDown</span><span class="p">();</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">};</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}.</span><span class="na">start</span><span class="p">();</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;ç­‰å¾… 2 ä¸ªå­çº¿ç¨‹æ‰§è¡Œå®Œæ¯•...&#34;</span><span class="p">);</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">latch</span><span class="p">.</span><span class="na">await</span><span class="p">();</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;2 ä¸ªå­çº¿ç¨‹å·²ç»æ‰§è¡Œå®Œæ¯•&#34;</span><span class="p">);</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;ç»§ç»­æ‰§è¡Œä¸»çº¿ç¨‹&#34;</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="cyclibarrierå›ç¯æ …æ -ç­‰å¾…è‡³barrierçŠ¶æ€å†å…¨éƒ¨åŒæ—¶æ‰§è¡Œ">CycliBarrierï¼ˆå›ç¯æ …æ -ç­‰å¾…è‡³barrierçŠ¶æ€å†å…¨éƒ¨åŒæ—¶æ‰§è¡Œï¼‰
</h3><blockquote>
<p>å­—é¢æ„æ€å›ç¯æ …æ ï¼Œé€šè¿‡å®ƒå¯ä»¥å®ç°è®©ä¸€ç»„çº¿ç¨‹ç­‰å¾…è‡³æŸä¸ªçŠ¶æ€ä¹‹åå†å…¨éƒ¨åŒæ—¶æ‰§è¡Œã€‚å«åšå›ç¯æ˜¯å› ä¸ºå½“æ‰€æœ‰ç­‰å¾…çº¿ç¨‹éƒ½è¢«é‡Šæ”¾ä»¥åï¼ŒCyclicBarrier å¯ä»¥è¢«é‡ç”¨ã€‚æˆ‘ä»¬æš‚ä¸”æŠŠè¿™ä¸ªçŠ¶æ€å°±å«åšbarrierï¼Œå½“è°ƒç”¨ await()æ–¹æ³•ä¹‹åï¼Œçº¿ç¨‹å°±å¤„äº barrier äº†ã€‚<br>
CyclicBarrier ä¸­æœ€é‡è¦çš„æ–¹æ³•å°±æ˜¯ await æ–¹æ³•ï¼Œå®ƒæœ‰ 2 ä¸ªé‡è½½ç‰ˆæœ¬ï¼š</p>
</blockquote>
<ol>
<li>public int await()ï¼šç”¨æ¥æŒ‚èµ·å½“å‰çº¿ç¨‹ï¼Œç›´è‡³æ‰€æœ‰çº¿ç¨‹éƒ½åˆ°è¾¾ barrier çŠ¶æ€å†åŒæ—¶æ‰§è¡Œåç»­ä»»åŠ¡ï¼›</li>
<li>public int await(long timeout, TimeUnit unit)ï¼šè®©è¿™äº›çº¿ç¨‹ç­‰å¾…è‡³ä¸€å®šçš„æ—¶é—´ï¼Œå¦‚æœè¿˜æœ‰çº¿ç¨‹æ²¡æœ‰åˆ°è¾¾ barrier çŠ¶æ€å°±ç›´æ¥è®©åˆ°è¾¾ barrier çš„çº¿ç¨‹æ‰§è¡Œåç»­ä»»åŠ¡ã€‚<br>
å…·ä½“ä½¿ç”¨å¦‚ä¸‹ï¼Œå¦å¤– CyclicBarrier æ˜¯å¯ä»¥é‡ç”¨çš„ï¼š
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">4</span><span class="p">;</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">CyclicBarrier</span><span class="w"> </span><span class="n">barrier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CyclicBarrier</span><span class="p">(</span><span class="n">N</span><span class="p">);</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="n">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">N</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">new</span><span class="w"> </span><span class="n">Writer</span><span class="p">(</span><span class="n">barrier</span><span class="p">).</span><span class="na">start</span><span class="p">();</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">static</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Writer</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">Thread</span><span class="p">{</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">CyclicBarrier</span><span class="w"> </span><span class="n">cyclicBarrier</span><span class="p">;</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">Writer</span><span class="p">(</span><span class="n">CyclicBarrier</span><span class="w"> </span><span class="n">cyclicBarrier</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">cyclicBarrier</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cyclicBarrier</span><span class="p">;</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">Thread</span><span class="p">.</span><span class="na">sleep</span><span class="p">(</span><span class="n">5000</span><span class="p">);</span><span class="w"> </span><span class="c1">//ä»¥ç¡çœ æ¥æ¨¡æ‹Ÿçº¿ç¨‹éœ€è¦é¢„å®šå†™å…¥æ•°æ®æ“ä½œ  </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;çº¿ç¨‹&#34;</span><span class="o">+</span><span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">().</span><span class="na">getName</span><span class="p">()</span><span class="o">+</span><span class="s">&#34;å†™å…¥æ•°æ®å®Œ  
</span></span></span><span class="line"><span class="cl"><span class="s">            æ¯•ï¼Œç­‰å¾…å…¶ä»–çº¿ç¨‹å†™å…¥å®Œæ¯•&#34;</span><span class="p">);</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">cyclicBarrier</span><span class="p">.</span><span class="na">await</span><span class="p">();</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">InterruptedException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="n">BrokenBarrierException</span><span class="w"> </span><span class="n">e</span><span class="p">){</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;æ‰€æœ‰çº¿ç¨‹å†™å…¥å®Œæ¯•ï¼Œç»§ç»­å¤„ç†å…¶ä»–ä»»åŠ¡ï¼Œæ¯”å¦‚æ•°æ®æ“ä½œ&#34;</span><span class="p">);</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div></li>
</ol>
<h3 id="semaphoreä¿¡å·é‡-æ§åˆ¶åŒæ—¶è®¿é—®çš„çº¿ç¨‹ä¸ªæ•°">Semaphoreï¼ˆä¿¡å·é‡-æ§åˆ¶åŒæ—¶è®¿é—®çš„çº¿ç¨‹ä¸ªæ•°ï¼‰
</h3><blockquote>
<p>Semaphore ç¿»è¯‘æˆå­—é¢æ„æ€ä¸º ä¿¡å·é‡ï¼ŒSemaphore å¯ä»¥æ§åˆ¶åŒæ—¶è®¿é—®çš„çº¿ç¨‹ä¸ªæ•°ï¼Œé€šè¿‡acquire() è·å–ä¸€ä¸ªè®¸å¯ï¼Œå¦‚æœæ²¡æœ‰å°±ç­‰å¾…ï¼Œè€Œ release() é‡Šæ”¾ä¸€ä¸ªè®¸å¯ã€‚Semaphore ç±»ä¸­æ¯”è¾ƒé‡è¦çš„å‡ ä¸ªæ–¹æ³•ã€‚</p>
</blockquote>
<ol>
<li>
<blockquote>
<p>public void acquire(): ç”¨æ¥è·å–ä¸€ä¸ªè®¸å¯ï¼Œè‹¥æ— è®¸å¯èƒ½å¤Ÿè·å¾—ï¼Œåˆ™ä¼šä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°è·å¾—è®¸å¯ã€‚</p>
</blockquote>
</li>
<li>
<blockquote>
<p>public void acquire(int permits):è·å– permits ä¸ªè®¸å¯</p>
</blockquote>
</li>
<li>
<blockquote>
<p>public void release() { } :é‡Šæ”¾è®¸å¯ã€‚æ³¨æ„ï¼Œåœ¨é‡Šæ”¾è®¸å¯ä¹‹å‰ï¼Œå¿…é¡»å…ˆè·è·å¾—è®¸å¯ã€‚</p>
</blockquote>
</li>
<li>
<blockquote>
<p>public void release(int permits) { }:é‡Šæ”¾ permits ä¸ªè®¸å¯<br>
ä¸Šé¢ 4 ä¸ªæ–¹æ³•éƒ½ä¼šè¢«é˜»å¡ï¼Œå¦‚æœæƒ³ç«‹å³å¾—åˆ°æ‰§è¡Œç»“æœï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢å‡ ä¸ªæ–¹æ³•</p>
</blockquote>
</li>
<li>
<blockquote>
<p>public boolean tryAcquire():å°è¯•è·å–ä¸€ä¸ªè®¸å¯ï¼Œè‹¥è·å–æˆåŠŸï¼Œåˆ™ç«‹å³è¿”å› trueï¼Œè‹¥è·å–å¤±è´¥ï¼Œåˆ™ç«‹å³è¿”å› false</p>
</blockquote>
</li>
<li>
<blockquote>
<p>public boolean tryAcquire(long timeout, TimeUnit unit):å°è¯•è·å–ä¸€ä¸ªè®¸å¯ï¼Œè‹¥åœ¨æŒ‡å®šçš„æ—¶é—´å†…è·å–æˆåŠŸï¼Œåˆ™ç«‹å³è¿”å› trueï¼Œå¦åˆ™åˆ™ç«‹å³è¿”å› false</p>
</blockquote>
</li>
<li>
<blockquote>
<p>public boolean tryAcquire(int permits):å°è¯•è·å– permits ä¸ªè®¸å¯ï¼Œè‹¥è·å–æˆåŠŸï¼Œåˆ™ç«‹å³è¿”å› trueï¼Œè‹¥è·å–å¤±è´¥ï¼Œåˆ™ç«‹å³è¿”å› false</p>
</blockquote>
</li>
<li>
<blockquote>
<p>public boolean tryAcquire(int permits, long timeout, TimeUnit unit): å°è¯•è·å– permitsä¸ªè®¸å¯ï¼Œè‹¥åœ¨æŒ‡å®šçš„æ—¶é—´å†…è·å–æˆåŠŸï¼Œåˆ™ç«‹å³è¿”å› trueï¼Œå¦åˆ™åˆ™ç«‹å³è¿”å› false</p>
</blockquote>
</li>
<li>
<blockquote>
<p>è¿˜å¯ä»¥é€šè¿‡ availablePermits()æ–¹æ³•å¾—åˆ°å¯ç”¨çš„è®¸å¯æ•°ç›®ã€‚ä¾‹å­ï¼šè‹¥ä¸€ä¸ªå·¥å‚æœ‰ 5 å°æœºå™¨ï¼Œä½†æ˜¯æœ‰ 8 ä¸ªå·¥äººï¼Œä¸€å°æœºå™¨åŒæ—¶åªèƒ½è¢«ä¸€ä¸ªå·¥äººä½¿ç”¨ï¼Œåªæœ‰ä½¿ç”¨å®Œäº†ï¼Œå…¶ä»–å·¥äººæ‰èƒ½ç»§ç»­ä½¿ç”¨ã€‚é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ Semaphore æ¥å®ç°ï¼š</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kt">int</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">8</span><span class="p">;</span><span class="w"> </span><span class="c1">//å·¥äººæ•°  </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Semaphore</span><span class="w"> </span><span class="n">semaphore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Semaphore</span><span class="p">(</span><span class="n">5</span><span class="p">);</span><span class="w"> </span><span class="c1">//æœºå™¨æ•°ç›®  </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="n">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">N</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">new</span><span class="w"> </span><span class="n">Worker</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">semaphore</span><span class="p">).</span><span class="na">start</span><span class="p">();</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">static</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Worker</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">Thread</span><span class="p">{</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">num</span><span class="p">;</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Semaphore</span><span class="w"> </span><span class="n">semaphore</span><span class="p">;</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">Worker</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">num</span><span class="p">,</span><span class="n">Semaphore</span><span class="w"> </span><span class="n">semaphore</span><span class="p">){</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">num</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">num</span><span class="p">;</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">semaphore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">semaphore</span><span class="p">;</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nd">@Override</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">semaphore</span><span class="p">.</span><span class="na">acquire</span><span class="p">();</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;å·¥äºº&#34;</span><span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="na">num</span><span class="o">+</span><span class="s">&#34;å ç”¨ä¸€ä¸ªæœºå™¨åœ¨ç”Ÿäº§...&#34;</span><span class="p">);</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">Thread</span><span class="p">.</span><span class="na">sleep</span><span class="p">(</span><span class="n">2000</span><span class="p">);</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;å·¥äºº&#34;</span><span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="na">num</span><span class="o">+</span><span class="s">&#34;é‡Šæ”¾å‡ºæœºå™¨&#34;</span><span class="p">);</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">semaphore</span><span class="p">.</span><span class="na">release</span><span class="p">();</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">InterruptedException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div></li>
</ol>
<ul>
<li>CountDownLatch å’Œ CyclicBarrier éƒ½èƒ½å¤Ÿå®ç°çº¿ç¨‹ä¹‹é—´çš„ç­‰å¾…ï¼Œåªä¸è¿‡å®ƒä»¬ä¾§é‡ç‚¹ä¸åŒï¼›CountDownLatch ä¸€èˆ¬ç”¨äºæŸä¸ªçº¿ç¨‹ A ç­‰å¾…è‹¥å¹²ä¸ªå…¶ä»–çº¿ç¨‹æ‰§è¡Œå®Œä»»åŠ¡ä¹‹åï¼Œå®ƒæ‰æ‰§è¡Œï¼›è€Œ CyclicBarrier ä¸€èˆ¬ç”¨äºä¸€ç»„çº¿ç¨‹äº’ç›¸ç­‰å¾…è‡³æŸä¸ªçŠ¶æ€ï¼Œç„¶åè¿™ä¸€ç»„çº¿ç¨‹å†åŒæ—¶æ‰§è¡Œï¼›å¦å¤–ï¼ŒCountDownLatch æ˜¯ä¸èƒ½å¤Ÿé‡ç”¨çš„ï¼Œè€Œ CyclicBarrier æ˜¯å¯ä»¥é‡ç”¨çš„</li>
<li>Semaphore å…¶å®å’Œé”æœ‰ç‚¹ç±»ä¼¼ï¼Œå®ƒä¸€èˆ¬ç”¨äºæ§åˆ¶å¯¹æŸç»„èµ„æºçš„è®¿é—®æƒé™ã€‚</li>
</ul>
<h3 id="volatileå…³é”®å­—çš„ä½œç”¨å˜é‡å¯è§æ€§ç¦æ­¢é‡æ’åº">volatileå…³é”®å­—çš„ä½œç”¨ï¼ˆå˜é‡å¯è§æ€§ã€ç¦æ­¢é‡æ’åºï¼‰
</h3><blockquote>
<p>Java è¯­è¨€æä¾›äº†ä¸€ç§ç¨å¼±çš„åŒæ­¥æœºåˆ¶ï¼Œå³ volatile å˜é‡ï¼Œç”¨æ¥ç¡®ä¿å°†å˜é‡çš„æ›´æ–°æ“ä½œé€šçŸ¥åˆ°å…¶ä»–çº¿ç¨‹ã€‚volatile å˜é‡å…·å¤‡ä¸¤ç§ç‰¹æ€§ï¼Œvolatile å˜é‡ä¸ä¼šè¢«ç¼“å­˜åœ¨å¯„å­˜å™¨æˆ–è€…å¯¹å…¶ä»–å¤„ç†å™¨ä¸å¯è§çš„åœ°æ–¹ï¼Œå› æ­¤åœ¨è¯»å– volatile ç±»å‹çš„å˜é‡æ—¶æ€»ä¼šè¿”å›æœ€æ–°å†™å…¥çš„å€¼ã€‚<br>
<code>å˜é‡å¯è§æ€§</code><br>
å…¶ä¸€æ˜¯ä¿è¯è¯¥å˜é‡å¯¹æ‰€æœ‰çº¿ç¨‹å¯è§ï¼Œè¿™é‡Œçš„å¯è§æ€§æŒ‡çš„æ˜¯å½“ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†å˜é‡çš„å€¼ï¼Œé‚£ä¹ˆæ–°çš„å€¼å¯¹äºå…¶ä»–çº¿ç¨‹æ˜¯å¯ä»¥ç«‹å³è·å–çš„ã€‚<br>
<code>ç¦æ­¢é‡æ’åº</code><br>
volatile ç¦æ­¢äº†æŒ‡ä»¤é‡æ’ã€‚<br>
<code>æ¯” sychronized æ›´è½»é‡çº§çš„åŒæ­¥é”</code><br>
åœ¨è®¿é—® volatile å˜é‡æ—¶ä¸ä¼šæ‰§è¡ŒåŠ é”æ“ä½œï¼Œå› æ­¤ä¹Ÿå°±ä¸ä¼šä½¿æ‰§è¡Œçº¿ç¨‹é˜»å¡ï¼Œå› æ­¤ volatile å˜é‡æ˜¯ä¸€ç§æ¯” sychronized å…³é”®å­—æ›´è½»é‡çº§çš„åŒæ­¥æœºåˆ¶ã€‚volatile é€‚åˆè¿™ç§åœºæ™¯ï¼šä¸€ä¸ªå˜é‡è¢«å¤šä¸ªçº¿ç¨‹å…±äº«ï¼Œçº¿ç¨‹ç›´æ¥ç»™è¿™ä¸ªå˜é‡èµ‹å€¼ã€‚
å½“å¯¹é volatile å˜é‡è¿›è¡Œè¯»å†™çš„æ—¶å€™ï¼Œæ¯ä¸ªçº¿ç¨‹å…ˆä»å†…å­˜æ‹·è´å˜é‡åˆ° CPU ç¼“å­˜ä¸­ã€‚å¦‚æœè®¡ç®—æœºæœ‰å¤šä¸ª CPUï¼Œæ¯ä¸ªçº¿ç¨‹å¯èƒ½åœ¨ä¸åŒçš„ CPU ä¸Šè¢«å¤„ç†ï¼Œè¿™æ„å‘³ç€æ¯ä¸ªçº¿ç¨‹å¯ä»¥æ‹·è´åˆ°ä¸åŒçš„ CPU cache ä¸­ã€‚è€Œå£°æ˜å˜é‡æ˜¯ volatile çš„ï¼ŒJVM ä¿è¯äº†æ¯æ¬¡è¯»å˜é‡éƒ½ä»å†…å­˜ä¸­è¯»ï¼Œè·³è¿‡ CPU cache è¿™ä¸€æ­¥ã€‚
<code>é€‚ç”¨åœºæ™¯</code><br>
å€¼å¾—è¯´æ˜çš„æ˜¯å¯¹ volatile å˜é‡çš„å•æ¬¡è¯»/å†™æ“ä½œå¯ä»¥ä¿è¯åŸå­æ€§çš„ï¼Œå¦‚ long å’Œ double ç±»å‹å˜é‡ï¼Œä½†æ˜¯å¹¶ä¸èƒ½ä¿è¯ i++è¿™ç§æ“ä½œçš„åŸå­æ€§ï¼Œå› ä¸ºæœ¬è´¨ä¸Š i++æ˜¯è¯»ã€å†™ä¸¤æ¬¡æ“ä½œã€‚åœ¨æŸäº›åœºæ™¯ä¸‹å¯ä»¥ä»£æ›¿ Synchronizedã€‚ä½†æ˜¯,volatile çš„ä¸èƒ½å®Œå…¨å–ä»£ Synchronized çš„ä½ç½®ï¼Œåªæœ‰åœ¨ä¸€äº›ç‰¹æ®Šçš„åœºæ™¯ä¸‹ï¼Œæ‰èƒ½é€‚ç”¨ volatileã€‚æ€»çš„æ¥è¯´ï¼Œå¿…é¡»åŒæ—¶æ»¡è¶³ä¸‹é¢ä¸¤ä¸ªæ¡ä»¶æ‰èƒ½ä¿è¯åœ¨å¹¶å‘ç¯å¢ƒçš„çº¿ç¨‹å®‰å…¨ï¼š<br>
ï¼ˆ1ï¼‰å¯¹å˜é‡çš„å†™æ“ä½œä¸ä¾èµ–äºå½“å‰å€¼ï¼ˆæ¯”å¦‚ i++ï¼‰ï¼Œæˆ–è€…è¯´æ˜¯å•çº¯çš„å˜é‡èµ‹å€¼ï¼ˆboolean flag = trueï¼‰ã€‚<br>
ï¼ˆ2ï¼‰è¯¥å˜é‡æ²¡æœ‰åŒ…å«åœ¨å…·æœ‰å…¶ä»–å˜é‡çš„ä¸å˜å¼ä¸­ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸åŒçš„ volatile å˜é‡ä¹‹é—´ï¼Œä¸èƒ½äº’ç›¸ä¾èµ–ã€‚åªæœ‰åœ¨çŠ¶æ€çœŸæ­£ç‹¬ç«‹äºç¨‹åºå†…å…¶ä»–å†…å®¹æ—¶æ‰èƒ½ä½¿ç”¨ volatileã€‚</p>
</blockquote>
<h3 id="å¦‚ä½•åœ¨ä¸¤ä¸ªçº¿ç¨‹ä¹‹é—´å…±äº«æ•°æ®">å¦‚ä½•åœ¨ä¸¤ä¸ªçº¿ç¨‹ä¹‹é—´å…±äº«æ•°æ®
</h3><blockquote>
<p>Java é‡Œé¢è¿›è¡Œå¤šçº¿ç¨‹é€šä¿¡çš„ä¸»è¦æ–¹å¼å°±æ˜¯å…±äº«å†…å­˜çš„æ–¹å¼ï¼Œå…±äº«å†…å­˜ä¸»è¦çš„å…³æ³¨ç‚¹æœ‰ä¸¤ä¸ªï¼šå¯è§æ€§å’Œæœ‰åºæ€§åŸå­æ€§ã€‚Java å†…å­˜æ¨¡å‹ï¼ˆJMMï¼‰è§£å†³äº†å¯è§æ€§å’Œæœ‰åºæ€§çš„é—®é¢˜ï¼Œè€Œé”è§£å†³äº†åŸå­æ€§çš„é—®é¢˜ï¼Œç†æƒ³æƒ…å†µä¸‹æˆ‘ä»¬å¸Œæœ›åšåˆ°åŒæ­¥å’Œäº’æ–¥ã€‚æœ‰ä»¥ä¸‹å¸¸è§„å®ç°æ–¹æ³•ï¼š<br>
å°†æ•°æ®æŠ½è±¡æˆä¸€ä¸ªç±»ï¼Œå¹¶å°†æ•°æ®çš„æ“ä½œä½œä¸ºè¿™ä¸ªç±»çš„æ–¹æ³•</p>
</blockquote>
<ol>
<li>å°†æ•°æ®æŠ½è±¡æˆä¸€ä¸ªç±»ï¼Œå¹¶å°†å¯¹è¿™ä¸ªæ•°æ®çš„æ“ä½œä½œä¸ºè¿™ä¸ªç±»çš„æ–¹æ³•ï¼Œè¿™ä¹ˆè®¾è®¡å¯ä»¥å’Œå®¹æ˜“åšåˆ°åŒæ­¥ï¼Œåªè¦åœ¨æ–¹æ³•ä¸ŠåŠ â€œsynchronizeâ€</li>
<li>Runnable å¯¹è±¡ä½œä¸ºä¸€ä¸ªç±»çš„å†…éƒ¨ç±»ï¼šå°† Runnable å¯¹è±¡ä½œä¸ºä¸€ä¸ªç±»çš„å†…éƒ¨ç±»ï¼Œå…±äº«æ•°æ®ä½œä¸ºè¿™ä¸ªç±»çš„æˆå‘˜å˜é‡ï¼Œæ¯ä¸ªçº¿ç¨‹å¯¹å…±äº«æ•°æ®çš„æ“ä½œæ–¹æ³•ä¹Ÿå°è£…åœ¨å¤–éƒ¨ç±»ï¼Œä»¥ä¾¿å®ç°å¯¹æ•°æ®çš„å„ä¸ªæ“ä½œçš„åŒæ­¥å’Œäº’æ–¥ï¼Œä½œä¸ºå†…éƒ¨ç±»çš„å„ä¸ª Runnable å¯¹è±¡è°ƒç”¨å¤–éƒ¨ç±»çš„è¿™äº›æ–¹æ³•ã€‚</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MyData</span><span class="w"> </span><span class="p">{</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="o">=</span><span class="n">0</span><span class="p">;</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">synchronized</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">add</span><span class="p">(){</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">j</span><span class="o">++</span><span class="p">;</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;çº¿ç¨‹&#34;</span><span class="o">+</span><span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">().</span><span class="na">getName</span><span class="p">()</span><span class="o">+</span><span class="s">&#34;j ä¸ºï¼š&#34;</span><span class="o">+</span><span class="n">j</span><span class="p">);</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">synchronized</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">dec</span><span class="p">(){</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">j</span><span class="o">--</span><span class="p">;</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;çº¿ç¨‹&#34;</span><span class="o">+</span><span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">().</span><span class="na">getName</span><span class="p">()</span><span class="o">+</span><span class="s">&#34;j ä¸ºï¼š&#34;</span><span class="o">+</span><span class="n">j</span><span class="p">);</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">getData</span><span class="p">(){</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">j</span><span class="p">;</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">AddRunnable</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Runnable</span><span class="p">{</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">MyData</span><span class="w"> </span><span class="n">data</span><span class="p">;</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">AddRunnable</span><span class="p">(</span><span class="n">MyData</span><span class="w"> </span><span class="n">data</span><span class="p">){</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">data</span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">;</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">   
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">data</span><span class="p">.</span><span class="na">add</span><span class="p">();</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">DecRunnable</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Runnable</span><span class="w"> </span><span class="p">{</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">MyData</span><span class="w"> </span><span class="n">data</span><span class="p">;</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">DecRunnable</span><span class="p">(</span><span class="n">MyData</span><span class="w"> </span><span class="n">data</span><span class="p">){</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">;</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">data</span><span class="p">.</span><span class="na">dec</span><span class="p">();</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">MyData</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">MyData</span><span class="p">();</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Runnable</span><span class="w"> </span><span class="n">add</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">AddRunnable</span><span class="p">(</span><span class="n">data</span><span class="p">);</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Runnable</span><span class="w"> </span><span class="n">dec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DecRunnable</span><span class="p">(</span><span class="n">data</span><span class="p">);</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="n">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">2</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">new</span><span class="w"> </span><span class="n">Thread</span><span class="p">(</span><span class="n">add</span><span class="p">).</span><span class="na">start</span><span class="p">();</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">new</span><span class="w"> </span><span class="n">Thread</span><span class="p">(</span><span class="n">dec</span><span class="p">).</span><span class="na">start</span><span class="p">();</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MyData</span><span class="w"> </span><span class="p">{</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="o">=</span><span class="n">0</span><span class="p">;</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">synchronized</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">add</span><span class="p">(){</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">j</span><span class="o">++</span><span class="p">;</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;çº¿ç¨‹&#34;</span><span class="o">+</span><span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">().</span><span class="na">getName</span><span class="p">()</span><span class="o">+</span><span class="s">&#34;j ä¸ºï¼š&#34;</span><span class="o">+</span><span class="n">j</span><span class="p">);</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">synchronized</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">dec</span><span class="p">(){</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">j</span><span class="o">--</span><span class="p">;</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;çº¿ç¨‹&#34;</span><span class="o">+</span><span class="n">Thread</span><span class="p">.</span><span class="na">currentThread</span><span class="p">().</span><span class="na">getName</span><span class="p">()</span><span class="o">+</span><span class="s">&#34;j ä¸ºï¼š&#34;</span><span class="o">+</span><span class="n">j</span><span class="p">);</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">getData</span><span class="p">(){</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">j</span><span class="p">;</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">TestThread</span><span class="w"> </span><span class="p">{</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">MyData</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">MyData</span><span class="p">();</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="n">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">2</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">new</span><span class="w"> </span><span class="n">Thread</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Runnable</span><span class="p">(){</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">data</span><span class="p">.</span><span class="na">add</span><span class="p">();</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}).</span><span class="na">start</span><span class="p">();</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">new</span><span class="w"> </span><span class="n">Thread</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Runnable</span><span class="p">(){</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="n">data</span><span class="p">.</span><span class="na">dec</span><span class="p">();</span><span class="w">   
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}).</span><span class="na">start</span><span class="p">();</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="threadlocalä½œç”¨çº¿æ€§æœ¬åœ°å­˜å‚¨">ThreadLocalä½œç”¨ï¼ˆçº¿æ€§æœ¬åœ°å­˜å‚¨ï¼‰
</h3><blockquote>
<p>ThreadLocalï¼Œå¾ˆå¤šåœ°æ–¹å«åšçº¿ç¨‹æœ¬åœ°å˜é‡ï¼Œä¹Ÿæœ‰äº›åœ°æ–¹å«åšçº¿ç¨‹æœ¬åœ°å­˜å‚¨ï¼ŒThreadLocal çš„ä½œç”¨æ˜¯æä¾›çº¿ç¨‹å†…çš„å±€éƒ¨å˜é‡ï¼Œè¿™ç§å˜é‡åœ¨çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸå†…èµ·ä½œç”¨ï¼Œå‡å°‘åŒä¸€ä¸ªçº¿ç¨‹å†…å¤šä¸ªå‡½æ•°æˆ–è€…ç»„ä»¶ä¹‹é—´ä¸€äº›å…¬å…±å˜é‡çš„ä¼ é€’çš„å¤æ‚åº¦ã€‚<br>
<code>ThreadLocalMap</code>ï¼ˆçº¿ç¨‹çš„ä¸€ä¸ªå±æ€§ï¼‰</p>
</blockquote>
<ol>
<li>æ¯ä¸ªçº¿ç¨‹ä¸­éƒ½æœ‰ä¸€ä¸ªè‡ªå·±çš„ ThreadLocalMap ç±»å¯¹è±¡ï¼Œå¯ä»¥å°†çº¿ç¨‹è‡ªå·±çš„å¯¹è±¡ä¿æŒåˆ°å…¶ä¸­ï¼Œå„ç®¡å„çš„ï¼Œçº¿ç¨‹å¯ä»¥æ­£ç¡®çš„è®¿é—®åˆ°è‡ªå·±çš„å¯¹è±¡ã€‚</li>
<li>å°†ä¸€ä¸ªå…±ç”¨çš„ ThreadLocal é™æ€å®ä¾‹ä½œä¸º keyï¼Œå°†ä¸åŒå¯¹è±¡çš„å¼•ç”¨ä¿å­˜åˆ°ä¸åŒçº¿ç¨‹çš„ThreadLocalMap ä¸­ï¼Œç„¶ååœ¨çº¿ç¨‹æ‰§è¡Œçš„å„å¤„é€šè¿‡è¿™ä¸ªé™æ€ ThreadLocal å®ä¾‹çš„ get()æ–¹æ³•å–å¾—è‡ªå·±çº¿ç¨‹ä¿å­˜çš„é‚£ä¸ªå¯¹è±¡ï¼Œé¿å…äº†å°†è¿™ä¸ªå¯¹è±¡ä½œä¸ºå‚æ•°ä¼ é€’çš„éº»çƒ¦ã€‚</li>
<li>ThreadLocalMap å…¶å®å°±æ˜¯çº¿ç¨‹é‡Œé¢çš„ä¸€ä¸ªå±æ€§ï¼Œå®ƒåœ¨ Thread ç±»ä¸­å®šä¹‰ThreadLocal.ThreadLocalMap threadLocals = null;<br>
<code>ä½¿ç”¨åœºæ™¯</code><br>
æœ€å¸¸è§çš„ ThreadLocal ä½¿ç”¨åœºæ™¯ä¸º ç”¨æ¥è§£å†³ æ•°æ®åº“è¿æ¥ã€Session ç®¡ç†ç­‰ã€‚
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">ThreadLocal</span><span class="w"> </span><span class="n">threadSession</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ThreadLocal</span><span class="p">();</span><span class="w">   
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">Session</span><span class="w"> </span><span class="nf">getSession</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">InfrastructureException</span><span class="w"> </span><span class="p">{</span><span class="w">   
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Session</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Session</span><span class="p">)</span><span class="w"> </span><span class="n">threadSession</span><span class="p">.</span><span class="na">get</span><span class="p">();</span><span class="w">   
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">   
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">s</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">   
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getSessionFactory</span><span class="p">().</span><span class="na">openSession</span><span class="p">();</span><span class="w">   
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="n">threadSession</span><span class="p">.</span><span class="na">set</span><span class="p">(</span><span class="n">s</span><span class="p">);</span><span class="w">   
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">   
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">HibernateException</span><span class="w"> </span><span class="n">ex</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">   
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">InfrastructureException</span><span class="p">(</span><span class="n">ex</span><span class="p">);</span><span class="w">   
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">   
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">s</span><span class="p">;</span><span class="w">   
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div></li>
</ol>
<h3 id="synchronized-å’Œ-reentrantlock-çš„åŒºåˆ«">Synchronized å’Œ ReentrantLock çš„åŒºåˆ«
</h3><h3 id="ä¸¤è€…çš„å…±åŒç‚¹">ä¸¤è€…çš„å…±åŒç‚¹
</h3><ol>
<li>éƒ½æ˜¯ç”¨æ¥åè°ƒå¤šçº¿ç¨‹å¯¹å…±äº«å¯¹è±¡ã€å˜é‡çš„è®¿é—®</li>
<li>éƒ½æ˜¯å¯é‡å…¥é”ï¼ŒåŒä¸€çº¿ç¨‹å¯ä»¥å¤šæ¬¡è·å¾—åŒä¸€ä¸ªé”</li>
<li>éƒ½ä¿è¯äº†å¯è§æ€§å’Œäº’æ–¥æ€§</li>
</ol>
<h3 id="ä¸¤è€…çš„ä¸åŒç‚¹">ä¸¤è€…çš„ä¸åŒç‚¹
</h3><ol>
<li>ReentrantLock æ˜¾ç¤ºçš„è·å¾—ã€é‡Šæ”¾é”ï¼Œsynchronized éšå¼è·å¾—é‡Šæ”¾é”</li>
<li>ReentrantLock å¯å“åº”ä¸­æ–­ã€å¯è½®å›ï¼Œsynchronized æ˜¯ä¸å¯ä»¥å“åº”ä¸­æ–­çš„ï¼Œä¸ºå¤„ç†é”çš„ä¸å¯ç”¨æ€§æä¾›äº†æ›´é«˜çš„çµæ´»æ€§</li>
<li>ReentrantLock æ˜¯ API çº§åˆ«çš„ï¼Œsynchronized æ˜¯ JVM çº§åˆ«çš„</li>
<li>ReentrantLock å¯ä»¥å®ç°å…¬å¹³é”</li>
<li>ReentrantLock é€šè¿‡ Condition å¯ä»¥ç»‘å®šå¤šä¸ªæ¡ä»¶</li>
<li>åº•å±‚å®ç°ä¸ä¸€æ ·ï¼Œ synchronized æ˜¯åŒæ­¥é˜»å¡ï¼Œä½¿ç”¨çš„æ˜¯æ‚²è§‚å¹¶å‘ç­–ç•¥ï¼Œlock æ˜¯åŒæ­¥éé˜»å¡ï¼Œé‡‡ç”¨çš„æ˜¯ä¹è§‚å¹¶å‘ç­–ç•¥</li>
<li>Lock æ˜¯ä¸€ä¸ªæ¥å£ï¼Œè€Œ synchronized æ˜¯ Java ä¸­çš„å…³é”®å­—ï¼Œsynchronized æ˜¯å†…ç½®çš„è¯­è¨€å®ç°ã€‚</li>
<li>synchronized åœ¨å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œä¼šè‡ªåŠ¨é‡Šæ”¾çº¿ç¨‹å æœ‰çš„é”ï¼Œå› æ­¤ä¸ä¼šå¯¼è‡´æ­»é”ç°è±¡å‘ç”Ÿï¼›è€Œ Lock åœ¨å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œå¦‚æœæ²¡æœ‰ä¸»åŠ¨é€šè¿‡ unLock()å»é‡Šæ”¾é”ï¼Œåˆ™å¾ˆå¯èƒ½é€ æˆæ­»é”ç°è±¡ï¼Œå› æ­¤ä½¿ç”¨ Lock æ—¶éœ€è¦åœ¨ finally å—ä¸­é‡Šæ”¾é”ã€‚</li>
<li>Lock å¯ä»¥è®©ç­‰å¾…é”çš„çº¿ç¨‹å“åº”ä¸­æ–­ï¼Œè€Œ synchronized å´ä¸è¡Œï¼Œä½¿ç”¨ synchronized æ—¶ï¼Œç­‰å¾…çš„çº¿ç¨‹ä¼šä¸€ç›´ç­‰å¾…ä¸‹å»ï¼Œä¸èƒ½å¤Ÿå“åº”ä¸­æ–­ã€‚</li>
<li>é€šè¿‡ Lock å¯ä»¥çŸ¥é“æœ‰æ²¡æœ‰æˆåŠŸè·å–é”ï¼Œè€Œ synchronized å´æ— æ³•åŠåˆ°ã€‚</li>
<li>Lock å¯ä»¥æé«˜å¤šä¸ªçº¿ç¨‹è¿›è¡Œè¯»æ“ä½œçš„æ•ˆç‡ï¼Œæ—¢å°±æ˜¯å®ç°è¯»å†™é”ç­‰ã€‚</li>
</ol>
<h3 id="concurrenthashmapå¹¶å‘">ConcurrentHashMapå¹¶å‘
</h3><h3 id="å‡å°é”ç²’åº¦">å‡å°é”ç²’åº¦
</h3><blockquote>
<p>å‡å°é”ç²’åº¦æ˜¯æŒ‡ç¼©å°é”å®šå¯¹è±¡çš„èŒƒå›´ï¼Œä»è€Œå‡å°é”å†²çªçš„å¯èƒ½æ€§ï¼Œä»è€Œæé«˜ç³»ç»Ÿçš„å¹¶å‘èƒ½åŠ›ã€‚å‡å°é”ç²’åº¦æ˜¯ä¸€ç§å‰Šå¼±å¤šçº¿ç¨‹é”ç«äº‰çš„æœ‰æ•ˆæ‰‹æ®µï¼Œè¿™ç§æŠ€æœ¯å…¸å‹çš„åº”ç”¨æ˜¯ ConcurrentHashMap(é«˜æ€§èƒ½çš„ HashMap)ç±»çš„å®ç°ã€‚å¯¹äº HashMap è€Œè¨€ï¼Œæœ€é‡è¦çš„ä¸¤ä¸ªæ–¹æ³•æ˜¯ get ä¸ set æ–¹æ³•ï¼Œå¦‚æœæˆ‘ä»¬å¯¹æ•´ä¸ª HashMap åŠ é”ï¼Œå¯ä»¥å¾—åˆ°çº¿ç¨‹å®‰å…¨çš„å¯¹è±¡ï¼Œä½†æ˜¯åŠ é”ç²’åº¦å¤ªå¤§ã€‚Segment çš„å¤§å°ä¹Ÿè¢«ç§°ä¸º ConcurrentHashMap çš„å¹¶å‘åº¦ã€‚</p>
</blockquote>
<h3 id="concurrenthashmapåˆ†æ®µé”">ConcurrentHashMapåˆ†æ®µé”
</h3><blockquote>
<p>ConcurrentHashMapï¼Œå®ƒå†…éƒ¨ç»†åˆ†äº†è‹¥å¹²ä¸ªå°çš„ HashMapï¼Œç§°ä¹‹ä¸ºæ®µ(Segment)ã€‚é»˜è®¤æƒ…å†µä¸‹ä¸€ä¸ª ConcurrentHashMap è¢«è¿›ä¸€æ­¥ç»†åˆ†ä¸º 16 ä¸ªæ®µï¼Œå³å°±æ˜¯é”çš„å¹¶å‘åº¦ã€‚<br>
å¦‚æœéœ€è¦åœ¨ ConcurrentHashMap ä¸­æ·»åŠ ä¸€ä¸ªæ–°çš„è¡¨é¡¹ï¼Œå¹¶ä¸æ˜¯å°†æ•´ä¸ª HashMap åŠ é”ï¼Œè€Œæ˜¯é¦–å…ˆæ ¹æ® hashcode å¾—åˆ°è¯¥è¡¨é¡¹åº”è¯¥å­˜æ”¾åœ¨å“ªä¸ªæ®µä¸­ï¼Œç„¶åå¯¹è¯¥æ®µåŠ é”ï¼Œå¹¶å®Œæˆ put æ“ä½œã€‚åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ï¼Œå¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶è¿›è¡Œ putæ“ä½œï¼Œåªè¦è¢«åŠ å…¥çš„è¡¨é¡¹ä¸å­˜æ”¾åœ¨åŒä¸€ä¸ªæ®µä¸­ï¼Œåˆ™çº¿ç¨‹é—´å¯ä»¥åšåˆ°çœŸæ­£çš„å¹¶è¡Œã€‚<br>
<code>ConcurrentHashMap æ˜¯ç”± Segment æ•°ç»„ç»“æ„å’Œ HashEntry æ•°ç»„ç»“æ„ç»„æˆ</code><br>
ConcurrentHashMap æ˜¯ç”± Segment æ•°ç»„ç»“æ„å’Œ HashEntry æ•°ç»„ç»“æ„ç»„æˆã€‚Segment æ˜¯ä¸€ç§å¯é‡å…¥é” ReentrantLockï¼Œåœ¨ ConcurrentHashMap é‡Œæ‰®æ¼”é”çš„è§’è‰²ï¼ŒHashEntry åˆ™ç”¨äºå­˜å‚¨é”®å€¼å¯¹æ•°æ®ã€‚ä¸€ä¸ª ConcurrentHashMap é‡ŒåŒ…å«ä¸€ä¸ª Segment æ•°ç»„ï¼ŒSegment çš„ç»“æ„å’Œ HashMapç±»ä¼¼ï¼Œæ˜¯ä¸€ç§æ•°ç»„å’Œé“¾è¡¨ç»“æ„ï¼Œ ä¸€ä¸ª Segment é‡ŒåŒ…å«ä¸€ä¸ª HashEntry æ•°ç»„ï¼Œæ¯ä¸ª HashEntry æ˜¯ä¸€ä¸ªé“¾è¡¨ç»“æ„çš„å…ƒç´ ï¼Œ æ¯ä¸ª Segment å®ˆæŠ¤ä¸€ä¸ª HashEntry æ•°ç»„é‡Œçš„å…ƒç´ ,å½“å¯¹ HashEntry æ•°ç»„çš„æ•°æ®è¿›è¡Œä¿®æ”¹æ—¶ï¼Œå¿…é¡»é¦–å…ˆè·å¾—å®ƒå¯¹åº”çš„ Segment é”ã€‚</p>
</blockquote>
<h3 id="javaä¸­ç”¨åˆ°çš„çº¿ç¨‹è°ƒåº¦">Javaä¸­ç”¨åˆ°çš„çº¿ç¨‹è°ƒåº¦
</h3><h3 id="æŠ¢å å¼è°ƒåº¦">æŠ¢å å¼è°ƒåº¦
</h3><blockquote>
<p>æŠ¢å å¼è°ƒåº¦æŒ‡çš„æ˜¯æ¯æ¡çº¿ç¨‹æ‰§è¡Œçš„æ—¶é—´ã€çº¿ç¨‹çš„åˆ‡æ¢éƒ½ç”±ç³»ç»Ÿæ§åˆ¶ï¼Œç³»ç»Ÿæ§åˆ¶æŒ‡çš„æ˜¯åœ¨ç³»ç»ŸæŸç§è¿è¡Œæœºåˆ¶ä¸‹ï¼Œå¯èƒ½æ¯æ¡çº¿ç¨‹éƒ½åˆ†åŒæ ·çš„æ‰§è¡Œæ—¶é—´ç‰‡ï¼Œä¹Ÿå¯èƒ½æ˜¯æŸäº›çº¿ç¨‹æ‰§è¡Œçš„æ—¶é—´ç‰‡è¾ƒé•¿ï¼Œç”šè‡³æŸäº›çº¿ç¨‹å¾—ä¸åˆ°æ‰§è¡Œçš„æ—¶é—´ç‰‡ã€‚åœ¨è¿™ç§æœºåˆ¶ä¸‹ï¼Œä¸€ä¸ªçº¿ç¨‹çš„å µå¡ä¸ä¼šå¯¼è‡´æ•´ä¸ªè¿›ç¨‹å µå¡ã€‚</p>
</blockquote>
<h3 id="ååŒå¼è°ƒåº¦">ååŒå¼è°ƒåº¦
</h3><blockquote>
<p>ååŒå¼è°ƒåº¦æŒ‡æŸä¸€çº¿ç¨‹æ‰§è¡Œå®Œåä¸»åŠ¨é€šçŸ¥ç³»ç»Ÿåˆ‡æ¢åˆ°å¦ä¸€çº¿ç¨‹ä¸Šæ‰§è¡Œï¼Œè¿™ç§æ¨¡å¼å°±åƒæ¥åŠ›èµ›ä¸€æ ·ï¼Œä¸€ä¸ªäººè·‘å®Œè‡ªå·±çš„è·¯ç¨‹å°±æŠŠæ¥åŠ›æ£’äº¤æ¥ç»™ä¸‹ä¸€ä¸ªäººï¼Œä¸‹ä¸ªäººç»§ç»­å¾€ä¸‹è·‘ã€‚çº¿ç¨‹çš„æ‰§è¡Œæ—¶é—´ç”±çº¿ç¨‹æœ¬èº«æ§åˆ¶ï¼Œçº¿ç¨‹åˆ‡æ¢å¯ä»¥é¢„çŸ¥ï¼Œä¸å­˜åœ¨å¤šçº¿ç¨‹åŒæ­¥é—®é¢˜ï¼Œä½†å®ƒæœ‰ä¸€ä¸ªè‡´å‘½å¼±ç‚¹ï¼šå¦‚æœä¸€ä¸ªçº¿ç¨‹ç¼–å†™æœ‰é—®é¢˜ï¼Œè¿è¡Œåˆ°ä¸€åŠå°±ä¸€ç›´å µå¡ï¼Œé‚£ä¹ˆå¯èƒ½å¯¼è‡´æ•´ä¸ªç³»ç»Ÿå´©æºƒã€‚</p>
</blockquote>
<h3 id="jvmçš„çº¿ç¨‹è°ƒåº¦å®ç°æŠ¢å å¼è°ƒåº¦">jvmçš„çº¿ç¨‹è°ƒåº¦å®ç°ï¼ˆæŠ¢å å¼è°ƒåº¦ï¼‰
</h3><blockquote>
<p>java ä½¿ç”¨çš„çº¿ç¨‹è°ƒä½¿ç”¨æŠ¢å å¼è°ƒåº¦ï¼ŒJava ä¸­çº¿ç¨‹ä¼šæŒ‰ä¼˜å…ˆçº§åˆ†é… CPU æ—¶é—´ç‰‡è¿è¡Œï¼Œä¸”ä¼˜å…ˆçº§è¶Šé«˜è¶Šä¼˜å…ˆæ‰§è¡Œï¼Œä½†ä¼˜å…ˆçº§é«˜å¹¶ä¸ä»£è¡¨èƒ½ç‹¬è‡ªå ç”¨æ‰§è¡Œæ—¶é—´ç‰‡ï¼Œå¯èƒ½æ˜¯ä¼˜å…ˆçº§é«˜å¾—åˆ°è¶Šå¤šçš„æ‰§è¡Œæ—¶é—´ç‰‡ï¼Œåä¹‹ï¼Œä¼˜å…ˆçº§ä½çš„åˆ†åˆ°çš„æ‰§è¡Œæ—¶é—´å°‘ä½†ä¸ä¼šåˆ†é…ä¸åˆ°æ‰§è¡Œæ—¶é—´ã€‚</p>
</blockquote>
<h3 id="çº¿ç¨‹è®©å‡ºcpuçš„æƒ…å†µ">çº¿ç¨‹è®©å‡ºCPUçš„æƒ…å†µ
</h3><ol>
<li>å½“å‰è¿è¡Œçº¿ç¨‹ä¸»åŠ¨æ”¾å¼ƒ CPUï¼ŒJVM æš‚æ—¶æ”¾å¼ƒ CPU æ“ä½œï¼ˆåŸºäºæ—¶é—´ç‰‡è½®è½¬è°ƒåº¦çš„ JVM æ“ä½œç³»ç»Ÿä¸ä¼šè®©çº¿ç¨‹æ°¸ä¹…æ”¾å¼ƒ CPUï¼Œæˆ–è€…è¯´æ”¾å¼ƒæœ¬æ¬¡æ—¶é—´ç‰‡çš„æ‰§è¡Œæƒï¼‰ï¼Œä¾‹å¦‚è°ƒç”¨ yield()æ–¹æ³•ã€‚</li>
<li>å½“å‰è¿è¡Œçº¿ç¨‹å› ä¸ºæŸäº›åŸå› è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œä¾‹å¦‚é˜»å¡åœ¨ I/O ä¸Šã€‚</li>
<li>å½“å‰è¿è¡Œçº¿ç¨‹ç»“æŸï¼Œå³è¿è¡Œå®Œ run()æ–¹æ³•é‡Œé¢çš„ä»»åŠ¡ã€‚</li>
</ol>
<h3 id="è¿›ç¨‹è°ƒåº¦ç®—æ³•">è¿›ç¨‹è°ƒåº¦ç®—æ³•
</h3><h3 id="ä¼˜å…ˆè°ƒåº¦ç®—æ³•">ä¼˜å…ˆè°ƒåº¦ç®—æ³•
</h3><ol>
<li>å…ˆæ¥å…ˆæœåŠ¡è°ƒåº¦ç®—æ³•ï¼ˆFCFSï¼‰ å½“åœ¨ä½œä¸šè°ƒåº¦ä¸­é‡‡ç”¨è¯¥ç®—æ³•æ—¶ï¼Œæ¯æ¬¡è°ƒåº¦éƒ½æ˜¯ä»åå¤‡ä½œä¸šé˜Ÿåˆ—ä¸­é€‰æ‹©ä¸€ä¸ªæˆ–å¤šä¸ªæœ€å…ˆè¿›å…¥è¯¥é˜Ÿåˆ—çš„ä½œä¸šï¼Œå°†å®ƒä»¬è°ƒå…¥å†…å­˜ï¼Œä¸ºå®ƒä»¬åˆ†é…èµ„æºã€åˆ›å»ºè¿›ç¨‹ï¼Œç„¶åæ”¾å…¥å°±ç»ªé˜Ÿåˆ—ã€‚åœ¨è¿›ç¨‹è°ƒåº¦ä¸­é‡‡ç”¨ FCFS ç®—æ³•æ—¶ï¼Œåˆ™æ¯æ¬¡è°ƒåº¦æ˜¯ä»å°±ç»ªé˜Ÿåˆ—ä¸­é€‰æ‹©ä¸€ä¸ªæœ€å…ˆè¿›å…¥è¯¥é˜Ÿåˆ—çš„è¿›ç¨‹ï¼Œä¸ºä¹‹åˆ†é…å¤„ç†æœºï¼Œä½¿ä¹‹æŠ•å…¥è¿è¡Œã€‚è¯¥è¿›ç¨‹ä¸€ç›´è¿è¡Œåˆ°å®Œæˆæˆ–å‘ç”ŸæŸäº‹ä»¶è€Œé˜»å¡åæ‰æ”¾å¼ƒå¤„ç†æœºï¼Œç‰¹ç‚¹æ˜¯ï¼šç®—æ³•æ¯”è¾ƒç®€å•ï¼Œå¯ä»¥å®ç°åŸºæœ¬ä¸Šçš„å…¬å¹³ã€‚</li>
<li>çŸ­ä½œä¸š(è¿›ç¨‹)ä¼˜å…ˆè°ƒåº¦ç®—æ³•çŸ­ä½œä¸šä¼˜å…ˆ(SJF)çš„è°ƒåº¦ç®—æ³•æ˜¯ä»åå¤‡é˜Ÿåˆ—ä¸­é€‰æ‹©ä¸€ä¸ªæˆ–è‹¥å¹²ä¸ªä¼°è®¡è¿è¡Œæ—¶é—´æœ€çŸ­çš„ä½œä¸šï¼Œå°†å®ƒä»¬è°ƒå…¥å†…å­˜è¿è¡Œã€‚è€ŒçŸ­è¿›ç¨‹ä¼˜å…ˆ(SPF)è°ƒåº¦ç®—æ³•åˆ™æ˜¯ä»å°±ç»ªé˜Ÿåˆ—ä¸­é€‰å‡ºä¸€ä¸ªä¼°è®¡è¿è¡Œæ—¶é—´æœ€çŸ­çš„è¿›ç¨‹ï¼Œå°†å¤„ç†æœºåˆ†é…ç»™å®ƒï¼Œä½¿å®ƒç«‹å³æ‰§è¡Œå¹¶ä¸€ç›´æ‰§è¡Œåˆ°å®Œæˆï¼Œæˆ–å‘ç”ŸæŸäº‹ä»¶è€Œè¢«é˜»å¡æ”¾å¼ƒå¤„ç†æœºæ—¶å†é‡æ–°è°ƒåº¦ã€‚è¯¥ç®—æ³•æœªç…§é¡¾ç´§è¿«å‹ä½œä¸šã€‚</li>
</ol>
<h3 id="é«˜ä¼˜å…ˆæƒä¼˜å…ˆè°ƒåº¦ç®—æ³•">é«˜ä¼˜å…ˆæƒä¼˜å…ˆè°ƒåº¦ç®—æ³•
</h3><blockquote>
<p>ä¸ºäº†ç…§é¡¾ç´§è¿«å‹ä½œä¸šï¼Œä½¿ä¹‹åœ¨è¿›å…¥ç³»ç»Ÿåä¾¿è·å¾—ä¼˜å…ˆå¤„ç†ï¼Œå¼•å…¥äº†æœ€é«˜ä¼˜å…ˆæƒä¼˜å…ˆ(FPF)è°ƒåº¦ç®—æ³•ã€‚å½“æŠŠè¯¥ç®—æ³•ç”¨äºä½œä¸šè°ƒåº¦æ—¶ï¼Œç³»ç»Ÿå°†ä»åå¤‡é˜Ÿåˆ—ä¸­é€‰æ‹©è‹¥å¹²ä¸ªä¼˜å…ˆæƒæœ€é«˜çš„ä½œä¸šè£…å…¥å†…å­˜ã€‚å½“ç”¨äºè¿›ç¨‹è°ƒåº¦æ—¶ï¼Œè¯¥ç®—æ³•æ˜¯æŠŠå¤„ç†æœºåˆ†é…ç»™å°±ç»ªé˜Ÿåˆ—ä¸­ä¼˜å…ˆæƒæœ€é«˜çš„è¿›ç¨‹ã€‚</p>
</blockquote>
<ol>
<li>éæŠ¢å å¼ä¼˜å…ˆæƒç®—æ³•åœ¨è¿™ç§æ–¹å¼ä¸‹ï¼Œç³»ç»Ÿä¸€æ—¦æŠŠå¤„ç†æœºåˆ†é…ç»™å°±ç»ªé˜Ÿåˆ—ä¸­ä¼˜å…ˆæƒæœ€é«˜çš„è¿›ç¨‹åï¼Œè¯¥è¿›ç¨‹ä¾¿ä¸€ç›´æ‰§è¡Œä¸‹å»ï¼Œç›´è‡³å®Œæˆï¼›æˆ–å› å‘ç”ŸæŸäº‹ä»¶ä½¿è¯¥è¿›ç¨‹æ”¾å¼ƒå¤„ç†æœºæ—¶ã€‚è¿™ç§è°ƒåº¦ç®—æ³•ä¸»è¦ç”¨äºæ‰¹å¤„ç†ç³»ç»Ÿä¸­ï¼›ä¹Ÿå¯ç”¨äºæŸäº›å¯¹å®æ—¶æ€§è¦æ±‚ä¸ä¸¥çš„å®æ—¶ç³»ç»Ÿä¸­ã€‚</li>
<li>æŠ¢å å¼ä¼˜å…ˆæƒè°ƒåº¦ç®—æ³•åœ¨è¿™ç§æ–¹å¼ä¸‹ï¼Œç³»ç»ŸåŒæ ·æ˜¯æŠŠå¤„ç†æœºåˆ†é…ç»™ä¼˜å…ˆæƒæœ€é«˜çš„è¿›ç¨‹ï¼Œä½¿ä¹‹æ‰§è¡Œã€‚ä½†åœ¨å…¶æ‰§è¡ŒæœŸé—´ï¼Œåªè¦åˆå‡ºç°äº†å¦ä¸€ä¸ªå…¶ä¼˜å…ˆæƒæ›´é«˜çš„è¿›ç¨‹ï¼Œè¿›ç¨‹è°ƒåº¦ç¨‹åºå°±ç«‹å³åœæ­¢å½“å‰è¿›ç¨‹(åŸä¼˜å…ˆæƒæœ€é«˜çš„è¿›ç¨‹)çš„æ‰§è¡Œï¼Œé‡æ–°å°†å¤„ç†æœºåˆ†é…ç»™æ–°åˆ°çš„ä¼˜å…ˆæƒæœ€é«˜çš„è¿›ç¨‹ã€‚æ˜¾ç„¶ï¼Œè¿™ç§æŠ¢å å¼çš„ä¼˜å…ˆæƒè°ƒåº¦ç®—æ³•èƒ½æ›´å¥½åœ°æ»¡è¶³ç´§è¿«ä½œä¸šçš„è¦æ±‚ï¼Œæ•…è€Œå¸¸ç”¨äºè¦æ±‚æ¯”è¾ƒä¸¥æ ¼çš„å®æ—¶ç³»ç»Ÿä¸­ï¼Œä»¥åŠå¯¹æ€§èƒ½è¦æ±‚è¾ƒé«˜çš„æ‰¹å¤„ç†å’Œåˆ†æ—¶ç³»ç»Ÿä¸­ã€‚</li>
<li>é«˜å“åº”æ¯”ä¼˜å…ˆè°ƒåº¦ç®—æ³• åœ¨æ‰¹å¤„ç†ç³»ç»Ÿä¸­ï¼ŒçŸ­ä½œä¸šä¼˜å…ˆç®—æ³•æ˜¯ä¸€ç§æ¯”è¾ƒå¥½çš„ç®—æ³•ï¼Œå…¶ä¸»è¦çš„ä¸è¶³ä¹‹å¤„æ˜¯é•¿ä½œä¸šçš„è¿è¡Œå¾—ä¸åˆ°ä¿è¯ã€‚å¦‚æœæˆ‘ä»¬èƒ½ä¸ºæ¯ä¸ªä½œä¸šå¼•å…¥å‰é¢æ‰€è¿°çš„åŠ¨æ€ä¼˜å…ˆæƒï¼Œå¹¶ä½¿ä½œä¸šçš„ä¼˜å…ˆçº§éšç€ç­‰å¾…æ—¶é—´çš„å¢åŠ è€Œä»¥é€Ÿç‡ a æé«˜ï¼Œåˆ™é•¿ä½œä¸šåœ¨ç­‰å¾…ä¸€å®šçš„æ—¶é—´åï¼Œå¿…ç„¶æœ‰æœºä¼šåˆ†é…åˆ°å¤„ç†æœºã€‚
<ol>
<li>å¦‚æœä½œä¸šçš„ç­‰å¾…æ—¶é—´ç›¸åŒï¼Œåˆ™è¦æ±‚æœåŠ¡çš„æ—¶é—´æ„ˆçŸ­ï¼Œå…¶ä¼˜å…ˆæƒæ„ˆé«˜ï¼Œå› è€Œè¯¥ç®—æ³•æœ‰åˆ©äºçŸ­ä½œä¸šã€‚</li>
<li>å½“è¦æ±‚æœåŠ¡çš„æ—¶é—´ç›¸åŒæ—¶ï¼Œä½œä¸šçš„ä¼˜å…ˆæƒå†³å®šäºå…¶ç­‰å¾…æ—¶é—´ï¼Œç­‰å¾…æ—¶é—´æ„ˆé•¿ï¼Œå…¶ä¼˜å…ˆæƒæ„ˆé«˜ï¼Œå› è€Œå®ƒå®ç°çš„æ˜¯å…ˆæ¥å…ˆæœåŠ¡ã€‚</li>
<li>å¯¹äºé•¿ä½œä¸šï¼Œä½œä¸šçš„ä¼˜å…ˆçº§å¯ä»¥éšç­‰å¾…æ—¶é—´çš„å¢åŠ è€Œæé«˜ï¼Œå½“å…¶ç­‰å¾…æ—¶é—´è¶³å¤Ÿé•¿æ—¶ï¼Œå…¶ä¼˜å…ˆçº§ä¾¿å¯å‡åˆ°å¾ˆé«˜ï¼Œä»è€Œä¹Ÿå¯è·å¾—å¤„ç†æœºã€‚ç®€è¨€ä¹‹ï¼Œè¯¥ç®—æ³•æ—¢ç…§é¡¾äº†çŸ­ä½œä¸šï¼Œåˆè€ƒè™‘äº†ä½œä¸šåˆ°è¾¾çš„å…ˆåæ¬¡åºï¼Œä¸ä¼šä½¿é•¿ä½œä¸šé•¿æœŸå¾—ä¸åˆ°æœåŠ¡ã€‚å› æ­¤ï¼Œè¯¥ç®—æ³•å®ç°äº†ä¸€ç§è¾ƒå¥½çš„æŠ˜è¡·ã€‚å½“ç„¶ï¼Œåœ¨åˆ©ç”¨è¯¥ç®—æ³•æ—¶ï¼Œæ¯è¦è¿›è¡Œè°ƒåº¦ä¹‹å‰ï¼Œéƒ½é¡»å…ˆåšå“åº”æ¯”çš„è®¡ç®—ï¼Œè¿™ä¼šå¢åŠ ç³»ç»Ÿå¼€é”€ã€‚</li>
</ol>
</li>
</ol>
<h3 id="åŸºäºæ—¶é—´ç‰‡çš„è½®è½¬è°ƒåº¦ç®—æ³•">åŸºäºæ—¶é—´ç‰‡çš„è½®è½¬è°ƒåº¦ç®—æ³•
</h3><ol>
<li>æ—¶é—´ç‰‡è½®è½¬æ³•åœ¨æ—©æœŸçš„æ—¶é—´ç‰‡è½®è½¬æ³•ä¸­ï¼Œç³»ç»Ÿå°†æ‰€æœ‰çš„å°±ç»ªè¿›ç¨‹æŒ‰å…ˆæ¥å…ˆæœåŠ¡çš„åŸåˆ™æ’æˆä¸€ä¸ªé˜Ÿåˆ—ï¼Œæ¯æ¬¡è°ƒåº¦æ—¶ï¼ŒæŠŠ CPU åˆ†é…ç»™é˜Ÿé¦–è¿›ç¨‹ï¼Œå¹¶ä»¤å…¶æ‰§è¡Œä¸€ä¸ªæ—¶é—´ç‰‡ã€‚æ—¶é—´ç‰‡çš„å¤§å°ä»å‡  ms åˆ°å‡ ç™¾ msã€‚å½“æ‰§è¡Œçš„æ—¶é—´ç‰‡ç”¨å®Œæ—¶ï¼Œç”±ä¸€ä¸ªè®¡æ—¶å™¨å‘å‡ºæ—¶é’Ÿä¸­æ–­è¯·æ±‚ï¼Œè°ƒåº¦ç¨‹åºä¾¿æ®æ­¤ä¿¡å·æ¥åœæ­¢è¯¥è¿›ç¨‹çš„æ‰§è¡Œï¼Œå¹¶å°†å®ƒé€å¾€å°±ç»ªé˜Ÿåˆ—çš„æœ«å°¾ï¼›ç„¶åï¼Œå†æŠŠå¤„ç†æœºåˆ†é…ç»™å°±ç»ªé˜Ÿåˆ—ä¸­æ–°çš„é˜Ÿé¦–è¿›ç¨‹ï¼ŒåŒæ—¶ä¹Ÿè®©å®ƒæ‰§è¡Œä¸€ä¸ªæ—¶é—´ç‰‡ã€‚è¿™æ ·å°±å¯ä»¥ä¿è¯å°±ç»ªé˜Ÿåˆ—ä¸­çš„æ‰€æœ‰è¿›ç¨‹åœ¨ä¸€ç»™å®šçš„æ—¶é—´å†…å‡èƒ½è·å¾—ä¸€æ—¶é—´ç‰‡çš„å¤„ç†æœºæ‰§è¡Œæ—¶é—´ã€‚</li>
<li>å¤šçº§åé¦ˆé˜Ÿåˆ—è°ƒåº¦ç®—æ³•<br>
(1) åº”è®¾ç½®å¤šä¸ªå°±ç»ªé˜Ÿåˆ—ï¼Œå¹¶ä¸ºå„ä¸ªé˜Ÿåˆ—èµ‹äºˆä¸åŒçš„ä¼˜å…ˆçº§ã€‚ç¬¬ä¸€ä¸ªé˜Ÿåˆ—çš„ä¼˜å…ˆçº§æœ€é«˜ï¼Œç¬¬äºŒä¸ªé˜Ÿåˆ—æ¬¡ä¹‹ï¼Œå…¶ä½™å„é˜Ÿåˆ—çš„ä¼˜å…ˆæƒé€ä¸ªé™ä½ã€‚è¯¥ç®—æ³•èµ‹äºˆå„ä¸ªé˜Ÿåˆ—ä¸­è¿›ç¨‹æ‰§è¡Œæ—¶é—´ç‰‡çš„å¤§å°ä¹Ÿå„ä¸ç›¸åŒï¼Œåœ¨ä¼˜å…ˆæƒæ„ˆé«˜çš„é˜Ÿåˆ—ä¸­ï¼Œä¸ºæ¯ä¸ªè¿›ç¨‹æ‰€è§„å®šçš„æ‰§è¡Œæ—¶é—´ç‰‡å°±æ„ˆå°ã€‚ä¾‹å¦‚ï¼Œç¬¬äºŒä¸ªé˜Ÿåˆ—çš„æ—¶é—´ç‰‡è¦æ¯”ç¬¬ä¸€ä¸ªé˜Ÿåˆ—çš„æ—¶é—´ç‰‡é•¿ä¸€å€ï¼Œâ€¦â€¦ï¼Œç¬¬ i+1 ä¸ªé˜Ÿåˆ—çš„æ—¶é—´ç‰‡è¦æ¯”ç¬¬ i ä¸ªé˜Ÿåˆ—çš„æ—¶é—´ç‰‡é•¿ä¸€å€ã€‚<br>
(2) å½“ä¸€ä¸ªæ–°è¿›ç¨‹è¿›å…¥å†…å­˜åï¼Œé¦–å…ˆå°†å®ƒæ”¾å…¥ç¬¬ä¸€é˜Ÿåˆ—çš„æœ«å°¾ï¼ŒæŒ‰ FCFS åŸåˆ™æ’é˜Ÿç­‰å¾…è°ƒåº¦ã€‚å½“è½®åˆ°è¯¥è¿›ç¨‹æ‰§è¡Œæ—¶ï¼Œå¦‚å®ƒèƒ½åœ¨è¯¥æ—¶é—´ç‰‡å†…å®Œæˆï¼Œä¾¿å¯å‡†å¤‡æ’¤ç¦»ç³»ç»Ÿï¼›å¦‚æœå®ƒåœ¨ä¸€ä¸ªæ—¶é—´ç‰‡ç»“æŸæ—¶å°šæœªå®Œæˆï¼Œè°ƒåº¦ç¨‹åºä¾¿å°†è¯¥è¿›ç¨‹è½¬å…¥ç¬¬äºŒé˜Ÿåˆ—çš„æœ«å°¾ï¼Œå†åŒæ ·åœ°æŒ‰ FCFS åŸåˆ™ç­‰å¾…è°ƒåº¦æ‰§è¡Œï¼›å¦‚æœå®ƒåœ¨ç¬¬äºŒé˜Ÿåˆ—ä¸­è¿è¡Œä¸€ä¸ªæ—¶é—´ç‰‡åä»æœªå®Œæˆï¼Œå†ä¾æ¬¡å°†å®ƒæ”¾å…¥ç¬¬ä¸‰é˜Ÿåˆ—ï¼Œâ€¦â€¦ï¼Œå¦‚æ­¤ä¸‹å»ï¼Œå½“ä¸€ä¸ªé•¿ä½œä¸š(è¿›ç¨‹)ä»ç¬¬ä¸€é˜Ÿåˆ—ä¾æ¬¡é™åˆ°ç¬¬ n é˜Ÿåˆ—åï¼Œåœ¨ç¬¬ n é˜Ÿåˆ—ä¾¿é‡‡å–æŒ‰æ—¶é—´ç‰‡è½®è½¬çš„æ–¹å¼è¿è¡Œã€‚<br>
(3) ä»…å½“ç¬¬ä¸€é˜Ÿåˆ—ç©ºé—²æ—¶ï¼Œè°ƒåº¦ç¨‹åºæ‰è°ƒåº¦ç¬¬äºŒé˜Ÿåˆ—ä¸­çš„è¿›ç¨‹è¿è¡Œï¼›ä»…å½“ç¬¬ 1ï½(i-1)é˜Ÿåˆ—å‡ç©ºæ—¶ï¼Œæ‰ä¼šè°ƒåº¦ç¬¬ i é˜Ÿåˆ—ä¸­çš„è¿›ç¨‹è¿è¡Œã€‚å¦‚æœå¤„ç†æœºæ­£åœ¨ç¬¬ i é˜Ÿåˆ—ä¸­ä¸ºæŸè¿›ç¨‹æœåŠ¡æ—¶ï¼Œåˆæœ‰æ–°è¿›ç¨‹è¿›å…¥ä¼˜å…ˆæƒè¾ƒé«˜çš„é˜Ÿåˆ—(ç¬¬ 1ï½(i-1)ä¸­çš„ä»»ä½•ä¸€ä¸ªé˜Ÿåˆ—)ï¼Œåˆ™æ­¤æ—¶æ–°è¿›ç¨‹å°†æŠ¢å æ­£åœ¨è¿è¡Œè¿›ç¨‹çš„å¤„ç†æœºï¼Œå³ç”±è°ƒåº¦ç¨‹åºæŠŠæ­£åœ¨è¿è¡Œçš„è¿›ç¨‹æ”¾å›åˆ°ç¬¬ i é˜Ÿåˆ—çš„æœ«å°¾ï¼ŒæŠŠå¤„ç†æœºåˆ†é…ç»™æ–°åˆ°çš„é«˜ä¼˜å…ˆæƒè¿›ç¨‹ã€‚ åœ¨å¤šçº§åé¦ˆé˜Ÿåˆ—è°ƒåº¦ç®—æ³•ä¸­ï¼Œå¦‚æœè§„å®šç¬¬ä¸€ä¸ªé˜Ÿåˆ—çš„æ—¶é—´ç‰‡ç•¥å¤§äºå¤šæ•°äººæœºäº¤äº’æ‰€éœ€ä¹‹å¤„ç†æ—¶é—´æ—¶ï¼Œä¾¿èƒ½å¤Ÿè¾ƒå¥½çš„æ»¡è¶³å„ç§ç±»å‹ç”¨æˆ·çš„éœ€è¦ã€‚</li>
</ol>
<h3 id="ä»€ä¹ˆæ˜¯casæ¯”è¾ƒå¹¶äº¤æ¢-ä¹è§‚é”æœºåˆ¶-é”è‡ªæ—‹">ä»€ä¹ˆæ˜¯CASï¼ˆæ¯”è¾ƒå¹¶äº¤æ¢-ä¹è§‚é”æœºåˆ¶-é”è‡ªæ—‹ï¼‰
</h3><h3 id="æ¦‚å¿µåŠç‰¹æ€§">æ¦‚å¿µåŠç‰¹æ€§
</h3><blockquote>
<p>CASï¼ˆCompare And Swap/Setï¼‰æ¯”è¾ƒå¹¶äº¤æ¢ï¼ŒCAS ç®—æ³•çš„è¿‡ç¨‹æ˜¯è¿™æ ·ï¼šå®ƒåŒ…å« 3 ä¸ªå‚æ•°CAS(V,E,N)ã€‚V è¡¨ç¤ºè¦æ›´æ–°çš„å˜é‡(å†…å­˜å€¼)ï¼ŒE è¡¨ç¤ºé¢„æœŸå€¼(æ—§çš„)ï¼ŒN è¡¨ç¤ºæ–°å€¼ã€‚å½“ä¸”ä»…å½“ V å€¼ç­‰äº E å€¼æ—¶ï¼Œæ‰ä¼šå°† V çš„å€¼è®¾ä¸º Nï¼Œå¦‚æœ V å€¼å’Œ E å€¼ä¸åŒï¼Œåˆ™è¯´æ˜å·²ç»æœ‰å…¶ä»–çº¿ç¨‹åšäº†æ›´æ–°ï¼Œåˆ™å½“å‰çº¿ç¨‹ä»€ä¹ˆéƒ½ä¸åšã€‚æœ€åï¼ŒCAS è¿”å›å½“å‰ V çš„çœŸå®å€¼ã€‚<br>
CAS æ“ä½œæ˜¯æŠ±ç€ä¹è§‚çš„æ€åº¦è¿›è¡Œçš„(ä¹è§‚é”)ï¼Œå®ƒæ€»æ˜¯è®¤ä¸ºè‡ªå·±å¯ä»¥æˆåŠŸå®Œæˆæ“ä½œã€‚å½“å¤šä¸ªçº¿ç¨‹åŒæ—¶ä½¿ç”¨ CAS æ“ä½œä¸€ä¸ªå˜é‡æ—¶ï¼Œåªæœ‰ä¸€ä¸ªä¼šèƒœå‡ºï¼Œå¹¶æˆåŠŸæ›´æ–°ï¼Œå…¶ä½™å‡ä¼šå¤±è´¥ã€‚å¤±è´¥çš„çº¿ç¨‹ä¸ä¼šè¢«æŒ‚èµ·ï¼Œä»…æ˜¯è¢«å‘ŠçŸ¥å¤±è´¥ï¼Œå¹¶ä¸”å…è®¸å†æ¬¡å°è¯•ï¼Œå½“ç„¶ä¹Ÿå…è®¸å¤±è´¥çš„çº¿ç¨‹æ”¾å¼ƒæ“ä½œã€‚åŸºäºè¿™æ ·çš„åŸç†ï¼ŒCAS æ“ä½œå³ä½¿æ²¡æœ‰é”ï¼Œä¹Ÿå¯ä»¥å‘ç°å…¶ä»–çº¿ç¨‹å¯¹å½“å‰çº¿ç¨‹çš„å¹²æ‰°ï¼Œå¹¶è¿›è¡Œæ°å½“çš„å¤„ç†ã€‚</p>
</blockquote>
<h3 id="åŸå­åŒ…javautilconcurrentatomicé”è‡ªæ—‹">åŸå­åŒ…java.util.concurrent.atomicï¼ˆé”è‡ªæ—‹ï¼‰
</h3><blockquote>
<p>JDK1.5 çš„åŸå­åŒ…ï¼šjava.util.concurrent.atomic è¿™ä¸ªåŒ…é‡Œé¢æä¾›äº†ä¸€ç»„åŸå­ç±»ã€‚å…¶åŸºæœ¬çš„ç‰¹æ€§å°±æ˜¯åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œå½“æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œè¿™äº›ç±»çš„å®ä¾‹åŒ…å«çš„æ–¹æ³•æ—¶ï¼Œå…·æœ‰æ’ä»–æ€§ï¼Œå³å½“æŸä¸ªçº¿ç¨‹è¿›å…¥æ–¹æ³•ï¼Œæ‰§è¡Œå…¶ä¸­çš„æŒ‡ä»¤æ—¶ï¼Œä¸ä¼šè¢«å…¶ä»–çº¿ç¨‹æ‰“æ–­ï¼Œè€Œåˆ«çš„çº¿ç¨‹å°±åƒè‡ªæ—‹é”ä¸€æ ·ï¼Œä¸€ç›´ç­‰åˆ°è¯¥æ–¹æ³•æ‰§è¡Œå®Œæˆï¼Œæ‰ç”± JVM ä»ç­‰å¾…é˜Ÿåˆ—ä¸­é€‰æ‹©ä¸€ä¸ªå¦ä¸€ä¸ªçº¿ç¨‹è¿›å…¥ï¼Œè¿™åªæ˜¯ä¸€ç§é€»è¾‘ä¸Šçš„ç†è§£ã€‚ç›¸å¯¹äºå¯¹äº synchronized è¿™ç§é˜»å¡ç®—æ³•ï¼ŒCAS æ˜¯éé˜»å¡ç®—æ³•çš„ä¸€ç§å¸¸è§å®ç°ã€‚ç”±äºä¸€èˆ¬ CPU åˆ‡æ¢æ—¶é—´æ¯” CPU æŒ‡ä»¤é›†æ“ä½œæ›´åŠ é•¿ï¼Œ æ‰€ä»¥ J.U.C åœ¨æ€§èƒ½ä¸Šæœ‰äº†å¾ˆå¤§çš„æå‡ã€‚å¦‚ä¸‹ä»£ç ï¼š</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">AtomicInteger</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">Number</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">java</span><span class="p">.</span><span class="na">io</span><span class="p">.</span><span class="na">Serializable</span><span class="w"> </span><span class="p">{</span><span class="w">   
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">volatile</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">value</span><span class="p">;</span><span class="w">   
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">get</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">   
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">value</span><span class="p">;</span><span class="w">   
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">   
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">getAndIncrement</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">   
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(;;)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">//CAS è‡ªæ—‹ï¼Œä¸€ç›´å°è¯•ï¼Œç›´è¾¾æˆåŠŸ  </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">current</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get</span><span class="p">();</span><span class="w">   
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">next</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">current</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">1</span><span class="p">;</span><span class="w">   
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">compareAndSet</span><span class="p">(</span><span class="n">current</span><span class="p">,</span><span class="w"> </span><span class="n">next</span><span class="p">))</span><span class="w">   
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">current</span><span class="p">;</span><span class="w">   
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">   
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">   
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">compareAndSet</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">expect</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">update</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">   
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">unsafe</span><span class="p">.</span><span class="na">compareAndSwapInt</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">valueOffset</span><span class="p">,</span><span class="w"> </span><span class="n">expect</span><span class="p">,</span><span class="w"> </span><span class="n">update</span><span class="p">);</span><span class="w">   
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">   
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>getAndIncrement é‡‡ç”¨äº† CAS æ“ä½œï¼Œæ¯æ¬¡ä»å†…å­˜ä¸­è¯»å–æ•°æ®ç„¶åå°†æ­¤æ•°æ®å’Œ+1 åçš„ç»“æœè¿›è¡ŒCAS æ“ä½œï¼Œå¦‚æœæˆåŠŸå°±è¿”å›ç»“æœï¼Œå¦åˆ™é‡è¯•ç›´åˆ°æˆåŠŸä¸ºæ­¢ã€‚è€Œ compareAndSet åˆ©ç”¨ JNI æ¥å®ŒæˆCPU æŒ‡ä»¤çš„æ“ä½œã€‚</p>
</blockquote>
<h3 id="abaé—®é¢˜">ABAé—®é¢˜
</h3><blockquote>
<p>CAS ä¼šå¯¼è‡´ABA é—®é¢˜ã€‚CAS ç®—æ³•å®ç°ä¸€ä¸ªé‡è¦å‰æéœ€è¦å–å‡ºå†…å­˜ä¸­æŸæ—¶åˆ»çš„æ•°æ®ï¼Œè€Œåœ¨ä¸‹æ—¶åˆ»æ¯”è¾ƒå¹¶æ›¿æ¢ï¼Œé‚£ä¹ˆåœ¨è¿™ä¸ªæ—¶é—´å·®ç±»ä¼šå¯¼è‡´æ•°æ®çš„å˜åŒ–ã€‚<br>
æ¯”å¦‚è¯´ä¸€ä¸ªçº¿ç¨‹ one ä»å†…å­˜ä½ç½® V ä¸­å–å‡º Aï¼Œè¿™æ—¶å€™å¦ä¸€ä¸ªçº¿ç¨‹ two ä¹Ÿä»å†…å­˜ä¸­å–å‡º Aï¼Œå¹¶ä¸”two è¿›è¡Œäº†ä¸€äº›æ“ä½œå˜æˆäº† Bï¼Œç„¶å two åˆå°† V ä½ç½®çš„æ•°æ®å˜æˆ Aï¼Œè¿™æ—¶å€™çº¿ç¨‹ one è¿›è¡Œ CAS æ“ä½œå‘ç°å†…å­˜ä¸­ä»ç„¶æ˜¯ Aï¼Œç„¶å one æ“ä½œæˆåŠŸã€‚å°½ç®¡çº¿ç¨‹ one çš„ CAS æ“ä½œæˆåŠŸï¼Œä½†æ˜¯ä¸ä»£è¡¨è¿™ä¸ªè¿‡ç¨‹å°±æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚<br>
éƒ¨åˆ†ä¹è§‚é”çš„å®ç°æ˜¯é€šè¿‡ç‰ˆæœ¬å·ï¼ˆversionï¼‰çš„æ–¹å¼æ¥è§£å†³ ABA é—®é¢˜ï¼Œä¹è§‚é”æ¯æ¬¡åœ¨æ‰§è¡Œæ•°æ®çš„ä¿®æ”¹æ“ä½œæ—¶ï¼Œéƒ½ä¼šå¸¦ä¸Šä¸€ä¸ªç‰ˆæœ¬å·ï¼Œä¸€æ—¦ç‰ˆæœ¬å·å’Œæ•°æ®çš„ç‰ˆæœ¬å·ä¸€è‡´å°±å¯ä»¥æ‰§è¡Œä¿®æ”¹æ“ä½œå¹¶å¯¹ç‰ˆæœ¬å·æ‰§è¡Œ+1 æ“ä½œï¼Œå¦åˆ™å°±æ‰§è¡Œå¤±è´¥ã€‚å› ä¸ºæ¯æ¬¡æ“ä½œçš„ç‰ˆæœ¬å·éƒ½ä¼šéšä¹‹å¢åŠ ï¼Œæ‰€ä»¥ä¸ä¼šå‡ºç° ABA é—®é¢˜ï¼Œå› ä¸ºç‰ˆæœ¬å·åªä¼šå¢åŠ ä¸ä¼šå‡å°‘ã€‚</p>
</blockquote>
<h3 id="ä»€ä¹ˆæ˜¯aqsæŠ½è±¡çš„é˜Ÿåˆ—åŒæ­¥å™¨">ä»€ä¹ˆæ˜¯AQSï¼ˆæŠ½è±¡çš„é˜Ÿåˆ—åŒæ­¥å™¨ï¼‰
</h3><blockquote>
<p>AbstractQueuedSynchronizer ç±»å¦‚å…¶åï¼ŒæŠ½è±¡çš„é˜Ÿåˆ—å¼çš„åŒæ­¥å™¨ï¼ŒAQS å®šä¹‰äº†ä¸€å¥—å¤šçº¿ç¨‹è®¿é—®å…±äº«èµ„æºçš„åŒæ­¥å™¨æ¡†æ¶ï¼Œè®¸å¤šåŒæ­¥ç±»å®ç°éƒ½ä¾èµ–äºå®ƒï¼Œå¦‚å¸¸ç”¨çš„ReentrantLock/Semaphore/CountDownLatchã€‚<br>
å®ƒç»´æŠ¤äº†ä¸€ä¸ª volatile int stateï¼ˆä»£è¡¨å…±äº«èµ„æºï¼‰å’Œä¸€ä¸ª FIFO çº¿ç¨‹ç­‰å¾…é˜Ÿåˆ—ï¼ˆå¤šçº¿ç¨‹äº‰ç”¨èµ„æºè¢«é˜»å¡æ—¶ä¼šè¿›å…¥æ­¤é˜Ÿåˆ—ï¼‰ã€‚è¿™é‡Œ volatile æ˜¯æ ¸å¿ƒå…³é”®è¯ï¼Œå…·ä½“ volatile çš„è¯­ä¹‰ï¼Œåœ¨æ­¤ä¸è¿°ã€‚state çš„è®¿é—®æ–¹å¼æœ‰ä¸‰ç§:</p>
</blockquote>
<ol>
<li>getState()</li>
<li>setState()</li>
<li>compareAndSetState()</li>
</ol>
<blockquote>
<p><code>AQS å®šä¹‰ä¸¤ç§èµ„æºå…±äº«æ–¹å¼</code><br>
Exclusive ç‹¬å èµ„æº-ReentrantLock<br>
<code>Exclusiveï¼ˆç‹¬å ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½æ‰§è¡Œï¼Œå¦‚ ReentrantLockï¼‰</code><br>
Share å…±äº«èµ„æº-Semaphore/CountDownLat<br>
Shareï¼ˆå…±äº«ï¼Œå¤šä¸ªçº¿ç¨‹å¯åŒæ—¶æ‰§è¡Œï¼Œå¦‚ Semaphore/CountDownLatchï¼‰ã€‚<br>
AQS åªæ˜¯ä¸€ä¸ªæ¡†æ¶ï¼Œå…·ä½“èµ„æºçš„è·å–/é‡Šæ”¾æ–¹å¼äº¤ç”±è‡ªå®šä¹‰åŒæ­¥å™¨å»å®ç°ï¼ŒAQS è¿™é‡Œåªå®šä¹‰äº†ä¸€ä¸ªæ¥å£ï¼Œå…·ä½“èµ„æºçš„è·å–äº¤ç”±è‡ªå®šä¹‰åŒæ­¥å™¨å»å®ç°äº†ï¼ˆé€šè¿‡ state çš„ get/set/CAS)ä¹‹æ‰€ä»¥æ²¡æœ‰å®šä¹‰æˆabstract ï¼Œæ˜¯ å›  ä¸ºç‹¬ å æ¨¡ å¼ ä¸‹ åª ç”¨å®ç° tryAcquire-tryRelease ï¼Œè€Œ å…±äº« æ¨¡ å¼ ä¸‹ åªç”¨ å® ç°tryAcquireShared-tryReleaseSharedã€‚å¦‚æœéƒ½å®šä¹‰æˆabstractï¼Œé‚£ä¹ˆæ¯ä¸ªæ¨¡å¼ä¹Ÿè¦å»å®ç°å¦ä¸€æ¨¡å¼ä¸‹çš„æ¥å£ã€‚ä¸åŒçš„è‡ªå®šä¹‰åŒæ­¥å™¨äº‰ç”¨å…±äº«èµ„æºçš„æ–¹å¼ä¹Ÿä¸åŒã€‚è‡ªå®šä¹‰åŒæ­¥å™¨åœ¨å®ç°æ—¶åªéœ€è¦å®ç°å…±äº«èµ„æº state çš„è·å–ä¸é‡Šæ”¾æ–¹å¼å³å¯ï¼Œè‡³äºå…·ä½“çº¿ç¨‹ç­‰å¾…é˜Ÿåˆ—çš„ç»´æŠ¤ï¼ˆå¦‚è·å–èµ„æºå¤±è´¥å…¥é˜Ÿ/å”¤é†’å‡ºé˜Ÿç­‰ï¼‰ï¼ŒAQS å·²ç»åœ¨é¡¶å±‚å®ç°å¥½äº†ã€‚è‡ªå®šä¹‰åŒæ­¥å™¨å®ç°æ—¶ä¸»è¦å®ç°ä»¥ä¸‹å‡ ç§æ–¹æ³•ï¼š</p>
</blockquote>
<ol>
<li>isHeldExclusively()ï¼šè¯¥çº¿ç¨‹æ˜¯å¦æ­£åœ¨ç‹¬å èµ„æºã€‚åªæœ‰ç”¨åˆ° condition æ‰éœ€è¦å»å®ç°å®ƒã€‚</li>
<li>tryAcquire(int)ï¼šç‹¬å æ–¹å¼ã€‚å°è¯•è·å–èµ„æºï¼ŒæˆåŠŸåˆ™è¿”å› trueï¼Œå¤±è´¥åˆ™è¿”å› falseã€‚</li>
<li>tryRelease(int)ï¼šç‹¬å æ–¹å¼ã€‚å°è¯•é‡Šæ”¾èµ„æºï¼ŒæˆåŠŸåˆ™è¿”å› trueï¼Œå¤±è´¥åˆ™è¿”å› falseã€‚</li>
<li>tryAcquireShared(int)ï¼šå…±äº«æ–¹å¼ã€‚å°è¯•è·å–èµ„æºã€‚è´Ÿæ•°è¡¨ç¤ºå¤±è´¥ï¼›0 è¡¨ç¤ºæˆåŠŸï¼Œä½†æ²¡æœ‰å‰©ä½™å¯ç”¨èµ„æºï¼›æ­£æ•°è¡¨ç¤ºæˆåŠŸï¼Œä¸”æœ‰å‰©ä½™èµ„æºã€‚</li>
<li>tryReleaseShared(int)ï¼šå…±äº«æ–¹å¼ã€‚å°è¯•é‡Šæ”¾èµ„æºï¼Œå¦‚æœé‡Šæ”¾åå…è®¸å”¤é†’åç»­ç­‰å¾…ç»“ç‚¹è¿”å›trueï¼Œå¦åˆ™è¿”å› false</li>
</ol>
<blockquote>
<p><code>åŒæ­¥å™¨çš„å®ç°æ˜¯ ABS æ ¸å¿ƒï¼ˆstate èµ„æºçŠ¶æ€è®¡æ•°ï¼‰</code><br>
åŒæ­¥å™¨çš„å®ç°æ˜¯ ABS æ ¸å¿ƒï¼Œä»¥ ReentrantLock ä¸ºä¾‹ï¼Œstate åˆå§‹åŒ–ä¸º 0ï¼Œè¡¨ç¤ºæœªé”å®šçŠ¶æ€ã€‚A çº¿ç¨‹lock()æ—¶ï¼Œä¼šè°ƒç”¨ tryAcquire()ç‹¬å è¯¥é”å¹¶å°† state+1ã€‚æ­¤åï¼Œå…¶ä»–çº¿ç¨‹å† tryAcquire()æ—¶å°±ä¼šå¤±è´¥ï¼Œç›´åˆ° A çº¿ç¨‹ unlock()åˆ° state=0ï¼ˆå³é‡Šæ”¾é”ï¼‰ä¸ºæ­¢ï¼Œå…¶å®ƒçº¿ç¨‹æ‰æœ‰æœºä¼šè·å–è¯¥é”ã€‚å½“ç„¶ï¼Œé‡Šæ”¾é”ä¹‹å‰ï¼ŒA çº¿ç¨‹è‡ªå·±æ˜¯å¯ä»¥é‡å¤è·å–æ­¤é”çš„ï¼ˆstate ä¼šç´¯åŠ ï¼‰ï¼Œè¿™å°±æ˜¯å¯é‡å…¥çš„æ¦‚å¿µã€‚ä½†è¦æ³¨æ„ï¼Œè·å–å¤šå°‘æ¬¡å°±è¦é‡Šæ”¾å¤šä¹ˆæ¬¡ï¼Œè¿™æ ·æ‰èƒ½ä¿è¯ state æ˜¯èƒ½å›åˆ°é›¶æ€çš„ã€‚<br>
ä»¥ CountDownLatch ä»¥ä¾‹ï¼Œä»»åŠ¡åˆ†ä¸º N ä¸ªå­çº¿ç¨‹å»æ‰§è¡Œï¼Œstate ä¹Ÿåˆå§‹åŒ–ä¸º Nï¼ˆæ³¨æ„ N è¦ä¸çº¿ç¨‹ä¸ªæ•°ä¸€è‡´ï¼‰ã€‚è¿™ N ä¸ªå­çº¿ç¨‹æ˜¯å¹¶è¡Œæ‰§è¡Œçš„ï¼Œæ¯ä¸ªå­çº¿ç¨‹æ‰§è¡Œå®Œå countDown()ä¸€æ¬¡ï¼Œstateä¼š CAS å‡ 1ã€‚ç­‰åˆ°æ‰€æœ‰å­çº¿ç¨‹éƒ½æ‰§è¡Œå®Œå(å³ state=0)ï¼Œä¼š unpark()ä¸»è°ƒç”¨çº¿ç¨‹ï¼Œç„¶åä¸»è°ƒç”¨çº¿ç¨‹å°±ä¼šä» await()å‡½æ•°è¿”å›ï¼Œç»§ç»­åä½™åŠ¨ä½œã€‚
<code>ReentrantReadWriteLock å®ç°ç‹¬å å’Œå…±äº«ä¸¤ç§æ–¹å¼</code><br>
ä¸€èˆ¬æ¥è¯´ï¼Œè‡ªå®šä¹‰åŒæ­¥å™¨è¦ä¹ˆæ˜¯ç‹¬å æ–¹æ³•ï¼Œè¦ä¹ˆæ˜¯å…±äº«æ–¹å¼ï¼Œä»–ä»¬ä¹Ÿåªéœ€å®ç° tryAcquired-tryReleaseã€tryAcquireShared-tryReleaseShared ä¸­çš„ä¸€ç§å³å¯ã€‚ä½† AQS ä¹Ÿæ”¯æŒè‡ªå®šä¹‰åŒæ­¥å™¨åŒæ—¶å®ç°ç‹¬å å’Œå…±äº«ä¸¤ç§æ–¹å¼ï¼Œå¦‚ ReentrantReadWriteLockã€‚</p>
</blockquote>

</section>


    <footer class="article-footer">
    

    </footer>


    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">ç›¸å…³æ–‡ç« </h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="has-image">
    <a href="/p/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/">
        
        
            <div class="article-image">
                <img src="/p/%E8%B0%B7%E7%B2%92%E5%95%86%E5%9F%8E/pawel-czerwinski-8uZPynIu-rQ-unsplash_hu5155801371712385131.jpg" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post è°·ç²’å•†åŸ"
                        data-key="è°·ç²’å•†åŸ" 
                        data-hash="md5-g&#43;Jrgc4Z5tPs5P2ZfECbfQ==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">è°·ç²’å•†åŸ</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/server.port%E5%90%AF%E5%8A%A8%E7%AB%AF%E5%8F%A3%E4%B8%8D%E7%94%9F%E6%95%88/">
        
        
            <div class="article-image">
                <img src="/p/server.port%E5%90%AF%E5%8A%A8%E7%AB%AF%E5%8F%A3%E4%B8%8D%E7%94%9F%E6%95%88/202412212133331.17160ff775d0c4cdc8a3406cfa05a128_hu5648387431953040294.png" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post server.portå¯åŠ¨ç«¯å£ä¸ç”Ÿæ•ˆ"
                        data-key="server.portå¯åŠ¨ç«¯å£ä¸ç”Ÿæ•ˆ" 
                        data-hash="md5-FxYP93XQxM3Io0Bs&#43;gWhKA==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">server.portå¯åŠ¨ç«¯å£ä¸ç”Ÿæ•ˆ</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/map%E4%B8%8E%E5%AE%9E%E4%BD%93%E8%BD%AC%E6%8D%A2/">
        
        
            <div class="article-image">
                <img src="/p/map%E4%B8%8E%E5%AE%9E%E4%BD%93%E8%BD%AC%E6%8D%A2/202412212036798.6239d0d98413049b6c55a34b456087b1_hu16519776400703086887.png" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post Mapä¸å®ä½“è½¬æ¢"
                        data-key="Mapä¸å®ä½“è½¬æ¢" 
                        data-hash="md5-YjnQ2YQTBJtsVaNLRWCHsQ==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">Mapä¸å®ä½“è½¬æ¢</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/povodaobodtopojo/">
        
        
            <div class="article-image">
                <img src="/p/povodaobodtopojo/202412212036798.6239d0d98413049b6c55a34b456087b1_hu16519776400703086887.png" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post POã€VOã€DAOã€BOã€DTOã€POJO"
                        data-key="POã€VOã€DAOã€BOã€DTOã€POJO" 
                        data-hash="md5-YjnQ2YQTBJtsVaNLRWCHsQ==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">POã€VOã€DAOã€BOã€DTOã€POJO</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/thymeleaf/">
        
        
            <div class="article-image">
                <img src="/p/thymeleaf/202412211939238.ac4b28233b675f2a3353e7252f6f31af_hu2731044164903080209.png" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post Thymeleaf"
                        data-key="Thymeleaf" 
                        data-hash="md5-rEsoIztnXyozU&#43;clL28xrw==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">Thymeleaf</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2020 - 
        
        2024 æ·±æµ·ç«é”…åº—
    </section>
    
    <section class="powerby">
        ä½¿ç”¨ <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> æ„å»º <br />
        ä¸»é¢˜ <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.29.0">Stack</a></b> ç”± <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> è®¾è®¡
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
