<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="Kubernetes_1">
<title>Kubernetes_1</title>

<link rel='canonical' href='https://IsUnderAchiever.github.io/p/kubernetes_1/'>

<link rel="stylesheet" href="/scss/style.min.b85f3de2f132c41bcf65396d29447bd98774c1cff192b74d7f75bc7b72545eb8.css"><meta property='og:title' content="Kubernetes_1">
<meta property='og:description' content="Kubernetes_1">
<meta property='og:url' content='https://IsUnderAchiever.github.io/p/kubernetes_1/'>
<meta property='og:site_name' content='Ê∑±Êµ∑ÁÅ´ÈîÖÂ∫ó'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:published_time' content='2024-12-24T00:00:00&#43;00:00'/><meta property='article:modified_time' content='2024-12-24T00:00:00&#43;00:00'/><meta property='og:image' content='https://IsUnderAchiever.github.io/p/kubernetes_1/202412242125601.png' />
<meta name="twitter:title" content="Kubernetes_1">
<meta name="twitter:description" content="Kubernetes_1"><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='https://IsUnderAchiever.github.io/p/kubernetes_1/202412242125601.png' />
    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="ÂàáÊç¢ËèúÂçï">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/header_hu16240087013746809388.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">üòÅ</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">Ê∑±Êµ∑ÁÅ´ÈîÖÂ∫ó</a></h1>
            <h2 class="site-description">ËÆ∞ÂΩïÊàëÁöÑÊàêÈïøÂè≤</h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://space.bilibili.com/477448861'
                        target="_blank"
                        title="Bilibili"
                        rel="me"
                    >
                        
                        
                            <?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg t="1734756297204" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4471" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><path d="M685.21 117.15c6.63-9.41 21.12-11.52 30.21-4.47 9.06 6.34 11.49 19.96 5.35 29.12-35.44 51.91-70.81 103.88-106.31 155.76-0.63 1.02-1.16 2.09-1.7 3.16 86.41 0.03 172.82 0.01 259.22 0.02 10.3-0.39 19.61 8.97 19.11 19.28 0.08 172.65 0.18 345.31 0.23 517.97 0.29 9.97-8.32 19.2-18.33 19.35-21.78 0.24-43.56-0.17-65.32 0.19-1.96 17.65-9.87 34.97-23.27 46.85-12.92 12-31.5 17.75-48.9 14.36-28.92-5.43-48.64-33.26-51.72-61.39-109.19 0.08-218.38 0.08-327.57 0-2.33 18.48-10.77 36.55-25.23 48.6-15.66 13.62-39.03 17.75-58.17 9.42-23.11-9.58-37.95-33.47-40.48-57.84-27.1-0.36-54.23 0.06-81.33-0.21-9.8-0.41-18.09-9.49-17.73-19.28 0.06-170.34 0.08-340.69 0.12-511.04 0.1-4.55-0.51-9.27 1.09-13.64 2.49-7.28 9.81-12.67 17.54-12.61 91.71-0.09 183.42 0.12 275.13-0.11-50.14-27.95-100.88-54.9-151.14-82.66-10.46-5.79-13.59-20.94-6.66-30.59 5.82-9.13 18.87-12.17 28.25-6.87 69.04 37.58 138.06 75.18 207.1 112.76 3.52 1.62 5.91 4.67 8.61 7.31 15.47 0.33 30.96 0.05 46.45 0.15 41.94-61.11 83.59-122.43 125.45-183.59M169.87 336.87c-0.09 161.25 0.16 322.48 0.35 483.72 228.11-0.17 456.22-0.07 684.33-0.05-0.02-161.22 0.22-322.46 0.07-483.68-228.25 0.01-456.5-0.02-684.75 0.01M271 857.38c2.22 11.33 10.44 23.52 23 24.07 12.45-0.26 21.53-12.56 22.95-24.07-15.32 0.05-30.64 0.02-45.95 0m452.05 0c1.42 11.5 10.51 23.79 22.95 24.07 12.54-0.55 20.85-12.71 22.99-24.06-15.31 0.01-30.63 0.04-45.94-0.01z" fill="#454545" p-id="4472"></path><path d="M221.28 374.37c3.83-0.94 7.81-0.61 11.72-0.65 188.33 0.01 376.65-0.01 564.98 0.01 10.85-0.43 20.67 9.41 20.08 20.27 0.14 123.33-0.02 246.66 0.16 369.99 0.13 8.3-5.4 16.35-13.29 19-4.14 1.52-8.61 1.18-12.93 1.19-188.67-0.04-377.35 0.06-566.02-0.04-12.39 0.23-21.58-12.32-19.69-24.15 0.06-122.01 0.04-244.03 0.11-366.04-0.24-8.92 6.15-17.52 14.88-19.58M243 410.18c-0.38 112.4 0.15 224.81 0.11 337.21 179.44 0.13 358.89 0.09 538.34 0.02 0.01-112.43 0.4-224.89-0.09-337.3-179.45 0.14-358.91-0.01-538.36 0.07z" fill="#454545" p-id="4473"></path><path d="M600.4 471.55c5.06-1.37 10.69-0.78 15.28 1.8 35.65 21.33 71.26 42.72 106.91 64.07 4.92 2.83 10.29 5.72 13.05 10.95 4.45 7.6 3.2 17.98-3.01 24.24-6.32 7.05-17.67 8.31-25.62 3.34-37.26-22.4-74.56-44.75-111.83-67.13-6.4-3.83-10.36-11.35-9.78-18.79 0.31-8.57 6.75-16.33 15-18.48zM405.42 481.48c8.67-1.08 17.67 4.03 21.1 12.09 4.57 9.77-0.18 22.57-10.12 26.85-33.02 15.3-66.04 30.58-99.07 45.84-9.66 4.53-22.34-0.1-26.68-9.87-4.95-9.45-0.72-22.17 8.73-26.97 30.72-14.34 61.56-28.44 92.31-42.72 4.46-1.98 8.79-4.61 13.73-5.22zM407.29 596.31c8.9-3.09 19.57 1.06 24.09 9.31 4.37 7.1 1.79 15.88 4.5 23.51 3.44 13.44 14.3 26.79 29.14 27.09 13.98 0.07 24.84-11.84 28.91-24.34 2.31-6.05 2.52-12.54 2.96-18.9 1.17-11.04 12.56-19.47 23.46-17.43 9.81 1.3 17.53 10.53 17.35 20.37-0.08 15.28 7.21 32.12 21.92 38.44 8.4 3.65 18.6 1.7 25.5-4.2 10.37-8.44 15.16-22.11 15.17-35.21 0.14-10.37 9.36-19.53 19.73-19.62 10.15-0.64 19.85 7.53 21.03 17.62 2.16 35.45-20.4 73.22-55.9 82.28-24.72 6.92-51.53-3.48-68.08-22.38-10.45 11.74-24.48 20.62-40.07 23.39-17.51 3.32-36.18-1.22-50.48-11.76-21.88-15.69-33.94-42.91-33.43-69.55 0.28-8.35 6.19-16.17 14.2-18.62z" fill="#454545" p-id="4474"></path></svg>
                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://github.com/IsUnderAchiever'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>‰∏ªÈ°µ</span>
            </a>
        </li>
        
        
        <li >
            <a href='/%E5%85%B3%E4%BA%8E/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>ÂÖ≥‰∫é</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>ÂΩíÊ°£</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>ÊêúÁ¥¢</span>
            </a>
        </li>
        
        
        <li >
            <a href='/%E9%93%BE%E6%8E%A5/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>ÈìæÊé•</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">
                    
                        <li id="i18n-switch">  
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M4 5h7" />
  <path d="M9 3v2c0 4.418 -2.239 8 -5 8" />
  <path d="M5 9c-.003 2.144 2.952 3.908 6.7 4" />
  <path d="M12 20l4 -9l4 9" />
  <path d="M19.1 18h-6.2" />
</svg>



                            <select name="language" title="language" onchange="window.location.href = this.selectedOptions[0].value">
                                
                                    <option value="https://IsUnderAchiever.github.io/en/" >English</option>
                                
                                    <option value="https://IsUnderAchiever.github.io/" selected>‰∏≠Êñá</option>
                                
                            </select>
                        </li>
                    
                

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>ÊöóËâ≤Ê®°Âºè</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">ÁõÆÂΩï</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#Ê†∏ÂøÉÊ¶ÇÂøµ">Ê†∏ÂøÉÊ¶ÇÂøµ</a>
      <ol>
        <li><a href="#‰ªÄ‰πàÊòØ-kubernetes">‰ªÄ‰πàÊòØ Kubernetes</a></li>
        <li><a href="#‰∏∫‰ªÄ‰πàÈúÄË¶Å-kubernetes">‰∏∫‰ªÄ‰πàÈúÄË¶Å Kubernetes</a>
          <ol>
            <li><a href="#Â∫îÁî®ÈÉ®ÁΩ≤ÁöÑ‰∏âÂ§ßÈò∂ÊÆµ">Â∫îÁî®ÈÉ®ÁΩ≤ÁöÑ‰∏âÂ§ßÈò∂ÊÆµ</a></li>
            <li><a href="#k8s-ÁöÑÁâπÁÇπ">k8s ÁöÑÁâπÁÇπ</a></li>
          </ol>
        </li>
        <li><a href="#‰ºÅ‰∏öÁ∫ßÂÆπÂô®Ë∞ÉÂ∫¶Âπ≥Âè∞">‰ºÅ‰∏öÁ∫ßÂÆπÂô®Ë∞ÉÂ∫¶Âπ≥Âè∞</a></li>
        <li><a href="#ÈõÜÁæ§Êû∂ÊûÑ‰∏éÁªÑ‰ª∂">ÈõÜÁæ§Êû∂ÊûÑ‰∏éÁªÑ‰ª∂</a>
          <ol>
            <li><a href="#Áõ∏ÂÖ≥ÁªÑ‰ª∂">Áõ∏ÂÖ≥ÁªÑ‰ª∂</a></li>
            <li><a href="#ÂàÜÂ±ÇÊû∂ÊûÑ">ÂàÜÂ±ÇÊû∂ÊûÑ</a></li>
          </ol>
        </li>
        <li><a href="#Ê†∏ÂøÉÊ¶ÇÂøµ‰∏é‰∏ì‰∏öÊúØËØ≠">Ê†∏ÂøÉÊ¶ÇÂøµ‰∏é‰∏ì‰∏öÊúØËØ≠</a>
          <ol>
            <li><a href="#ÊúçÂä°ÁöÑÂàÜÁ±ª">ÊúçÂä°ÁöÑÂàÜÁ±ª</a></li>
            <li><a href="#ËµÑÊ∫êÂíåÂØπË±°">ËµÑÊ∫êÂíåÂØπË±°</a></li>
            <li><a href="#ÂØπË±°ËßÑÁ∫¶ÂíåÁä∂ÊÄÅ">ÂØπË±°ËßÑÁ∫¶ÂíåÁä∂ÊÄÅ</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#k8s-ÂÆûÊàòËøõÈò∂">K8S ÂÆûÊàòËøõÈò∂</a>
      <ol>
        <li><a href="#Êê≠Âª∫-kubernetes-ÈõÜÁæ§">Êê≠Âª∫ Kubernetes ÈõÜÁæ§</a>
          <ol>
            <li><a href="#Êê≠Âª∫ÊñπÊ°à">Êê≠Âª∫ÊñπÊ°à</a></li>
            <li><a href="#ÂëΩ‰ª§Ë°åÂ∑•ÂÖ∑-kubectl">ÂëΩ‰ª§Ë°åÂ∑•ÂÖ∑ kubectl</a></li>
            <li><a href="#ËµÑÊ∫êÁ±ªÂûã‰∏éÂà´Âêç">ËµÑÊ∫êÁ±ªÂûã‰∏éÂà´Âêç</a></li>
            <li><a href="#Ê†ºÂºèÂåñËæìÂá∫">Ê†ºÂºèÂåñËæìÂá∫</a></li>
            <li><a href="#api-Ê¶ÇËø∞">API Ê¶ÇËø∞</a></li>
          </ol>
        </li>
        <li><a href="#Ê∑±ÂÖ•-pod">Ê∑±ÂÖ• Pod</a>
          <ol>
            <li><a href="#pod-ÈÖçÁΩÆÊñá‰ª∂">Pod ÈÖçÁΩÆÊñá‰ª∂</a></li>
            <li><a href="#Êé¢Èíà">Êé¢Èíà</a></li>
            <li><a href="#ÁîüÂëΩÂë®Êúü">ÁîüÂëΩÂë®Êúü</a></li>
          </ol>
        </li>
        <li><a href="#ËµÑÊ∫êË∞ÉÂ∫¶">ËµÑÊ∫êË∞ÉÂ∫¶</a>
          <ol>
            <li><a href="#label-Âíå-selector">Label Âíå Selector</a></li>
            <li><a href="#deployment">Deployment</a></li>
            <li><a href="#statefulset-1">StatefulSet</a></li>
            <li><a href="#daemonset">DaemonSet</a></li>
            <li><a href="#hpa-Ëá™Âä®Êâ©Áº©ÂÆπ">HPA Ëá™Âä®Êâ©/Áº©ÂÆπ</a></li>
          </ol>
        </li>
      </ol>
    </li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="has-image main-article">
    <header class="article-header">
    <div class="article-image">
        <a href="/p/kubernetes_1/">
            <img src="/p/kubernetes_1/202412242125601_hu6944413584555012341.png" srcset="/p/kubernetes_1/202412242125601_hu6944413584555012341.png 800w, /p/kubernetes_1/202412242125601_hu13128054618936277471.png 1600w"  width="800"
                height="388" loading="lazy" alt="Featured image of post Kubernetes_1" />
            
        </a>
    </div>
    

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/kubernetes_1/" >
                Kubernetes_1
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/kubernetes_1/">Kubernetes_1</a>
        </h2>
    
        
        <h3 class="article-subtitle">
            Kubernetes_1
        </h3>
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">2024-12-24</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    ÈòÖËØªÊó∂Èïø: 63 ÂàÜÈíü
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
<script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>


    <section class="article-content">
    
    
    <h1 id="kubernetes_1">Kubernetes_1
</h1><h2 id="Ê†∏ÂøÉÊ¶ÇÂøµ">Ê†∏ÂøÉÊ¶ÇÂøµ
</h2><h3 id="‰ªÄ‰πàÊòØ-kubernetes">‰ªÄ‰πàÊòØ Kubernetes
</h3><p><strong>Kubernetes</strong> ÊòØ‰∏Ä‰∏™ÂºÄÊ∫êÁöÑÔºåÁî®‰∫éÁÆ°ÁêÜ‰∫ëÂπ≥Âè∞‰∏≠Â§ö‰∏™‰∏ªÊú∫‰∏äÁöÑÂÆπÂô®ÂåñÁöÑÂ∫îÁî®ÔºåKubernetes ÁöÑÁõÆÊ†áÊòØËÆ©ÈÉ®ÁΩ≤ÂÆπÂô®ÂåñÁöÑÂ∫îÁî®ÁÆÄÂçïÂπ∂‰∏îÈ´òÊïàÔºàpowerfulÔºâÔºåKubernetes Êèê‰æõ‰∫ÜÂ∫îÁî®ÈÉ®ÁΩ≤ÔºåËßÑÂàíÔºåÊõ¥Êñ∞ÔºåÁª¥Êä§ÁöÑ‰∏ÄÁßçÊú∫Âà∂„ÄÇ</p>
<p><strong>Kubernetes</strong> Ëøô‰∏™ÂêçÂ≠óÊ∫ê‰∫éÂ∏åËÖäËØ≠ÔºåÊÑè‰∏∫‚ÄúËàµÊâã‚ÄùÊàñ‚ÄúÈ£ûË°åÂëò‚Äù„ÄÇk8s Ëøô‰∏™Áº©ÂÜôÊòØÂõ†‰∏∫ k Âíå s ‰πãÈó¥ÊúâÂÖ´‰∏™Â≠óÁ¨¶ÁöÑÂÖ≥Á≥ª„ÄÇ Google Âú® 2014 Âπ¥ÂºÄÊ∫ê‰∫Ü Kubernetes È°πÁõÆ„ÄÇ Kubernetes Âª∫Á´ãÂú® <a class="link" href="https://research.google/pubs/pub43438"  target="_blank" rel="noopener" >Google Â§ßËßÑÊ®°ËøêË°åÁîü‰∫ßÂ∑•‰ΩúË¥üËΩΩÂçÅÂá†Âπ¥ÁªèÈ™å</a>ÁöÑÂü∫Á°Ä‰∏äÔºå ÁªìÂêà‰∫ÜÁ§æÂå∫‰∏≠ÊúÄ‰ºòÁßÄÁöÑÊÉ≥Ê≥ïÂíåÂÆûË∑µ„ÄÇ</p>
<h3 id="‰∏∫‰ªÄ‰πàÈúÄË¶Å-kubernetes">‰∏∫‰ªÄ‰πàÈúÄË¶Å Kubernetes
</h3><h4 id="Â∫îÁî®ÈÉ®ÁΩ≤ÁöÑ‰∏âÂ§ßÈò∂ÊÆµ">Â∫îÁî®ÈÉ®ÁΩ≤ÁöÑ‰∏âÂ§ßÈò∂ÊÆµ
</h4><ol>
<li>‰º†ÁªüÈÉ®ÁΩ≤
<ul>
<li>Á®ãÂ∫èÂëò/ËøêÁª¥Â∑•Á®ãÂ∏àÊâãÂä®Êìç‰ΩúÈÉ®ÁΩ≤Â∫îÁî®ÔºåÁõ¥Êé•Â∞ÜÂ∫îÁî®ÈÉ®ÁΩ≤Âú®ÁõÆÊ†áÊú∫Âô®‰∏äÔºåÁî±‰∫éËµÑÊ∫ê‰∏çÈöîÁ¶ªÔºåÂÆπÊòìÂá∫Áé∞ËµÑÊ∫ê‰∫âÊä¢„ÄÅ‰æùËµñÂÜ≤Á™ÅÁ≠âÂêÑÊñπÈù¢ÈóÆÈ¢ò„ÄÇ</li>
</ul>
</li>
<li>ËôöÊãüÂåñÈÉ®ÁΩ≤
<ul>
<li>Âà©Áî® OpenStask / VMware Á≠âËôöÊãüÂåñÊäÄÊúØÔºåÂ∞Ü‰∏ÄÂè∞ÁõÆÊ†áÊú∫Âô®ËôöÊãüÂåñ‰∏∫Â§ö‰∏™ËôöÊãüÊú∫Âô®ÔºåÊåâÁÖßÈúÄÊ±ÇÂ∞ÜÂ∫îÁî®ÈÉ®ÁΩ≤Âà∞‰∏çÂêåÁöÑËôöÊãüÊú∫‰∏≠ÔºåÂØπËôöÊãüÊú∫ËøõË°åÂä®ÊÄÅÁöÑÊ∞¥Âπ≥Êâ©ÂÆπÁ≠âÁÆ°ÁêÜÊìç‰Ωú„ÄÇ</li>
<li>Áõ∏ÂØπ‰º†ÁªüÈÉ®ÁΩ≤Ëá™Âä®Âåñ„ÄÅËµÑÊ∫êÈöîÁ¶ªÁöÑËÉΩÂäõÊèêÂçá‰∫ÜÔºåÂ∏¶Êù•ÁöÑÈóÆÈ¢òÊòØËôöÊãüÂåñÁöÑÈÄªËæëËøáÈáçÔºåÂØºËá¥ÊïàÁéá‰∏çÈ´òÔºå‰∏îËÄóË¥πËµÑÊ∫êËæÉÂ§ö„ÄÇ</li>
</ul>
</li>
<li>ÂÆπÂô®ÂåñÈÉ®ÁΩ≤
<ul>
<li>ÂèØ‰ª•ÁêÜËß£‰∏∫ËΩªÈáèÁ∫ßÁöÑËôöÊãüÂåñÔºåÂÆåÁæéÂº•Ë°•ËôöÊãüÂåñÊäÄÊúØËøáÈáçÁöÑÈóÆÈ¢òÔºå‰∏îÁî±‰∫éÁõ¥Êé•ÂÖ±‰∫´‰∏ªÊú∫Á°¨‰ª∂ËµÑÊ∫êÔºåÂè™ÊòØÈÄöËøáÁ≥ªÁªüÊèê‰æõÁöÑÂëΩÂêçÁ©∫Èó¥Á≠âÊäÄÊúØÂÆûÁé∞ËµÑÊ∫êÈöîÁ¶ªÔºåÊçüËÄóÊõ¥Â∞èÔºå‰∏îÊïàÁéáÊõ¥È´ò„ÄÇ</li>
</ul>
</li>
</ol>
<h4 id="k8s-ÁöÑÁâπÁÇπ">k8s ÁöÑÁâπÁÇπ
</h4><ol>
<li>Ëá™Êàë‰øÆÂ§ç</li>
<li>ÂºπÊÄß‰º∏Áº©</li>
<li>Ëá™Âä®ÈÉ®ÁΩ≤ÂíåÂõûÊªö</li>
<li>ÊúçÂä°ÂèëÁé∞ÂíåË¥üËΩΩÂùáË°°</li>
<li>Êú∫ÂØÜÂíåÈÖçÁΩÆÁÆ°ÁêÜ</li>
<li>Â≠òÂÇ®ÁºñÊéí</li>
<li>ÊâπÂ§ÑÁêÜ</li>
</ol>
<h3 id="‰ºÅ‰∏öÁ∫ßÂÆπÂô®Ë∞ÉÂ∫¶Âπ≥Âè∞">‰ºÅ‰∏öÁ∫ßÂÆπÂô®Ë∞ÉÂ∫¶Âπ≥Âè∞
</h3><ol>
<li>Apache Mesos
<ol>
<li>Âü∫Êú¨Ê¶ÇÂøµ
<ul>
<li>Mesos ÊòØ‰∏Ä‰∏™ÂàÜÂ∏ÉÂºèË∞ÉÂ∫¶Á≥ªÁªüÂÜÖÊ†∏ÔºåÊó©‰∫é Docker ‰∫ßÁîüÔºåMesos ‰Ωú‰∏∫ËµÑÊ∫êÁÆ°ÁêÜÂô®Ôºå‰ªé DC/OS (Êï∞ÊçÆ‰∏≠ÂøÉÊìç‰ΩúÁ≥ªÁªü)ÁöÑËßíÂ∫¶Êèê‰æõËµÑÊ∫êËßÜÂõæ„ÄÇ‰∏ª/‰ªéÁªìÊûÑÂ∑•‰ΩúÊ®°ÂºèÔºå‰∏ªËäÇÁÇπÂàÜÈÖç‰ªªÂä°ÔºåÂπ∂Áî®‰ªéËäÇÁÇπ‰∏äÁöÑ Executor Ë¥üË¥£ÊâßË°åÔºåÈÄöËøá Zookeeper Áªô‰∏ªËäÇÁÇπÊèê‰æõÊúçÂä°Ê≥®ÂÜå„ÄÅÊúçÂä°ÂèëÁé∞ÂäüËÉΩ„ÄÇÈÄöËøá Framework Marathon Êèê‰æõÂÆπÂô®Ë∞ÉÂ∫¶ÁöÑËÉΩÂäõ„ÄÇ</li>
</ul>
</li>
<li>‰ºòÂäø
<ul>
<li>ÁªèËøáÊó∂Èó¥ÁöÑÊ£ÄÈ™åÔºå‰Ωú‰∏∫ËµÑÊ∫êÁÆ°ÁêÜÂô®ÁöÑ Apache Mesos Âú®ÂÆπÂô®‰πãÂâçÂ∞±Â∑≤ÁªèÂá∫Áé∞Âæà‰πÖ‰∫ÜÔºåÊîØÊåÅËøêË°åÂÆπÂô®ÂåñÂåñÂíåÈùûÂÆπÂô®ÂåñÁöÑÂ∑•‰ΩúË¥üËΩΩ„ÄÇÂèØ‰ª•ÊîØÊåÅÂ∫îÁî®Á®ãÂ∫èÁöÑÂÅ•Â∫∑Ê£ÄÊü•ÔºåÂºÄÊîæÁöÑÊû∂ÊûÑ„ÄÇÊîØÊåÅÂ§ö‰∏™Ê°ÜÊû∂ÂíåÂ§ö‰∏™Ë∞ÉÂ∫¶Âô®ÔºåÈÄöËøá‰∏çÂêåÁöÑ Framework ÂèØ‰ª•ËøêË°å Hadoop/Spark/MPI Á≠âÂ§öÁßç‰∏çÂêåÁöÑ‰ªªÂä°„ÄÇ</li>
<li>ÊîØÊåÅË∂ÖÂ§ßÂûãËßÑÊ®°ÁöÑËäÇÁÇπÁÆ°ÁêÜÔºåÊ®°ÊãüÊµãËØïÊîØÊåÅË∂ÖËøá 5w+ ËäÇÁÇπÔºåÂú®Â§ßËßÑÊ®°‰∏äÊã•ÊúâËæÉÂ§ß‰ºòÂäø„ÄÇ</li>
</ul>
</li>
</ol>
</li>
<li>Docker Swarm
<ol>
<li>Âü∫Êú¨Ê¶ÇÂøµ
<ul>
<li>Docker Swarm ÊòØ‰∏Ä‰∏™Áî± Docker ÂºÄÂèëÁöÑË∞ÉÂ∫¶Ê°ÜÊû∂„ÄÇÁî± Docker Ëá™Ë∫´ÂºÄÂèëÁöÑÂ•ΩÂ§Ñ‰πã‰∏ÄÂ∞±ÊòØÊ†áÂáÜ Docker API ÁöÑ‰ΩøÁî®ÔºåSwarm Áî±Â§ö‰∏™‰ª£ÁêÜÔºàAgentÔºâÁªÑÊàêÔºåÊääËøô‰∫õ‰ª£ÁêÜÁß∞‰πã‰∏∫ËäÇÁÇπÔºàNodeÔºâ„ÄÇËøô‰∫õËäÇÁÇπÂ∞±ÊòØ‰∏ªÊú∫ÔºåËøô‰∫õ‰∏ªÊú∫Âú®ÂêØÂä® Docker Daemon ÁöÑÊó∂ÂÄôÂ∞±‰ºöÊâìÂºÄÁõ∏Â∫îÁöÑÁ´ØÂè£Ôºå‰ª•Ê≠§ÊîØÊåÅ Docker ËøúÁ®ã API„ÄÇËøô‰∫õÊú∫Âô®‰ºöÊ†πÊçÆ Swarm Ë∞ÉÂ∫¶Âô®ÂàÜÈÖçÁªôÂÆÉ‰ª¨ÁöÑ‰ªªÂä°ÔºåÊãâÂèñÂíåËøêË°å‰∏çÂêåÁöÑÈïúÂÉè„ÄÇ</li>
</ul>
</li>
<li>‰ºòÂäø
<ul>
<li>‰ªé Docker1.12 ÁâàÊú¨ÂºÄÂßãÔºåSwarm Èöè Docker ‰∏ÄËµ∑ÈªòËÆ§ÂÆâË£ÖÂèëÂ∏É„ÄÇÁî±‰∫éÈöè Docker ÂºïÊìé‰∏ÄËµ∑ÂèëÂ∏ÉÔºåÊó†ÈúÄÈ¢ùÂ§ñÂÆâË£ÖÔºåÈÖçÁΩÆÁÆÄÂçï„ÄÇÊîØÊåÅÊúçÂä°Ê≥®ÂÜå„ÄÅÊúçÂä°ÂèëÁé∞ÔºåÂÜÖÁΩÆ Overlay Network ‰ª•Âèä Load Balancer„ÄÇ‰∏é Docker CLI ÈùûÂ∏∏Á±ª‰ººÁöÑÊìç‰ΩúÂëΩ‰ª§ÔºåÂØπÁÜüÊÇâ Docker ÁöÑ‰∫∫ÈùûÂ∏∏ÂÆπÊòì‰∏äÊâãÂ≠¶‰π†„ÄÇ</li>
<li>ÂÖ•Èó®Èó®Êßõ„ÄÅÂ≠¶‰π†ÊàêÊú¨ËæÉ‰ΩéÔºå‰ΩøÁî®Êõ¥‰æøÊç∑ÔºåÈÄÇÁî®‰∫é‰∏≠Â∞èÂûãÁ≥ªÁªü„ÄÇ</li>
</ul>
</li>
</ol>
</li>
<li>Google Kubernetes
<ol>
<li>Âü∫Êú¨Ê¶ÇÂøµ
<ul>
<li>Kubernetes ÊòØÂü∫‰∫é Google Âú®ËøáÂéªÂçÅ‰∫îÂπ¥Êù•Â§ßÈáèÁîü‰∫ßÁéØÂ¢É‰∏≠ËøêË°åÂ∑•‰ΩúË¥üËΩΩÁöÑÁªèÈ™å„ÄÇKubernetes ÁöÑÂÆûÁé∞ÂèÇËÄÉ‰∫Ü Google ÂÜÖÈÉ®ÁöÑËµÑÊ∫êË∞ÉÂ∫¶Ê°ÜÊû∂Ôºå‰ΩÜÂπ∂‰∏çÊòØ Borg ÁöÑÂÜÖÈÉ®ÂÆπÂô®ÁºñÊéíÁ≥ªÁªüÁöÑÂºÄÊ∫êÔºåËÄåÊòØÂÄüÈâ¥ Google ‰ªéËøêË°å Borg Ëé∑ÂæóÁöÑÁªèÈ™åÊïôËÆ≠ÔºåÂΩ¢Êàê‰∫Ü Kubernetes È°πÁõÆ„ÄÇ</li>
<li>ÂÆÉ‰ΩøÁî® Label Âíå Pod ÁöÑÊ¶ÇÂøµÊù•Â∞ÜÂÆπÂô®ÂàíÂàÜ‰∏∫ÈÄªËæëÂçïÂÖÉ„ÄÇPods ÊòØÂêåÂú∞Âçè‰ΩúÔºàco-locatedÔºâÂÆπÂô®ÁöÑÈõÜÂêàÔºåËøô‰∫õÂÆπÂô®Ë¢´ÂÖ±ÂêåÈÉ®ÁΩ≤ÂíåË∞ÉÂ∫¶ÔºåÂΩ¢Êàê‰∫Ü‰∏Ä‰∏™ÊúçÂä°ÔºåËøôÊòØ Kubernetes ÂíåÂÖ∂‰ªñ‰∏§‰∏™Ê°ÜÊû∂ÁöÑ‰∏ªË¶ÅÂå∫Âà´„ÄÇÁõ∏ÊØî‰∫éÂü∫‰∫éÁõ∏‰ººÂ∫¶ÁöÑÂÆπÂô®Ë∞ÉÂ∫¶ÊñπÂºèÔºàÂ∞±ÂÉè Swarm Âíå MesosÔºâÔºåËøô‰∏™ÊñπÊ≥ïÁÆÄÂåñ‰∫ÜÂØπÈõÜÁæ§ÁöÑÁÆ°ÁêÜ„ÄÇ</li>
</ul>
</li>
<li>‰ºòÂäø
<ul>
<li>ÊúÄÊµÅË°åÁ≠âÂÆπÂô®ÁºñÊéíËß£ÂÜ≥ÊñπÊ°àÊ°ÜÊû∂ÔºåÂü∫‰∫é Google Â∫ûÂ§ßÁöÑÁîüÊÄÅÂúàÂèäÁ§æÂå∫‰∫ßÁîüÁöÑ‰∫ßÂìÅ„ÄÇÈÄöËøá Pods Ëøô‰∏ÄÊäΩË±°ÁöÑÊ¶ÇÂøµÔºåËß£ÂÜ≥ Container ‰πãÈó¥ÁöÑ‰æùËµñ‰∫éÈÄö‰ø°ÈóÆÈ¢ò„ÄÇPodsÔºåServicesÔºåDeployments ÊòØÁã¨Á´ãÈÉ®ÁΩ≤ÁöÑÈÉ®ÂàÜÔºåÂèØ‰ª•ÈÄöËøá Selector Êèê‰æõÊõ¥Â§öÁöÑÁÅµÊ¥ªÊÄß„ÄÇÂÜÖÁΩÆÊúçÂä°Ê≥®ÂÜåË°®ÂíåË¥üËΩΩÂπ≥Ë°°„ÄÇ</li>
<li>ÈÄÇÁî®Â∫¶Êõ¥ÂπøÔºåÂäüËÉΩÊõ¥Âº∫Â§ßÔºåÁõ∏ËæÉ‰∫é Mesos Êù•ËØ¥ËäÇÁÇπËßÑÊ®°ËæÉÂ∞èÔºå</li>
</ul>
</li>
</ol>
</li>
</ol>
<h3 id="ÈõÜÁæ§Êû∂ÊûÑ‰∏éÁªÑ‰ª∂">ÈõÜÁæ§Êû∂ÊûÑ‰∏éÁªÑ‰ª∂
</h3><h4 id="Áõ∏ÂÖ≥ÁªÑ‰ª∂">Áõ∏ÂÖ≥ÁªÑ‰ª∂
</h4><h5 id="ÊéßÂà∂Èù¢ÊùøÁªÑ‰ª∂master">ÊéßÂà∂Èù¢ÊùøÁªÑ‰ª∂ÔºàMasterÔºâ
</h5><p>
<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo03/202412242119647.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo03/202412242119647.png" alt="k8s1.drawio"  />
	</a>
</div>
</p>
<p><strong>ÂÖ∂‰∏≠Ê†áËâ≤ÁöÑÂú∞ÊñπÈúÄË¶ÅÈáçÁÇπÊ≥®ÊÑè</strong></p>
<blockquote>
<h6 id="kube-api-server">kube-api-server
</h6></blockquote>
<p>API ÊúçÂä°Âô®ÊòØ Kubernetes <a class="link" href="https://kubernetes.io/zh-cn/docs/reference/glossary/?all=true#term-control-plane"  target="_blank" rel="noopener" >ÊéßÂà∂Âπ≥Èù¢</a>ÁöÑÁªÑ‰ª∂Ôºå ËØ•ÁªÑ‰ª∂Ë¥üË¥£ÂÖ¨ÂºÄ‰∫Ü Kubernetes APIÔºåË¥üË¥£Â§ÑÁêÜÊé•ÂèóËØ∑Ê±ÇÁöÑÂ∑•‰Ωú„ÄÇ API ÊúçÂä°Âô®ÊòØ Kubernetes ÊéßÂà∂Âπ≥Èù¢ÁöÑÂâçÁ´Ø„ÄÇ</p>
<p>Kubernetes API ÊúçÂä°Âô®ÁöÑ‰∏ªË¶ÅÂÆûÁé∞ÊòØ <a class="link" href="https://kubernetes.io/zh-cn/docs/reference/command-line-tools-reference/kube-apiserver/"  target="_blank" rel="noopener" >kube-apiserver</a>„ÄÇ kube-apiserver ËÆæËÆ°‰∏äËÄÉËôë‰∫ÜÊ∞¥Âπ≥Êâ©Áº©Ôºå‰πüÂ∞±ÊòØËØ¥ÔºåÂÆÉÂèØÈÄöËøáÈÉ®ÁΩ≤Â§ö‰∏™ÂÆû‰æãÊù•ËøõË°åÊâ©Áº©„ÄÇ ‰Ω†ÂèØ‰ª•ËøêË°å kube-apiserver ÁöÑÂ§ö‰∏™ÂÆû‰æãÔºåÂπ∂Âú®Ëøô‰∫õÂÆû‰æã‰πãÈó¥Âπ≥Ë°°ÊµÅÈáè„ÄÇ</p>
<blockquote>
<h6 id="kube-controller-manager">kube-controller-manager
</h6></blockquote>
<p><a class="link" href="https://kubernetes.io/zh-cn/docs/reference/command-line-tools-reference/kube-controller-manager/"  target="_blank" rel="noopener" >kube-controller-manager</a> ÊòØ<a class="link" href="https://kubernetes.io/zh-cn/docs/reference/glossary/?all=true#term-control-plane"  target="_blank" rel="noopener" >ÊéßÂà∂Âπ≥Èù¢</a>ÁöÑÁªÑ‰ª∂Ôºå Ë¥üË¥£ËøêË°å<a class="link" href="https://kubernetes.io/zh-cn/docs/concepts/architecture/controller/"  target="_blank" rel="noopener" >ÊéßÂà∂Âô®</a>ËøõÁ®ã„ÄÇ</p>
<p>‰ªéÈÄªËæë‰∏äËÆ≤Ôºå ÊØè‰∏™<a class="link" href="https://kubernetes.io/zh-cn/docs/concepts/architecture/controller/"  target="_blank" rel="noopener" >ÊéßÂà∂Âô®</a>ÈÉΩÊòØ‰∏Ä‰∏™ÂçïÁã¨ÁöÑËøõÁ®ãÔºå ‰ΩÜÊòØ‰∏∫‰∫ÜÈôç‰ΩéÂ§çÊùÇÊÄßÔºåÂÆÉ‰ª¨ÈÉΩË¢´ÁºñËØëÂà∞Âêå‰∏Ä‰∏™ÂèØÊâßË°åÊñá‰ª∂ÔºåÂπ∂Âú®Âêå‰∏Ä‰∏™ËøõÁ®ã‰∏≠ËøêË°å„ÄÇ</p>
<p>Ëøô‰∫õÊéßÂà∂Âô®ÂåÖÊã¨Ôºö</p>
<ul>
<li>ËäÇÁÇπÊéßÂà∂Âô®ÔºàNode ControllerÔºâÔºöË¥üË¥£Âú®ËäÇÁÇπÂá∫Áé∞ÊïÖÈöúÊó∂ËøõË°åÈÄöÁü•ÂíåÂìçÂ∫î</li>
<li>‰ªªÂä°ÊéßÂà∂Âô®ÔºàJob ControllerÔºâÔºöÁõëÊµã‰ª£Ë°®‰∏ÄÊ¨°ÊÄß‰ªªÂä°ÁöÑ Job ÂØπË±°ÔºåÁÑ∂ÂêéÂàõÂª∫ Pods Êù•ËøêË°åËøô‰∫õ‰ªªÂä°Áõ¥Ëá≥ÂÆåÊàê</li>
<li>Á´ØÁÇπÂàÜÁâáÊéßÂà∂Âô®ÔºàEndpointSlice controllerÔºâÔºöÂ°´ÂÖÖÁ´ØÁÇπÂàÜÁâáÔºàEndpointSliceÔºâÂØπË±°Ôºà‰ª•Êèê‰æõ Service Âíå Pod ‰πãÈó¥ÁöÑÈìæÊé•Ôºâ„ÄÇ</li>
<li>ÊúçÂä°Ë¥¶Âè∑ÊéßÂà∂Âô®ÔºàServiceAccount controllerÔºâÔºö‰∏∫Êñ∞ÁöÑÂëΩÂêçÁ©∫Èó¥ÂàõÂª∫ÈªòËÆ§ÁöÑÊúçÂä°Ë¥¶Âè∑ÔºàServiceAccountÔºâ„ÄÇ</li>
</ul>
<blockquote>
<h6 id="cloud-controller-manager">cloud-controller-manager
</h6></blockquote>
<p>ÂµåÂÖ•‰∫ÜÁâπÂÆö‰∫é‰∫ëÂπ≥Âè∞ÁöÑÊéßÂà∂ÈÄªËæë„ÄÇ ‰∫ëÊéßÂà∂Âô®ÁÆ°ÁêÜÂô®ÔºàCloud Controller ManagerÔºâÂÖÅËÆ∏‰Ω†Â∞Ü‰Ω†ÁöÑÈõÜÁæ§ËøûÊé•Âà∞‰∫ëÊèê‰æõÂïÜÁöÑ API ‰πã‰∏äÔºå Âπ∂Â∞Ü‰∏éËØ•‰∫ëÂπ≥Âè∞‰∫§‰∫íÁöÑÁªÑ‰ª∂Âêå‰∏é‰Ω†ÁöÑÈõÜÁæ§‰∫§‰∫íÁöÑÁªÑ‰ª∂ÂàÜÁ¶ªÂºÄÊù•„ÄÇ</p>
<p>cloud-controller-manager ‰ªÖËøêË°åÁâπÂÆö‰∫é‰∫ëÂπ≥Âè∞ÁöÑÊéßÂà∂Âô®„ÄÇ Âõ†Ê≠§Â¶ÇÊûú‰Ω†Âú®Ëá™Â∑±ÁöÑÁéØÂ¢É‰∏≠ËøêË°å KubernetesÔºåÊàñËÄÖÂú®Êú¨Âú∞ËÆ°ÁÆóÊú∫‰∏≠ËøêË°åÂ≠¶‰π†ÁéØÂ¢ÉÔºå ÊâÄÈÉ®ÁΩ≤ÁöÑÈõÜÁæ§‰∏çÈúÄË¶ÅÊúâ‰∫ëÊéßÂà∂Âô®ÁÆ°ÁêÜÂô®„ÄÇ</p>
<p>‰∏é kube-controller-manager Á±ª‰ººÔºåcloud-controller-manager Â∞ÜËã•Âπ≤ÈÄªËæë‰∏äÁã¨Á´ãÁöÑÊéßÂà∂ÂõûË∑ØÁªÑÂêàÂà∞Âêå‰∏Ä‰∏™ÂèØÊâßË°åÊñá‰ª∂‰∏≠Ôºå ‰æõ‰Ω†‰ª•Âêå‰∏ÄËøõÁ®ãÁöÑÊñπÂºèËøêË°å„ÄÇ ‰Ω†ÂèØ‰ª•ÂØπÂÖ∂ÊâßË°åÊ∞¥Âπ≥Êâ©ÂÆπÔºàËøêË°å‰∏çÊ≠¢‰∏Ä‰∏™ÂâØÊú¨Ôºâ‰ª•ÊèêÂçáÊÄßËÉΩÊàñËÄÖÂ¢ûÂº∫ÂÆπÈîôËÉΩÂäõ„ÄÇ</p>
<blockquote>
<h6 id="kube-scheduler">kube-scheduler
</h6></blockquote>
<p>scheduler Ë¥üË¥£ËµÑÊ∫êÁöÑË∞ÉÂ∫¶ÔºåÊåâÁÖßÈ¢ÑÂÆöÁöÑË∞ÉÂ∫¶Á≠ñÁï•Â∞Ü Pod Ë∞ÉÂ∫¶Âà∞Áõ∏Â∫îÁöÑÊú∫Âô®‰∏äÔºõ</p>
<blockquote>
<h6 id="etcd">etcd
</h6></blockquote>
<p>‰∏ÄËá¥‰∏îÈ´òÂ∫¶ÂèØÁî®ÁöÑÈîÆÂÄºÂ≠òÂÇ®ÔºåÁî®‰Ωú Kubernetes ÁöÑÊâÄÊúâÈõÜÁæ§Êï∞ÊçÆÁöÑÂêéÂè∞Êï∞ÊçÆÂ∫ì„ÄÇ</p>
<p>Â¶ÇÊûú‰Ω†ÁöÑ Kubernetes ÈõÜÁæ§‰ΩøÁî® etcd ‰Ωú‰∏∫ÂÖ∂ÂêéÂè∞Êï∞ÊçÆÂ∫ìÔºå ËØ∑Á°Æ‰øù‰Ω†ÈíàÂØπËøô‰∫õÊï∞ÊçÆÊúâ‰∏Ä‰ªΩ <a class="link" href="https://kubernetes.io/zh-cn/docs/tasks/administer-cluster/configure-upgrade-etcd/#backing-up-an-etcd-cluster"  target="_blank" rel="noopener" >Â§á‰ªΩ</a>ËÆ°Âàí„ÄÇ</p>
<p>‰Ω†ÂèØ‰ª•Âú®ÂÆòÊñπ<a class="link" href="https://etcd.io/docs/"  target="_blank" rel="noopener" >ÊñáÊ°£</a>‰∏≠ÊâæÂà∞ÊúâÂÖ≥ etcd ÁöÑÊ∑±ÂÖ•Áü•ËØÜ„ÄÇ</p>
<p>Êó©ÊúüÊï∞ÊçÆÂ≠òÊîæÂú®ÂÜÖÂ≠òÔºåÁé∞Âú®Â∑≤ÁªèÊòØÊåÅ‰πÖÂåñÂ≠òÂÇ®ÁöÑ‰∫Ü„ÄÇ</p>
<h5 id="ËäÇÁÇπÁªÑ‰ª∂">ËäÇÁÇπÁªÑ‰ª∂
</h5><blockquote>
<h6 id="kubelet">kubelet
</h6></blockquote>
<p>kubelet Ë¥üË¥£Áª¥Êä§ÂÆπÂô®ÁöÑÁîüÂëΩÂë®ÊúüÔºåÂêåÊó∂‰πüË¥üË¥£ VolumeÔºàCVIÔºâÂíåÁΩëÁªúÔºàCNIÔºâÁöÑÁÆ°ÁêÜÔºõ</p>
<blockquote>
<h6 id="kube-proxy">kube-proxy
</h6></blockquote>
<p>kube-proxy Ë¥üË¥£‰∏∫ Service Êèê‰æõ cluster ÂÜÖÈÉ®ÁöÑÊúçÂä°ÂèëÁé∞ÂíåË¥üËΩΩÂùáË°°Ôºõkube-proxy Ë¥üË¥£‰∏∫ Service Êèê‰æõ cluster ÂÜÖÈÉ®ÁöÑÊúçÂä°ÂèëÁé∞ÂíåË¥üËΩΩÂùáË°°Ôºõ</p>
<blockquote>
<h6 id="container-runtime">container runtime
</h6></blockquote>
<p>Container runtime Ë¥üË¥£ÈïúÂÉèÁÆ°ÁêÜ‰ª•Âèä Pod ÂíåÂÆπÂô®ÁöÑÁúüÊ≠£ËøêË°åÔºàCRIÔºâÔºõ
Kubernetes ÊîØÊåÅËÆ∏Â§öÂÆπÂô®ËøêË°åÁéØÂ¢ÉÔºå‰æãÂ¶Ç <a class="link" href="https://containerd.io/docs/"  target="_blank" rel="noopener" >containerd</a>„ÄÅ <a class="link" href="https://cri-o.io/#what-is-cri-o"  target="_blank" rel="noopener" >CRI-O</a> ‰ª•Âèä <a class="link" href="https://github.com/kubernetes/community/blob/master/contributors/devel/sig-node/container-runtime-interface.md"  target="_blank" rel="noopener" >Kubernetes CRI (ÂÆπÂô®ËøêË°åÁéØÂ¢ÉÊé•Âè£)</a> ÁöÑÂÖ∂‰ªñ‰ªª‰ΩïÂÆûÁé∞„ÄÇ</p>
<h5 id="ÈôÑÂä†ÁªÑ‰ª∂">ÈôÑÂä†ÁªÑ‰ª∂
</h5><blockquote>
<h6 id="kube-dns">kube-dns
</h6></blockquote>
<p>kube-dns Ë¥üË¥£‰∏∫Êï¥‰∏™ÈõÜÁæ§Êèê‰æõ DNS ÊúçÂä°</p>
<blockquote>
<h6 id="ingress-controller">Ingress Controller
</h6></blockquote>
<p>Ingress Controller ‰∏∫ÊúçÂä°Êèê‰æõÂ§ñÁΩëÂÖ•Âè£</p>
<blockquote>
<h6 id="prometheus">Prometheus
</h6></blockquote>
<p>Prometheus Êèê‰æõËµÑÊ∫êÁõëÊéß</p>
<blockquote>
<h6 id="dashboard">Dashboard
</h6></blockquote>
<p>Dashboard Êèê‰æõ GUI</p>
<blockquote>
<h6 id="federation">Federation
</h6></blockquote>
<p>Federation Êèê‰æõË∑®ÂèØÁî®Âå∫ÁöÑÈõÜÁæ§</p>
<blockquote>
<h6 id="fluentd-elasticsearch">Fluentd-elasticsearch
</h6></blockquote>
<p>Fluentd-elasticsearch Êèê‰æõÈõÜÁæ§Êó•ÂøóÈááÈõÜ„ÄÅÂ≠òÂÇ®‰∏éÊü•ËØ¢</p>
<h4 id="ÂàÜÂ±ÇÊû∂ÊûÑ">ÂàÜÂ±ÇÊû∂ÊûÑ
</h4><ol>
<li>ÁîüÊÄÅÁ≥ªÁªü
<ul>
<li>Âú®Êé•Âè£Â±Ç‰πã‰∏äÁöÑÂ∫ûÂ§ßÂÆπÂô®ÈõÜÁæ§ÁÆ°ÁêÜË∞ÉÂ∫¶ÁöÑÁîüÊÄÅÁ≥ªÁªüÔºåÂèØ‰ª•ÂàíÂàÜ‰∏∫‰∏§‰∏™ËåÉÁï¥Ôºö
<ul>
<li>Kubernetes Â§ñÈÉ®ÔºöÊó•Âøó„ÄÅÁõëÊéß„ÄÅÈÖçÁΩÆÁÆ°ÁêÜ„ÄÅCI„ÄÅCD„ÄÅWorkflow„ÄÅFaaS„ÄÅOTS Â∫îÁî®„ÄÅChatOps Á≠â</li>
<li>Kubernetes ÂÜÖÈÉ®ÔºöCRI„ÄÅCNI„ÄÅCVI„ÄÅÈïúÂÉè‰ªìÂ∫ì„ÄÅCloud Provider„ÄÅÈõÜÁæ§Ëá™Ë∫´ÁöÑÈÖçÁΩÆÂíåÁÆ°ÁêÜÁ≠â</li>
</ul>
</li>
</ul>
</li>
<li>Êé•Âè£Â±Ç
<ul>
<li>kubectl ÂëΩ‰ª§Ë°åÂ∑•ÂÖ∑„ÄÅÂÆ¢Êà∑Á´Ø SDK ‰ª•ÂèäÈõÜÁæ§ËÅîÈÇ¶</li>
</ul>
</li>
<li>ÁÆ°ÁêÜÂ±Ç
<ul>
<li>Á≥ªÁªüÂ∫¶ÈáèÔºàÂ¶ÇÂü∫Á°ÄËÆæÊñΩ„ÄÅÂÆπÂô®ÂíåÁΩëÁªúÁöÑÂ∫¶ÈáèÔºâÔºåËá™Âä®ÂåñÔºàÂ¶ÇËá™Âä®Êâ©Â±ï„ÄÅÂä®ÊÄÅ Provision Á≠âÔºâ‰ª•ÂèäÁ≠ñÁï•ÁÆ°ÁêÜÔºàRBAC„ÄÅQuota„ÄÅPSP„ÄÅNetworkPolicy Á≠âÔºâ</li>
</ul>
</li>
<li>Â∫îÁî®Â±Ç
<ul>
<li>ÈÉ®ÁΩ≤ÔºàÊó†Áä∂ÊÄÅÂ∫îÁî®„ÄÅÊúâÁä∂ÊÄÅÂ∫îÁî®„ÄÅÊâπÂ§ÑÁêÜ‰ªªÂä°„ÄÅÈõÜÁæ§Â∫îÁî®Á≠âÔºâÂíåË∑ØÁî±ÔºàÊúçÂä°ÂèëÁé∞„ÄÅDNS Ëß£ÊûêÁ≠âÔºâ</li>
</ul>
</li>
<li>Ê†∏ÂøÉÂ±Ç
<ul>
<li>Kubernetes ÊúÄÊ†∏ÂøÉÁöÑÂäüËÉΩÔºåÂØπÂ§ñÊèê‰æõ API ÊûÑÂª∫È´òÂ±ÇÁöÑÂ∫îÁî®ÔºåÂØπÂÜÖÊèê‰æõÊèí‰ª∂ÂºèÂ∫îÁî®ÊâßË°åÁéØÂ¢É</li>
</ul>
</li>
</ol>
<h3 id="Ê†∏ÂøÉÊ¶ÇÂøµ‰∏é‰∏ì‰∏öÊúØËØ≠">Ê†∏ÂøÉÊ¶ÇÂøµ‰∏é‰∏ì‰∏öÊúØËØ≠
</h3><h4 id="ÊúçÂä°ÁöÑÂàÜÁ±ª">ÊúçÂä°ÁöÑÂàÜÁ±ª
</h4><h5 id="Êó†Áä∂ÊÄÅ">Êó†Áä∂ÊÄÅ
</h5><blockquote>
<p>ÈúÄË¶ÅÂú®ÊúçÂä°ËøêË°åÁéØÂ¢É‰∏ãÂ≠òÂÇ®Êï∞ÊçÆÁöÑÊúçÂä°ÔºåÊàë‰ª¨Áß∞‰πã‰∏∫<code>Êó†Áä∂ÊÄÅÂ∫îÁî®</code></p>
</blockquote>
<p>‰ª£Ë°®Â∫îÁî®</p>
<ol>
<li>Nginx</li>
<li>Apache</li>
</ol>
<p>‰ºòÁÇπÔºöÂØπÂÆ¢Êà∑Á´ØÈÄèÊòéÔºåÊó†‰æùËµñÂÖ≥Á≥ªÔºåÂèØ‰ª•È´òÊïàÂÆûÁé∞Êâ©ÂÆπ„ÄÅËøÅÁßª</p>
<p>Áº∫ÁÇπÔºö‰∏çËÉΩÂ≠òÂÇ®Êï∞ÊçÆÔºåÈúÄË¶ÅÈ¢ùÂ§ñÁöÑÊï∞ÊçÆÊúçÂä°ÊîØÊíë</p>
<h5 id="ÊúâÁä∂ÊÄÅ">ÊúâÁä∂ÊÄÅ
</h5><p>‰ª£Ë°®Â∫îÁî®</p>
<ol>
<li>MySQL</li>
<li>Redis</li>
</ol>
<p>‰ºòÁÇπÔºöÂèØ‰ª•Áã¨Á´ãÂ≠òÂÇ®Êï∞ÊçÆÔºåÂÆûÁé∞Êï∞ÊçÆÁÆ°ÁêÜ
Áº∫ÁÇπÔºöÈõÜÁæ§ÁéØÂ¢É‰∏ãÈúÄË¶ÅÂÆûÁé∞‰∏ª‰ªé„ÄÅÊï∞ÊçÆÂêåÊ≠•„ÄÅÂ§á‰ªΩ„ÄÅÊ∞¥Âπ≥Êâ©ÂÆπÂ§çÊùÇ</p>
<h4 id="ËµÑÊ∫êÂíåÂØπË±°">ËµÑÊ∫êÂíåÂØπË±°
</h4><p>Kubernetes ‰∏≠ÁöÑÊâÄÊúâÂÜÖÂÆπÈÉΩË¢´ÊäΩË±°‰∏∫‚ÄúËµÑÊ∫ê‚ÄùÔºåÂ¶Ç Pod„ÄÅService„ÄÅNode Á≠âÈÉΩÊòØËµÑÊ∫ê„ÄÇ‚ÄúÂØπË±°‚ÄùÂ∞±ÊòØ‚ÄúËµÑÊ∫ê‚ÄùÁöÑÂÆû‰æãÔºåÊòØÊåÅ‰πÖÂåñÁöÑÂÆû‰Ωì„ÄÇÂ¶ÇÊüê‰∏™ÂÖ∑‰ΩìÁöÑ Pod„ÄÅÊüê‰∏™ÂÖ∑‰ΩìÁöÑ Node„ÄÇKubernetes ‰ΩøÁî®Ëøô‰∫õÂÆû‰ΩìÂéªË°®Á§∫Êï¥‰∏™ÈõÜÁæ§ÁöÑÁä∂ÊÄÅ„ÄÇ</p>
<p>ÂØπË±°ÁöÑÂàõÂª∫„ÄÅÂà†Èô§„ÄÅ‰øÆÊîπÈÉΩÊòØÈÄöËøá ‚ÄúKubernetes API‚ÄùÔºå‰πüÂ∞±ÊòØ ‚ÄúApi Server‚Äù ÁªÑ‰ª∂Êèê‰æõÁöÑ API Êé•Âè£ÔºåËøô‰∫õÊòØ RESTful È£éÊ†ºÁöÑ ApiÔºå‰∏é k8s ÁöÑ‚Äú‰∏áÁâ©ÁöÜÂØπË±°‚ÄùÁêÜÂøµÁõ∏Á¨¶„ÄÇÂëΩ‰ª§Ë°åÂ∑•ÂÖ∑ ‚Äúkubectl‚ÄùÔºåÂÆûÈôÖ‰∏ä‰πüÊòØË∞ÉÁî® kubernetes api„ÄÇ</p>
<p>K8s ‰∏≠ÁöÑËµÑÊ∫êÁ±ªÂà´ÊúâÂæàÂ§öÁßçÔºåkubectl ÂèØ‰ª•ÈÄöËøáÈÖçÁΩÆÊñá‰ª∂Êù•ÂàõÂª∫Ëøô‰∫õ ‚ÄúÂØπË±°‚ÄùÔºåÈÖçÁΩÆÊñá‰ª∂Êõ¥ÂÉèÊòØÊèèËø∞ÂØπË±°‚ÄúÂ±ûÊÄß‚ÄùÁöÑÊñá‰ª∂ÔºåÈÖçÁΩÆÊñá‰ª∂Ê†ºÂºèÂèØ‰ª•ÊòØ ‚ÄúJSON‚Äù Êàñ ‚ÄúYAML‚ÄùÔºåÂ∏∏Áî® ‚ÄúYAML‚Äù„ÄÇ</p>
<h5 id="ÂÖÉÊï∞ÊçÆÂûã"><code>ÂÖÉÊï∞ÊçÆÂûã</code>
</h5><ol>
<li>Horizontal Pod AutoscalerÔºàHPAÔºâ
<ul>
<li>Pod Ëá™Âä®Êâ©ÂÆπÔºöÂèØ‰ª•Ê†πÊçÆ CPU ‰ΩøÁî®ÁéáÊàñËá™ÂÆö‰πâÊåáÊ†áÔºàmetricsÔºâËá™Âä®ÂØπ Pod ËøõË°åÊâ©/Áº©ÂÆπ„ÄÇ
<ul>
<li>ÊéßÂà∂ÁÆ°ÁêÜÂô®ÊØèÈöî 30sÔºàÂèØ‰ª•ÈÄöËøá‚Äìhorizontal-pod-autoscaler-sync-period ‰øÆÊîπÔºâÊü•ËØ¢ metrics ÁöÑËµÑÊ∫ê‰ΩøÁî®ÊÉÖÂÜµ</li>
<li>ÊîØÊåÅ‰∏âÁßç metrics Á±ªÂûã
<ul>
<li>È¢ÑÂÆö‰πâ metricsÔºàÊØîÂ¶Ç Pod ÁöÑ CPUÔºâ‰ª•Âà©Áî®ÁéáÁöÑÊñπÂºèËÆ°ÁÆó</li>
<li>Ëá™ÂÆö‰πâÁöÑ Pod metricsÔºå‰ª•ÂéüÂßãÂÄºÔºàraw valueÔºâÁöÑÊñπÂºèËÆ°ÁÆó</li>
<li>Ëá™ÂÆö‰πâÁöÑ object metrics</li>
</ul>
</li>
<li>ÊîØÊåÅ‰∏§Áßç metrics Êü•ËØ¢ÊñπÂºèÔºöHeapster ÂíåËá™ÂÆö‰πâÁöÑ REST API</li>
<li>ÊîØÊåÅÂ§ö metrics</li>
</ul>
</li>
</ul>
</li>
<li>PodTemplate
<ul>
<li>Pod Template ÊòØÂÖ≥‰∫é Pod ÁöÑÂÆö‰πâÔºå‰ΩÜÊòØË¢´ÂåÖÂê´Âú®ÂÖ∂‰ªñÁöÑ Kubernetes ÂØπË±°‰∏≠Ôºà‰æãÂ¶Ç Deployment„ÄÅStatefulSet„ÄÅDaemonSet Á≠âÊéßÂà∂Âô®Ôºâ„ÄÇÊéßÂà∂Âô®ÈÄöËøá Pod Template ‰ø°ÊÅØÊù•ÂàõÂª∫ Pod„ÄÇ</li>
</ul>
</li>
<li>LimitRange
<ul>
<li>ÂèØ‰ª•ÂØπÈõÜÁæ§ÂÜÖ Request Âíå Limits ÁöÑÈÖçÁΩÆÂÅö‰∏Ä‰∏™ÂÖ®Â±ÄÁöÑÁªü‰∏ÄÁöÑÈôêÂà∂ÔºåÁõ∏ÂΩì‰∫éÊâπÈáèËÆæÁΩÆ‰∫ÜÊüê‰∏Ä‰∏™ËåÉÂõ¥ÂÜÖÔºàÊüê‰∏™ÂëΩÂêçÁ©∫Èó¥ÔºâÁöÑ Pod ÁöÑËµÑÊ∫ê‰ΩøÁî®ÈôêÂà∂„ÄÇ</li>
</ul>
</li>
</ol>
<h5 id="ÈõÜÁæ§Á∫ß"><code>ÈõÜÁæ§Á∫ß</code>
</h5><ol>
<li>
<p>Namespace</p>
<ul>
<li>
<p>Kubernetes ÊîØÊåÅÂ§ö‰∏™ËôöÊãüÈõÜÁæ§ÔºåÂÆÉ‰ª¨Â∫ïÂ±Ç‰æùËµñ‰∫éÂêå‰∏Ä‰∏™Áâ©ÁêÜÈõÜÁæ§ÔºåËøô‰∫õËôöÊãüÈõÜÁæ§Ë¢´Áß∞‰∏∫ÂëΩÂêçÁ©∫Èó¥„ÄÇ</p>
<p>‰ΩúÁî®ÊòØÁî®‰∫éÂÆûÁé∞Â§öÂõ¢Èòü/ÁéØÂ¢ÉÁöÑËµÑÊ∫êÈöîÁ¶ª„ÄÇ</p>
<p>ÂëΩÂêçÁ©∫Èó¥ namespace ÊòØ k8s ÈõÜÁæ§Á∫ßÂà´ÁöÑËµÑÊ∫êÔºåÂèØ‰ª•Áªô‰∏çÂêåÁöÑÁî®Êà∑„ÄÅÁßüÊà∑„ÄÅÁéØÂ¢ÉÊàñÈ°πÁõÆÂàõÂª∫ÂØπÂ∫îÁöÑÂëΩÂêçÁ©∫Èó¥„ÄÇ</p>
<p>ÈªòËÆ§ namespaceÔºö</p>
<ul>
<li>kube-system ‰∏ªË¶ÅÁî®‰∫éËøêË°åÁ≥ªÁªüÁ∫ßËµÑÊ∫êÔºåÂ≠òÊîæ k8s Ëá™Ë∫´ÁöÑÁªÑ‰ª∂</li>
<li>kube-public Ê≠§ÂëΩÂêçÁ©∫Èó¥ÊòØËá™Âä®ÂàõÂª∫ÁöÑÔºåÂπ∂‰∏îÂèØ‰æõÊâÄÊúâÁî®Êà∑ÔºàÂåÖÊã¨Êú™ÁªèËøáË∫´‰ªΩÈ™åËØÅÁöÑÁî®Êà∑ÔºâËØªÂèñ„ÄÇÊ≠§ÂëΩÂêçÁ©∫Èó¥‰∏ªË¶ÅÁî®‰∫éÈõÜÁæ§‰ΩøÁî®ÔºåÂÖ≥ËÅîÁöÑ‰∏Ä‰∫õËµÑÊ∫êÂú®ÈõÜÁæ§‰∏≠ÊòØÂèØËßÅÁöÑÂπ∂‰∏îÂèØ‰ª•ÂÖ¨ÂºÄËØªÂèñ„ÄÇÊ≠§ÂëΩÂêçÁ©∫Èó¥ÁöÑÂÖ¨ÂÖ±ÊñπÈù¢Áü•ËØÜ‰∏Ä‰∏™Á∫¶ÂÆöÔºå‰ΩÜ‰∏çÊòØÈùûË¶ÅËøô‰πàË¶ÅÊ±Ç„ÄÇ</li>
<li>default Êú™ÊåáÂÆöÂêçÁß∞Á©∫Èó¥ÁöÑËµÑÊ∫êÂ∞±ÊòØ defaultÔºåÂç≥‰Ω†Âú®ÂàõÂª∫ pod Êó∂Â¶ÇÊûúÊ≤°ÊúâÊåáÂÆö namespaceÔºåÂàô‰ºöÈªòËÆ§‰ΩøÁî® default</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Node</p>
<ul>
<li>‰∏çÂÉèÂÖ∂‰ªñÁöÑËµÑÊ∫êÔºàÂ¶Ç Pod Âíå NamespaceÔºâÔºåNode Êú¨Ë¥®‰∏ä‰∏çÊòØ Kubernetes Êù•ÂàõÂª∫ÁöÑÔºåKubernetes Âè™ÊòØÁÆ°ÁêÜ Node ‰∏äÁöÑËµÑÊ∫ê„ÄÇËôΩÁÑ∂ÂèØ‰ª•ÈÄöËøá Manifest ÂàõÂª∫‰∏Ä‰∏™ Node ÂØπË±°ÔºàÂ¶Ç‰∏ã json ÊâÄÁ§∫ÔºâÔºå‰ΩÜ Kubernetes ‰πüÂè™ÊòØÂéªÊ£ÄÊü•ÊòØÂê¶ÁúüÁöÑÊòØÊúâËøô‰πà‰∏Ä‰∏™ NodeÔºåÂ¶ÇÊûúÊ£ÄÊü•Â§±Ë¥•Ôºå‰πü‰∏ç‰ºöÂæÄ‰∏äË∞ÉÂ∫¶ Pod„ÄÇ</li>
</ul>
</li>
<li>
<p>ClusterRole</p>
<ul>
<li>ClusterRole ÊòØ‰∏ÄÁªÑÊùÉÈôêÁöÑÈõÜÂêàÔºå‰ΩÜ‰∏é Role ‰∏çÂêåÁöÑÊòØÔºåClusterRole ÂèØ‰ª•Âú®ÂåÖÊã¨ÊâÄÊúâ Namespace ÂíåÈõÜÁæ§Á∫ßÂà´ÁöÑËµÑÊ∫êÊàñÈùûËµÑÊ∫êÁ±ªÂûãËøõË°åÈâ¥ÊùÉ„ÄÇ</li>
</ul>
</li>
<li>
<p>ClusterRoleBinding</p>
<ul>
<li>ClusterRoleBindingÔºöÂ∞Ü Subject ÁªëÂÆöÂà∞ ClusterRoleÔºåClusterRoleBinding Â∞Ü‰ΩøËßÑÂàôÂú®ÊâÄÊúâÂëΩÂêçÁ©∫Èó¥‰∏≠ÁîüÊïà„ÄÇ</li>
</ul>
</li>
</ol>
<h5 id="ÂëΩÂêçÁ©∫Èó¥Á∫ß"><code>ÂëΩÂêçÁ©∫Èó¥Á∫ß</code>
</h5><h6 id="Â∑•‰ΩúË¥üËΩΩÂûã">Â∑•‰ΩúË¥üËΩΩÂûã
</h6><p><strong>Pod</strong>
PodÔºàÂÆπÂô®ÁªÑÔºâÊòØ Kubernetes ‰∏≠ÊúÄÂ∞èÁöÑÂèØÈÉ®ÁΩ≤ÂçïÂÖÉ„ÄÇ‰∏Ä‰∏™ PodÔºàÂÆπÂô®ÁªÑÔºâÂåÖÂê´‰∫Ü‰∏Ä‰∏™Â∫îÁî®Á®ãÂ∫èÂÆπÂô®ÔºàÊüê‰∫õÊÉÖÂÜµ‰∏ãÊòØÂ§ö‰∏™ÂÆπÂô®Ôºâ„ÄÅÂ≠òÂÇ®ËµÑÊ∫ê„ÄÅ‰∏Ä‰∏™ÂîØ‰∏ÄÁöÑÁΩëÁªú IP Âú∞ÂùÄ„ÄÅ‰ª•Âèä‰∏Ä‰∫õÁ°ÆÂÆöÂÆπÂô®ËØ•Â¶Ç‰ΩïËøêË°åÁöÑÈÄâÈ°π„ÄÇPod ÂÆπÂô®ÁªÑ‰ª£Ë°®‰∫Ü Kubernetes ‰∏≠‰∏Ä‰∏™Áã¨Á´ãÁöÑÂ∫îÁî®Á®ãÂ∫èËøêË°åÂÆû‰æãÔºåËØ•ÂÆû‰æãÂèØËÉΩÁî±Âçï‰∏™ÂÆπÂô®ÊàñËÄÖÂá†‰∏™Á¥ßËÄ¶ÂêàÂú®‰∏ÄËµ∑ÁöÑÂÆπÂô®ÁªÑÊàê„ÄÇ</p>
<p>Docker ÊòØ Kubernetes Pod ‰∏≠‰ΩøÁî®ÊúÄÂπøÊ≥õÁöÑÂÆπÂô®ÂºïÊìéÔºõKubernetes Pod ÂêåÊó∂‰πüÊîØÊåÅÂÖ∂‰ªñÁ±ªÂûãÁöÑÂÆπÂô®ÂºïÊìé„ÄÇ</p>
<p>Kubernetes ÈõÜÁæ§‰∏≠ÁöÑ Pod Â≠òÂú®Â¶Ç‰∏ã‰∏§Áßç‰ΩøÁî®ÈÄîÂæÑÔºö</p>
<ul>
<li>‰∏Ä‰∏™ Pod ‰∏≠Âè™ËøêË°å‰∏Ä‰∏™ÂÆπÂô®„ÄÇ&ldquo;one-container-per-pod&rdquo; ÊòØ Kubernetes ‰∏≠ÊúÄÂ∏∏ËßÅÁöÑ‰ΩøÁî®ÊñπÂºè„ÄÇÊ≠§Êó∂ÔºåÊÇ®ÂèØ‰ª•ËÆ§‰∏∫ Pod ÂÆπÂô®ÁªÑÊòØËØ•ÂÆπÂô®ÁöÑ wrapperÔºåKubernetes ÈÄöËøá Pod ÁÆ°ÁêÜÂÆπÂô®ÔºåËÄå‰∏çÊòØÁõ¥Êé•ÁÆ°ÁêÜÂÆπÂô®„ÄÇ</li>
<li>‰∏Ä‰∏™ Pod ‰∏≠ËøêË°åÂ§ö‰∏™ÈúÄË¶Å‰∫íÁõ∏Âçè‰ΩúÁöÑÂÆπÂô®„ÄÇÊÇ®ÂèØ‰ª•Â∞ÜÂ§ö‰∏™Á¥ßÂØÜËÄ¶Âêà„ÄÅÂÖ±‰∫´ËµÑÊ∫ê‰∏îÂßãÁªàÂú®‰∏ÄËµ∑ËøêË°åÁöÑÂÆπÂô®ÁºñÊéíÂú®Âêå‰∏Ä‰∏™ Pod ‰∏≠</li>
</ul>
<blockquote>
<p>ÂâØÊú¨ÔºàreplicasÔºâ</p>
</blockquote>
<p>ÂÖàÂºïÂÖ•‚ÄúÂâØÊú¨‚ÄùÁöÑÊ¶ÇÂøµ‚Äî‚Äî‰∏Ä‰∏™ Pod ÂèØ‰ª•Ë¢´Â§çÂà∂ÊàêÂ§ö‰ªΩÔºåÊØè‰∏Ä‰ªΩÂèØË¢´Áß∞‰πã‰∏∫‰∏Ä‰∏™‚ÄúÂâØÊú¨‚ÄùÔºåËøô‰∫õ‚ÄúÂâØÊú¨‚ÄùÈô§‰∫Ü‰∏Ä‰∫õÊèèËø∞ÊÄßÁöÑ‰ø°ÊÅØÔºàPod ÁöÑÂêçÂ≠ó„ÄÅuid Á≠âÔºâ‰∏ç‰∏ÄÊ†∑‰ª•Â§ñÔºåÂÖ∂ÂÆÉ‰ø°ÊÅØÈÉΩÊòØ‰∏ÄÊ†∑ÁöÑÔºåË≠¨Â¶Ç Pod ÂÜÖÈÉ®ÁöÑÂÆπÂô®„ÄÅÂÆπÂô®Êï∞Èáè„ÄÅÂÆπÂô®ÈáåÈù¢ËøêË°åÁöÑÂ∫îÁî®Á≠âÁöÑËøô‰∫õ‰ø°ÊÅØÈÉΩÊòØ‰∏ÄÊ†∑ÁöÑÔºåËøô‰∫õÂâØÊú¨Êèê‰æõÂêåÊ†∑ÁöÑÂäüËÉΩ„ÄÇ</p>
<p>Pod ÁöÑ***‚ÄúÊéßÂà∂Âô®‚Äù***ÈÄöÂ∏∏ÂåÖÂê´‰∏Ä‰∏™Âêç‰∏∫ ‚Äúreplicas‚Äù ÁöÑÂ±ûÊÄß„ÄÇ‚Äúreplicas‚ÄùÂ±ûÊÄßÂàôÊåáÂÆö‰∫ÜÁâπÂÆö Pod ÁöÑÂâØÊú¨ÁöÑÊï∞ÈáèÔºåÂΩìÂΩìÂâçÈõÜÁæ§‰∏≠ËØ• Pod ÁöÑÊï∞Èáè‰∏éËØ•Â±ûÊÄßÊåáÂÆöÁöÑÂÄº‰∏ç‰∏ÄËá¥Êó∂Ôºåk8s ‰ºöÈááÂèñ‰∏Ä‰∫õÁ≠ñÁï•Âéª‰ΩøÂæóÂΩìÂâçÁä∂ÊÄÅÊª°Ë∂≥ÈÖçÁΩÆÁöÑË¶ÅÊ±Ç„ÄÇ</p>
<blockquote>
<p>ÊéßÂà∂Âô®</p>
</blockquote>
<p>ÂΩì Pod Ë¢´ÂàõÂª∫Âá∫Êù•ÔºåPod ‰ºöË¢´Ë∞ÉÂ∫¶Âà∞ÈõÜÁæ§‰∏≠ÁöÑËäÇÁÇπ‰∏äËøêË°åÔºåPod ‰ºöÂú®ËØ•ËäÇÁÇπ‰∏ä‰∏ÄÁõ¥‰øùÊåÅËøêË°åÁä∂ÊÄÅÔºåÁõ¥Âà∞ËøõÁ®ãÁªàÊ≠¢„ÄÅPod ÂØπË±°Ë¢´Âà†Èô§„ÄÅPod Âõ†ËäÇÁÇπËµÑÊ∫ê‰∏çË∂≥ËÄåË¢´È©±ÈÄêÊàñËÄÖËäÇÁÇπÂ§±Êïà‰∏∫Ê≠¢„ÄÇPod Âπ∂‰∏ç‰ºöËá™ÊÑàÔºåÂΩìËäÇÁÇπÂ§±ÊïàÔºåÊàñËÄÖË∞ÉÂ∫¶ Pod ÁöÑËøô‰∏ÄÊìç‰ΩúÂ§±Ë¥•‰∫ÜÔºåPod Â∞±ËØ•Ë¢´Âà†Èô§„ÄÇÂ¶ÇÊ≠§ÔºåÂçïÂçïÁî® Pod Êù•ÈÉ®ÁΩ≤Â∫îÁî®ÔºåÊòØ‰∏çÁ®≥ÂÆö‰∏çÂÆâÂÖ®ÁöÑ„ÄÇ</p>
<p>Kubernetes ‰ΩøÁî®Êõ¥È´òÁ∫ßÁöÑËµÑÊ∫êÂØπË±° <strong>*‚ÄúÊéßÂà∂Âô®‚Äù*</strong> Êù•ÂÆûÁé∞ÂØπ Pod ÁöÑÁÆ°ÁêÜ„ÄÇÊéßÂà∂Âô®ÂèØ‰ª•‰∏∫ÊÇ®ÂàõÂª∫ÂíåÁÆ°ÁêÜÂ§ö‰∏™ PodÔºåÁÆ°ÁêÜÂâØÊú¨Âíå‰∏äÁ∫øÔºåÂπ∂Âú®ÈõÜÁæ§ËåÉÂõ¥ÂÜÖÊèê‰æõËá™‰øÆÂ§çËÉΩÂäõ„ÄÇ ‰æãÂ¶ÇÔºåÂ¶ÇÊûú‰∏Ä‰∏™ËäÇÁÇπÂ§±Ë¥•ÔºåÊéßÂà∂Âô®ÂèØ‰ª•Âú®‰∏çÂêåÁöÑËäÇÁÇπ‰∏äË∞ÉÂ∫¶‰∏ÄÊ†∑ÁöÑÊõøË∫´Êù•Ëá™Âä®ÊõøÊç¢ Pod„ÄÇ</p>
<p><strong>ÈÄÇÁî®Êó†Áä∂ÊÄÅÊúçÂä°</strong></p>
<ul>
<li>
<p><code>ReplicationControllerÔºàRCÔºâ</code></p>
<ul>
<li>Replication Controller ÁÆÄÁß∞ RCÔºåRC ÊòØ Kubernetes Á≥ªÁªü‰∏≠ÁöÑÊ†∏ÂøÉÊ¶ÇÂøµ‰πã‰∏ÄÔºåÁÆÄÂçïÊù•ËØ¥ÔºåRC ÂèØ‰ª•‰øùËØÅÂú®‰ªªÊÑèÊó∂Èó¥ËøêË°å Pod ÁöÑÂâØÊú¨Êï∞ÈáèÔºåËÉΩÂ§ü‰øùËØÅ Pod ÊÄªÊòØÂèØÁî®ÁöÑ„ÄÇÂ¶ÇÊûúÂÆûÈôÖ Pod Êï∞ÈáèÊØîÊåáÂÆöÁöÑÂ§öÈÇ£Â∞±ÁªìÊùüÊéâÂ§ö‰ΩôÁöÑÔºåÂ¶ÇÊûúÂÆûÈôÖÊï∞ÈáèÊØîÊåáÂÆöÁöÑÂ∞ëÂ∞±Êñ∞ÂêØÂä®‰∏Ä‰∫õ PodÔºåÂΩì Pod Â§±Ë¥•„ÄÅË¢´Âà†Èô§ÊàñËÄÖÊåÇÊéâÂêéÔºåRC ÈÉΩ‰ºöÂéªËá™Âä®ÂàõÂª∫Êñ∞ÁöÑ Pod Êù•‰øùËØÅÂâØÊú¨Êï∞ÈáèÔºåÊâÄ‰ª•Âç≥‰ΩøÂè™Êúâ‰∏Ä‰∏™ PodÔºåÊàë‰ª¨‰πüÂ∫îËØ•‰ΩøÁî® RC Êù•ÁÆ°ÁêÜÊàë‰ª¨ÁöÑ Pod„ÄÇÂèØ‰ª•ËØ¥ÔºåÈÄöËøá ReplicationControllerÔºåKubernetes ÂÆûÁé∞‰∫Ü Pod ÁöÑÈ´òÂèØÁî®ÊÄß„ÄÇ</li>
</ul>
</li>
<li>
<p>ReplicaSetÔºàRSÔºâ</p>
<ul>
<li>
<p>RC ÔºàReplicationController Ôºâ‰∏ªË¶ÅÁöÑ‰ΩúÁî®Â∞±ÊòØÁî®Êù•Á°Æ‰øùÂÆπÂô®Â∫îÁî®ÁöÑÂâØÊú¨Êï∞ÂßãÁªà‰øùÊåÅÂú®Áî®Êà∑ÂÆö‰πâÁöÑÂâØÊú¨Êï∞ „ÄÇÂç≥Â¶ÇÊûúÊúâÂÆπÂô®ÂºÇÂ∏∏ÈÄÄÂá∫Ôºå‰ºöËá™Âä®ÂàõÂª∫Êñ∞ÁöÑ Pod Êù•Êõø‰ª£ÔºõËÄåÂ¶ÇÊûúÂºÇÂ∏∏Â§öÂá∫Êù•ÁöÑÂÆπÂô®‰πü‰ºöËá™Âä®ÂõûÊî∂ÔºàÂ∑≤ÁªèÊàê‰∏∫ËøáÂéªÊó∂ÔºâÔºåÂú® v1.11 ÁâàÊú¨Â∫üÂºÉ„ÄÇ</p>
<p><strong>Kubernetes ÂÆòÊñπÂª∫ËÆÆ‰ΩøÁî® RSÔºàReplicaSet Ôºâ Êõø‰ª£ RC ÔºàReplicationController Ôºâ ËøõË°åÈÉ®ÁΩ≤ÔºåRS Ë∑ü RC Ê≤°ÊúâÊú¨Ë¥®ÁöÑ‰∏çÂêåÔºåÂè™ÊòØÂêçÂ≠ó‰∏ç‰∏ÄÊ†∑ÔºåÂπ∂‰∏î RS ÊîØÊåÅÈõÜÂêàÂºèÁöÑ selector„ÄÇ</strong></p>
<p><code>Label Âíå Selector</code></p>
<p>label ÔºàÊ†áÁ≠æÔºâÊòØÈôÑÂä†Âà∞ Kubernetes ÂØπË±°ÔºàÊØîÂ¶Ç PodsÔºâ‰∏äÁöÑÈîÆÂÄºÂØπÔºåÁî®‰∫éÂå∫ÂàÜÂØπË±°ÔºàÊØîÂ¶Ç Pod„ÄÅServiceÔºâ„ÄÇ label Êó®Âú®Áî®‰∫éÊåáÂÆöÂØπÁî®Êà∑ÊúâÊÑè‰πâ‰∏îÁõ∏ÂÖ≥ÁöÑÂØπË±°ÁöÑÊ†áËØÜÂ±ûÊÄßÔºå‰ΩÜ‰∏çÁõ¥Êé•ÂØπÊ†∏ÂøÉÁ≥ªÁªüÊúâËØ≠‰πâÂê´‰πâ„ÄÇ label ÂèØ‰ª•Áî®‰∫éÁªÑÁªáÂíåÈÄâÊã©ÂØπË±°ÁöÑÂ≠êÈõÜ„ÄÇlabel ÂèØ‰ª•Âú®ÂàõÂª∫Êó∂ÈôÑÂä†Âà∞ÂØπË±°ÔºåÈöèÂêéÂèØ‰ª•ÈöèÊó∂Ê∑ªÂä†Âíå‰øÆÊîπ„ÄÇÂèØ‰ª•ÂÉè namespace ‰∏ÄÊ†∑Ôºå‰ΩøÁî® label Êù•Ëé∑ÂèñÊüêÁ±ªÂØπË±°Ôºå‰ΩÜ label ÂèØ‰ª•‰∏é selector ‰∏ÄËµ∑ÈÖçÂêà‰ΩøÁî®ÔºåÁî®Ë°®ËææÂºèÂØπÊù°‰ª∂Âä†‰ª•ÈôêÂà∂ÔºåÂÆûÁé∞Êõ¥Á≤æÁ°Æ„ÄÅÊõ¥ÁÅµÊ¥ªÁöÑËµÑÊ∫êÊü•Êâæ„ÄÇ</p>
<p>label ‰∏é selector ÈÖçÂêàÔºåÂèØ‰ª•ÂÆûÁé∞ÂØπË±°ÁöÑ‚ÄúÂÖ≥ËÅî‚ÄùÔºå‚ÄúPod ÊéßÂà∂Âô®‚Äù ‰∏é Pod ÊòØÁõ∏ÂÖ≥ËÅîÁöÑ ‚Äî‚Äî ‚ÄúPod ÊéßÂà∂Âô®‚Äù‰æùËµñ‰∫é PodÔºåÂèØ‰ª•Áªô Pod ËÆæÁΩÆ labelÔºåÁÑ∂ÂêéÁªô‚ÄúÊéßÂà∂Âô®‚ÄùËÆæÁΩÆÂØπÂ∫îÁöÑ selectorÔºåËøôÂ∞±ÂÆûÁé∞‰∫ÜÂØπË±°ÁöÑÂÖ≥ËÅî„ÄÇ</p>
</li>
</ul>
</li>
<li>
<p>Deployment</p>
<ul>
<li>
<p>Deployment ‰∏∫ Pod Âíå Replica Set Êèê‰æõÂ£∞ÊòéÂºèÊõ¥Êñ∞„ÄÇ</p>
<p>‰Ω†Âè™ÈúÄË¶ÅÂú® Deployment ‰∏≠ÊèèËø∞‰Ω†ÊÉ≥Ë¶ÅÁöÑÁõÆÊ†áÁä∂ÊÄÅÊòØ‰ªÄ‰πàÔºåDeployment controller Â∞±‰ºöÂ∏Æ‰Ω†Â∞Ü Pod Âíå Replica Set ÁöÑÂÆûÈôÖÁä∂ÊÄÅÊîπÂèòÂà∞‰Ω†ÁöÑÁõÆÊ†áÁä∂ÊÄÅ„ÄÇ‰Ω†ÂèØ‰ª•ÂÆö‰πâ‰∏Ä‰∏™ÂÖ®Êñ∞ÁöÑ DeploymentÔºå‰πüÂèØ‰ª•ÂàõÂª∫‰∏Ä‰∏™Êñ∞ÁöÑÊõøÊç¢ÊóßÁöÑ Deployment„ÄÇ</p>
<ol>
<li>ÂàõÂª∫ Replica Set / Pod</li>
<li>ÊªöÂä®ÂçáÁ∫ß/ÂõûÊªö</li>
<li>Âπ≥ÊªëÊâ©ÂÆπÂíåÁº©ÂÆπ</li>
<li>ÊöÇÂÅú‰∏éÊÅ¢Â§ç Deployment</li>
</ol>
</li>
</ul>
</li>
</ul>
<p><strong>ÈÄÇÁî®ÊúâÁä∂ÊÄÅÊúçÂä°</strong></p>
<p><code>StatefulSet</code></p>
<p>StatefulSet ‰∏≠ÊØè‰∏™ Pod ÁöÑ DNS Ê†ºÂºè‰∏∫ statefulSetName-{0..N-1}.serviceName.namespace.svc.cluster.local</p>
<ul>
<li>serviceName ‰∏∫ Headless Service ÁöÑÂêçÂ≠ó</li>
<li>0..N-1 ‰∏∫ Pod ÊâÄÂú®ÁöÑÂ∫èÂè∑Ôºå‰ªé 0 ÂºÄÂßãÂà∞ N-1</li>
<li>statefulSetName ‰∏∫ StatefulSet ÁöÑÂêçÂ≠ó</li>
<li>namespace ‰∏∫ÊúçÂä°ÊâÄÂú®ÁöÑ namespaceÔºåHeadless Servic Âíå StatefulSet ÂøÖÈ°ªÂú®Áõ∏ÂêåÁöÑ namespace</li>
<li>.cluster.local ‰∏∫ Cluster Domain</li>
</ul>
<p>‰∏ªË¶ÅÁâπÁÇπ</p>
<ol>
<li>Á®≥ÂÆöÁöÑÊåÅ‰πÖÂåñÂ≠òÂÇ®
<ul>
<li>Âç≥ Pod ÈáçÊñ∞Ë∞ÉÂ∫¶ÂêéËøòÊòØËÉΩËÆøÈóÆÂà∞Áõ∏ÂêåÁöÑÊåÅ‰πÖÂåñÊï∞ÊçÆÔºåÂü∫‰∫é PVC Êù•ÂÆûÁé∞</li>
</ul>
</li>
<li>Á®≥ÂÆöÁöÑÁΩëÁªúÊ†áÂøó
<ul>
<li>Á®≥ÂÆöÁöÑÁΩëÁªúÊ†áÂøóÔºåÂç≥ Pod ÈáçÊñ∞Ë∞ÉÂ∫¶ÂêéÂÖ∂ PodName Âíå HostName ‰∏çÂèòÔºåÂü∫‰∫é Headless ServiceÔºàÂç≥Ê≤°Êúâ Cluster IP ÁöÑ ServiceÔºâÊù•ÂÆûÁé∞</li>
</ul>
</li>
<li>ÊúâÂ∫èÈÉ®ÁΩ≤ÔºåÊúâÂ∫èÊâ©Â±ï
<ul>
<li>ÊúâÂ∫èÈÉ®ÁΩ≤ÔºåÊúâÂ∫èÊâ©Â±ïÔºåÂç≥ Pod ÊòØÊúâÈ°∫Â∫èÁöÑÔºåÂú®ÈÉ®ÁΩ≤ÊàñËÄÖÊâ©Â±ïÁöÑÊó∂ÂÄôË¶Å‰æùÊçÆÂÆö‰πâÁöÑÈ°∫Â∫è‰æùÊ¨°‰æùÊ¨°ËøõË°åÔºàÂç≥‰ªé 0 Âà∞ N-1ÔºåÂú®‰∏ã‰∏Ä‰∏™ Pod ËøêË°å‰πãÂâçÊâÄÊúâ‰πãÂâçÁöÑ Pod ÂøÖÈ°ªÈÉΩÊòØ Running Âíå Ready Áä∂ÊÄÅÔºâÔºåÂü∫‰∫é init containers Êù•ÂÆûÁé∞</li>
</ul>
</li>
<li>ÊúâÂ∫èÊî∂Áº©ÔºåÊúâÂ∫èÂà†Èô§
<ul>
<li>ÊúâÂ∫èÊî∂Áº©ÔºåÊúâÂ∫èÂà†Èô§ÔºàÂç≥‰ªé N-1 Âà∞ 0Ôºâ</li>
</ul>
</li>
</ol>
<p>ÁªÑÊàê</p>
<ol>
<li>
<p>Headless Service</p>
<ul>
<li>
<p>Áî®‰∫éÂÆö‰πâÁΩëÁªúÊ†áÂøóÔºàDNS domainÔºâ</p>
<p>Domain Name ServerÔºöÂüüÂêçÊúçÂä°
Â∞ÜÂüüÂêç‰∏é ip ÁªëÂÆöÊò†Â∞ÑÂÖ≥Á≥ª</p>
<p>ÊúçÂä°Âêç =&gt; ËÆøÈóÆË∑ØÂæÑÔºàÂüüÂêçÔºâ =&gt; ip</p>
</li>
</ul>
</li>
<li>
<p>volumeClaimTemplate</p>
<ul>
<li>Áî®‰∫éÂàõÂª∫ PersistentVolumes</li>
</ul>
</li>
</ol>
<p>Ê≥®ÊÑè‰∫ãÈ°π</p>
<ol>
<li>kubernetes v1.5 ÁâàÊú¨‰ª•‰∏äÊâçÊîØÊåÅ</li>
<li>ÊâÄÊúâ Pod ÁöÑ Volume ÂøÖÈ°ª‰ΩøÁî® PersistentVolume ÊàñËÄÖÊòØÁÆ°ÁêÜÂëò‰∫ãÂÖàÂàõÂª∫Â•Ω</li>
<li>‰∏∫‰∫Ü‰øùËØÅÊï∞ÊçÆÂÆâÂÖ®ÔºåÂà†Èô§ StatefulSet Êó∂‰∏ç‰ºöÂà†Èô§ Volume</li>
<li>StatefulSet ÈúÄË¶Å‰∏Ä‰∏™ Headless Service Êù•ÂÆö‰πâ DNS domainÔºåÈúÄË¶ÅÂú® StatefulSet ‰πãÂâçÂàõÂª∫Â•Ω</li>
</ol>
<p><strong>ÂÆàÊä§ËøõÁ®ã</strong></p>
<p><code>DaemonSet</code></p>
<p>DaemonSet ‰øùËØÅÂú®ÊØè‰∏™ Node ‰∏äÈÉΩËøêË°å‰∏Ä‰∏™ÂÆπÂô®ÂâØÊú¨ÔºåÂ∏∏Áî®Êù•ÈÉ®ÁΩ≤‰∏Ä‰∫õÈõÜÁæ§ÁöÑÊó•Âøó„ÄÅÁõëÊéßÊàñËÄÖÂÖ∂‰ªñÁ≥ªÁªüÁÆ°ÁêÜÂ∫îÁî®„ÄÇÂÖ∏ÂûãÁöÑÂ∫îÁî®ÂåÖÊã¨Ôºö</p>
<ul>
<li>Êó•ÂøóÊî∂ÈõÜÔºåÊØîÂ¶Ç fluentdÔºålogstash Á≠â</li>
<li>Á≥ªÁªüÁõëÊéßÔºåÊØîÂ¶Ç Prometheus Node ExporterÔºåcollectdÔºåNew Relic agentÔºåGanglia gmond Á≠â</li>
<li>Á≥ªÁªüÁ®ãÂ∫èÔºåÊØîÂ¶Ç kube-proxy, kube-dns, glusterd, ceph Á≠â</li>
</ul>
<p><strong>‰ªªÂä°/ÂÆöÊó∂‰ªªÂä°</strong></p>
<ol>
<li>Job</li>
<li>CronJob</li>
</ol>
<h6 id="ÊúçÂä°ÂèëÁé∞">ÊúçÂä°ÂèëÁé∞
</h6><p><code>Service</code></p>
<p>‚ÄúService‚Äù ÁÆÄÂÜô ‚Äúsvc‚Äù„ÄÇPod ‰∏çËÉΩÁõ¥Êé•Êèê‰æõÁªôÂ§ñÁΩëËÆøÈóÆÔºåËÄåÊòØÂ∫îËØ•‰ΩøÁî® service„ÄÇService Â∞±ÊòØÊää Pod Êö¥Èú≤Âá∫Êù•Êèê‰æõÊúçÂä°ÔºåService ÊâçÊòØÁúüÊ≠£ÁöÑ‚ÄúÊúçÂä°‚ÄùÔºåÂÆÉÁöÑ‰∏≠ÊñáÂêçÂ∞±Âè´‚ÄúÊúçÂä°‚Äù„ÄÇ</p>
<p>ÂèØ‰ª•ËØ¥ Service ÊòØ‰∏Ä‰∏™Â∫îÁî®ÊúçÂä°ÁöÑÊäΩË±°ÔºåÂÆö‰πâ‰∫Ü Pod ÈÄªËæëÈõÜÂêàÂíåËÆøÈóÆËøô‰∏™ Pod ÈõÜÂêàÁöÑÁ≠ñÁï•„ÄÇService ‰ª£ÁêÜ Pod ÈõÜÂêàÔºåÂØπÂ§ñË°®Áé∞‰∏∫‰∏Ä‰∏™ËÆøÈóÆÂÖ•Âè£ÔºåËÆøÈóÆËØ•ÂÖ•Âè£ÁöÑËØ∑Ê±ÇÂ∞ÜÁªèËøáË¥üËΩΩÂùáË°°ÔºåËΩ¨ÂèëÂà∞ÂêéÁ´Ø Pod ‰∏≠ÁöÑÂÆπÂô®„ÄÇ</p>
<p><code>Ingress</code></p>
<p>Ingress ÂèØ‰ª•Êèê‰æõÂ§ñÁΩëËÆøÈóÆ Service ÁöÑËÉΩÂäõ„ÄÇÂèØ‰ª•ÊääÊüê‰∏™ËØ∑Ê±ÇÂú∞ÂùÄÊò†Â∞Ñ„ÄÅË∑ØÁî±Âà∞ÁâπÂÆöÁöÑ service„ÄÇ</p>
<p>ingress ÈúÄË¶ÅÈÖçÂêà ingress controller ‰∏ÄËµ∑‰ΩøÁî®ÊâçËÉΩÂèëÊå•‰ΩúÁî®Ôºåingress Âè™ÊòØÁõ∏ÂΩì‰∫éË∑ØÁî±ËßÑÂàôÁöÑÈõÜÂêàËÄåÂ∑≤ÔºåÁúüÊ≠£ÂÆûÁé∞Ë∑ØÁî±ÂäüËÉΩÁöÑÔºåÊòØ Ingress ControllerÔºåingress controller ÂíåÂÖ∂ÂÆÉ k8s ÁªÑ‰ª∂‰∏ÄÊ†∑Ôºå‰πüÊòØÂú® Pod ‰∏≠ËøêË°å„ÄÇ</p>
<h6 id="Â≠òÂÇ®">Â≠òÂÇ®
</h6><p><code>Volume</code></p>
<p>Êï∞ÊçÆÂç∑ÔºåÂÖ±‰∫´ Pod ‰∏≠ÂÆπÂô®‰ΩøÁî®ÁöÑÊï∞ÊçÆ„ÄÇÁî®Êù•ÊîæÊåÅ‰πÖÂåñÁöÑÊï∞ÊçÆÔºåÊØîÂ¶ÇÊï∞ÊçÆÂ∫ìÊï∞ÊçÆ„ÄÇ</p>
<p><code>CSI</code></p>
<p>Container Storage Interface ÊòØÁî±Êù•Ëá™ Kubernetes„ÄÅMesos„ÄÅDocker Á≠âÁ§æÂå∫ÊàêÂëòËÅîÂêàÂà∂ÂÆöÁöÑ‰∏Ä‰∏™Ë°å‰∏öÊ†áÂáÜÊé•Âè£ËßÑËåÉÔºåÊó®Âú®Â∞Ü‰ªªÊÑèÂ≠òÂÇ®Á≥ªÁªüÊö¥Èú≤ÁªôÂÆπÂô®ÂåñÂ∫îÁî®Á®ãÂ∫è„ÄÇ</p>
<p>CSI ËßÑËåÉÂÆö‰πâ‰∫ÜÂ≠òÂÇ®Êèê‰æõÂïÜÂÆûÁé∞ CSI ÂÖºÂÆπÁöÑ Volume Plugin ÁöÑÊúÄÂ∞èÊìç‰ΩúÈõÜÂíåÈÉ®ÁΩ≤Âª∫ËÆÆ„ÄÇCSI ËßÑËåÉÁöÑ‰∏ªË¶ÅÁÑ¶ÁÇπÊòØÂ£∞Êòé Volume Plugin ÂøÖÈ°ªÂÆûÁé∞ÁöÑÊé•Âè£„ÄÇ</p>
<h6 id="ÁâπÊÆäÁ±ªÂûãÈÖçÁΩÆ">ÁâπÊÆäÁ±ªÂûãÈÖçÁΩÆ
</h6><p><code>ConfigMap</code></p>
<p>Áî®Êù•ÊîæÈÖçÁΩÆÔºå‰∏é Secret ÊòØÁ±ª‰ººÁöÑÔºåÂè™ÊòØ ConfigMap ÊîæÁöÑÊòØÊòéÊñáÁöÑÊï∞ÊçÆÔºåSecret ÊòØÂØÜÊñáÂ≠òÊîæ„ÄÇ</p>
<p><code>Secret</code></p>
<p>Secret Ëß£ÂÜ≥‰∫ÜÂØÜÁ†Å„ÄÅtoken„ÄÅÂØÜÈí•Á≠âÊïèÊÑüÊï∞ÊçÆÁöÑÈÖçÁΩÆÈóÆÈ¢òÔºåËÄå‰∏çÈúÄË¶ÅÊääËøô‰∫õÊïèÊÑüÊï∞ÊçÆÊö¥Èú≤Âà∞ÈïúÂÉèÊàñËÄÖ Pod Spec ‰∏≠„ÄÇSecret ÂèØ‰ª•‰ª• Volume ÊàñËÄÖÁéØÂ¢ÉÂèòÈáèÁöÑÊñπÂºè‰ΩøÁî®„ÄÇ</p>
<p><strong>Secret Êúâ‰∏âÁßçÁ±ªÂûãÔºö</strong></p>
<ul>
<li>Service AccountÔºöÁî®Êù•ËÆøÈóÆ Kubernetes APIÔºåÁî± Kubernetes Ëá™Âä®ÂàõÂª∫ÔºåÂπ∂‰∏î‰ºöËá™Âä®ÊåÇËΩΩÂà∞ Pod ÁöÑ /run/secrets/kubernetes.io/serviceaccount ÁõÆÂΩï‰∏≠Ôºõ</li>
<li>OpaqueÔºöbase64 ÁºñÁ†ÅÊ†ºÂºèÁöÑ SecretÔºåÁî®Êù•Â≠òÂÇ®ÂØÜÁ†Å„ÄÅÂØÜÈí•Á≠âÔºõ</li>
<li>kubernetes.io/dockerconfigjsonÔºöÁî®Êù•Â≠òÂÇ®ÁßÅÊúâ docker registry ÁöÑËÆ§ËØÅ‰ø°ÊÅØ„ÄÇ</li>
</ul>
<p><code>DownwardAPI</code></p>
<p>downwardAPI Ëøô‰∏™Ê®°ÂºèÂíåÂÖ∂‰ªñÊ®°Âºè‰∏ç‰∏ÄÊ†∑ÁöÑÂú∞ÊñπÂú®‰∫éÂÆÉ‰∏çÊòØ‰∏∫‰∫ÜÂ≠òÊîæÂÆπÂô®ÁöÑÊï∞ÊçÆ‰πü‰∏çÊòØÁî®Êù•ËøõË°åÂÆπÂô®ÂíåÂÆø‰∏ªÊú∫ÁöÑÊï∞ÊçÆ‰∫§Êç¢ÁöÑÔºåËÄåÊòØËÆ© pod ÈáåÁöÑÂÆπÂô®ËÉΩÂ§üÁõ¥Êé•Ëé∑ÂèñÂà∞Ëøô‰∏™ pod ÂØπË±°Êú¨Ë∫´ÁöÑ‰∏Ä‰∫õ‰ø°ÊÅØ„ÄÇ</p>
<p>downwardAPI Êèê‰æõ‰∫Ü‰∏§ÁßçÊñπÂºèÁî®‰∫éÂ∞Ü pod ÁöÑ‰ø°ÊÅØÊ≥®ÂÖ•Âà∞ÂÆπÂô®ÂÜÖÈÉ®Ôºö</p>
<p>ÁéØÂ¢ÉÂèòÈáèÔºöÁî®‰∫éÂçï‰∏™ÂèòÈáèÔºåÂèØ‰ª•Â∞Ü pod ‰ø°ÊÅØÂíåÂÆπÂô®‰ø°ÊÅØÁõ¥Êé•Ê≥®ÂÖ•ÂÆπÂô®ÂÜÖÈÉ®</p>
<p>volume ÊåÇËΩΩÔºöÂ∞Ü pod ‰ø°ÊÅØÁîüÊàê‰∏∫Êñá‰ª∂ÔºåÁõ¥Êé•ÊåÇËΩΩÂà∞ÂÆπÂô®ÂÜÖÈÉ®‰∏≠Âéª</p>
<h6 id="ÂÖ∂‰ªñ">ÂÖ∂‰ªñ
</h6><p><code>Role</code></p>
<p>Role ÊòØ‰∏ÄÁªÑÊùÉÈôêÁöÑÈõÜÂêàÔºå‰æãÂ¶Ç Role ÂèØ‰ª•ÂåÖÂê´ÂàóÂá∫ Pod ÊùÉÈôêÂèäÂàóÂá∫ Deployment ÊùÉÈôêÔºåRole Áî®‰∫éÁªôÊüê‰∏™ Namespace ‰∏≠ÁöÑËµÑÊ∫êËøõË°åÈâ¥ÊùÉ„ÄÇ</p>
<p><code>RoleBinding</code></p>
<p>RoleBinding ÔºöÂ∞Ü Subject ÁªëÂÆöÂà∞ RoleÔºåRoleBinding ‰ΩøËßÑÂàôÂú®ÂëΩÂêçÁ©∫Èó¥ÂÜÖÁîüÊïà„ÄÇ</p>
<h4 id="ÂØπË±°ËßÑÁ∫¶ÂíåÁä∂ÊÄÅ">ÂØπË±°ËßÑÁ∫¶ÂíåÁä∂ÊÄÅ
</h4><p>ÂØπË±°ÊòØÁî®Êù•ÂÆåÊàê‰∏Ä‰∫õ‰ªªÂä°ÁöÑÔºåÊòØÊåÅ‰πÖÁöÑÔºåÊòØÊúâÁõÆÁöÑÊÄßÁöÑÔºåÂõ†Ê≠§ kubernetes ÂàõÂª∫‰∏Ä‰∏™ÂØπË±°ÂêéÔºåÂ∞ÜÊåÅÁª≠Âú∞Â∑•‰Ωú‰ª•Á°Æ‰øùÂØπË±°Â≠òÂú®„ÄÇÂΩìÁÑ∂Ôºåkubernetes Âπ∂‰∏çÂè™ÊòØÁª¥ÊåÅÂØπË±°ÁöÑÂ≠òÂú®Ëøô‰πàÁÆÄÂçïÔºåkubernetes ËøòÁÆ°ÁêÜÁùÄÂØπË±°ÁöÑÊñπÊñπÈù¢Èù¢„ÄÇÊØè‰∏™ Kubernetes ÂØπË±°ÂåÖÂê´‰∏§‰∏™ÂµåÂ•óÁöÑÂØπË±°Â≠óÊÆµÔºåÂÆÉ‰ª¨Ë¥üË¥£ÁÆ°ÁêÜÂØπË±°ÁöÑÈÖçÁΩÆÔºå‰ªñ‰ª¨ÂàÜÂà´ÊòØ ‚Äúspec‚Äù Âíå ‚Äústatus‚Äù „ÄÇ</p>
<h5 id="ËßÑÁ∫¶spec">ËßÑÁ∫¶ÔºàSpecÔºâ
</h5><p>‚Äúspec‚Äù ÊòØ ‚ÄúËßÑÁ∫¶‚Äù„ÄÅ‚ÄúËßÑÊ†º‚Äù ÁöÑÊÑèÊÄùÔºåspec ÊòØÂøÖÈúÄÁöÑÔºåÂÆÉÊèèËø∞‰∫ÜÂØπË±°ÁöÑÊúüÊúõÁä∂ÊÄÅÔºàDesired StateÔºâ‚Äî‚Äî Â∏åÊúõÂØπË±°ÊâÄÂÖ∑ÊúâÁöÑÁâπÂæÅ„ÄÇÂΩìÂàõÂª∫ Kubernetes ÂØπË±°Êó∂ÔºåÂøÖÈ°ªÊèê‰æõÂØπË±°ÁöÑËßÑÁ∫¶ÔºåÁî®Êù•ÊèèËø∞ËØ•ÂØπË±°ÁöÑÊúüÊúõÁä∂ÊÄÅÔºå‰ª•ÂèäÂÖ≥‰∫éÂØπË±°ÁöÑ‰∏Ä‰∫õÂü∫Êú¨‰ø°ÊÅØÔºà‰æãÂ¶ÇÂêçÁß∞Ôºâ„ÄÇ</p>
<h5 id="Áä∂ÊÄÅstatus">Áä∂ÊÄÅÔºàStatusÔºâ
</h5><p>Ë°®Á§∫ÂØπË±°ÁöÑÂÆûÈôÖÁä∂ÊÄÅÔºåËØ•Â±ûÊÄßÁî± k8s Ëá™Â∑±Áª¥Êä§Ôºåk8s ‰ºöÈÄöËøá‰∏ÄÁ≥ªÂàóÁöÑ<code>ÊéßÂà∂Âô®</code>ÂØπ<code>ÂØπÂ∫îÂØπË±°</code>ËøõË°åÁÆ°ÁêÜÔºåËÆ©ÂØπË±°Â∞ΩÂèØËÉΩÁöÑËÆ©ÂÆûÈôÖÁä∂ÊÄÅ‰∏éÊúüÊúõÁä∂ÊÄÅÈáçÂêà„ÄÇ</p>
<h2 id="k8s-ÂÆûÊàòËøõÈò∂">K8S ÂÆûÊàòËøõÈò∂
</h2><h3 id="Êê≠Âª∫-kubernetes-ÈõÜÁæ§">Êê≠Âª∫ Kubernetes ÈõÜÁæ§
</h3><h4 id="Êê≠Âª∫ÊñπÊ°à">Êê≠Âª∫ÊñπÊ°à
</h4><ol>
<li>
<p>minikube</p>
<ul>
<li>
<p><a class="link" href="https://minikube.sigs.k8s.io/"  target="_blank" rel="noopener" >minikube</a> ÊòØ‰∏Ä‰∏™Â∑•ÂÖ∑Ôºå ËÉΩËÆ©‰Ω†Âú®Êú¨Âú∞ËøêË°å Kubernetes„ÄÇ minikube Âú®‰Ω†ÁöÑ‰∏™‰∫∫ËÆ°ÁÆóÊú∫ÔºàÂåÖÊã¨ Windows„ÄÅmacOS Âíå Linux PCÔºâ‰∏äËøêË°å‰∏Ä‰∏™‰∏Ä‰ΩìÂåñÔºàall-in-oneÔºâÊàñÂ§öËäÇÁÇπÁöÑÊú¨Âú∞ Kubernetes ÈõÜÁæ§Ôºå‰ª•‰æø‰Ω†Êù•Â∞ùËØï Kubernetes ÊàñËÄÖÂºÄÂ±ïÊØèÂ§©ÁöÑÂºÄÂèëÂ∑•‰Ωú„ÄÇ</p>
<p><a class="link" href="https://minikube.sigs.k8s.io/docs/start/"  target="_blank" rel="noopener" >ÂÆòÊñπÂÆâË£ÖÊñáÊ°£</a></p>
</li>
</ul>
</li>
<li>
<p><strong><code>kubeadm</code></strong></p>
<ul>
<li>
<p>ÊúçÂä°Âô®Ë¶ÅÊ±Ç</p>
<ol>
<li>3 Âè∞ÊúçÂä°Âô®ÔºàËôöÊãüÊú∫Ôºâ
<ul>
<li>k8s-masterÔºö192.168.133.130</li>
<li>k8s-node1Ôºö192.168.133.131</li>
<li>k8s-node2Ôºö192.168.133.132</li>
</ul>
</li>
<li>ÊúÄ‰ΩéÈÖçÁΩÆÔºö2 Ê†∏„ÄÅ2G ÂÜÖÂ≠ò„ÄÅ20G Á°¨Áõò</li>
<li>ÊúÄÂ•ΩËÉΩËÅîÁΩëÔºå‰∏çËÉΩËÅîÁΩëÁöÑËØùÈúÄË¶ÅÊúâÊèê‰æõÂØπÂ∫îÈïúÂÉèÁöÑÁßÅÊúâ‰ªìÂ∫ì</li>
</ol>
</li>
<li>
<p>ËΩØ‰ª∂ÁéØÂ¢É</p>
<ol>
<li>Êìç‰ΩúÁ≥ªÁªüÔºöCentOS 7</li>
<li>DockerÔºö20+</li>
<li>k8sÔºö1.23.6</li>
</ol>
</li>
<li>
<p>ÂÆâË£ÖÊ≠•È™§</p>
<blockquote>
<p>ÁéØÂ¢ÉÈÖçÁΩÆËøôÈáåÈÄâÊã©<code>20.10.7</code>ÁâàÊú¨ÁöÑ DockerÔºåÂõ†‰∏∫ kubernetes Âú®<code>1.24</code>‰πãÂêéÁöÑÁâàÊú¨‰∏çÂÜçÊîØÊåÅ<code>Docker</code>ÔºåÊâÄ‰ª•ËøôÈáåÈÄâÊã©ÂÆâË£Ö<code>1.23.6</code>ÁâàÊú¨ÁöÑ<code>kubernetes</code></p>
</blockquote>
<p>ËøôÈáåÂáÜÂ§á‰∏â‰∏™ËôöÊãüÊú∫Ôºå‰∏Ä‰∏™‰Ωú‰∏∫<code>master</code>ËäÇÁÇπÔºåÂè¶Â§ñ‰∏§‰∏™ÂàÜÂà´ÊòØ<code>node1</code>Âíå<code>node2</code></p>
<p>‰ª•<code>kubeadm</code>ÁöÑÊñπÂºèËøõË°åÂÆâË£Ö<code>kubernetes</code></p>
<blockquote>
<p><a class="link" href="https://blog.csdn.net/LONG_Yi_1994/article/details/127139637"  target="_blank" rel="noopener" >Âç∏ËΩΩ k8s ÊïôÁ®ã</a></p>
</blockquote>
<p>‰∏ãÈù¢ÂºÄÂßãÂÆâË£Ö<code>k8s</code></p>
<p>Âú®‰∏âÂè∞ËôöÊãüÊú∫‰∏äÈÉΩÈúÄË¶ÅÊâßË°å</p>
<ol>
<li>
<p>ÂàùÂßãÊìç‰Ωú</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># ÂÖ≥Èó≠Èò≤ÁÅ´Â¢ô</span>
</span></span><span class="line"><span class="cl">systemctl stop firewalld
</span></span><span class="line"><span class="cl">systemctl disable firewalld
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ÂÖ≥Èó≠selinux</span>
</span></span><span class="line"><span class="cl">sed -i <span class="s1">&#39;s/enforcing/disabled/&#39;</span> /etc/selinux/config  <span class="c1"># Ê∞∏‰πÖ</span>
</span></span><span class="line"><span class="cl">setenforce <span class="m">0</span>  <span class="c1"># ‰∏¥Êó∂</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ÂÖ≥Èó≠swap</span>
</span></span><span class="line"><span class="cl">swapoff -a  <span class="c1"># ‰∏¥Êó∂</span>
</span></span><span class="line"><span class="cl">sed -ri <span class="s1">&#39;s/.*swap.*/#&amp;/&#39;</span> /etc/fstab    <span class="c1"># Ê∞∏‰πÖ</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ÂÖ≥Èó≠ÂÆåswapÂêéÔºå‰∏ÄÂÆöË¶ÅÈáçÂêØ‰∏Ä‰∏ãËôöÊãüÊú∫ÔºÅÔºÅÔºÅ</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Ê†πÊçÆËßÑÂàíËÆæÁΩÆ‰∏ªÊú∫Âêç</span>
</span></span><span class="line"><span class="cl">hostnamectl set-hostname &lt;hostname&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Âú®masterÊ∑ªÂä†hosts</span>
</span></span><span class="line"><span class="cl">cat &gt;&gt; /etc/hosts <span class="s">&lt;&lt; EOF
</span></span></span><span class="line"><span class="cl"><span class="s">192.168.133.131 k8s-master
</span></span></span><span class="line"><span class="cl"><span class="s">192.168.133.132 k8s-node1
</span></span></span><span class="line"><span class="cl"><span class="s">192.168.133.133 k8s-node2
</span></span></span><span class="line"><span class="cl"><span class="s">EOF</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Â∞ÜÊ°•Êé•ÁöÑIPv4ÊµÅÈáè‰º†ÈÄíÂà∞iptablesÁöÑÈìæ</span>
</span></span><span class="line"><span class="cl">cat &gt; /etc/sysctl.d/k8s.conf <span class="s">&lt;&lt; EOF
</span></span></span><span class="line"><span class="cl"><span class="s">net.bridge.bridge-nf-call-ip6tables = 1
</span></span></span><span class="line"><span class="cl"><span class="s">net.bridge.bridge-nf-call-iptables = 1
</span></span></span><span class="line"><span class="cl"><span class="s">EOF</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">sysctl --system  <span class="c1"># ÁîüÊïà</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Êó∂Èó¥ÂêåÊ≠•</span>
</span></span><span class="line"><span class="cl">yum install ntpdate -y
</span></span><span class="line"><span class="cl">ntpdate time.windows.com
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Êü•ÁúãÂΩìÂâçÊó∂Èó¥</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Â¶ÇÊûúÂèëÁé∞Êó∂Èó¥‰∏çÊ≠£Á°ÆÔºåÂÖàÈáçÂêØ‰∏Ä‰∏ãËôöÊãüÊú∫</span>
</span></span><span class="line"><span class="cl">date
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>ÂÆâË£Ö<code>Docker</code>ËøáÁ®ãË∑≥Ëøá</p>
</blockquote>
</li>
<li>
<p>ÂÆâË£ÖÂü∫Á°ÄËΩØ‰ª∂ÔºàÊâÄÊúâËäÇÁÇπÔºâ</p>
<ol>
<li>
<p>ÂÆâË£Ö Docker</p>
</li>
<li>
<p>Ê∑ªÂä†ÈòøÈáå‰∫ë yum Ê∫ê</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">cat &gt; /etc/yum.repos.d/kubernetes.repo <span class="s">&lt;&lt; EOF
</span></span></span><span class="line"><span class="cl"><span class="s">[kubernetes]
</span></span></span><span class="line"><span class="cl"><span class="s">name=Kubernetes
</span></span></span><span class="line"><span class="cl"><span class="s">baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64
</span></span></span><span class="line"><span class="cl"><span class="s">enabled=1
</span></span></span><span class="line"><span class="cl"><span class="s">gpgcheck=0
</span></span></span><span class="line"><span class="cl"><span class="s">repo_gpgcheck=0
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg
</span></span></span><span class="line"><span class="cl"><span class="s">EOF</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>ÂÆâË£Ö kubeadm„ÄÅkubelet„ÄÅkubectl</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">yum install -y kubelet-1.23.6 kubeadm-1.23.6 kubectl-1.23.6
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">systemctl <span class="nb">enable</span> kubelet
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">systemctl status kubelet
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ÈÖçÁΩÆÂÖ≥Èó≠ Docker ÁöÑ cgroupsÔºå‰øÆÊîπ /etc/docker/daemon.jsonÔºåÂä†ÂÖ•‰ª•‰∏ãÂÜÖÂÆπ</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;exec-opts&#34;</span>: <span class="o">[</span><span class="s2">&#34;native.cgroupdriver=systemd&#34;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ÈáçÂêØ docker</span>
</span></span><span class="line"><span class="cl">systemctl daemon-reload
</span></span><span class="line"><span class="cl">systemctl restart docker
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ol>
</li>
<li>
<p>ÈÉ®ÁΩ≤ Kubernetes Master</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># Âú® Master ËäÇÁÇπ‰∏ãÊâßË°å</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">kubeadm init <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      --apiserver-advertise-address<span class="o">=</span>192.168.133.131 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      --image-repository registry.aliyuncs.com/google_containers <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      --kubernetes-version v1.23.6 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      --service-cidr<span class="o">=</span>10.96.0.0/12 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      --pod-network-cidr<span class="o">=</span>10.244.0.0/16
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ÂÆâË£ÖÊàêÂäüÂêéÔºåÂ§çÂà∂Â¶Ç‰∏ãÈÖçÁΩÆÂπ∂ÊâßË°å</span>
</span></span><span class="line"><span class="cl">mkdir -p <span class="nv">$HOME</span>/.kube
</span></span><span class="line"><span class="cl">sudo cp -i /etc/kubernetes/admin.conf <span class="nv">$HOME</span>/.kube/config
</span></span><span class="line"><span class="cl">sudo chown <span class="k">$(</span>id -u<span class="k">)</span>:<span class="k">$(</span>id -g<span class="k">)</span> <span class="nv">$HOME</span>/.kube/config
</span></span><span class="line"><span class="cl">kubectl get nodes
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÊâßË°å‰πãÂêéÁúãÂà∞Â¶Ç‰∏ã‰ø°ÊÅØ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">Your</span> <span class="n">Kubernetes</span> <span class="n">control</span><span class="o">-</span><span class="n">plane</span> <span class="n">has</span> <span class="n">initialized</span> <span class="n">successfully</span><span class="o">!</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">To</span> <span class="n">start</span> <span class="n">using</span> <span class="n">your</span> <span class="n">cluster</span><span class="p">,</span> <span class="n">you</span> <span class="n">need</span> <span class="n">to</span> <span class="n">run</span> <span class="n">the</span> <span class="n">following</span> <span class="n">as</span> <span class="n">a</span> <span class="n">regular</span> <span class="n">user</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">mkdir</span> <span class="o">-</span><span class="n">p</span> <span class="o">$</span><span class="n">HOME</span><span class="o">/.</span><span class="n">kube</span>
</span></span><span class="line"><span class="cl">  <span class="n">sudo</span> <span class="n">cp</span> <span class="o">-</span><span class="n">i</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">kubernetes</span><span class="o">/</span><span class="n">admin</span><span class="o">.</span><span class="n">conf</span> <span class="o">$</span><span class="n">HOME</span><span class="o">/.</span><span class="n">kube</span><span class="o">/</span><span class="n">config</span>
</span></span><span class="line"><span class="cl">  <span class="n">sudo</span> <span class="n">chown</span> <span class="o">$</span><span class="p">(</span><span class="n">id</span> <span class="o">-</span><span class="n">u</span><span class="p">):</span><span class="o">$</span><span class="p">(</span><span class="n">id</span> <span class="o">-</span><span class="n">g</span><span class="p">)</span> <span class="o">$</span><span class="n">HOME</span><span class="o">/.</span><span class="n">kube</span><span class="o">/</span><span class="n">config</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Alternatively</span><span class="p">,</span> <span class="k">if</span> <span class="n">you</span> <span class="n">are</span> <span class="n">the</span> <span class="n">root</span> <span class="n">user</span><span class="p">,</span> <span class="n">you</span> <span class="n">can</span> <span class="n">run</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">export</span> <span class="n">KUBECONFIG</span><span class="o">=/</span><span class="n">etc</span><span class="o">/</span><span class="n">kubernetes</span><span class="o">/</span><span class="n">admin</span><span class="o">.</span><span class="n">conf</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">You</span> <span class="n">should</span> <span class="n">now</span> <span class="n">deploy</span> <span class="n">a</span> <span class="n">pod</span> <span class="n">network</span> <span class="n">to</span> <span class="n">the</span> <span class="n">cluster</span><span class="o">.</span>
</span></span><span class="line"><span class="cl"><span class="n">Run</span> <span class="s2">&#34;kubectl apply -f [podnetwork].yaml&#34;</span> <span class="n">with</span> <span class="n">one</span> <span class="n">of</span> <span class="n">the</span> <span class="n">options</span> <span class="n">listed</span> <span class="n">at</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">  <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">kubernetes</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">docs</span><span class="o">/</span><span class="n">concepts</span><span class="o">/</span><span class="n">cluster</span><span class="o">-</span><span class="n">administration</span><span class="o">/</span><span class="n">addons</span><span class="o">/</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Then</span> <span class="n">you</span> <span class="n">can</span> <span class="n">join</span> <span class="n">any</span> <span class="n">number</span> <span class="n">of</span> <span class="n">worker</span> <span class="n">nodes</span> <span class="n">by</span> <span class="n">running</span> <span class="n">the</span> <span class="n">following</span> <span class="n">on</span> <span class="n">each</span> <span class="n">as</span> <span class="n">root</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">kubeadm</span> <span class="n">join</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">42.131</span><span class="p">:</span><span class="mi">6443</span> <span class="o">--</span><span class="n">token</span> <span class="n">g9tav3</span><span class="o">.</span><span class="n">xcm2xeniyr5oyib7</span> \
</span></span><span class="line"><span class="cl">	<span class="o">--</span><span class="n">discovery</span><span class="o">-</span><span class="n">token</span><span class="o">-</span><span class="n">ca</span><span class="o">-</span><span class="n">cert</span><span class="o">-</span><span class="nb">hash</span> <span class="n">sha256</span><span class="p">:</span><span class="mi">0</span><span class="n">a77d2c43287e745286bc98863e34ed678f5c9c9ee44a5c179d375755648852a</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>Âä†ÂÖ• Kubernetes Node</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># ÂàÜÂà´Âú® k8s-node1 Âíå k8s-node2 ÊâßË°å</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ‰∏ãÊñπÂëΩ‰ª§ÂèØ‰ª•Âú® k8s master ÊéßÂà∂Âè∞ÂàùÂßãÂåñÊàêÂäüÂêéÂ§çÂà∂ join ÂëΩ‰ª§</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">kubeadm join 192.168.133.131:6443 --token j1wr0y.ej27ox9h3psu96jw --discovery-token-ca-cert-hash sha256:a751ecab11ba054ec4cb70d807de589ae6688324672f02fa4dc62560728d51d4
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Â¶ÇÊûúÂàùÂßãÂåñÁöÑ token ‰∏çÂ∞èÂøÉÊ∏ÖÁ©∫‰∫ÜÔºåÂèØ‰ª•ÈÄöËøáÂ¶Ç‰∏ãÂëΩ‰ª§Ëé∑ÂèñÊàñËÄÖÈáçÊñ∞Áî≥ËØ∑</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Â¶ÇÊûú token Â∑≤ÁªèËøáÊúüÔºåÂ∞±ÈáçÊñ∞Áî≥ËØ∑</span>
</span></span><span class="line"><span class="cl">kubeadm token create
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># token Ê≤°ÊúâËøáÊúüÂèØ‰ª•ÈÄöËøáÂ¶Ç‰∏ãÂëΩ‰ª§Ëé∑Âèñ</span>
</span></span><span class="line"><span class="cl">kubeadm token list
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Ëé∑Âèñ --discovery-token-ca-cert-hash ÂÄºÔºåÂæóÂà∞ÂÄºÂêéÈúÄË¶ÅÂú®ÂâçÈù¢ÊãºÊé•‰∏ä sha256:</span>
</span></span><span class="line"><span class="cl">openssl x509 -pubkey -in /etc/kubernetes/pki/ca.crt <span class="p">|</span> openssl rsa -pubin -outform der 2&gt;/dev/null <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>openssl dgst -sha256 -hex <span class="p">|</span> sed <span class="s1">&#39;s/^.* //&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Âà†Èô§ÊóßÁöÑ kubelet ËØÅ‰π¶Êñá‰ª∂</span>
</span></span><span class="line"><span class="cl">rm -f  /opt/kubernetes/ssl/kubelet*
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Âà†Èô§ kubelet kubeconfig Êñá‰ª∂</span>
</span></span><span class="line"><span class="cl">rm -f /opt/kubernetes/cfg/kubelet.kubeconfig
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ÈáçÂêØ kubelet ÊúçÂä°ÔºåËÆ© master ÈáçÊñ∞È¢ÅÂèëÂÆ¢Êà∑Á´ØËØÅ‰π¶</span>
</span></span><span class="line"><span class="cl">systemctl restart kubelet
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ÈáçÊñ∞join</span>
</span></span><span class="line"><span class="cl">kubeadm join 192.168.133.131:6443 --token f9gwk1.8xastiqq3p9khlzm --discovery-token-ca-cert-hash sha256:7c10606bed070f0eb4ab19399de70744fca7a3e1be7324c9102cb53ba0ac9be6
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂèØ‰ª•ÁúãÂà∞Â≠êËäÇÁÇπÊâìÂç∞Â¶Ç‰∏ãÂÜÖÂÆπÔºå‰ª£Ë°®Â∑≤ÁªèÂä†ÂÖ•<code>k8s</code>ÈõÜÁæ§ÁéØÂ¢É‰∫Ü</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">This node has joined the cluster:
</span></span><span class="line"><span class="cl">* Certificate signing request was sent to apiserver and a response was received.
</span></span><span class="line"><span class="cl">* The Kubelet was informed of the new secure connection details.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Run &#39;kubectl get nodes&#39; on the control-plane to see this node join the cluster
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÊàëÊ≥®ÊÑèÂà∞ kubeadm init Êó∂Êä•Ëøá‰∏§‰∏™Ôºå<code>[WARNING SystemVerification]: this Docker version is not on the list of validated versions: 26.1.4. Latest validated version: 20.10</code></p>
<p>ÂéüÂõ†ÊòØ docker ÁâàÊú¨ÈóÆÈ¢òÔºåÂêéÊù•ÂÆâË£Ö<code>20.10.7</code>ÁâàÊú¨ÁöÑ docker ‰πãÂêéÔºåËØ•Ë≠¶ÂëäÊ∂àÈô§Êéâ‰∫Ü</p>
<p>Á¨¨‰∫å‰∏™Ë≠¶ÂëäÊòØ<code>[WARNING Swap]: swap is enabled; production deployments should disable swap unless testing the NodeSwap feature gate of the kubelet</code></p>
<p>ÊâßË°å‰ª•‰∏ãÂëΩ‰ª§Âç≥ÂèØ<code>swapoff -a</code></p>
</li>
<li>
<p>ÈÉ®ÁΩ≤ CNI ÁΩëÁªúÊèí‰ª∂</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># Âú® master ËäÇÁÇπ‰∏äÊâßË°å</span>
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> /opt/k8s
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ‰∏ãËΩΩ calico ÈÖçÁΩÆÊñá‰ª∂ÔºåÂèØËÉΩ‰ºöÁΩëÁªúË∂ÖÊó∂</span>
</span></span><span class="line"><span class="cl">curl https://docs.projectcalico.org/manifests/calico.yaml -O
</span></span><span class="line"><span class="cl">wget https://docs.projectcalico.org/manifests/calico.yaml
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ‰øÆÊîπ calico.yaml Êñá‰ª∂‰∏≠ÁöÑ CALICO_IPV4POOL_CIDR ÈÖçÁΩÆÔºå‰øÆÊîπ‰∏∫‰∏éÂàùÂßãÂåñÁöÑ cidr Áõ∏Âêå(10.244.0.0/16)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ‰øÆÊîπ IP_AUTODETECTION_METHOD ‰∏ãÁöÑÁΩëÂç°ÂêçÁß∞</span>
</span></span><span class="line"><span class="cl">sed -i <span class="s1">&#39;s/&#34;autodetect&#34;/&#34;autodetect&#34;\n            - name: IP_AUTODETECTION_METHOD\n               value: &#34;interface=ens33&#34;/g&#39;</span> calico.yaml
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Êü•ÁúãÈúÄË¶Å‰∏ãËΩΩÁöÑÈïúÂÉè</span>
</span></span><span class="line"><span class="cl">grep image calico.yaml
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Âà†Èô§ÈïúÂÉè docker.io/ ÂâçÁºÄÔºåÈÅøÂÖç‰∏ãËΩΩËøáÊÖ¢ÂØºËá¥Â§±Ë¥•</span>
</span></span><span class="line"><span class="cl">sed -i <span class="s1">&#39;s#docker.io/##g&#39;</span> calico.yaml
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Êü•ÁúãÂà†Èô§ÂâçÁºÄÁöÑÊìç‰ΩúÊòØÂê¶ÊàêÂäü</span>
</span></span><span class="line"><span class="cl">grep image calico.yaml
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ÊûÑÂª∫Â∫îÁî®</span>
</span></span><span class="line"><span class="cl">kubectl apply -f calico.yaml
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Âà†Èô§Â∫îÁî®</span>
</span></span><span class="line"><span class="cl"><span class="c1"># kubectl delete -f calico.yaml</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Êü•ÁúãÊûÑÂª∫ÁªìÊûú(PendingÂú®ÊâßË°å‰∏≠ÔºåÈúÄË¶ÅÁ≠âÂæÖÂèòÊàêRunning)</span>
</span></span><span class="line"><span class="cl">kubectl get po -n kube-system
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Êü•ÁúãPendingÁä∂ÂÜµ</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Ê†ºÂºè:kubectl describe po &lt;name&gt; -n kube-system</span>
</span></span><span class="line"><span class="cl">kubectl describe po calico-node-sc9g6 -n kube-system
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">docker images <span class="p">|</span> grep calico/cni
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>Â¶ÇÊûúÊãâÂèñÈïúÂÉèË∂ÖÊó∂ÔºåÂèØ‰ª•ÈÄöËøáÈÖçÁΩÆ<code>/etc/docker/daemon.json</code>Êñá‰ª∂</p>
</blockquote>
<p>ÊàëÂú®ÂÆâË£ÖËøáÁ®ã‰∏≠ÈÅáÂà∞ÁöÑÈóÆÈ¢òÂ¶Ç‰∏ã</p>
<p>Êê≠Âª∫ k8s ÈõÜÁæ§Êó∂‰∏ÄÁõ¥ NotReadyÔºåÊàëÈÅáÂà∞ÁöÑÂéüÂõ†ÊòØÈïúÂÉèÊãâÂèñÂ§±Ë¥• calico/cni:v3.25.0„ÄÅcalico/node:v3.25.0ÔºåÈÖçÁΩÆ/etc/docker/daemon.json Êñá‰ª∂Â¶Ç‰∏ã</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;registry-mirrors&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;https://hub.uuuadc.top&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;https://docker.anyhub.us.kg&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;https://dockerhub.jobcher.com&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;https://dockerhub.icu&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;https://docker.ckyl.me&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;https://docker.awsl9527.cn&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;exec-opts&#34;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&#34;native.cgroupdriver=systemd&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;log-driver&#34;</span><span class="p">:</span> <span class="s2">&#34;json-file&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;log-opts&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;max-size&#34;</span><span class="p">:</span> <span class="s2">&#34;100m&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;storage-driver&#34;</span><span class="p">:</span> <span class="s2">&#34;overlay2&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>ÁªßÁª≠‰ΩøÁî®Â¶Ç‰∏ãÂëΩ‰ª§Êõ¥Êñ∞ÈÖçÁΩÆÔºåÂÜçÈáçÊñ∞ pull ‰∏ÄÈÅçÂç≥ÂèØ</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">sudo systemctl daemon-reload
</span></span><span class="line"><span class="cl">sudo systemctl restart docker
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>ÊµãËØï kubernetes ÈõÜÁæ§</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># ÂàõÂª∫ÈÉ®ÁΩ≤</span>
</span></span><span class="line"><span class="cl">kubectl create deployment nginx --image<span class="o">=</span>nginx
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Êö¥Èú≤Á´ØÂè£</span>
</span></span><span class="line"><span class="cl">kubectl expose deployment nginx --port<span class="o">=</span><span class="m">80</span> --type<span class="o">=</span>NodePort
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Êü•Áúã pod ‰ª•ÂèäÊúçÂä°‰ø°ÊÅØ</span>
</span></span><span class="line"><span class="cl">kubectl get pod,svc
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ol>
</li>
</ul>
</li>
<li>
<p>‰∫åËøõÂà∂ÂÆâË£Ö</p>
<ul>
<li>Âà©Áî® k8s ÂÆòÊñπ github ‰ªìÂ∫ì‰∏ãËΩΩ‰∫åËøõÂà∂ÂåÖÂÆâË£ÖÔºåÂÆâË£ÖËøáÁ®ãËæÉÂ§çÊùÇÔºå‰ΩÜÁõ∏ÂØπËæÉ‰∏∫Á®≥ÂÆöÔºåÊé®ËçêÁîü‰∫ßÁéØÂ¢É‰ΩøÁî®„ÄÇ</li>
</ul>
</li>
<li>
<p>ÂëΩ‰ª§Ë°åÂ∑•ÂÖ∑</p>
</li>
</ol>
<h4 id="ÂëΩ‰ª§Ë°åÂ∑•ÂÖ∑-kubectl">ÂëΩ‰ª§Ë°åÂ∑•ÂÖ∑ kubectl
</h4><p>Kubernetes Êèê‰æõ kubectl ÊòØ‰ΩøÁî® Kubernetes API ‰∏é Kubernetes ÈõÜÁæ§ÁöÑ<a class="link" href="https://kubernetes.io/zh-cn/docs/reference/glossary/?all=true#term-control-plane"  target="_blank" rel="noopener" >ÊéßÂà∂Èù¢</a>ËøõË°åÈÄö‰ø°ÁöÑÂëΩ‰ª§Ë°åÂ∑•ÂÖ∑„ÄÇ</p>
<p>Ëøô‰∏™Â∑•ÂÖ∑Âè´ÂÅö kubectl„ÄÇ
<a class="link" href="https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands"  target="_blank" rel="noopener" >Êõ¥Â§öÂëΩ‰ª§</a></p>
<p><a class="link" href="https://kubernetes.io/zh-cn/docs/reference/kubectl/generated/kubectl/"  target="_blank" rel="noopener" >kubectl ÂëΩ‰ª§</a></p>
<h5 id="Âú®‰ªªÊÑèËäÇÁÇπ‰ΩøÁî®-kubectl">Âú®‰ªªÊÑèËäÇÁÇπ‰ΩøÁî® kubectl
</h5><h6 id="Â∞Ü-master-ËäÇÁÇπ‰∏≠-etckubernetesadminconf-Êã∑Ë¥ùÂà∞ÈúÄË¶ÅËøêË°åÁöÑÊúçÂä°Âô®ÁöÑ-etckubernetes-ÁõÆÂΩï‰∏≠">Â∞Ü master ËäÇÁÇπ‰∏≠ /etc/kubernetes/admin.conf Êã∑Ë¥ùÂà∞ÈúÄË¶ÅËøêË°åÁöÑÊúçÂä°Âô®ÁöÑ /etc/kubernetes ÁõÆÂΩï‰∏≠
</h6><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">scp /etc/kubernetes/admin.conf root@k8s-node1:/etc/kubernetes
</span></span><span class="line"><span class="cl">scp /etc/kubernetes/admin.conf root@k8s-node2:/etc/kubernetes
</span></span></code></pre></td></tr></table>
</div>
</div><h6 id="Âú®ÂØπÂ∫îÁöÑÊúçÂä°Âô®‰∏äÈÖçÁΩÆÁéØÂ¢ÉÂèòÈáè">Âú®ÂØπÂ∫îÁöÑÊúçÂä°Âô®‰∏äÈÖçÁΩÆÁéØÂ¢ÉÂèòÈáè
</h6><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;export KUBECONFIG=/etc/kubernetes/admin.conf&#34;</span> &gt;&gt; ~/.bash_profile
</span></span><span class="line"><span class="cl"><span class="nb">source</span> ~/.bash_profile
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>Âú®Â≠êËäÇÁÇπ‰∏äÊâßË°å<code>kubectl</code>ÂëΩ‰ª§Êü•ÁúãÊòØÂê¶ÊàêÂäü</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">kubectl get pod,svc
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="ËµÑÊ∫êÊìç‰Ωú">ËµÑÊ∫êÊìç‰Ωú
</h5><h6 id="ÂàõÂª∫ÂØπË±°">ÂàõÂª∫ÂØπË±°
</h6><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">kubectl create -f ./my-manifest.yaml           <span class="c1"># ÂàõÂª∫ËµÑÊ∫ê</span>
</span></span><span class="line"><span class="cl">kubectl create -f ./my1.yaml -f ./my2.yaml     <span class="c1"># ‰ΩøÁî®Â§ö‰∏™Êñá‰ª∂ÂàõÂª∫ËµÑÊ∫ê</span>
</span></span><span class="line"><span class="cl">kubectl create -f ./dir                        <span class="c1"># ‰ΩøÁî®ÁõÆÂΩï‰∏ãÁöÑÊâÄÊúâÊ∏ÖÂçïÊñá‰ª∂Êù•ÂàõÂª∫ËµÑÊ∫ê</span>
</span></span><span class="line"><span class="cl">kubectl create -f https://git.io/vPieo         <span class="c1"># ‰ΩøÁî® url Êù•ÂàõÂª∫ËµÑÊ∫ê</span>
</span></span><span class="line"><span class="cl">kubectl run nginx --image<span class="o">=</span>nginx                <span class="c1"># ÂêØÂä®‰∏Ä‰∏™ nginx ÂÆû‰æã</span>
</span></span><span class="line"><span class="cl">kubectl explain pods,svc                       <span class="c1"># Ëé∑Âèñ pod Âíå svc ÁöÑÊñáÊ°£</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ‰ªé stdin ËæìÂÖ•‰∏≠ÂàõÂª∫Â§ö‰∏™ YAML ÂØπË±°</span>
</span></span><span class="line"><span class="cl">cat <span class="s">&lt;&lt;EOF | kubectl create -f -
</span></span></span><span class="line"><span class="cl"><span class="s">apiVersion: v1
</span></span></span><span class="line"><span class="cl"><span class="s">kind: Pod
</span></span></span><span class="line"><span class="cl"><span class="s">metadata:
</span></span></span><span class="line"><span class="cl"><span class="s">  name: busybox-sleep
</span></span></span><span class="line"><span class="cl"><span class="s">spec:
</span></span></span><span class="line"><span class="cl"><span class="s">  containers:
</span></span></span><span class="line"><span class="cl"><span class="s">  - name: busybox
</span></span></span><span class="line"><span class="cl"><span class="s">    image: busybox
</span></span></span><span class="line"><span class="cl"><span class="s">    args:
</span></span></span><span class="line"><span class="cl"><span class="s">    - sleep
</span></span></span><span class="line"><span class="cl"><span class="s">    - &#34;1000000&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">---
</span></span></span><span class="line"><span class="cl"><span class="s">apiVersion: v1
</span></span></span><span class="line"><span class="cl"><span class="s">kind: Pod
</span></span></span><span class="line"><span class="cl"><span class="s">metadata:
</span></span></span><span class="line"><span class="cl"><span class="s">  name: busybox-sleep-less
</span></span></span><span class="line"><span class="cl"><span class="s">spec:
</span></span></span><span class="line"><span class="cl"><span class="s">  containers:
</span></span></span><span class="line"><span class="cl"><span class="s">  - name: busybox
</span></span></span><span class="line"><span class="cl"><span class="s">    image: busybox
</span></span></span><span class="line"><span class="cl"><span class="s">    args:
</span></span></span><span class="line"><span class="cl"><span class="s">    - sleep
</span></span></span><span class="line"><span class="cl"><span class="s">    - &#34;1000&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">EOF</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ÂàõÂª∫ÂåÖÂê´Âá†‰∏™ key ÁöÑ Secret</span>
</span></span><span class="line"><span class="cl">cat <span class="s">&lt;&lt;EOF | kubectl create -f -
</span></span></span><span class="line"><span class="cl"><span class="s">apiVersion: v1
</span></span></span><span class="line"><span class="cl"><span class="s">kind: Secret
</span></span></span><span class="line"><span class="cl"><span class="s">metadata:
</span></span></span><span class="line"><span class="cl"><span class="s">  name: mysecret
</span></span></span><span class="line"><span class="cl"><span class="s">type: Opaque
</span></span></span><span class="line"><span class="cl"><span class="s">data:
</span></span></span><span class="line"><span class="cl"><span class="s">  password: $(echo &#34;s33msi4&#34; | base64)
</span></span></span><span class="line"><span class="cl"><span class="s">  username: $(echo &#34;jane&#34; | base64)
</span></span></span><span class="line"><span class="cl"><span class="s">EOF</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>nginx-demo.yaml</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w"> </span><span class="c"># apiÊñáÊ°£ÁâàÊú¨</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Pod</span><span class="w"> </span><span class="c"># ËµÑÊ∫êÂØπË±°Á±ªÂûã</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w"> </span><span class="c"># PodÁõ∏ÂÖ≥ÁöÑÂÖÉÊï∞ÊçÆÔºåÁî®‰∫éÊèèËø∞Pod</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx-demo</span><span class="w"> </span><span class="c"># PodÁöÑÂêçÁß∞</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w"> </span><span class="c"># ÂÆö‰πâPodÁöÑÊ†áÁ≠æ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">myFirstApp</span><span class="w"> </span><span class="c"># ‰ª•‰∏ãÂÖ®ÈÉ®ÈÉΩÊòØËá™ÂÆö‰πâÊ†áÁ≠æ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="m">0.0.1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;default&#39;</span><span class="w"> </span><span class="c"># ÂëΩÂêçÁ©∫Èó¥</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w"> </span><span class="c"># ÊúüÊúõPodÊ†πÊçÆËøôÈáåÁöÑÊèèËø∞ËøõË°åÂàõÂª∫</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">containers</span><span class="p">:</span><span class="w"> </span><span class="c"># ÂØπ‰∫éPod‰∏≠ÂÆπÂô®ÁöÑÊèèËø∞</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w"> </span><span class="c"># ÂÆπÂô®ÂêçÁß∞</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">nginx:1.7.9</span><span class="w"> </span><span class="c"># ÊåáÂÆöÂÆπÂô®ÁöÑÈïúÂÉè</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">IfNotPresent</span><span class="w"> </span><span class="c"># ÊåáÂÆöÈïúÂÉèÁöÑÊãâÂèñÁ≠ñÁï•</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="c"># ÊåáÂÆöÂÆπÂô®ÂêØÂä®Êó∂ÔºåÊâßË°åÁöÑÂëΩ‰ª§</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- -<span class="l">g</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="s1">&#39;daemon off;&#39;</span><span class="w"> </span><span class="c"># nginx -g &#39;daemon off;&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">workingDir</span><span class="p">:</span><span class="w"> </span><span class="l">/usr/share/nginx/html</span><span class="w"> </span><span class="c"># ÊåáÂÆöÂ∑•‰ΩúÁõÆÂΩï</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">http</span><span class="w"> </span><span class="c"># Á´ØÂè£ÂêçÁß∞</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w"> </span><span class="c"># ÂÆπÂô®ÂÜÖÊö¥Èú≤ÁöÑÁ´ØÂè£</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">TCP</span><span class="w"> </span><span class="c"># ÊèèËø∞ËØ•Á´ØÂè£ÊòØÂü∫‰∫é‰ªÄ‰πàÂçèËÆÆËøõË°åÈÄöËÆØÁöÑ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">env</span><span class="p">:</span><span class="w"> </span><span class="c"># ÁéØÂ¢ÉÂèòÈáè</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">JVM_OPTS</span><span class="w"> </span><span class="c"># ÁéØÂ¢ÉÂèòÈáèÂêçÁß∞</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;-Xms128m -Xmx128m&#39;</span><span class="w"> </span><span class="c"># ÁéØÂ¢ÉÂèòÈáèÂÄº</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">resources</span><span class="p">:</span><span class="w"> </span><span class="c"># ÈÖçÁΩÆËµÑÊ∫ê</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">requests</span><span class="p">:</span><span class="w"> </span><span class="c"># ÊúÄÂ∞ëÈúÄË¶ÅÂ§öÂ∞ëËµÑÊ∫ê</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="l">100m</span><span class="w"> </span><span class="c"># 1000mÁ≠â‰∫é‰∏Ä‰∏™cpuÊ†∏ÂøÉÔºåÊúÄÂ∞ë‰ΩøÁî®0.1‰∏™Ê†∏ÂøÉ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l">128Mi</span><span class="w"> </span><span class="c"># ÈôêÂà∂ÂÜÖÂ≠òÊúÄÂ∞ë‰ΩøÁî®128ÂÖÜ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">limits</span><span class="p">:</span><span class="w"> </span><span class="c"># ÊúÄÂ§ö‰ΩøÁî®Â§öÂ∞ëËµÑÊ∫ê</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="l">200m</span><span class="w"> </span><span class="c"># ÈôêÂà∂cpuÊúÄÂ§ö‰ΩøÁî®0.2‰∏™Ê†∏ÂøÉ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l">256Mi</span><span class="w"> </span><span class="c"># ÈôêÂà∂ÂÜÖÂ≠òÊúÄÂ§ö‰ΩøÁî®256ÂÖÜ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">restartPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">OnFailure</span><span class="w"> </span><span class="c"># ÈÖçÁΩÆÈáçÂêØÁ≠ñÁï•</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>ÂèØ‰ΩøÁî®Â¶Ç‰∏ãÂëΩ‰ª§ÂàõÂª∫ pod</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">kubectl create -f nginx-demo.yaml
</span></span></code></pre></td></tr></table>
</div>
</div><h6 id="ÊòæÁ§∫ÂíåÊü•ÊâæËµÑÊ∫ê">ÊòæÁ§∫ÂíåÊü•ÊâæËµÑÊ∫ê
</h6><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># Get commands with basic output</span>
</span></span><span class="line"><span class="cl">$ kubectl get services                          <span class="c1"># ÂàóÂá∫ÊâÄÊúâ namespace ‰∏≠ÁöÑÊâÄÊúâ service</span>
</span></span><span class="line"><span class="cl">$ kubectl get pods --all-namespaces             <span class="c1"># ÂàóÂá∫ÊâÄÊúâ namespace ‰∏≠ÁöÑÊâÄÊúâ pod</span>
</span></span><span class="line"><span class="cl">$ kubectl get pods -o wide                      <span class="c1"># ÂàóÂá∫ÊâÄÊúâ pod Âπ∂ÊòæÁ§∫ËØ¶ÁªÜ‰ø°ÊÅØ</span>
</span></span><span class="line"><span class="cl">$ kubectl get deployment my-dep                 <span class="c1"># ÂàóÂá∫ÊåáÂÆö deployment</span>
</span></span><span class="line"><span class="cl">$ kubectl get pods --include-uninitialized      <span class="c1"># ÂàóÂá∫ËØ• namespace ‰∏≠ÁöÑÊâÄÊúâ pod ÂåÖÊã¨Êú™ÂàùÂßãÂåñÁöÑ</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ‰ΩøÁî®ËØ¶ÁªÜËæìÂá∫Êù•ÊèèËø∞ÂëΩ‰ª§</span>
</span></span><span class="line"><span class="cl">$ kubectl describe nodes my-node
</span></span><span class="line"><span class="cl">$ kubectl describe pods my-pod
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ kubectl get services --sort-by<span class="o">=</span>.metadata.name <span class="c1"># List Services Sorted by Name</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Ê†πÊçÆÈáçÂêØÊ¨°Êï∞ÊéíÂ∫èÂàóÂá∫ pod</span>
</span></span><span class="line"><span class="cl">$ kubectl get pods --sort-by<span class="o">=</span><span class="s1">&#39;.status.containerStatuses[0].restartCount&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Ëé∑ÂèñÊâÄÊúâÂÖ∑Êúâ app=cassandra ÁöÑ pod ‰∏≠ÁöÑ version Ê†áÁ≠æ</span>
</span></span><span class="line"><span class="cl">$ kubectl get pods --selector<span class="o">=</span><span class="nv">app</span><span class="o">=</span>cassandra rc -o <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  <span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.items[*].metadata.labels.version}&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Ëé∑ÂèñÊâÄÊúâËäÇÁÇπÁöÑ ExternalIP</span>
</span></span><span class="line"><span class="cl">$ kubectl get nodes -o <span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.items[*].status.addresses[?(@.type==&#34;ExternalIP&#34;)].address}&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ÂàóÂá∫Â±û‰∫éÊüê‰∏™ PC ÁöÑ Pod ÁöÑÂêçÂ≠ó</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ‚Äújq‚ÄùÂëΩ‰ª§Áî®‰∫éËΩ¨Êç¢Â§çÊùÇÁöÑ jsonpathÔºåÂèÇËÄÉ https://stedolan.github.io/jq/</span>
</span></span><span class="line"><span class="cl">$ <span class="nv">sel</span><span class="o">=</span><span class="si">${</span><span class="k">$(</span>kubectl get rc my-rc --output<span class="o">=</span>json <span class="p">|</span> jq -j <span class="s1">&#39;.spec.selector | to_entries | .[] | &#34;\(.key)=\(.value),&#34;&#39;</span><span class="k">)</span><span class="p">%?</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">$ <span class="nb">echo</span> <span class="k">$(</span>kubectl get pods --selector<span class="o">=</span><span class="nv">$sel</span> --output<span class="o">=</span><span class="nv">jsonpath</span><span class="o">={</span>.items..metadata.name<span class="o">}</span><span class="k">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Êü•ÁúãÂì™‰∫õËäÇÁÇπÂ∑≤Â∞±Áª™</span>
</span></span><span class="line"><span class="cl">$ <span class="nv">JSONPATH</span><span class="o">=</span><span class="s1">&#39;{range .items[*]}{@.metadata.name}:{range @.status.conditions[*]}{@.type}={@.status};{end}{end}&#39;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span> <span class="o">&amp;&amp;</span> kubectl get nodes -o <span class="nv">jsonpath</span><span class="o">=</span><span class="s2">&#34;</span><span class="nv">$JSONPATH</span><span class="s2">&#34;</span> <span class="p">|</span> grep <span class="s2">&#34;Ready=True&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ÂàóÂá∫ÂΩìÂâç Pod ‰∏≠‰ΩøÁî®ÁöÑ Secret</span>
</span></span><span class="line"><span class="cl">$ kubectl get pods -o json <span class="p">|</span> jq <span class="s1">&#39;.items[].spec.containers[].env[]?.valueFrom.secretKeyRef.name&#39;</span> <span class="p">|</span> grep -v null <span class="p">|</span> sort <span class="p">|</span> uniq
</span></span></code></pre></td></tr></table>
</div>
</div><h6 id="Êõ¥Êñ∞ËµÑÊ∫ê">Êõ¥Êñ∞ËµÑÊ∫ê
</h6><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ kubectl rolling-update frontend-v1 -f frontend-v2.json           <span class="c1"># ÊªöÂä®Êõ¥Êñ∞ pod frontend-v1</span>
</span></span><span class="line"><span class="cl">$ kubectl rolling-update frontend-v1 frontend-v2 --image<span class="o">=</span>image:v2  <span class="c1"># Êõ¥Êñ∞ËµÑÊ∫êÂêçÁß∞Âπ∂Êõ¥Êñ∞ÈïúÂÉè</span>
</span></span><span class="line"><span class="cl">$ kubectl rolling-update frontend --image<span class="o">=</span>image:v2                 <span class="c1"># Êõ¥Êñ∞ frontend pod ‰∏≠ÁöÑÈïúÂÉè</span>
</span></span><span class="line"><span class="cl">$ kubectl rolling-update frontend-v1 frontend-v2 --rollback        <span class="c1"># ÈÄÄÂá∫Â∑≤Â≠òÂú®ÁöÑËøõË°å‰∏≠ÁöÑÊªöÂä®Êõ¥Êñ∞</span>
</span></span><span class="line"><span class="cl">$ cat pod.json <span class="p">|</span> kubectl replace -f -                              <span class="c1"># Âü∫‰∫é stdin ËæìÂÖ•ÁöÑ JSON ÊõøÊç¢ pod</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Âº∫Âà∂ÊõøÊç¢ÔºåÂà†Èô§ÂêéÈáçÊñ∞ÂàõÂª∫ËµÑÊ∫ê„ÄÇ‰ºöÂØºËá¥ÊúçÂä°‰∏≠Êñ≠„ÄÇ</span>
</span></span><span class="line"><span class="cl">$ kubectl replace --force -f ./pod.json
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ‰∏∫ nginx RC ÂàõÂª∫ÊúçÂä°ÔºåÂêØÁî®Êú¨Âú∞ 80 Á´ØÂè£ËøûÊé•Âà∞ÂÆπÂô®‰∏äÁöÑ 8000 Á´ØÂè£</span>
</span></span><span class="line"><span class="cl">$ kubectl expose rc nginx --port<span class="o">=</span><span class="m">80</span> --target-port<span class="o">=</span><span class="m">8000</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Êõ¥Êñ∞ÂçïÂÆπÂô® pod ÁöÑÈïúÂÉèÁâàÊú¨ÔºàtagÔºâÂà∞ v4</span>
</span></span><span class="line"><span class="cl">$ kubectl get pod mypod -o yaml <span class="p">|</span> sed <span class="s1">&#39;s/\(image: myimage\):.*$/\1:v4/&#39;</span> <span class="p">|</span> kubectl replace -f -
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ kubectl label pods my-pod new-label<span class="o">=</span>awesome                      <span class="c1"># Ê∑ªÂä†Ê†áÁ≠æ</span>
</span></span><span class="line"><span class="cl">$ kubectl annotate pods my-pod icon-url<span class="o">=</span>http://goo.gl/XXBTWq       <span class="c1"># Ê∑ªÂä†Ê≥®Ëß£</span>
</span></span><span class="line"><span class="cl">$ kubectl autoscale deployment foo --min<span class="o">=</span><span class="m">2</span> --max<span class="o">=</span><span class="m">10</span>                <span class="c1"># Ëá™Âä®Êâ©Â±ï deployment ‚Äúfoo‚Äù</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h6 id="‰øÆË°•ËµÑÊ∫ê">‰øÆË°•ËµÑÊ∫ê
</h6><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ kubectl patch node k8s-node-1 -p <span class="s1">&#39;{&#34;spec&#34;:{&#34;unschedulable&#34;:true}}&#39;</span> <span class="c1"># ÈÉ®ÂàÜÊõ¥Êñ∞ËäÇÁÇπ</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Êõ¥Êñ∞ÂÆπÂô®ÈïúÂÉèÔºõ spec.containers[*].name ÊòØÂøÖÈ°ªÁöÑÔºåÂõ†‰∏∫ËøôÊòØÂêàÂπ∂ÁöÑÂÖ≥ÈîÆÂ≠ó</span>
</span></span><span class="line"><span class="cl">$ kubectl patch pod valid-pod -p <span class="s1">&#39;{&#34;spec&#34;:{&#34;containers&#34;:[{&#34;name&#34;:&#34;kubernetes-serve-hostname&#34;,&#34;image&#34;:&#34;new image&#34;}]}}&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ‰ΩøÁî®ÂÖ∑Êúâ‰ΩçÁΩÆÊï∞ÁªÑÁöÑ json Ë°•‰∏ÅÊõ¥Êñ∞ÂÆπÂô®ÈïúÂÉè</span>
</span></span><span class="line"><span class="cl">$ kubectl patch pod valid-pod --type<span class="o">=</span><span class="s1">&#39;json&#39;</span> -p<span class="o">=</span><span class="s1">&#39;[{&#34;op&#34;: &#34;replace&#34;, &#34;path&#34;: &#34;/spec/containers/0/image&#34;, &#34;value&#34;:&#34;new image&#34;}]&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ‰ΩøÁî®ÂÖ∑Êúâ‰ΩçÁΩÆÊï∞ÁªÑÁöÑ json Ë°•‰∏ÅÁ¶ÅÁî® deployment ÁöÑ livenessProbe</span>
</span></span><span class="line"><span class="cl">$ kubectl patch deployment valid-deployment  --type json   -p<span class="o">=</span><span class="s1">&#39;[{&#34;op&#34;: &#34;remove&#34;, &#34;path&#34;: &#34;/spec/template/spec/containers/0/livenessProbe&#34;}]&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h6 id="ÁºñËæëËµÑÊ∫ê">ÁºñËæëËµÑÊ∫ê
</h6><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ kubectl edit svc/docker-registry                      <span class="c1"># ÁºñËæëÂêç‰∏∫ docker-registry ÁöÑ service</span>
</span></span><span class="line"><span class="cl">$ <span class="nv">KUBE_EDITOR</span><span class="o">=</span><span class="s2">&#34;nano&#34;</span> kubectl edit svc/docker-registry   <span class="c1"># ‰ΩøÁî®ÂÖ∂ÂÆÉÁºñËæëÂô®</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h6 id="scale-ËµÑÊ∫ê">scale ËµÑÊ∫ê
</h6><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ kubectl scale --replicas<span class="o">=</span><span class="m">3</span> rs/foo                                 <span class="c1"># Scale a replicaset named &#39;foo&#39; to 3</span>
</span></span><span class="line"><span class="cl">$ kubectl scale --replicas<span class="o">=</span><span class="m">3</span> -f foo.yaml                            <span class="c1"># Scale a resource specified in &#34;foo.yaml&#34; to 3</span>
</span></span><span class="line"><span class="cl">$ kubectl scale --current-replicas<span class="o">=</span><span class="m">2</span> --replicas<span class="o">=</span><span class="m">3</span> deployment/mysql  <span class="c1"># If the deployment named mysql&#39;s current size is 2, scale mysql to 3</span>
</span></span><span class="line"><span class="cl">$ kubectl scale --replicas<span class="o">=</span><span class="m">5</span> rc/foo rc/bar rc/baz                   <span class="c1"># Scale multiple replication controllers</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h6 id="Âà†Èô§ËµÑÊ∫ê">Âà†Èô§ËµÑÊ∫ê
</h6><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ kubectl delete -f ./pod.json                                              <span class="c1"># Âà†Èô§ pod.json Êñá‰ª∂‰∏≠ÂÆö‰πâÁöÑÁ±ªÂûãÂíåÂêçÁß∞ÁöÑ pod</span>
</span></span><span class="line"><span class="cl">$ kubectl delete pod,service baz foo                                        <span class="c1"># Âà†Èô§Âêç‰∏∫‚Äúbaz‚ÄùÁöÑ pod ÂíåÂêç‰∏∫‚Äúfoo‚ÄùÁöÑ service</span>
</span></span><span class="line"><span class="cl">$ kubectl delete pods,services -l <span class="nv">name</span><span class="o">=</span>myLabel                              <span class="c1"># Âà†Èô§ÂÖ∑Êúâ name=myLabel Ê†áÁ≠æÁöÑ pod Âíå serivce</span>
</span></span><span class="line"><span class="cl">$ kubectl delete pods,services -l <span class="nv">name</span><span class="o">=</span>myLabel --include-uninitialized      <span class="c1"># Âà†Èô§ÂÖ∑Êúâ name=myLabel Ê†áÁ≠æÁöÑ pod Âíå serviceÔºåÂåÖÊã¨Â∞öÊú™ÂàùÂßãÂåñÁöÑ</span>
</span></span><span class="line"><span class="cl">$ kubectl -n my-ns delete po,svc --all                                      <span class="c1"># Âà†Èô§ my-ns namespace ‰∏ãÁöÑÊâÄÊúâ pod Âíå serivceÔºåÂåÖÊã¨Â∞öÊú™ÂàùÂßãÂåñÁöÑ</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="pod-‰∏éÈõÜÁæ§">Pod ‰∏éÈõÜÁæ§
</h5><h6 id="‰∏éËøêË°åÁöÑ-pod-‰∫§‰∫í">‰∏éËøêË°åÁöÑ Pod ‰∫§‰∫í
</h6><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ kubectl logs my-pod                                 <span class="c1"># dump ËæìÂá∫ pod ÁöÑÊó•ÂøóÔºàstdoutÔºâ</span>
</span></span><span class="line"><span class="cl">$ kubectl logs my-pod -c my-container                 <span class="c1"># dump ËæìÂá∫ pod ‰∏≠ÂÆπÂô®ÁöÑÊó•ÂøóÔºàstdoutÔºåpod ‰∏≠ÊúâÂ§ö‰∏™ÂÆπÂô®ÁöÑÊÉÖÂÜµ‰∏ã‰ΩøÁî®Ôºâ</span>
</span></span><span class="line"><span class="cl">$ kubectl logs -f my-pod                              <span class="c1"># ÊµÅÂºèËæìÂá∫ pod ÁöÑÊó•ÂøóÔºàstdoutÔºâ</span>
</span></span><span class="line"><span class="cl">$ kubectl logs -f my-pod -c my-container              <span class="c1"># ÊµÅÂºèËæìÂá∫ pod ‰∏≠ÂÆπÂô®ÁöÑÊó•ÂøóÔºàstdoutÔºåpod ‰∏≠ÊúâÂ§ö‰∏™ÂÆπÂô®ÁöÑÊÉÖÂÜµ‰∏ã‰ΩøÁî®Ôºâ</span>
</span></span><span class="line"><span class="cl">$ kubectl run -i --tty busybox --image<span class="o">=</span>busybox -- sh  <span class="c1"># ‰∫§‰∫íÂºè shell ÁöÑÊñπÂºèËøêË°å pod</span>
</span></span><span class="line"><span class="cl">$ kubectl attach my-pod -i                            <span class="c1"># ËøûÊé•Âà∞ËøêË°å‰∏≠ÁöÑÂÆπÂô®</span>
</span></span><span class="line"><span class="cl">$ kubectl port-forward my-pod 5000:6000               <span class="c1"># ËΩ¨Âèë pod ‰∏≠ÁöÑ 6000 Á´ØÂè£Âà∞Êú¨Âú∞ÁöÑ 5000 Á´ØÂè£</span>
</span></span><span class="line"><span class="cl">$ kubectl <span class="nb">exec</span> my-pod -- ls /                         <span class="c1"># Âú®Â∑≤Â≠òÂú®ÁöÑÂÆπÂô®‰∏≠ÊâßË°åÂëΩ‰ª§ÔºàÂè™Êúâ‰∏Ä‰∏™ÂÆπÂô®ÁöÑÊÉÖÂÜµ‰∏ãÔºâ</span>
</span></span><span class="line"><span class="cl">$ kubectl <span class="nb">exec</span> my-pod -c my-container -- ls /         <span class="c1"># Âú®Â∑≤Â≠òÂú®ÁöÑÂÆπÂô®‰∏≠ÊâßË°åÂëΩ‰ª§Ôºàpod ‰∏≠ÊúâÂ§ö‰∏™ÂÆπÂô®ÁöÑÊÉÖÂÜµ‰∏ãÔºâ</span>
</span></span><span class="line"><span class="cl">$ kubectl top pod POD_NAME --containers               <span class="c1"># ÊòæÁ§∫ÊåáÂÆö pod ÂíåÂÆπÂô®ÁöÑÊåáÊ†áÂ∫¶Èáè</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h6 id="‰∏éËäÇÁÇπÂíåÈõÜÁæ§‰∫§‰∫í">‰∏éËäÇÁÇπÂíåÈõÜÁæ§‰∫§‰∫í
</h6><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">$ kubectl cordon my-node                                                <span class="c1"># Ê†áËÆ∞ my-node ‰∏çÂèØË∞ÉÂ∫¶</span>
</span></span><span class="line"><span class="cl">$ kubectl drain my-node                                                 <span class="c1"># Ê∏ÖÁ©∫ my-node ‰ª•ÂæÖÁª¥Êä§</span>
</span></span><span class="line"><span class="cl">$ kubectl uncordon my-node                                              <span class="c1"># Ê†áËÆ∞ my-node ÂèØË∞ÉÂ∫¶</span>
</span></span><span class="line"><span class="cl">$ kubectl top node my-node                                              <span class="c1"># ÊòæÁ§∫ my-node ÁöÑÊåáÊ†áÂ∫¶Èáè</span>
</span></span><span class="line"><span class="cl">$ kubectl cluster-info                                                  <span class="c1"># ÊòæÁ§∫ master ÂíåÊúçÂä°ÁöÑÂú∞ÂùÄ</span>
</span></span><span class="line"><span class="cl">$ kubectl cluster-info dump                                             <span class="c1"># Â∞ÜÂΩìÂâçÈõÜÁæ§Áä∂ÊÄÅËæìÂá∫Âà∞ stdout</span>
</span></span><span class="line"><span class="cl">$ kubectl cluster-info dump --output-directory<span class="o">=</span>/path/to/cluster-state   <span class="c1"># Â∞ÜÂΩìÂâçÈõÜÁæ§Áä∂ÊÄÅËæìÂá∫Âà∞ /path/to/cluster-state</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Â¶ÇÊûúËØ•ÈîÆÂíåÂΩ±ÂìçÁöÑÊ±°ÁÇπÔºàtaintÔºâÂ∑≤Â≠òÂú®ÔºåÂàô‰ΩøÁî®ÊåáÂÆöÁöÑÂÄºÊõøÊç¢</span>
</span></span><span class="line"><span class="cl">$ kubectl taint nodes foo <span class="nv">dedicated</span><span class="o">=</span>special-user:NoSchedule
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="ËµÑÊ∫êÁ±ªÂûã‰∏éÂà´Âêç">ËµÑÊ∫êÁ±ªÂûã‰∏éÂà´Âêç
</h4><h5 id="pods">pods
</h5><blockquote>
<p>po</p>
</blockquote>
<p>Pod ÁöÑËÆæËÆ°ÁêÜÂøµÊòØÊîØÊåÅÂ§ö‰∏™ÂÆπÂô®Âú®‰∏Ä‰∏™ Pod ‰∏≠ÂÖ±‰∫´ÁΩëÁªúÂú∞ÂùÄÂíåÊñá‰ª∂Á≥ªÁªüÔºåÂèØ‰ª•ÈÄöËøáËøõÁ®ãÈó¥ÈÄö‰ø°ÂíåÊñá‰ª∂ÂÖ±‰∫´ËøôÁßçÁÆÄÂçïÈ´òÊïàÁöÑÊñπÂºèÁªÑÂêàÂÆåÊàêÊúçÂä°„ÄÇPod ÂØπÂ§öÂÆπÂô®ÁöÑÊîØÊåÅÊòØ K8 ÊúÄÂü∫Á°ÄÁöÑËÆæËÆ°ÁêÜÂøµ„ÄÇÊØîÂ¶Ç‰Ω†ËøêË°å‰∏Ä‰∏™Êìç‰ΩúÁ≥ªÁªüÂèëË°åÁâàÁöÑËΩØ‰ª∂‰ªìÂ∫ìÔºå‰∏Ä‰∏™ Nginx ÂÆπÂô®Áî®Êù•ÂèëÂ∏ÉËΩØ‰ª∂ÔºåÂè¶‰∏Ä‰∏™ÂÆπÂô®‰∏ìÈó®Áî®Êù•‰ªéÊ∫ê‰ªìÂ∫ìÂÅöÂêåÊ≠•ÔºåËøô‰∏§‰∏™ÂÆπÂô®ÁöÑÈïúÂÉè‰∏çÂ§™ÂèØËÉΩÊòØ‰∏Ä‰∏™Âõ¢ÈòüÂºÄÂèëÁöÑÔºå‰ΩÜÊòØ‰ªñ‰ª¨‰∏ÄÂùóÂÑøÂ∑•‰ΩúÊâçËÉΩÊèê‰æõ‰∏Ä‰∏™ÂæÆÊúçÂä°ÔºõËøôÁßçÊÉÖÂÜµ‰∏ãÔºå‰∏çÂêåÁöÑÂõ¢ÈòüÂêÑËá™ÂºÄÂèëÊûÑÂª∫Ëá™Â∑±ÁöÑÂÆπÂô®ÈïúÂÉèÔºåÂú®ÈÉ®ÁΩ≤ÁöÑÊó∂ÂÄôÁªÑÂêàÊàê‰∏Ä‰∏™ÂæÆÊúçÂä°ÂØπÂ§ñÊèê‰æõÊúçÂä°„ÄÇ</p>
<p>KubernetesÔºàk8sÔºâ‰∏≠ÁöÑ Pod ‰∏é Docker Compose ÊúâÁõ∏‰ºº‰πãÂ§Ñ</p>
<h5 id="replication-controller">Replication Controller
</h5><blockquote>
<p>rcÔºàÂâØÊú¨ÊéßÂà∂Âô®Ôºâ</p>
</blockquote>
<p>RC ÊòØ Kubernetes ÈõÜÁæ§‰∏≠ÊúÄÊó©ÁöÑ‰øùËØÅ Pod È´òÂèØÁî®ÁöÑ API ÂØπË±°„ÄÇÈÄöËøáÁõëÊéßËøêË°å‰∏≠ÁöÑ Pod Êù•‰øùËØÅÈõÜÁæ§‰∏≠ËøêË°åÊåáÂÆöÊï∞ÁõÆÁöÑ Pod ÂâØÊú¨„ÄÇÊåáÂÆöÁöÑÊï∞ÁõÆÂèØ‰ª•ÊòØÂ§ö‰∏™‰πüÂèØ‰ª•ÊòØ 1 ‰∏™ÔºõÂ∞ë‰∫éÊåáÂÆöÊï∞ÁõÆÔºåRC Â∞±‰ºöÂêØÂä®ËøêË°åÊñ∞ÁöÑ Pod ÂâØÊú¨ÔºõÂ§ö‰∫éÊåáÂÆöÊï∞ÁõÆÔºåRC Â∞±‰ºöÊùÄÊ≠ªÂ§ö‰ΩôÁöÑ Pod ÂâØÊú¨„ÄÇÂç≥‰ΩøÂú®ÊåáÂÆöÊï∞ÁõÆ‰∏∫ 1 ÁöÑÊÉÖÂÜµ‰∏ãÔºåÈÄöËøá RC ËøêË°å Pod ‰πüÊØîÁõ¥Êé•ËøêË°å Pod Êõ¥ÊòéÊô∫ÔºåÂõ†‰∏∫ RC ‰πüÂèØ‰ª•ÂèëÊå•ÂÆÉÈ´òÂèØÁî®ÁöÑËÉΩÂäõÔºå‰øùËØÅÊ∞∏ËøúÊúâ 1 ‰∏™ Pod Âú®ËøêË°å„ÄÇRC ÊòØ Kubernetes ËæÉÊó©ÊúüÁöÑÊäÄÊúØÊ¶ÇÂøµÔºåÂè™ÈÄÇÁî®‰∫éÈïøÊúü‰º∫ÊúçÂûãÁöÑ‰∏öÂä°Á±ªÂûãÔºåÊØîÂ¶ÇÊéßÂà∂Â∞èÊú∫Âô®‰∫∫Êèê‰æõÈ´òÂèØÁî®ÁöÑ Web ÊúçÂä°„ÄÇ</p>
<p>Replica Set</p>
<blockquote>
<p>rsÔºàÂâØÊú¨ÈõÜÔºâ</p>
</blockquote>
<p>RS ÊòØÊñ∞‰∏Ä‰ª£ RCÔºåÊèê‰æõÂêåÊ†∑ÁöÑÈ´òÂèØÁî®ËÉΩÂäõÔºåÂå∫Âà´‰∏ªË¶ÅÂú®‰∫é <code>RS</code> ÂêéÊù•Â±Ö‰∏äÔºåËÉΩÊîØÊåÅÊõ¥Â§öÁßçÁ±ªÁöÑÂåπÈÖçÊ®°Âºè„ÄÇÂâØÊú¨ÈõÜÂØπË±°‰∏ÄËà¨‰∏çÂçïÁã¨‰ΩøÁî®ÔºåËÄåÊòØ‰Ωú‰∏∫ Deployment ÁöÑÁêÜÊÉ≥Áä∂ÊÄÅÂèÇÊï∞‰ΩøÁî®„ÄÇ</p>
<h5 id="deployments">deployments
</h5><blockquote>
<p>deploy</p>
</blockquote>
<p>ÈÉ®ÁΩ≤Ë°®Á§∫Áî®Êà∑ÂØπ Kubernetes ÈõÜÁæ§ÁöÑ‰∏ÄÊ¨°Êõ¥Êñ∞Êìç‰Ωú„ÄÇÈÉ®ÁΩ≤ÊòØ‰∏Ä‰∏™ÊØî RS Â∫îÁî®Ê®°ÂºèÊõ¥ÂπøÁöÑ API ÂØπË±°ÔºåÂèØ‰ª•ÊòØÂàõÂª∫‰∏Ä‰∏™Êñ∞ÁöÑÊúçÂä°ÔºåÊõ¥Êñ∞‰∏Ä‰∏™Êñ∞ÁöÑÊúçÂä°Ôºå‰πüÂèØ‰ª•ÊòØÊªöÂä®ÂçáÁ∫ß‰∏Ä‰∏™ÊúçÂä°„ÄÇÊªöÂä®ÂçáÁ∫ß‰∏Ä‰∏™ÊúçÂä°ÔºåÂÆûÈôÖÊòØÂàõÂª∫‰∏Ä‰∏™Êñ∞ÁöÑ RSÔºåÁÑ∂ÂêéÈÄêÊ∏êÂ∞ÜÊñ∞ RS ‰∏≠ÂâØÊú¨Êï∞Â¢ûÂä†Âà∞ÁêÜÊÉ≥Áä∂ÊÄÅÔºåÂ∞ÜÊóß RS ‰∏≠ÁöÑÂâØÊú¨Êï∞ÂáèÂ∞èÂà∞ 0 ÁöÑÂ§çÂêàÊìç‰ΩúÔºõËøôÊ†∑‰∏Ä‰∏™Â§çÂêàÊìç‰ΩúÁî®‰∏Ä‰∏™ RS ÊòØ‰∏çÂ§™Â•ΩÊèèËø∞ÁöÑÔºåÊâÄ‰ª•Áî®‰∏Ä‰∏™Êõ¥ÈÄöÁî®ÁöÑ Deployment Êù•ÊèèËø∞„ÄÇ‰ª• Kubernetes ÁöÑÂèëÂ±ïÊñπÂêëÔºåÊú™Êù•ÂØπÊâÄÊúâÈïøÊúü‰º∫ÊúçÂûãÁöÑÁöÑ‰∏öÂä°ÁöÑÁÆ°ÁêÜÔºåÈÉΩ‰ºöÈÄöËøá Deployment Êù•ÁÆ°ÁêÜ„ÄÇ</p>
<h5 id="statefulset">statefulset
</h5><blockquote>
<p>stsÔºàÊúâÁä∂ÊÄÅÊúçÂä°ÈõÜÔºâ</p>
</blockquote>
<p>RC Âíå RS ‰∏ªË¶ÅÊòØÊéßÂà∂Êèê‰æõÊó†Áä∂ÊÄÅÊúçÂä°ÁöÑÔºåÂÖ∂ÊâÄÊéßÂà∂ÁöÑ Pod ÁöÑÂêçÂ≠óÊòØÈöèÊú∫ËÆæÁΩÆÁöÑÔºå‰∏Ä‰∏™ Pod Âá∫ÊïÖÈöú‰∫ÜÂ∞±Ë¢´‰∏¢ÂºÉÊéâÔºåÂú®Âè¶‰∏Ä‰∏™Âú∞ÊñπÈáçÂêØ‰∏Ä‰∏™Êñ∞ÁöÑ PodÔºåÂêçÂ≠óÂèò‰∫Ü„ÄÇÂêçÂ≠óÂíåÂêØÂä®Âú®Âì™ÂÑøÈÉΩ‰∏çÈáçË¶ÅÔºåÈáçË¶ÅÁöÑÂè™ÊòØ Pod ÊÄªÊï∞ÔºõËÄå StatefulSet ÊòØÁî®Êù•ÊéßÂà∂ÊúâÁä∂ÊÄÅÊúçÂä°ÔºåStatefulSet ‰∏≠ÁöÑÊØè‰∏™ Pod ÁöÑÂêçÂ≠óÈÉΩÊòØ‰∫ãÂÖàÁ°ÆÂÆöÁöÑÔºå‰∏çËÉΩÊõ¥Êîπ„ÄÇ</p>
<p>ÂØπ‰∫é RC Âíå RS ‰∏≠ÁöÑ PodÔºå‰∏ÄËà¨‰∏çÊåÇËΩΩÂ≠òÂÇ®ÊàñËÄÖÊåÇËΩΩÂÖ±‰∫´Â≠òÂÇ®Ôºå‰øùÂ≠òÁöÑÊòØÊâÄÊúâ Pod ÂÖ±‰∫´ÁöÑÁä∂ÊÄÅÔºõÂØπ‰∫é StatefulSet ‰∏≠ÁöÑ PodÔºåÊØè‰∏™ Pod ÊåÇËΩΩËá™Â∑±Áã¨Á´ãÁöÑÂ≠òÂÇ®ÔºåÂ¶ÇÊûú‰∏Ä‰∏™ Pod Âá∫Áé∞ÊïÖÈöúÔºå‰ªéÂÖ∂‰ªñËäÇÁÇπÂêØÂä®‰∏Ä‰∏™ÂêåÊ†∑ÂêçÂ≠óÁöÑ PodÔºåË¶ÅÊåÇËΩΩ‰∏äÂéüÊù• Pod ÁöÑÂ≠òÂÇ®ÁªßÁª≠‰ª•ÂÆÉÁöÑÁä∂ÊÄÅÊèê‰æõÊúçÂä°„ÄÇ</p>
<p>ÈÄÇÂêà‰∫é StatefulSet ÁöÑ‰∏öÂä°ÂåÖÊã¨Êï∞ÊçÆÂ∫ìÊúçÂä° MySQL Âíå PostgreSQLÔºåÈõÜÁæ§ÂåñÁÆ°ÁêÜÊúçÂä° ZooKeeper„ÄÅetcd Á≠âÊúâÁä∂ÊÄÅÊúçÂä°„ÄÇStatefulSet ÁöÑÂè¶‰∏ÄÁßçÂÖ∏ÂûãÂ∫îÁî®Âú∫ÊôØÊòØ‰Ωú‰∏∫‰∏ÄÁßçÊØîÊôÆÈÄöÂÆπÂô®Êõ¥Á®≥ÂÆöÂèØÈù†ÁöÑÊ®°ÊãüËôöÊãüÊú∫ÁöÑÊú∫Âà∂„ÄÇ‰º†ÁªüÁöÑËôöÊãüÊú∫Ê≠£ÊòØ‰∏ÄÁßçÊúâÁä∂ÊÄÅÁöÑÂÆ†Áâ©ÔºåËøêÁª¥‰∫∫ÂëòÈúÄË¶Å‰∏çÊñ≠Âú∞Áª¥Êä§ÂÆÉÔºåÂÆπÂô®ÂàöÂºÄÂßãÊµÅË°åÊó∂ÔºåÊàë‰ª¨Áî®ÂÆπÂô®Êù•Ê®°ÊãüËôöÊãüÊú∫‰ΩøÁî®ÔºåÊâÄÊúâÁä∂ÊÄÅÈÉΩ‰øùÂ≠òÂú®ÂÆπÂô®ÈáåÔºåËÄåËøôÂ∑≤Ë¢´ËØÅÊòéÊòØÈùûÂ∏∏‰∏çÂÆâÂÖ®„ÄÅ‰∏çÂèØÈù†ÁöÑ„ÄÇ‰ΩøÁî® StatefulSetÔºåPod ‰ªçÁÑ∂ÂèØ‰ª•ÈÄöËøáÊºÇÁßªÂà∞‰∏çÂêåËäÇÁÇπÊèê‰æõÈ´òÂèØÁî®ÔºåËÄåÂ≠òÂÇ®‰πüÂèØ‰ª•ÈÄöËøáÂ§ñÊåÇÁöÑÂ≠òÂÇ®Êù•Êèê‰æõÈ´òÂèØÈù†ÊÄßÔºåStatefulSet ÂÅöÁöÑÂè™ÊòØÂ∞ÜÁ°ÆÂÆöÁöÑ Pod ‰∏éÁ°ÆÂÆöÁöÑÂ≠òÂÇ®ÂÖ≥ËÅîËµ∑Êù•‰øùËØÅÁä∂ÊÄÅÁöÑËøûÁª≠ÊÄß„ÄÇ</p>
<h5 id="volume">volume
</h5><p>Kubernetes ÈõÜÁæ§‰∏≠ÁöÑÂ≠òÂÇ®Âç∑Ë∑ü Docker ÁöÑÂ≠òÂÇ®Âç∑Êúâ‰∫õÁ±ª‰ººÔºåÂè™‰∏çËøá Docker ÁöÑÂ≠òÂÇ®Âç∑‰ΩúÁî®ËåÉÂõ¥‰∏∫‰∏Ä‰∏™ÂÆπÂô®ÔºåËÄå Kubernetes ÁöÑÂ≠òÂÇ®Âç∑ÁöÑÁîüÂëΩÂë®ÊúüÂíå‰ΩúÁî®ËåÉÂõ¥ÊòØ‰∏Ä‰∏™ Pod„ÄÇÊØè‰∏™ Pod ‰∏≠Â£∞ÊòéÁöÑÂ≠òÂÇ®Âç∑Áî± Pod ‰∏≠ÁöÑÊâÄÊúâÂÆπÂô®ÂÖ±‰∫´„ÄÇKubernetes ÊîØÊåÅÈùûÂ∏∏Â§öÁöÑÂ≠òÂÇ®Âç∑Á±ªÂûãÔºåÁâπÂà´ÁöÑÔºåÊîØÊåÅÂ§öÁßçÂÖ¨Êúâ‰∫ëÂπ≥Âè∞ÁöÑÂ≠òÂÇ®ÔºåÂåÖÊã¨ AWSÔºåGoogle Âíå Azure ‰∫ëÔºõÊîØÊåÅÂ§öÁßçÂàÜÂ∏ÉÂºèÂ≠òÂÇ®ÂåÖÊã¨ GlusterFS Âíå CephÔºõ‰πüÊîØÊåÅËæÉÂÆπÊòì‰ΩøÁî®ÁöÑ‰∏ªÊú∫Êú¨Âú∞ÁõÆÂΩï emptyDir, hostPath Âíå NFS„ÄÇKubernetes ËøòÊîØÊåÅ‰ΩøÁî® Persistent Volume Claim Âç≥ PVC ËøôÁßçÈÄªËæëÂ≠òÂÇ®Ôºå‰ΩøÁî®ËøôÁßçÂ≠òÂÇ®Ôºå‰ΩøÂæóÂ≠òÂÇ®ÁöÑ‰ΩøÁî®ËÄÖÂèØ‰ª•ÂøΩÁï•ÂêéÂè∞ÁöÑÂÆûÈôÖÂ≠òÂÇ®ÊäÄÊúØÔºà‰æãÂ¶Ç AWSÔºåGoogle Êàñ GlusterFS Âíå CephÔºâÔºåËÄåÂ∞ÜÊúâÂÖ≥Â≠òÂÇ®ÂÆûÈôÖÊäÄÊúØÁöÑÈÖçÁΩÆ‰∫§ÁªôÂ≠òÂÇ®ÁÆ°ÁêÜÂëòÈÄöËøá Persistent Volume Êù•ÈÖçÁΩÆ„ÄÇ</p>
<h5 id="services">services
</h5><blockquote>
<p>svc</p>
</blockquote>
<h5 id="namespace">namespace
</h5><blockquote>
<p>ns</p>
</blockquote>
<p>ÂëΩÂêçÁ©∫Èó¥‰∏∫ Kubernetes ÈõÜÁæ§Êèê‰æõËôöÊãüÁöÑÈöîÁ¶ª‰ΩúÁî®ÔºåKubernetes ÈõÜÁæ§ÂàùÂßãÊúâ‰∏§‰∏™ÂëΩÂêçÁ©∫Èó¥ÔºåÂàÜÂà´ÊòØÈªòËÆ§ÂëΩÂêçÁ©∫Èó¥ default ÂíåÁ≥ªÁªüÂëΩÂêçÁ©∫Èó¥ kube-systemÔºåÈô§Ê≠§‰ª•Â§ñÔºåÁÆ°ÁêÜÂëòÂèØ‰ª•ÂèØ‰ª•ÂàõÂª∫Êñ∞ÁöÑÂëΩÂêçÁ©∫Èó¥Êª°Ë∂≥ÈúÄË¶Å„ÄÇ</p>
<h5 id="nodes">nodes
</h5><blockquote>
<p>no</p>
</blockquote>
<h4 id="Ê†ºÂºèÂåñËæìÂá∫">Ê†ºÂºèÂåñËæìÂá∫
</h4><h5 id="ËæìÂá∫-json-Ê†ºÂºè">ËæìÂá∫ json Ê†ºÂºè
</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">-o json
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="‰ªÖÊâìÂç∞ËµÑÊ∫êÂêçÁß∞">‰ªÖÊâìÂç∞ËµÑÊ∫êÂêçÁß∞
</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">-o name
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="‰ª•Á∫ØÊñáÊú¨Ê†ºÂºèËæìÂá∫ÊâÄÊúâ‰ø°ÊÅØ">‰ª•Á∫ØÊñáÊú¨Ê†ºÂºèËæìÂá∫ÊâÄÊúâ‰ø°ÊÅØ
</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">-o wide
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="ËæìÂá∫-yaml-Ê†ºÂºè">ËæìÂá∫ yaml Ê†ºÂºè
</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">-o yaml
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="api-Ê¶ÇËø∞">API Ê¶ÇËø∞
</h4><p>ÂÆòÁΩëÊñáÊ°£Ôºöhttps://kubernetes.io/zh-cn/docs/reference/using-api/</p>
<p>REST API ÊòØ Kubernetes Á≥ªÁªüÁöÑÈáçË¶ÅÈÉ®ÂàÜÔºåÁªÑ‰ª∂‰πãÈó¥ÁöÑÊâÄÊúâÊìç‰ΩúÂíåÈÄö‰ø°ÂùáÁî± API Server Â§ÑÁêÜÁöÑ REST AP I Ë∞ÉÁî®ÔºåÂ§ßÂ§öÊï∞ÊÉÖÂÜµ‰∏ãÔºå API ÂÆö‰πâÂíåÂÆûÁé∞ÈÉΩÁ¨¶ÂêàÊ†áÂáÜÁöÑ HTTP REST Ê†ºÂºèÔºåÂèØ‰ª•ÈÄöËøá <a class="link" href="http://docs.kubernetes.org.cn/61.html"  target="_blank" rel="noopener" >kubectl</a> ÂëΩ‰ª§ÁÆ°ÁêÜÂ∑•ÂÖ∑ÊàñÂÖ∂‰ªñÂëΩ‰ª§Ë°åÂ∑•ÂÖ∑Êù•ÊâßË°å„ÄÇ</p>
<h5 id="Á±ªÂûã">Á±ªÂûã
</h5><h6 id="alpha">Alpha
</h6><ul>
<li>ÂåÖÂê´ alpha ÂêçÁß∞ÁöÑÁâàÊú¨Ôºà‰æãÂ¶Ç v1alpha1Ôºâ„ÄÇ</li>
<li>ËØ•ËΩØ‰ª∂ÂèØËÉΩÂåÖÂê´ÈîôËØØ„ÄÇÂêØÁî®‰∏Ä‰∏™ÂäüËÉΩÂèØËÉΩ‰ºöÂØºËá¥ bug„ÄÇÈªòËÆ§ÊÉÖÂÜµ‰∏ãÔºåÂäüËÉΩÂèØËÉΩ‰ºöË¢´Á¶ÅÁî®„ÄÇ</li>
<li>ÈöèÊó∂ÂèØËÉΩ‰ºö‰∏¢ÂºÉÂØπËØ•ÂäüËÉΩÁöÑÊîØÊåÅÔºåÊÅï‰∏çÂè¶Ë°åÈÄöÁü•„ÄÇ</li>
<li>API ÂèØËÉΩÂú®‰ª•ÂêéÁöÑËΩØ‰ª∂ÁâàÊú¨‰∏≠‰ª•‰∏çÂÖºÂÆπÁöÑÊñπÂºèÊõ¥ÊîπÔºåÊÅï‰∏çÂè¶Ë°åÈÄöÁü•„ÄÇ</li>
<li>ËØ•ËΩØ‰ª∂Âª∫ËÆÆ‰ªÖÂú®Áü≠ÊúüÊµãËØïÈõÜÁæ§‰∏≠‰ΩøÁî®ÔºåÂõ†‰∏∫ÈîôËØØÁöÑÈ£éÈô©Â¢ûÂä†ÂíåÁº∫‰πèÈïøÊúüÊîØÊåÅ„ÄÇ</li>
</ul>
<h6 id="beta">Beta
</h6><ul>
<li>ÂåÖÂê´ <strong>beta</strong> ÂêçÁß∞ÁöÑÁâàÊú¨Ôºà‰æãÂ¶Ç <strong>v2beta3</strong>Ôºâ„ÄÇ</li>
<li>ËØ•ËΩØ‰ª∂ÁªèËøáÂæàÂ•ΩÁöÑÊµãËØï„ÄÇÂêØÁî®ÂäüËÉΩË¢´ËÆ§‰∏∫ÊòØÂÆâÂÖ®ÁöÑ„ÄÇÈªòËÆ§ÊÉÖÂÜµ‰∏ãÂäüËÉΩÊòØÂºÄÂêØÁöÑ„ÄÇ</li>
<li>ÁªÜËäÇÂèØËÉΩ‰ºöÊîπÂèòÔºå‰ΩÜÂäüËÉΩÂú®ÂêéÁª≠ÁâàÊú¨‰∏ç‰ºöË¢´Âà†Èô§</li>
<li>ÂØπË±°ÁöÑÊ®°ÂºèÊàñËØ≠‰πâÂú®ÈöèÂêéÁöÑ beta ÁâàÊú¨Êàñ Stable ÁâàÊú¨‰∏≠ÂèØËÉΩ‰ª•‰∏çÂÖºÂÆπÁöÑÊñπÂºèÂèëÁîüÂèòÂåñ„ÄÇÂ¶ÇÊûúËøôÁßçÊÉÖÂÜµÂèëÁîüÊó∂ÔºåÂÆòÊñπ‰ºöÊèê‰æõËøÅÁßªÊìç‰ΩúÊåáÂçó„ÄÇËøôÂèØËÉΩÈúÄË¶ÅÂà†Èô§„ÄÅÁºñËæëÂíåÈáçÊñ∞ÂàõÂª∫ API ÂØπË±°„ÄÇ</li>
<li>ËØ•ÁâàÊú¨Âú®ÂêéÁª≠ÂèØËÉΩ‰ºöÊõ¥Êîπ‰∏Ä‰∫õ‰∏çÂÖºÂÆπÂú∞ÊñπÔºåÊâÄ‰ª•Âª∫ËÆÆÁî®‰∫éÈùûÂÖ≥ÈîÆ‰∏öÂä°ÔºåÂ¶ÇÊûú‰Ω†ÊúâÂ§ö‰∏™ÂèØ‰ª•Áã¨Á´ãÂçáÁ∫ßÁöÑÈõÜÁæ§Ôºå‰Ω†‰πüÂèØ‰ª•ÊîæÂÆΩÊ≠§ÈôêÂà∂„ÄÇ</li>
<li><strong>Â§ßÂÆ∂‰ΩøÁî®ËøáÁöÑ Beta ÁâàÊú¨ÂêéÔºåÂèØ‰ª•Â§öÁªôÁ§æÂå∫ÂèçÈ¶àÔºåÂ¶ÇÊûúÊ≠§ÁâàÊú¨Âú®ÂêéÁª≠Êõ¥Êñ∞ÂêéÂ∞Ü‰∏ç‰ºöÊúâÂ§™Â§ßÂèòÂåñ„ÄÇ</strong></li>
</ul>
<h6 id="stable">Stable
</h6><ul>
<li>ËØ•ÁâàÊú¨ÂêçÁß∞ÂëΩÂêçÊñπÂºèÔºö<strong>vX</strong> ËøôÈáå <strong>X</strong> ÊòØ‰∏Ä‰∏™Êï¥Êï∞„ÄÇ</li>
<li>Stable ÁâàÊú¨ÁöÑÂäüËÉΩÁâπÊÄßÔºåÂ∞ÜÂá∫Áé∞Âú®ÂêéÁª≠ÂèëÂ∏ÉÁöÑËΩØ‰ª∂ÁâàÊú¨‰∏≠„ÄÇ</li>
</ul>
<h5 id="ËÆøÈóÆÊéßÂà∂">ËÆøÈóÆÊéßÂà∂
</h5><h6 id="ËÆ§ËØÅ">ËÆ§ËØÅ
</h6><h6 id="ÊéàÊùÉ">ÊéàÊùÉ
</h6><h5 id="Â∫üÂºÉ-api-ËØ¥Êòé">Â∫üÂºÉ api ËØ¥Êòé
</h5><p><a class="link" href="https://kubernetes.io/zh-cn/docs/reference/using-api/deprecation-guide/"  target="_blank" rel="noopener" >Áõ∏ÂÖ≥ÊñáÊ°£</a></p>
<h3 id="Ê∑±ÂÖ•-pod">Ê∑±ÂÖ• Pod
</h3><h4 id="pod-ÈÖçÁΩÆÊñá‰ª∂">Pod ÈÖçÁΩÆÊñá‰ª∂
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w"> </span><span class="c"># api ÊñáÊ°£ÁâàÊú¨</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Pod</span><span class="w"> </span><span class="c"># ËµÑÊ∫êÂØπË±°Á±ªÂûãÔºå‰πüÂèØ‰ª•ÈÖçÁΩÆ‰∏∫ÂÉèDeployment„ÄÅStatefulSetËøô‰∏ÄÁ±ªÁöÑÂØπË±°</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w"> </span><span class="c"># Pod Áõ∏ÂÖ≥ÁöÑÂÖÉÊï∞ÊçÆÔºåÁî®‰∫éÊèèËø∞ Pod ÁöÑÊï∞ÊçÆ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx-demo</span><span class="w"> </span><span class="c"># Pod ÁöÑÂêçÁß∞</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w"> </span><span class="c"># ÂÆö‰πâ Pod ÁöÑÊ†áÁ≠æ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">app</span><span class="w"> </span><span class="c"># Ëá™ÂÆö‰πâ label Ê†áÁ≠æÔºåÂêçÂ≠ó‰∏∫ typeÔºåÂÄº‰∏∫ app</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">test</span><span class="p">:</span><span class="w"> </span><span class="m">1.0.0</span><span class="w"> </span><span class="c"># Ëá™ÂÆö‰πâ label Ê†áÁ≠æÔºåÊèèËø∞ Pod ÁâàÊú¨Âè∑</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;default&#39;</span><span class="w"> </span><span class="c"># ÂëΩÂêçÁ©∫Èó¥ÁöÑÈÖçÁΩÆ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w"> </span><span class="c"># ÊúüÊúõ Pod ÊåâÁÖßËøôÈáåÈù¢ÁöÑÊèèËø∞ËøõË°åÂàõÂª∫</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">containers</span><span class="p">:</span><span class="w"> </span><span class="c"># ÂØπ‰∫é Pod ‰∏≠ÁöÑÂÆπÂô®ÊèèËø∞</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w"> </span><span class="c"># ÂÆπÂô®ÁöÑÂêçÁß∞</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">nginx:1.7.9</span><span class="w"> </span><span class="c"># ÊåáÂÆöÂÆπÂô®ÁöÑÈïúÂÉè</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">IfNotPresent</span><span class="w"> </span><span class="c"># ÈïúÂÉèÊãâÂèñÁ≠ñÁï•ÔºåÊåáÂÆöÂ¶ÇÊûúÊú¨Âú∞ÊúâÂ∞±Áî®Êú¨Âú∞ÁöÑÔºåÂ¶ÇÊûúÊ≤°ÊúâÂ∞±ÊãâÂèñËøúÁ®ãÁöÑ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="c"># ÊåáÂÆöÂÆπÂô®ÂêØÂä®Êó∂ÊâßË°åÁöÑÂëΩ‰ª§</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- -<span class="l">g</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="s1">&#39;daemon off;&#39;</span><span class="w"> </span><span class="c"># nginx -g &#39;daemon off;&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">workingDir</span><span class="p">:</span><span class="w"> </span><span class="l">/usr/share/nginx/html</span><span class="w"> </span><span class="c"># ÂÆö‰πâÂÆπÂô®ÂêØÂä®ÂêéÁöÑÂ∑•‰ΩúÁõÆÂΩï</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">http</span><span class="w"> </span><span class="c"># Á´ØÂè£ÂêçÁß∞</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w"> </span><span class="c"># ÊèèËø∞ÂÆπÂô®ÂÜÖË¶ÅÊö¥Èú≤‰ªÄ‰πàÁ´ØÂè£</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">TCP</span><span class="w"> </span><span class="c"># ÊèèËø∞ËØ•Á´ØÂè£ÊòØÂü∫‰∫éÂì™ÁßçÂçèËÆÆÈÄö‰ø°ÁöÑ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">env</span><span class="p">:</span><span class="w"> </span><span class="c"># ÁéØÂ¢ÉÂèòÈáè</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">JVM_OPTS</span><span class="w"> </span><span class="c"># ÁéØÂ¢ÉÂèòÈáèÂêçÁß∞</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;-Xms128m -Xmx128m&#39;</span><span class="w"> </span><span class="c"># ÁéØÂ¢ÉÂèòÈáèÁöÑÂÄº</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">reousrces</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">requests</span><span class="p">:</span><span class="w"> </span><span class="c"># ÊúÄÂ∞ëÈúÄË¶ÅÂ§öÂ∞ëËµÑÊ∫ê</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="l">100m</span><span class="w"> </span><span class="c"># ÈôêÂà∂ cpu ÊúÄÂ∞ë‰ΩøÁî® 0.1 ‰∏™Ê†∏ÂøÉ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l">128Mi</span><span class="w"> </span><span class="c"># ÈôêÂà∂ÂÜÖÂ≠òÊúÄÂ∞ë‰ΩøÁî® 128ÂÖÜ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">limits</span><span class="p">:</span><span class="w"> </span><span class="c"># ÊúÄÂ§öÂèØ‰ª•Áî®Â§öÂ∞ëËµÑÊ∫ê</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="l">200m</span><span class="w"> </span><span class="c"># ÈôêÂà∂ cpu ÊúÄÂ§ö‰ΩøÁî® 0.2 ‰∏™Ê†∏ÂøÉ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l">256Mi</span><span class="w"> </span><span class="c"># ÈôêÂà∂ ÊúÄÂ§ö‰ΩøÁî® 256ÂÖÜ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">restartPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">OnFailure</span><span class="w"> </span><span class="c"># ÈáçÂêØÁ≠ñÁï•ÔºåÂè™ÊúâÂ§±Ë¥•ÁöÑÊÉÖÂÜµÊâç‰ºöÈáçÂêØ</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>ÊâßË°å‰ª•‰∏ãÂëΩ‰ª§ËøõË°åÂàõÂª∫</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># -f ÊåáÂÆöÂàõÂª∫Ê®°Êùø</span>
</span></span><span class="line"><span class="cl">kubectl create -f nginx-demo.yaml
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Êü•ÁúãpodsÁä∂ÊÄÅÔºåÂèëÁé∞Â∑≤ÁªèÂú®ËøêË°å‰∫Ü</span>
</span></span><span class="line"><span class="cl">kubectl get po
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Êü•ÁúãÊõ¥Âä†ËØ¶ÁªÜÁöÑ‰ø°ÊÅØÔºåÂ¶ÇÁ´ØÂè£Âè∑</span>
</span></span><span class="line"><span class="cl">kubectl get po -o wide
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">NAME         READY   STATUS    RESTARTS   AGE     IP               NODE        NOMINATED NODE   READINESS GATES
</span></span><span class="line"><span class="cl">nginx-demo   1/1     Running   <span class="m">0</span>          2m26s   10.244.169.131   k8s-node2   &lt;none&gt;           &lt;none&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ÂèØ‰ª•ÁúãÂà∞Ëøô‰∏™Êó∂ÂÄôÁöÑip(10.244.169.131)ÂíåËäÇÁÇπ(node2)</span>
</span></span><span class="line"><span class="cl">route -n
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
</span></span><span class="line"><span class="cl">0.0.0.0         192.168.42.2    0.0.0.0         UG    <span class="m">100</span>    <span class="m">0</span>        <span class="m">0</span> ens33
</span></span><span class="line"><span class="cl">10.244.36.64    192.168.42.132  255.255.255.192 UG    <span class="m">0</span>      <span class="m">0</span>        <span class="m">0</span> tunl0
</span></span><span class="line"><span class="cl">10.244.169.128  192.168.42.133  255.255.255.192 UG    <span class="m">0</span>      <span class="m">0</span>        <span class="m">0</span> tunl0
</span></span><span class="line"><span class="cl">10.244.235.192  0.0.0.0         255.255.255.192 U     <span class="m">0</span>      <span class="m">0</span>        <span class="m">0</span> *
</span></span><span class="line"><span class="cl">172.17.0.0      0.0.0.0         255.255.0.0     U     <span class="m">0</span>      <span class="m">0</span>        <span class="m">0</span> docker0
</span></span><span class="line"><span class="cl">192.168.42.0    0.0.0.0         255.255.255.0   U     <span class="m">100</span>    <span class="m">0</span>        <span class="m">0</span> ens33
</span></span><span class="line"><span class="cl">192.168.122.0   0.0.0.0         255.255.255.0   U     <span class="m">0</span>      <span class="m">0</span>        <span class="m">0</span> virbr0
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ÂèØ‰ª•ÁúãÂà∞Á°ÆÂÆûË¢´Ë∑ØÁî±Âà∞‰∫Ünode2ËäÇÁÇπ‰∏äÔºåËøô‰∏™ÂäüËÉΩÊòØÁî±‰∫éÊàë‰ª¨‰πãÂâçÂÆâË£Ö‰∫Ü`CNI ÁΩëÁªúÊèí‰ª∂`ÂÆûÁé∞ÁöÑ</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ip(10.244.169.131)ÈÄöËøánode2ËäÇÁÇπËøõË°åËΩ¨ÂèëÔºåÊ≠§Êó∂ÂÜçËøõÂÖ•node2ËäÇÁÇπ‰∏ãÊü•ÁúãË∑ØÁî±‰ø°ÊÅØÔºåÂ∞±ÂèØ‰ª•ÊâæÂà∞ÂΩìÂâçÁöÑÁΩëÂÖ≥‰∫Ü</span>
</span></span><span class="line"><span class="cl">Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
</span></span><span class="line"><span class="cl">0.0.0.0         192.168.42.2    0.0.0.0         UG    <span class="m">100</span>    <span class="m">0</span>        <span class="m">0</span> ens33
</span></span><span class="line"><span class="cl">10.244.36.64    192.168.42.132  255.255.255.192 UG    <span class="m">0</span>      <span class="m">0</span>        <span class="m">0</span> tunl0
</span></span><span class="line"><span class="cl">10.244.169.128  0.0.0.0         255.255.255.192 U     <span class="m">0</span>      <span class="m">0</span>        <span class="m">0</span> *
</span></span><span class="line"><span class="cl">10.244.169.130  0.0.0.0         255.255.255.255 UH    <span class="m">0</span>      <span class="m">0</span>        <span class="m">0</span> cali11b82779865
</span></span><span class="line"><span class="cl">10.244.169.131  0.0.0.0         255.255.255.255 UH    <span class="m">0</span>      <span class="m">0</span>        <span class="m">0</span> cali7543b7f115c
</span></span><span class="line"><span class="cl">10.244.235.192  192.168.42.131  255.255.255.192 UG    <span class="m">0</span>      <span class="m">0</span>        <span class="m">0</span> tunl0
</span></span><span class="line"><span class="cl">172.17.0.0      0.0.0.0         255.255.0.0     U     <span class="m">0</span>      <span class="m">0</span>        <span class="m">0</span> docker0
</span></span><span class="line"><span class="cl">192.168.42.0    0.0.0.0         255.255.255.0   U     <span class="m">100</span>    <span class="m">0</span>        <span class="m">0</span> ens33
</span></span><span class="line"><span class="cl">192.168.122.0   0.0.0.0         255.255.255.0   U     <span class="m">0</span>      <span class="m">0</span>        <span class="m">0</span> virbr0
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="Êé¢Èíà">Êé¢Èíà
</h4><blockquote>
<p>Âú®ÂÆûÈôÖËøêË°å‰∏≠ÂèØËÉΩ‰ºöÁî±‰∫éÂêÑÁßçÂéüÂõ†ÂØºËá¥ÊúçÂä°ÊåÇÊéâÔºåÊØîÂ¶ÇÂÜÖÂ≠òÊ∫¢Âá∫</p>
<p>‰ΩÜÊòØ pod ÊÄé‰πàÁõëÂê¨Âà∞ÂÆπÂô®ÊåÇÊéâ‰∫ÜÂë¢ÔºüÊòØÈÄöËøá<code>Êé¢Èíà</code>Êù•ÁõëÊéßÂÆπÂô®ÂÆûÁé∞</p>
<p>ÈúÄË¶ÅÂÖ≥Ê≥®‰∏ãÈÖçÁΩÆÁöÑ<code>ÈáçÂêØÁ≠ñÁï•(restartPolicy)</code>ÔºåÂΩìÂÆπÂô®ÊåÇÊéâ‰πãÂêéÔºåkubelet ‰ºöÊ†πÊçÆÈÖçÁΩÆÁöÑÈáçÂêØÁ≠ñÁï•ËøõË°åÈáçÂêØ</p>
</blockquote>
<p>ÂÆπÂô®ÂÜÖÂ∫îÁî®ÁöÑÁõëÊµãÊú∫Âà∂ÔºåÊ†πÊçÆ‰∏çÂêåÁöÑÊé¢ÈíàÊù•Âà§Êñ≠ÂÆπÂô®Â∫îÁî®ÂΩìÂâçÁöÑÁä∂ÊÄÅ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># Âà†Èô§nginx-demo pod</span>
</span></span><span class="line"><span class="cl">kubectl delete po nginx-demo
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ‰øÆÊîπyamlÔºåÊñ∞Â¢ûÊé¢ÈíàÈÖçÁΩÆ</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="startupprobe">StartupProbe
</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w"> </span><span class="c"># apiÊñáÊ°£ÁâàÊú¨</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Pod</span><span class="w"> </span><span class="c"># ËµÑÊ∫êÂØπË±°Á±ªÂûã</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w"> </span><span class="c"># PodÁõ∏ÂÖ≥ÁöÑÂÖÉÊï∞ÊçÆÔºåÁî®‰∫éÊèèËø∞Pod</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx-demo</span><span class="w"> </span><span class="c"># PodÁöÑÂêçÁß∞</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w"> </span><span class="c"># ÂÆö‰πâPodÁöÑÊ†áÁ≠æ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">myFirstApp</span><span class="w"> </span><span class="c"># ‰ª•‰∏ãÂÖ®ÈÉ®ÈÉΩÊòØËá™ÂÆö‰πâÊ†áÁ≠æ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="m">0.0.1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;default&#39;</span><span class="w"> </span><span class="c"># ÂëΩÂêçÁ©∫Èó¥</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w"> </span><span class="c"># ÊúüÊúõPodÊ†πÊçÆËøôÈáåÁöÑÊèèËø∞ËøõË°åÂàõÂª∫</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">containers</span><span class="p">:</span><span class="w"> </span><span class="c"># ÂØπ‰∫éPod‰∏≠ÂÆπÂô®ÁöÑÊèèËø∞</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w"> </span><span class="c"># ÂÆπÂô®ÂêçÁß∞</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">nginx:1.7.9</span><span class="w"> </span><span class="c"># ÊåáÂÆöÂÆπÂô®ÁöÑÈïúÂÉè</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">IfNotPresent</span><span class="w"> </span><span class="c"># ÊåáÂÆöÈïúÂÉèÁöÑÊãâÂèñÁ≠ñÁï•</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">startupProbe</span><span class="p">:</span><span class="w"> </span><span class="c"># Â∫îÁî®ÂêØÂä®Êé¢ÈíàÈÖçÁΩÆ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">httpGet</span><span class="p">:</span><span class="w"> </span><span class="c"># Êé¢ÊµãÊñπÂºèÔºåÂü∫‰∫éhttpËØ∑Ê±ÇÊé¢Êµã</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/api/path</span><span class="w"> </span><span class="c"># httpËØ∑Ê±ÇË∑ØÂæÑ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w"> </span><span class="c"># httpËØ∑Ê±ÇÁ´ØÂè£</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">failureThreshold</span><span class="p">:</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="c"># Â§±Ë¥•ÈáçËØïÂ§öÂ∞ëÊ¨°ÂêéÔºåÁúüÊ≠£Â§±Ë¥•</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">periodSeconds</span><span class="p">:</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="c"># Èó¥ÈöîÊó∂Èó¥</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">successThreshold</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="c"># Â§öÂ∞ëÊ¨°ÊàêÂäüÂêéÔºåÁúüÊ≠£ÊàêÂäü</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">timeoutSeconds</span><span class="p">:</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="c"># ËØ∑Ê±ÇÁöÑË∂ÖÊó∂Êó∂Èó¥</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="c"># ÊåáÂÆöÂÆπÂô®ÂêØÂä®Êó∂ÔºåÊâßË°åÁöÑÂëΩ‰ª§</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- -<span class="l">g</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="s1">&#39;daemon off;&#39;</span><span class="w"> </span><span class="c"># nginx -g &#39;daemon off;&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">workingDir</span><span class="p">:</span><span class="w"> </span><span class="l">/usr/share/nginx/html</span><span class="w"> </span><span class="c"># ÊåáÂÆöÂ∑•‰ΩúÁõÆÂΩï</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">http</span><span class="w"> </span><span class="c"># Á´ØÂè£ÂêçÁß∞</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w"> </span><span class="c"># ÂÆπÂô®ÂÜÖÊö¥Èú≤ÁöÑÁ´ØÂè£</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">TCP</span><span class="w"> </span><span class="c"># ÊèèËø∞ËØ•Á´ØÂè£ÊòØÂü∫‰∫é‰ªÄ‰πàÂçèËÆÆËøõË°åÈÄöËÆØÁöÑ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">env</span><span class="p">:</span><span class="w"> </span><span class="c"># ÁéØÂ¢ÉÂèòÈáè</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">JVM_OPTS</span><span class="w"> </span><span class="c"># ÁéØÂ¢ÉÂèòÈáèÂêçÁß∞</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;-Xms128m -Xmx128m&#39;</span><span class="w"> </span><span class="c"># ÁéØÂ¢ÉÂèòÈáèÂÄº</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">resources</span><span class="p">:</span><span class="w"> </span><span class="c"># ÈÖçÁΩÆËµÑÊ∫ê</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">requests</span><span class="p">:</span><span class="w"> </span><span class="c"># ÊúÄÂ∞ëÈúÄË¶ÅÂ§öÂ∞ëËµÑÊ∫ê</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="l">100m</span><span class="w"> </span><span class="c"># 1000mÁ≠â‰∫é‰∏Ä‰∏™cpuÊ†∏ÂøÉÔºåÊúÄÂ∞ë‰ΩøÁî®0.1‰∏™Ê†∏ÂøÉ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l">128Mi</span><span class="w"> </span><span class="c"># ÈôêÂà∂ÂÜÖÂ≠òÊúÄÂ∞ë‰ΩøÁî®128ÂÖÜ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">limits</span><span class="p">:</span><span class="w"> </span><span class="c"># ÊúÄÂ§ö‰ΩøÁî®Â§öÂ∞ëËµÑÊ∫ê</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="l">200m</span><span class="w"> </span><span class="c"># ÈôêÂà∂cpuÊúÄÂ§ö‰ΩøÁî®0.2‰∏™Ê†∏ÂøÉ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l">256Mi</span><span class="w"> </span><span class="c"># ÈôêÂà∂ÂÜÖÂ≠òÊúÄÂ§ö‰ΩøÁî®256ÂÖÜ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">restartPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">OnFailure</span><span class="w"> </span><span class="c"># ÈÖçÁΩÆÈáçÂêØÁ≠ñÁï•</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># ÂàõÂª∫po</span>
</span></span><span class="line"><span class="cl">kubectl create -f nginx-demo.yaml
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Êü•ÁúãpoÁä∂ÊÄÅ</span>
</span></span><span class="line"><span class="cl">kubectl get po
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Êü•ÁúãËØ¶ÁªÜ‰ø°ÊÅØ</span>
</span></span><span class="line"><span class="cl">kubectl describe po nginx-demo
</span></span><span class="line"><span class="cl"><span class="c1"># ÂèëÁé∞ÊúâÂ¶Ç‰∏ãÊó•Âøó</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Warning  Unhealthy  6s (x7 over 66s)   kubelet            Startup probe failed: HTTP probe failed with statuscode: 404</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Âõ†‰∏∫nginxÂπ∂Ê≤°Êúâ/api/pathËØ∑Ê±ÇË∑ØÂæÑÔºåÊâÄ‰ª•Êä•404</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Áé∞Âú®Êõ¥Êîπ‰∏∫/index.htmlÂêéÈáçÊñ∞ÊûÑÂª∫po</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ÂèëÁé∞ÊûÑÂª∫ÊàêÂäü</span>
</span></span><span class="line"><span class="cl"><span class="c1">#  Normal  Started    7s    kubelet            Started container nginx</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ÈÖçÁΩÆÊñá‰ª∂‰øÆÊîπÊàêÂ¶Ç‰∏ãÔºå‰∏çÂÜç‰ΩøÁî®httpÔºå‰ΩøÁî®tcpSocketÁöÑÂçèËÆÆ</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Âè™Ë¶ÅÊàêÂäüÂª∫Á´ãtcpËøûÊé•ÔºåÊàë‰ª¨Â∞±ËÆ§‰∏∫podÊûÑÂª∫ÊàêÂäü</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ÁºñËæëpods</span>
</span></span><span class="line"><span class="cl">kubectl edit po nginx-demo
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Âà†Èô§pods</span>
</span></span><span class="line"><span class="cl">kubectl delete po nginx-demo
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w"> </span><span class="c"># apiÊñáÊ°£ÁâàÊú¨</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Pod</span><span class="w"> </span><span class="c"># ËµÑÊ∫êÂØπË±°Á±ªÂûã</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w"> </span><span class="c"># PodÁõ∏ÂÖ≥ÁöÑÂÖÉÊï∞ÊçÆÔºåÁî®‰∫éÊèèËø∞Pod</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx-demo</span><span class="w"> </span><span class="c"># PodÁöÑÂêçÁß∞</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w"> </span><span class="c"># ÂÆö‰πâPodÁöÑÊ†áÁ≠æ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">myFirstApp</span><span class="w"> </span><span class="c"># ‰ª•‰∏ãÂÖ®ÈÉ®ÈÉΩÊòØËá™ÂÆö‰πâÊ†áÁ≠æ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="m">0.0.1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;default&#39;</span><span class="w"> </span><span class="c"># ÂëΩÂêçÁ©∫Èó¥</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w"> </span><span class="c"># ÊúüÊúõPodÊ†πÊçÆËøôÈáåÁöÑÊèèËø∞ËøõË°åÂàõÂª∫</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">containers</span><span class="p">:</span><span class="w"> </span><span class="c"># ÂØπ‰∫éPod‰∏≠ÂÆπÂô®ÁöÑÊèèËø∞</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w"> </span><span class="c"># ÂÆπÂô®ÂêçÁß∞</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">nginx:1.7.9</span><span class="w"> </span><span class="c"># ÊåáÂÆöÂÆπÂô®ÁöÑÈïúÂÉè</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">IfNotPresent</span><span class="w"> </span><span class="c"># ÊåáÂÆöÈïúÂÉèÁöÑÊãâÂèñÁ≠ñÁï•</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">startupProbe</span><span class="p">:</span><span class="w"> </span><span class="c"># Â∫îÁî®ÂêØÂä®Êé¢ÈíàÈÖçÁΩÆ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c"># httpGet: # Êé¢ÊµãÊñπÂºèÔºåÂü∫‰∫éhttpËØ∑Ê±ÇÊé¢Êµã</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c">#   path: /index.html # httpËØ∑Ê±ÇË∑ØÂæÑ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c">#   port: 80 # httpËØ∑Ê±ÇÁ´ØÂè£</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">tcpSocket</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">failureThreshold</span><span class="p">:</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="c"># Â§±Ë¥•ÈáçËØïÂ§öÂ∞ëÊ¨°ÂêéÔºåÁúüÊ≠£Â§±Ë¥•</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">periodSeconds</span><span class="p">:</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="c"># Èó¥ÈöîÊó∂Èó¥</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">successThreshold</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="c"># Â§öÂ∞ëÊ¨°ÊàêÂäüÂêéÔºåÁúüÊ≠£ÊàêÂäü</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">timeoutSeconds</span><span class="p">:</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="c"># ËØ∑Ê±ÇÁöÑË∂ÖÊó∂Êó∂Èó¥</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="c"># ÊåáÂÆöÂÆπÂô®ÂêØÂä®Êó∂ÔºåÊâßË°åÁöÑÂëΩ‰ª§</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- -<span class="l">g</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="s1">&#39;daemon off;&#39;</span><span class="w"> </span><span class="c"># nginx -g &#39;daemon off;&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">workingDir</span><span class="p">:</span><span class="w"> </span><span class="l">/usr/share/nginx/html</span><span class="w"> </span><span class="c"># ÊåáÂÆöÂ∑•‰ΩúÁõÆÂΩï</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">http</span><span class="w"> </span><span class="c"># Á´ØÂè£ÂêçÁß∞</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w"> </span><span class="c"># ÂÆπÂô®ÂÜÖÊö¥Èú≤ÁöÑÁ´ØÂè£</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">TCP</span><span class="w"> </span><span class="c"># ÊèèËø∞ËØ•Á´ØÂè£ÊòØÂü∫‰∫é‰ªÄ‰πàÂçèËÆÆËøõË°åÈÄöËÆØÁöÑ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">env</span><span class="p">:</span><span class="w"> </span><span class="c"># ÁéØÂ¢ÉÂèòÈáè</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">JVM_OPTS</span><span class="w"> </span><span class="c"># ÁéØÂ¢ÉÂèòÈáèÂêçÁß∞</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;-Xms128m -Xmx128m&#39;</span><span class="w"> </span><span class="c"># ÁéØÂ¢ÉÂèòÈáèÂÄº</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">resources</span><span class="p">:</span><span class="w"> </span><span class="c"># ÈÖçÁΩÆËµÑÊ∫ê</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">requests</span><span class="p">:</span><span class="w"> </span><span class="c"># ÊúÄÂ∞ëÈúÄË¶ÅÂ§öÂ∞ëËµÑÊ∫ê</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="l">100m</span><span class="w"> </span><span class="c"># 1000mÁ≠â‰∫é‰∏Ä‰∏™cpuÊ†∏ÂøÉÔºåÊúÄÂ∞ë‰ΩøÁî®0.1‰∏™Ê†∏ÂøÉ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l">128Mi</span><span class="w"> </span><span class="c"># ÈôêÂà∂ÂÜÖÂ≠òÊúÄÂ∞ë‰ΩøÁî®128ÂÖÜ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">limits</span><span class="p">:</span><span class="w"> </span><span class="c"># ÊúÄÂ§ö‰ΩøÁî®Â§öÂ∞ëËµÑÊ∫ê</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="l">200m</span><span class="w"> </span><span class="c"># ÈôêÂà∂cpuÊúÄÂ§ö‰ΩøÁî®0.2‰∏™Ê†∏ÂøÉ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l">256Mi</span><span class="w"> </span><span class="c"># ÈôêÂà∂ÂÜÖÂ≠òÊúÄÂ§ö‰ΩøÁî®256ÂÖÜ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">restartPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">OnFailure</span><span class="w"> </span><span class="c"># ÈÖçÁΩÆÈáçÂêØÁ≠ñÁï•</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>
<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo03/202412242119133.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo03/202412242119133.png" alt="image-20240624202529600"  />
	</a>
</div>
</p>
<blockquote>
<p>‰øÆÊîπÊàê exec ÁöÑÂΩ¢Âºè</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w"> </span><span class="c"># apiÊñáÊ°£ÁâàÊú¨</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Pod</span><span class="w"> </span><span class="c"># ËµÑÊ∫êÂØπË±°Á±ªÂûã</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w"> </span><span class="c"># PodÁõ∏ÂÖ≥ÁöÑÂÖÉÊï∞ÊçÆÔºåÁî®‰∫éÊèèËø∞Pod</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx-demo</span><span class="w"> </span><span class="c"># PodÁöÑÂêçÁß∞</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w"> </span><span class="c"># ÂÆö‰πâPodÁöÑÊ†áÁ≠æ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">myFirstApp</span><span class="w"> </span><span class="c"># ‰ª•‰∏ãÂÖ®ÈÉ®ÈÉΩÊòØËá™ÂÆö‰πâÊ†áÁ≠æ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="m">0.0.1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;default&#39;</span><span class="w"> </span><span class="c"># ÂëΩÂêçÁ©∫Èó¥</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w"> </span><span class="c"># ÊúüÊúõPodÊ†πÊçÆËøôÈáåÁöÑÊèèËø∞ËøõË°åÂàõÂª∫</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">containers</span><span class="p">:</span><span class="w"> </span><span class="c"># ÂØπ‰∫éPod‰∏≠ÂÆπÂô®ÁöÑÊèèËø∞</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w"> </span><span class="c"># ÂÆπÂô®ÂêçÁß∞</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">nginx:1.7.9</span><span class="w"> </span><span class="c"># ÊåáÂÆöÂÆπÂô®ÁöÑÈïúÂÉè</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">IfNotPresent</span><span class="w"> </span><span class="c"># ÊåáÂÆöÈïúÂÉèÁöÑÊãâÂèñÁ≠ñÁï•</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">startupProbe</span><span class="p">:</span><span class="w"> </span><span class="c"># Â∫îÁî®ÂêØÂä®Êé¢ÈíàÈÖçÁΩÆ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c"># httpGet: # Êé¢ÊµãÊñπÂºèÔºåÂü∫‰∫éhttpËØ∑Ê±ÇÊé¢Êµã</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c">#   path: /index.html # httpËØ∑Ê±ÇË∑ØÂæÑ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c">#   port: 80 # httpËØ∑Ê±ÇÁ´ØÂè£</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c"># tcpSocket:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c">#   port: 80</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">exec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">command</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="l">sh</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="l">c</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="s2">&#34;sleep 5;echo &#39;successful&#39; &gt; /inited;&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">failureThreshold</span><span class="p">:</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="c"># Â§±Ë¥•ÈáçËØïÂ§öÂ∞ëÊ¨°ÂêéÔºåÁúüÊ≠£Â§±Ë¥•</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">periodSeconds</span><span class="p">:</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="c"># Èó¥ÈöîÊó∂Èó¥</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">successThreshold</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="c"># Â§öÂ∞ëÊ¨°ÊàêÂäüÂêéÔºåÁúüÊ≠£ÊàêÂäü</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">timeoutSeconds</span><span class="p">:</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="c"># ËØ∑Ê±ÇÁöÑË∂ÖÊó∂Êó∂Èó¥</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="c"># ÊåáÂÆöÂÆπÂô®ÂêØÂä®Êó∂ÔºåÊâßË°åÁöÑÂëΩ‰ª§</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- -<span class="l">g</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="s1">&#39;daemon off;&#39;</span><span class="w"> </span><span class="c"># nginx -g &#39;daemon off;&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">workingDir</span><span class="p">:</span><span class="w"> </span><span class="l">/usr/share/nginx/html</span><span class="w"> </span><span class="c"># ÊåáÂÆöÂ∑•‰ΩúÁõÆÂΩï</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">http</span><span class="w"> </span><span class="c"># Á´ØÂè£ÂêçÁß∞</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w"> </span><span class="c"># ÂÆπÂô®ÂÜÖÊö¥Èú≤ÁöÑÁ´ØÂè£</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">TCP</span><span class="w"> </span><span class="c"># ÊèèËø∞ËØ•Á´ØÂè£ÊòØÂü∫‰∫é‰ªÄ‰πàÂçèËÆÆËøõË°åÈÄöËÆØÁöÑ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">env</span><span class="p">:</span><span class="w"> </span><span class="c"># ÁéØÂ¢ÉÂèòÈáè</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">JVM_OPTS</span><span class="w"> </span><span class="c"># ÁéØÂ¢ÉÂèòÈáèÂêçÁß∞</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;-Xms128m -Xmx128m&#39;</span><span class="w"> </span><span class="c"># ÁéØÂ¢ÉÂèòÈáèÂÄº</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">resources</span><span class="p">:</span><span class="w"> </span><span class="c"># ÈÖçÁΩÆËµÑÊ∫ê</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">requests</span><span class="p">:</span><span class="w"> </span><span class="c"># ÊúÄÂ∞ëÈúÄË¶ÅÂ§öÂ∞ëËµÑÊ∫ê</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="l">100m</span><span class="w"> </span><span class="c"># 1000mÁ≠â‰∫é‰∏Ä‰∏™cpuÊ†∏ÂøÉÔºåÊúÄÂ∞ë‰ΩøÁî®0.1‰∏™Ê†∏ÂøÉ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l">128Mi</span><span class="w"> </span><span class="c"># ÈôêÂà∂ÂÜÖÂ≠òÊúÄÂ∞ë‰ΩøÁî®128ÂÖÜ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">limits</span><span class="p">:</span><span class="w"> </span><span class="c"># ÊúÄÂ§ö‰ΩøÁî®Â§öÂ∞ëËµÑÊ∫ê</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="l">200m</span><span class="w"> </span><span class="c"># ÈôêÂà∂cpuÊúÄÂ§ö‰ΩøÁî®0.2‰∏™Ê†∏ÂøÉ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l">256Mi</span><span class="w"> </span><span class="c"># ÈôêÂà∂ÂÜÖÂ≠òÊúÄÂ§ö‰ΩøÁî®256ÂÖÜ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">restartPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">OnFailure</span><span class="w"> </span><span class="c"># ÈÖçÁΩÆÈáçÂêØÁ≠ñÁï•</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># Êü•ÁúãÂèëÁé∞ÈáçËØïËøá4Ê¨°ÔºåËØ¥ÊòéÂ§±Ë¥•‰∫Ü</span>
</span></span><span class="line"><span class="cl">kubectl get po
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ÂØªÊâæÂ§±Ë¥•ÂéüÂõ†</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ÂèëÁé∞ÊòØÂëΩ‰ª§ÊúâÈóÆÈ¢òÔºåÂÆûÈôÖÊâßË°åÁöÑÂëΩ‰ª§sh c sleep 5;echo &#39;successful&#39; &gt; /inited;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ÊúüÂæÖÊâßË°åÁöÑÂëΩ‰ª§sh -c sleep 5;echo &#39;successful&#39; &gt; /inited;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ‰øÆÊîπ‰ª£Á†Å „Äê- c„Äë -&gt; „Äê- -c„Äë</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ÊèêÁ§∫Startup probe failed: command &#34;sh -c sleep 5;echo &#39;successful&#39; &gt; /inited;&#34; timed out</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Âõ†‰∏∫Áù°Áú†5sÔºåËÄåÈÖçÁΩÆÁöÑË∂ÖÊó∂Êó∂Èó¥‰πüÊòØ5sÔºåÊàë‰ª¨ÁªßÁª≠ËÆ≤Áù°Áú†Êó∂Èó¥ÊîπÁü≠ÁÇπ</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># -itË°®Á§∫‰∫§‰∫íÊ®°Âºè</span>
</span></span><span class="line"><span class="cl"><span class="c1"># -cÊåáÂÆöÂÆπÂô®‰∏∫nginx</span>
</span></span><span class="line"><span class="cl"><span class="c1"># --ÂêéÈù¢ÁöÑÂëΩ‰ª§ÊòØÊâßË°åÁöÑshellÊåá‰ª§</span>
</span></span><span class="line"><span class="cl">kubectl <span class="nb">exec</span> -it nginx-demo -c nginx -- cat /inited
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>Â§çÂà∂‰∏Ä‰∏™<code>nginx-liveness-demo.yaml</code>Êñá‰ª∂</p>
</blockquote>
<h5 id="livenessprobe">LivenessProbe
</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w"> </span><span class="c"># apiÊñáÊ°£ÁâàÊú¨</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Pod</span><span class="w"> </span><span class="c"># ËµÑÊ∫êÂØπË±°Á±ªÂûã</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w"> </span><span class="c"># PodÁõ∏ÂÖ≥ÁöÑÂÖÉÊï∞ÊçÆÔºåÁî®‰∫éÊèèËø∞Pod</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx-liveness-demo</span><span class="w"> </span><span class="c"># PodÁöÑÂêçÁß∞</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w"> </span><span class="c"># ÂÆö‰πâPodÁöÑÊ†áÁ≠æ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">myFirstApp</span><span class="w"> </span><span class="c"># ‰ª•‰∏ãÂÖ®ÈÉ®ÈÉΩÊòØËá™ÂÆö‰πâÊ†áÁ≠æ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="m">0.0.1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;default&#39;</span><span class="w"> </span><span class="c"># ÂëΩÂêçÁ©∫Èó¥</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w"> </span><span class="c"># ÊúüÊúõPodÊ†πÊçÆËøôÈáåÁöÑÊèèËø∞ËøõË°åÂàõÂª∫</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">containers</span><span class="p">:</span><span class="w"> </span><span class="c"># ÂØπ‰∫éPod‰∏≠ÂÆπÂô®ÁöÑÊèèËø∞</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w"> </span><span class="c"># ÂÆπÂô®ÂêçÁß∞</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">nginx:1.7.9</span><span class="w"> </span><span class="c"># ÊåáÂÆöÂÆπÂô®ÁöÑÈïúÂÉè</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">IfNotPresent</span><span class="w"> </span><span class="c"># ÊåáÂÆöÈïúÂÉèÁöÑÊãâÂèñÁ≠ñÁï•</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">startupProbe</span><span class="p">:</span><span class="w"> </span><span class="c"># Â∫îÁî®ÂêØÂä®Êé¢ÈíàÈÖçÁΩÆ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c"># httpGet: # Êé¢ÊµãÊñπÂºèÔºåÂü∫‰∫éhttpËØ∑Ê±ÇÊé¢Êµã</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c">#   path: /index.html # httpËØ∑Ê±ÇË∑ØÂæÑ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c">#   port: 80 # httpËØ∑Ê±ÇÁ´ØÂè£</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c"># tcpSocket:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c">#   port: 80</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">exec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">command</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="l">sh</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- -<span class="l">c</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="s2">&#34;sleep 2;echo &#39;successful&#39; &gt; /inited;&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">failureThreshold</span><span class="p">:</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="c"># Â§±Ë¥•ÈáçËØïÂ§öÂ∞ëÊ¨°ÂêéÔºåÁúüÊ≠£Â§±Ë¥•</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">periodSeconds</span><span class="p">:</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="c"># Èó¥ÈöîÊó∂Èó¥</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">successThreshold</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="c"># Â§öÂ∞ëÊ¨°ÊàêÂäüÂêéÔºåÁúüÊ≠£ÊàêÂäü</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">timeoutSeconds</span><span class="p">:</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="c"># ËØ∑Ê±ÇÁöÑË∂ÖÊó∂Êó∂Èó¥</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">livenessProbe</span><span class="p">:</span><span class="w"> </span><span class="c"># Â∫îÁî®Â≠òÊ¥ªÊé¢ÈíàÈÖçÁΩÆ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">httpGet</span><span class="p">:</span><span class="w"> </span><span class="c"># Êé¢ÊµãÊñπÂºèÔºåÂü∫‰∫éhttpËØ∑Ê±ÇÊé¢Êµã</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/index1.html</span><span class="w"> </span><span class="c"># httpËØ∑Ê±ÇË∑ØÂæÑ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w"> </span><span class="c"># httpËØ∑Ê±ÇÁ´ØÂè£</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c"># tcpSocket:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c">#   port: 80</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c"># exec:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c">#   command:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c">#   - sh</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c">#   - -c</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c">#   - &#34;sleep 2;echo &#39;successful&#39; &gt; /inited;&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">failureThreshold</span><span class="p">:</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="c"># Â§±Ë¥•ÈáçËØïÂ§öÂ∞ëÊ¨°ÂêéÔºåÁúüÊ≠£Â§±Ë¥•</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">periodSeconds</span><span class="p">:</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="c"># Èó¥ÈöîÊó∂Èó¥</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">successThreshold</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="c"># Â§öÂ∞ëÊ¨°ÊàêÂäüÂêéÔºåÁúüÊ≠£ÊàêÂäü</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">timeoutSeconds</span><span class="p">:</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="c"># ËØ∑Ê±ÇÁöÑË∂ÖÊó∂Êó∂Èó¥</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="c"># ÊåáÂÆöÂÆπÂô®ÂêØÂä®Êó∂ÔºåÊâßË°åÁöÑÂëΩ‰ª§</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- -<span class="l">g</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="s1">&#39;daemon off;&#39;</span><span class="w"> </span><span class="c"># nginx -g &#39;daemon off;&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">workingDir</span><span class="p">:</span><span class="w"> </span><span class="l">/usr/share/nginx/html</span><span class="w"> </span><span class="c"># ÊåáÂÆöÂ∑•‰ΩúÁõÆÂΩï</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">http</span><span class="w"> </span><span class="c"># Á´ØÂè£ÂêçÁß∞</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w"> </span><span class="c"># ÂÆπÂô®ÂÜÖÊö¥Èú≤ÁöÑÁ´ØÂè£</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">TCP</span><span class="w"> </span><span class="c"># ÊèèËø∞ËØ•Á´ØÂè£ÊòØÂü∫‰∫é‰ªÄ‰πàÂçèËÆÆËøõË°åÈÄöËÆØÁöÑ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">env</span><span class="p">:</span><span class="w"> </span><span class="c"># ÁéØÂ¢ÉÂèòÈáè</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">JVM_OPTS</span><span class="w"> </span><span class="c"># ÁéØÂ¢ÉÂèòÈáèÂêçÁß∞</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;-Xms128m -Xmx128m&#39;</span><span class="w"> </span><span class="c"># ÁéØÂ¢ÉÂèòÈáèÂÄº</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">resources</span><span class="p">:</span><span class="w"> </span><span class="c"># ÈÖçÁΩÆËµÑÊ∫ê</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">requests</span><span class="p">:</span><span class="w"> </span><span class="c"># ÊúÄÂ∞ëÈúÄË¶ÅÂ§öÂ∞ëËµÑÊ∫ê</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="l">100m</span><span class="w"> </span><span class="c"># 1000mÁ≠â‰∫é‰∏Ä‰∏™cpuÊ†∏ÂøÉÔºåÊúÄÂ∞ë‰ΩøÁî®0.1‰∏™Ê†∏ÂøÉ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l">128Mi</span><span class="w"> </span><span class="c"># ÈôêÂà∂ÂÜÖÂ≠òÊúÄÂ∞ë‰ΩøÁî®128ÂÖÜ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">limits</span><span class="p">:</span><span class="w"> </span><span class="c"># ÊúÄÂ§ö‰ΩøÁî®Â§öÂ∞ëËµÑÊ∫ê</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="l">200m</span><span class="w"> </span><span class="c"># ÈôêÂà∂cpuÊúÄÂ§ö‰ΩøÁî®0.2‰∏™Ê†∏ÂøÉ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l">256Mi</span><span class="w"> </span><span class="c"># ÈôêÂà∂ÂÜÖÂ≠òÊúÄÂ§ö‰ΩøÁî®256ÂÖÜ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">restartPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">OnFailure</span><span class="w"> </span><span class="c"># ÈÖçÁΩÆÈáçÂêØÁ≠ñÁï•</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># ËØ∑Ê±Ç/index1.htmlÂ§±Ë¥•ÔºåÂú®ÈáçËØï5Ê¨°ÂêéÔºå‰æùÁÑ∂Êó†Ê≥ïÂêØÂä®</span>
</span></span><span class="line"><span class="cl"><span class="c1">#  Warning  Unhealthy  17s (x9 over 117s)   kubelet            Liveness probe failed: HTTP probe failed with statuscode: 404</span>
</span></span><span class="line"><span class="cl"><span class="c1">#  Normal   Killing    17s (x3 over 97s)    kubelet            Container nginx failed liveness probe, will be restarted</span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s1">&#39;success&#39;</span> &gt; index1.html
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Êã∑Ë¥ùÂà∞Êñá‰ª∂ÂÜÖÈÉ®</span>
</span></span><span class="line"><span class="cl">kubectl cp index1.html nginx-liveness-demo:/usr/share/nginx/html
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>ÂΩì‰∏âÁßçÊé¢ÈíàÂêåÊó∂Â≠òÂú®Êó∂ÔºåÂøÖÂÆöÂÖàËøêË°å<code>startup</code>Ôºå‰πãÂêéÊâçÊòØ<code>LivenessProbe</code>Âíå<code>ReadinessProbe</code></p>
</blockquote>
<h5 id="readinessprobe">ReadinessProbe
</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w"> </span><span class="c"># apiÊñáÊ°£ÁâàÊú¨</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Pod</span><span class="w"> </span><span class="c"># ËµÑÊ∫êÂØπË±°Á±ªÂûã</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w"> </span><span class="c"># PodÁõ∏ÂÖ≥ÁöÑÂÖÉÊï∞ÊçÆÔºåÁî®‰∫éÊèèËø∞Pod</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx-liveness-demo</span><span class="w"> </span><span class="c"># PodÁöÑÂêçÁß∞</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w"> </span><span class="c"># ÂÆö‰πâPodÁöÑÊ†áÁ≠æ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">myFirstApp</span><span class="w"> </span><span class="c"># ‰ª•‰∏ãÂÖ®ÈÉ®ÈÉΩÊòØËá™ÂÆö‰πâÊ†áÁ≠æ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="m">0.0.1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;default&#39;</span><span class="w"> </span><span class="c"># ÂëΩÂêçÁ©∫Èó¥</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w"> </span><span class="c"># ÊúüÊúõPodÊ†πÊçÆËøôÈáåÁöÑÊèèËø∞ËøõË°åÂàõÂª∫</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">containers</span><span class="p">:</span><span class="w"> </span><span class="c"># ÂØπ‰∫éPod‰∏≠ÂÆπÂô®ÁöÑÊèèËø∞</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w"> </span><span class="c"># ÂÆπÂô®ÂêçÁß∞</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">nginx:1.7.9</span><span class="w"> </span><span class="c"># ÊåáÂÆöÂÆπÂô®ÁöÑÈïúÂÉè</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">IfNotPresent</span><span class="w"> </span><span class="c"># ÊåáÂÆöÈïúÂÉèÁöÑÊãâÂèñÁ≠ñÁï•</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">startupProbe</span><span class="p">:</span><span class="w"> </span><span class="c"># Â∫îÁî®ÂêØÂä®Êé¢ÈíàÈÖçÁΩÆ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c"># httpGet: # Êé¢ÊµãÊñπÂºèÔºåÂü∫‰∫éhttpËØ∑Ê±ÇÊé¢Êµã</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c">#   path: /index.html # httpËØ∑Ê±ÇË∑ØÂæÑ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c">#   port: 80 # httpËØ∑Ê±ÇÁ´ØÂè£</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c"># tcpSocket:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c">#   port: 80</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">exec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">command</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="l">sh</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- -<span class="l">c</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="s2">&#34;sleep 2;echo &#39;successful&#39; &gt; /inited;&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">failureThreshold</span><span class="p">:</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="c"># Â§±Ë¥•ÈáçËØïÂ§öÂ∞ëÊ¨°ÂêéÔºåÁúüÊ≠£Â§±Ë¥•</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">periodSeconds</span><span class="p">:</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="c"># Èó¥ÈöîÊó∂Èó¥</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">successThreshold</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="c"># Â§öÂ∞ëÊ¨°ÊàêÂäüÂêéÔºåÁúüÊ≠£ÊàêÂäü</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">timeoutSeconds</span><span class="p">:</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="c"># ËØ∑Ê±ÇÁöÑË∂ÖÊó∂Êó∂Èó¥</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">livenessProbe</span><span class="p">:</span><span class="w"> </span><span class="c"># Â∫îÁî®Â≠òÊ¥ªÊé¢ÈíàÈÖçÁΩÆ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">httpGet</span><span class="p">:</span><span class="w"> </span><span class="c"># Êé¢ÊµãÊñπÂºèÔºåÂü∫‰∫éhttpËØ∑Ê±ÇÊé¢Êµã</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/index.html</span><span class="w"> </span><span class="c"># httpËØ∑Ê±ÇË∑ØÂæÑ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w"> </span><span class="c"># httpËØ∑Ê±ÇÁ´ØÂè£</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c"># tcpSocket:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c">#   port: 80</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c"># exec:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c">#   command:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c">#   - sh</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c">#   - -c</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c">#   - &#34;sleep 2;echo &#39;successful&#39; &gt; /inited;&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">failureThreshold</span><span class="p">:</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="c"># Â§±Ë¥•ÈáçËØïÂ§öÂ∞ëÊ¨°ÂêéÔºåÁúüÊ≠£Â§±Ë¥•</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">periodSeconds</span><span class="p">:</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="c"># Èó¥ÈöîÊó∂Èó¥</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">successThreshold</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="c"># Â§öÂ∞ëÊ¨°ÊàêÂäüÂêéÔºåÁúüÊ≠£ÊàêÂäü</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">timeoutSeconds</span><span class="p">:</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="c"># ËØ∑Ê±ÇÁöÑË∂ÖÊó∂Êó∂Èó¥</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">readinessProbe</span><span class="p">:</span><span class="w"> </span><span class="c"># Â∫îÁî®Â≠òÊ¥ªÊé¢ÈíàÈÖçÁΩÆ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">httpGet</span><span class="p">:</span><span class="w"> </span><span class="c"># Êé¢ÊµãÊñπÂºèÔºåÂü∫‰∫éhttpËØ∑Ê±ÇÊé¢Êµã</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/index1.html</span><span class="w"> </span><span class="c"># httpËØ∑Ê±ÇË∑ØÂæÑ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w"> </span><span class="c"># httpËØ∑Ê±ÇÁ´ØÂè£</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c"># tcpSocket:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c">#   port: 80</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c"># exec:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c">#   command:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c">#   - sh</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c">#   - -c</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c">#   - &#34;sleep 2;echo &#39;successful&#39; &gt; /inited;&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">failureThreshold</span><span class="p">:</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="c"># Â§±Ë¥•ÈáçËØïÂ§öÂ∞ëÊ¨°ÂêéÔºåÁúüÊ≠£Â§±Ë¥•</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">periodSeconds</span><span class="p">:</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="c"># Èó¥ÈöîÊó∂Èó¥</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">successThreshold</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="c"># Â§öÂ∞ëÊ¨°ÊàêÂäüÂêéÔºåÁúüÊ≠£ÊàêÂäü</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">timeoutSeconds</span><span class="p">:</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="c"># ËØ∑Ê±ÇÁöÑË∂ÖÊó∂Êó∂Èó¥</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="c"># ÊåáÂÆöÂÆπÂô®ÂêØÂä®Êó∂ÔºåÊâßË°åÁöÑÂëΩ‰ª§</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- -<span class="l">g</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="s1">&#39;daemon off;&#39;</span><span class="w"> </span><span class="c"># nginx -g &#39;daemon off;&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">workingDir</span><span class="p">:</span><span class="w"> </span><span class="l">/usr/share/nginx/html</span><span class="w"> </span><span class="c"># ÊåáÂÆöÂ∑•‰ΩúÁõÆÂΩï</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">http</span><span class="w"> </span><span class="c"># Á´ØÂè£ÂêçÁß∞</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w"> </span><span class="c"># ÂÆπÂô®ÂÜÖÊö¥Èú≤ÁöÑÁ´ØÂè£</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">TCP</span><span class="w"> </span><span class="c"># ÊèèËø∞ËØ•Á´ØÂè£ÊòØÂü∫‰∫é‰ªÄ‰πàÂçèËÆÆËøõË°åÈÄöËÆØÁöÑ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">env</span><span class="p">:</span><span class="w"> </span><span class="c"># ÁéØÂ¢ÉÂèòÈáè</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">JVM_OPTS</span><span class="w"> </span><span class="c"># ÁéØÂ¢ÉÂèòÈáèÂêçÁß∞</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;-Xms128m -Xmx128m&#39;</span><span class="w"> </span><span class="c"># ÁéØÂ¢ÉÂèòÈáèÂÄº</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">resources</span><span class="p">:</span><span class="w"> </span><span class="c"># ÈÖçÁΩÆËµÑÊ∫ê</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">requests</span><span class="p">:</span><span class="w"> </span><span class="c"># ÊúÄÂ∞ëÈúÄË¶ÅÂ§öÂ∞ëËµÑÊ∫ê</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="l">100m</span><span class="w"> </span><span class="c"># 1000mÁ≠â‰∫é‰∏Ä‰∏™cpuÊ†∏ÂøÉÔºåÊúÄÂ∞ë‰ΩøÁî®0.1‰∏™Ê†∏ÂøÉ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l">128Mi</span><span class="w"> </span><span class="c"># ÈôêÂà∂ÂÜÖÂ≠òÊúÄÂ∞ë‰ΩøÁî®128ÂÖÜ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">limits</span><span class="p">:</span><span class="w"> </span><span class="c"># ÊúÄÂ§ö‰ΩøÁî®Â§öÂ∞ëËµÑÊ∫ê</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="l">200m</span><span class="w"> </span><span class="c"># ÈôêÂà∂cpuÊúÄÂ§ö‰ΩøÁî®0.2‰∏™Ê†∏ÂøÉ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l">256Mi</span><span class="w"> </span><span class="c"># ÈôêÂà∂ÂÜÖÂ≠òÊúÄÂ§ö‰ΩøÁî®256ÂÖÜ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">restartPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">OnFailure</span><span class="w"> </span><span class="c"># ÈÖçÁΩÆÈáçÂêØÁ≠ñÁï•</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># 404</span>
</span></span><span class="line"><span class="cl"><span class="c1">#  Warning  Unhealthy  1s    kubelet            Readiness probe failed: HTTP probe failed with statuscode: 404</span>
</span></span><span class="line"><span class="cl">kubectl cp index1.html nginx-liveness-demo:/usr/share/nginx/html
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># nodeÁä∂ÊÄÅËΩ¨‰∏∫ready</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>
<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo03/202412242119552.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo03/202412242119552.png" alt="image-20240624205645684"  />
	</a>
</div>
</p>
<h5 id="Á±ªÂûã-1">Á±ªÂûã
</h5><ol>
<li>
<p>StartupProbe</p>
<p>k8s 1.16 ÁâàÊú¨Êñ∞Â¢ûÁöÑÊé¢ÈíàÔºåÁî®‰∫éÂà§Êñ≠Â∫îÁî®Á®ãÂ∫èÊòØÂê¶Â∑≤ÁªèÂêØÂä®‰∫Ü„ÄÇ</p>
<p>ÂΩìÈÖçÁΩÆ‰∫Ü startupProbe ÂêéÔºå‰ºöÂÖàÁ¶ÅÁî®ÂÖ∂‰ªñÊé¢ÈíàÔºåÁõ¥Âà∞ startupProbe ÊàêÂäüÂêéÔºåÂÖ∂‰ªñÊé¢ÈíàÊâç‰ºöÁªßÁª≠„ÄÇ</p>
<p>‰ΩúÁî®ÔºöÁî±‰∫éÊúâÊó∂ÂÄô‰∏çËÉΩÂáÜÁ°ÆÈ¢Ñ‰º∞Â∫îÁî®‰∏ÄÂÆöÊòØÂ§öÈïøÊó∂Èó¥ÂêØÂä®ÊàêÂäüÔºåÂõ†Ê≠§ÈÖçÁΩÆÂè¶Â§ñ‰∏§ÁßçÊñπÂºè‰∏çÊñπ‰æøÈÖçÁΩÆÂàùÂßãÂåñÊó∂ÈïøÊù•Ê£ÄÊµãÔºåËÄåÈÖçÁΩÆ‰∫Ü statupProbe ÂêéÔºåÂè™ÊúâÂú®Â∫îÁî®ÂêØÂä®ÊàêÂäü‰∫ÜÔºåÊâç‰ºöÊâßË°åÂè¶Â§ñ‰∏§ÁßçÊé¢ÈíàÔºåÂèØ‰ª•Êõ¥Âä†Êñπ‰æøÁöÑÁªìÂêà‰ΩøÁî®Âè¶Â§ñ‰∏§ÁßçÊé¢Èíà‰ΩøÁî®„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">startupProbe</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">httpGet</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/api/startup</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>LivenessProbe</p>
<p>Áî®‰∫éÊé¢ÊµãÂÆπÂô®‰∏≠ÁöÑÂ∫îÁî®ÊòØÂê¶ËøêË°åÔºåÂ¶ÇÊûúÊé¢ÊµãÂ§±Ë¥•Ôºåkubelet ‰ºöÊ†πÊçÆÈÖçÁΩÆÁöÑÈáçÂêØÁ≠ñÁï•ËøõË°åÈáçÂêØÔºåËã•Ê≤°ÊúâÈÖçÁΩÆÔºåÈªòËÆ§Â∞±ËÆ§‰∏∫ÂÆπÂô®ÂêØÂä®ÊàêÂäüÔºå‰∏ç‰ºöÊâßË°åÈáçÂêØÁ≠ñÁï•„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">livenessProbe</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">failureThreshold</span><span class="p">:</span><span class="w"> </span><span class="m">5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">httpGet</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/health</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">8080</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">scheme</span><span class="p">:</span><span class="w"> </span><span class="l">HTTP</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">initialDelaySeconds</span><span class="p">:</span><span class="w"> </span><span class="m">60</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">periodSeconds</span><span class="p">:</span><span class="w"> </span><span class="m">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">successThreshold</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">timeoutSeconds</span><span class="p">:</span><span class="w"> </span><span class="m">5</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>ReadinessProbe</p>
<p>Áî®‰∫éÊé¢ÊµãÂÆπÂô®ÂÜÖÁöÑÁ®ãÂ∫èÊòØÂê¶ÂÅ•Â∫∑ÔºåÂÆÉÁöÑËøîÂõûÂÄºÂ¶ÇÊûúËøîÂõû successÔºåÈÇ£‰πàÂ∞±ËÆ§‰∏∫ËØ•ÂÆπÂô®Â∑≤ÁªèÂÆåÂÖ®ÂêØÂä®ÔºåÂπ∂‰∏îËØ•ÂÆπÂô®ÊòØÂèØ‰ª•Êé•Êî∂Â§ñÈÉ®ÊµÅÈáèÁöÑ„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">readinessProbe</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">failureThreshold</span><span class="p">:</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="c"># ÈîôËØØÊ¨°Êï∞</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">httpGet</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/ready</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">8181</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">scheme</span><span class="p">:</span><span class="w"> </span><span class="l">HTTP</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">periodSeconds</span><span class="p">:</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="c"># Èó¥ÈöîÊó∂Èó¥</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">successThreshold</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">timeoutSeconds</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div></li>
</ol>
<h5 id="Êé¢ÊµãÊñπÂºè">Êé¢ÊµãÊñπÂºè
</h5><ol>
<li>
<p>ExecAction</p>
<p>Âú®ÂÆπÂô®ÂÜÖÈÉ®ÊâßË°å‰∏Ä‰∏™ÂëΩ‰ª§ÔºåÂ¶ÇÊûúËøîÂõûÂÄº‰∏∫ 0ÔºåÂàô‰ªªÂä°ÂÆπÂô®Êó∂ÂÅ•Â∫∑ÁöÑ„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">livenessProbe</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">exec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l">\- cat</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="l">\- /health</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>TCPSocketAction</p>
<p>ÈÄöËøá tcp ËøûÊé•ÁõëÊµãÂÆπÂô®ÂÜÖÁ´ØÂè£ÊòØÂê¶ÂºÄÊîæÔºåÂ¶ÇÊûúÂºÄÊîæÂàôËØÅÊòéËØ•ÂÆπÂô®ÂÅ•Â∫∑</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">livenessProbe</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">tcpSocket</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>HTTPGetAction</p>
<p>Áîü‰∫ßÁéØÂ¢ÉÁî®ÁöÑËæÉÂ§öÁöÑÊñπÂºèÔºåÂèëÈÄÅ HTTP ËØ∑Ê±ÇÂà∞ÂÆπÂô®ÂÜÖÁöÑÂ∫îÁî®Á®ãÂ∫èÔºåÂ¶ÇÊûúÊé•Âè£ËøîÂõûÁöÑÁä∂ÊÄÅÁ†ÅÂú® 200~400 ‰πãÈó¥ÔºåÂàôËÆ§‰∏∫ÂÆπÂô®ÂÅ•Â∫∑„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">livenessProbe</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="nt">failureThreshold</span><span class="p">:</span><span class="w"> </span><span class="m">5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="nt">httpGet</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/health</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">8080</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">scheme</span><span class="p">:</span><span class="w"> </span><span class="l">HTTP</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">httpHeaders</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="nt">\- name</span><span class="p">:</span><span class="w"> </span><span class="l">xxx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l">xxx</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div></li>
</ol>
<h5 id="ÂèÇÊï∞ÈÖçÁΩÆ">ÂèÇÊï∞ÈÖçÁΩÆ
</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">initialDelaySeconds</span><span class="p">:</span><span class="w"> </span><span class="m">60</span><span class="w"> </span><span class="c"># ÂàùÂßãÂåñÊó∂Èó¥</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">timeoutSeconds</span><span class="p">:</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="c"># Ë∂ÖÊó∂Êó∂Èó¥</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">periodSeconds</span><span class="p">:</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="c"># ÁõëÊµãÈó¥ÈöîÊó∂Èó¥</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">successThreshold</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="c"># Ê£ÄÊü• 1 Ê¨°ÊàêÂäüÂ∞±Ë°®Á§∫ÊàêÂäü</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">failureThreshold</span><span class="p">:</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="c"># ÁõëÊµãÂ§±Ë¥• 2 Ê¨°Â∞±Ë°®Á§∫Â§±Ë¥•</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="ÁîüÂëΩÂë®Êúü">ÁîüÂëΩÂë®Êúü
</h4><p>
<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo03/202412222125032.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo03/202412222125032.png" alt="image-20241215130746124"  />
	</a>
</div>
</p>
<blockquote>
<p>‰øÆÊîπ nginx-demo.yaml</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w"> </span><span class="c"># apiÊñáÊ°£ÁâàÊú¨</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Pod</span><span class="w"> </span><span class="c"># ËµÑÊ∫êÂØπË±°Á±ªÂûã</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w"> </span><span class="c"># PodÁõ∏ÂÖ≥ÁöÑÂÖÉÊï∞ÊçÆÔºåÁî®‰∫éÊèèËø∞Pod</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx-demo</span><span class="w"> </span><span class="c"># PodÁöÑÂêçÁß∞</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w"> </span><span class="c"># ÂÆö‰πâPodÁöÑÊ†áÁ≠æ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">myFirstApp</span><span class="w"> </span><span class="c"># ‰ª•‰∏ãÂÖ®ÈÉ®ÈÉΩÊòØËá™ÂÆö‰πâÊ†áÁ≠æ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="m">0.0.1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;default&#39;</span><span class="w"> </span><span class="c"># ÂëΩÂêçÁ©∫Èó¥</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w"> </span><span class="c"># ÊúüÊúõPodÊ†πÊçÆËøôÈáåÁöÑÊèèËø∞ËøõË°åÂàõÂª∫</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">containers</span><span class="p">:</span><span class="w"> </span><span class="c"># ÂØπ‰∫éPod‰∏≠ÂÆπÂô®ÁöÑÊèèËø∞</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w"> </span><span class="c"># ÂÆπÂô®ÂêçÁß∞</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">nginx:1.7.9</span><span class="w"> </span><span class="c"># ÊåáÂÆöÂÆπÂô®ÁöÑÈïúÂÉè</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">IfNotPresent</span><span class="w"> </span><span class="c"># ÊåáÂÆöÈïúÂÉèÁöÑÊãâÂèñÁ≠ñÁï•</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">lifecycle</span><span class="p">:</span><span class="w"> </span><span class="c"># ÁîüÂëΩÂë®ÊúüÁöÑÈÖçÁΩÆ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">postStart</span><span class="p">:</span><span class="w"> </span><span class="c"># ÁîüÂëΩÂë®ÊúüÂêØÂä®Èò∂ÊÆµÂÅöÁöÑ‰∫ãÊÉÖÔºå‰ΩÜÊòØ‰∏ç‰∏ÄÂÆöÂú®ÂÆπÂô®command‰πãÂâçËøêË°å</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">exec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">command</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span>- <span class="l">sh</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span>- -<span class="l">c</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span>- <span class="s2">&#34;echo &#39;this is postStart&#39; &gt; /usr/share/nginx/html/lifecycle.html&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">preStop</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">exec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">command</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span>- <span class="l">sh</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span>- -<span class="l">c</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span>- <span class="s2">&#34;sleep 50;echo &#39;this is preStop&#39; &gt;&gt; /usr/share/nginx/html/lifecycle.html&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="c"># ÊåáÂÆöÂÆπÂô®ÂêØÂä®Êó∂ÔºåÊâßË°åÁöÑÂëΩ‰ª§</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- -<span class="l">g</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="s1">&#39;daemon off;&#39;</span><span class="w"> </span><span class="c"># nginx -g &#39;daemon off;&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">workingDir</span><span class="p">:</span><span class="w"> </span><span class="l">/usr/share/nginx/html</span><span class="w"> </span><span class="c"># ÊåáÂÆöÂ∑•‰ΩúÁõÆÂΩï</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">http</span><span class="w"> </span><span class="c"># Á´ØÂè£ÂêçÁß∞</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w"> </span><span class="c"># ÂÆπÂô®ÂÜÖÊö¥Èú≤ÁöÑÁ´ØÂè£</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">TCP</span><span class="w"> </span><span class="c"># ÊèèËø∞ËØ•Á´ØÂè£ÊòØÂü∫‰∫é‰ªÄ‰πàÂçèËÆÆËøõË°åÈÄöËÆØÁöÑ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">env</span><span class="p">:</span><span class="w"> </span><span class="c"># ÁéØÂ¢ÉÂèòÈáè</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">JVM_OPTS</span><span class="w"> </span><span class="c"># ÁéØÂ¢ÉÂèòÈáèÂêçÁß∞</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;-Xms128m -Xmx128m&#39;</span><span class="w"> </span><span class="c"># ÁéØÂ¢ÉÂèòÈáèÂÄº</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">resources</span><span class="p">:</span><span class="w"> </span><span class="c"># ÈÖçÁΩÆËµÑÊ∫ê</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">requests</span><span class="p">:</span><span class="w"> </span><span class="c"># ÊúÄÂ∞ëÈúÄË¶ÅÂ§öÂ∞ëËµÑÊ∫ê</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="l">100m</span><span class="w"> </span><span class="c"># 1000mÁ≠â‰∫é‰∏Ä‰∏™cpuÊ†∏ÂøÉÔºåÊúÄÂ∞ë‰ΩøÁî®0.1‰∏™Ê†∏ÂøÉ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l">128Mi</span><span class="w"> </span><span class="c"># ÈôêÂà∂ÂÜÖÂ≠òÊúÄÂ∞ë‰ΩøÁî®128ÂÖÜ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">limits</span><span class="p">:</span><span class="w"> </span><span class="c"># ÊúÄÂ§ö‰ΩøÁî®Â§öÂ∞ëËµÑÊ∫ê</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="l">200m</span><span class="w"> </span><span class="c"># ÈôêÂà∂cpuÊúÄÂ§ö‰ΩøÁî®0.2‰∏™Ê†∏ÂøÉ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l">256Mi</span><span class="w"> </span><span class="c"># ÈôêÂà∂ÂÜÖÂ≠òÊúÄÂ§ö‰ΩøÁî®256ÂÖÜ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">restartPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">OnFailure</span><span class="w"> </span><span class="c"># ÈÖçÁΩÆÈáçÂêØÁ≠ñÁï•</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># Ê≥®ÊÑèpreStopÂ§ÑÁöÑÂëΩ‰ª§ÔºåÊúâ‰∏Ä‰∏™sleep 50</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Ëé∑ÂèñËØ¶ÁªÜ‰ø°ÊÅØ(ipÂú∞ÂùÄ)</span>
</span></span><span class="line"><span class="cl">kubectl get po -o wide
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">curl 10.244.36.70:80/lifecycle.html
</span></span><span class="line"><span class="cl"><span class="c1"># this is postStart</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ÂÜçÂºÄ‰∏Ä‰∏™Á™óÂè£ÔºåÊåÅÁª≠ÁõëÂê¨poÁä∂ÊÄÅ kubectl get po -w</span>
</span></span><span class="line"><span class="cl"><span class="c1"># -w ‰ª£Ë°®ÊåÅÁª≠ÁõëÂê¨podÁä∂ÊÄÅ</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Âà†Èô§podÂπ∂Êü•ÁúãÂà†Èô§ÁöÑÊó∂Èó¥</span>
</span></span><span class="line"><span class="cl"><span class="c1"># time‰ª£Ë°®ÊâìÂç∞ÊâßË°åÂëΩ‰ª§Ê∂àËÄóÁöÑÊó∂Èó¥</span>
</span></span><span class="line"><span class="cl"><span class="nb">time</span> kubectl delete po pod_name
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Ê≠§Êó∂ÂèëÁé∞Âπ∂Ê≤°ÊúâÂú®50sÊó∂Âà†Èô§(Âõ†‰∏∫Êàë‰ª¨`preStop`ÈáåÂÆö‰πâÁöÑÊòØsleepÊó∂Èó¥ÊòØ50s)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ÊòØÂõ†‰∏∫Â≠òÂú®‰∏Ä‰∏™Âà†Èô§ÈªòËÆ§Êó∂Èó¥ÈÖçÁΩÆÔºåÈªòËÆ§ÊòØ`30s`(terminationGracePeriodSeconds)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ÊâìÂç∞ÁªìÊûúÂ¶Ç‰∏ã</span>
</span></span><span class="line"><span class="cl">NAME         READY   STATUS    RESTARTS   AGE
</span></span><span class="line"><span class="cl">nginx-demo   1/1     Running   <span class="m">0</span>          14s
</span></span><span class="line"><span class="cl">nginx-demo   1/1     Terminating   <span class="m">0</span>          15s
</span></span><span class="line"><span class="cl">nginx-demo   1/1     Terminating   <span class="m">0</span>          45s
</span></span><span class="line"><span class="cl">nginx-demo   0/1     Terminating   <span class="m">0</span>          45s
</span></span><span class="line"><span class="cl">nginx-demo   0/1     Terminating   <span class="m">0</span>          45s
</span></span><span class="line"><span class="cl">nginx-demo   0/1     Terminating   <span class="m">0</span>          45s
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ‰ªéÁ¨¨‰∏Ä‰∏™TerminatingÂà∞ÊúÄÂêéÔºåÊ∂àËÄó‰∫Ü30sÔºåÂπ∂‰∏çÊòØ50s</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Âõ†‰∏∫k8s ÈªòËÆ§Áªô pod ÁöÑÂÅúÊ≠¢ÂÆΩÈôêÊó∂Èó¥‰∏∫ 30sÔºåÈÖçÁΩÆÂèÇÊï∞‰∏∫terminationGracePeriodSeconds: 30</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>
<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo03/202412222125697.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo03/202412222125697.png" alt="image-20241215171021871"  />
	</a>
</div>
</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w"> </span><span class="c"># apiÊñáÊ°£ÁâàÊú¨</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Pod</span><span class="w"> </span><span class="c"># ËµÑÊ∫êÂØπË±°Á±ªÂûã</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w"> </span><span class="c"># PodÁõ∏ÂÖ≥ÁöÑÂÖÉÊï∞ÊçÆÔºåÁî®‰∫éÊèèËø∞Pod</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx-po</span><span class="w"> </span><span class="c"># PodÁöÑÂêçÁß∞</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w"> </span><span class="c"># ÂÆö‰πâPodÁöÑÊ†áÁ≠æ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">myFirstApp</span><span class="w"> </span><span class="c"># ‰ª•‰∏ãÂÖ®ÈÉ®ÈÉΩÊòØËá™ÂÆö‰πâÊ†áÁ≠æ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="m">0.0.1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;default&#39;</span><span class="w"> </span><span class="c"># ÂëΩÂêçÁ©∫Èó¥</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w"> </span><span class="c"># ÊúüÊúõPodÊ†πÊçÆËøôÈáåÁöÑÊèèËø∞ËøõË°åÂàõÂª∫</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">terminationGracePeriodSeconds</span><span class="p">:</span><span class="w"> </span><span class="m">50</span><span class="w"> </span><span class="c"># ÂΩìpodË¢´Âà†Èô§Êó∂ÔºåÁªôËøô‰∏™podÂÆΩÈôêÂ§öÈïøÊó∂Èó¥</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">containers</span><span class="p">:</span><span class="w"> </span><span class="c"># ÂØπ‰∫éPod‰∏≠ÂÆπÂô®ÁöÑÊèèËø∞</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w"> </span><span class="c"># ÂÆπÂô®ÂêçÁß∞</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">nginx:1.7.9</span><span class="w"> </span><span class="c"># ÊåáÂÆöÂÆπÂô®ÁöÑÈïúÂÉè</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">IfNotPresent</span><span class="w"> </span><span class="c"># ÊåáÂÆöÈïúÂÉèÁöÑÊãâÂèñÁ≠ñÁï•</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">lifecycle</span><span class="p">:</span><span class="w"> </span><span class="c"># ÁîüÂëΩÂë®ÊúüÁöÑÈÖçÁΩÆ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">postStart</span><span class="p">:</span><span class="w"> </span><span class="c"># ÁîüÂëΩÂë®ÊúüÂêØÂä®Èò∂ÊÆµÂÅöÁöÑ‰∫ãÔºå‰∏ç‰∏ÄÂÆöÂú®command‰πãÂâçÊâßË°å</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">exec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">command</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span>- <span class="l">sh</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span>- -<span class="l">c</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span>- <span class="s2">&#34;echo &#39;hello&#39; &gt; /usr/share/nginx/html/prestop.html&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">preStop</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">exec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">command</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span>- <span class="l">sh</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span>- -<span class="l">c</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span>- <span class="s2">&#34;sleep 50;echo &#39;sleep..&#39; &gt;&gt; /usr/share/nginx/html/prestop.html&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="c"># ÊåáÂÆöÂÆπÂô®ÂêØÂä®Êó∂ÔºåÊâßË°åÁöÑÂëΩ‰ª§</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- -<span class="l">g</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="s1">&#39;daemon off;&#39;</span><span class="w"> </span><span class="c"># nginx -g &#39;daemon off;&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">workingDir</span><span class="p">:</span><span class="w"> </span><span class="l">/usr/share/nginx/html</span><span class="w"> </span><span class="c"># ÊåáÂÆöÂ∑•‰ΩúÁõÆÂΩï</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">http</span><span class="w"> </span><span class="c"># Á´ØÂè£ÂêçÁß∞</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w"> </span><span class="c"># ÂÆπÂô®ÂÜÖÊö¥Èú≤ÁöÑÁ´ØÂè£</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">TCP</span><span class="w"> </span><span class="c"># ÊèèËø∞ËØ•Á´ØÂè£ÊòØÂü∫‰∫é‰ªÄ‰πàÂçèËÆÆËøõË°åÈÄöËÆØÁöÑ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">env</span><span class="p">:</span><span class="w"> </span><span class="c"># ÁéØÂ¢ÉÂèòÈáè</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">JVM_OPTS</span><span class="w"> </span><span class="c"># ÁéØÂ¢ÉÂèòÈáèÂêçÁß∞</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;-Xms128m -Xmx128m&#39;</span><span class="w"> </span><span class="c"># ÁéØÂ¢ÉÂèòÈáèÂÄº</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">resources</span><span class="p">:</span><span class="w"> </span><span class="c"># ÈÖçÁΩÆËµÑÊ∫ê</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">requests</span><span class="p">:</span><span class="w"> </span><span class="c"># ÊúÄÂ∞ëÈúÄË¶ÅÂ§öÂ∞ëËµÑÊ∫ê</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="l">100m</span><span class="w"> </span><span class="c"># 1000mÁ≠â‰∫é‰∏Ä‰∏™cpuÊ†∏ÂøÉÔºåÊúÄÂ∞ë‰ΩøÁî®0.1‰∏™Ê†∏ÂøÉ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l">128Mi</span><span class="w"> </span><span class="c"># ÈôêÂà∂ÂÜÖÂ≠òÊúÄÂ∞ë‰ΩøÁî®128ÂÖÜ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">limits</span><span class="p">:</span><span class="w"> </span><span class="c"># ÊúÄÂ§ö‰ΩøÁî®Â§öÂ∞ëËµÑÊ∫ê</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="l">200m</span><span class="w"> </span><span class="c"># ÈôêÂà∂cpuÊúÄÂ§ö‰ΩøÁî®0.2‰∏™Ê†∏ÂøÉ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l">256Mi</span><span class="w"> </span><span class="c"># ÈôêÂà∂ÂÜÖÂ≠òÊúÄÂ§ö‰ΩøÁî®256ÂÖÜ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">restartPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">OnFailure</span><span class="w"> </span><span class="c"># ÈÖçÁΩÆÈáçÂêØÁ≠ñÁï•</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ÂèëÁé∞ËøôÊ¨°Â∞±ÊòØ<code>50s</code>‰∫Ü</p>
<h5 id="pod-ÈÄÄÂá∫ÊµÅÁ®ã">Pod ÈÄÄÂá∫ÊµÅÁ®ã
</h5><h6 id="Âà†Èô§Êìç‰Ωú">Âà†Èô§Êìç‰Ωú
</h6><ol>
<li>
<p>Endpoint Âà†Èô§ pod ÁöÑ ip Âú∞ÂùÄ</p>
</li>
<li>
<p>Pod ÂèòÊàê Terminating Áä∂ÊÄÅ</p>
<p>Âèò‰∏∫Âà†Èô§‰∏≠ÁöÑÁä∂ÊÄÅÂêéÔºå‰ºöÁªô pod ‰∏Ä‰∏™ÂÆΩÈôêÊúüÔºåËÆ© pod ÂéªÊâßË°å‰∏Ä‰∫õÊ∏ÖÁêÜÊàñÈîÄÊØÅÊìç‰Ωú„ÄÇ</p>
<p>ÈÖçÁΩÆÂèÇÊï∞Ôºö</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="c"># ‰ΩúÁî®‰∏é pod ‰∏≠ÁöÑÊâÄÊúâÂÆπÂô®</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">terminationGracePeriodSeconds</span><span class="p">:</span><span class="w"> </span><span class="m">30</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">containers</span><span class="p">:</span><span class="w"> </span><span class="l">\- xxx</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>ÊâßË°å preStop ÁöÑÊåá‰ª§</p>
</li>
</ol>
<h5 id="prestop-ÁöÑÂ∫îÁî®">PreStop ÁöÑÂ∫îÁî®
</h5><p>Â¶ÇÊûúÂ∫îÁî®ÈîÄÊØÅÊìç‰ΩúËÄóÊó∂ÈúÄË¶ÅÊØîËæÉÈïøÔºåÂèØ‰ª•Âú® preStop ÊåâÁÖßÂ¶Ç‰∏ãÊñπÂºèËøõË°åÈÖçÁΩÆ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">preStop</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">exec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l">\- sh</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="l">\- -c</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="l">\- &#39;sleep 20; kill pgrep java&#39;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>‰ΩÜÊòØÈúÄË¶ÅÊ≥®ÊÑèÔºåÁî±‰∫é k8s ÈªòËÆ§Áªô pod ÁöÑÂÅúÊ≠¢ÂÆΩÈôêÊó∂Èó¥‰∏∫ 30sÔºåÂ¶ÇÊûúÊàë‰ª¨ÂÅúÊ≠¢Êìç‰Ωú‰ºöË∂ÖËøá 30s Êó∂Ôºå‰∏çË¶ÅÂÖâËÆæÁΩÆ sleep 50ÔºåËøòË¶ÅÂ∞Ü terminationGracePeriodSeconds: 30 ‰πüÊõ¥Êñ∞ÊàêÊõ¥ÈïøÁöÑÊó∂Èó¥ÔºåÂê¶Âàô k8s ÊúÄÂ§öÂè™‰ºöÂú®Ëøô‰∏™Êó∂Èó¥ÁöÑÂü∫Á°Ä‰∏äÂÜçÂÆΩÈôêÂá†ÁßíÔºå‰∏ç‰ºöÁúüÊ≠£Á≠âÂæÖ 50s</p>
<ol>
<li>Ê≥®ÂÜå‰∏≠ÂøÉ‰∏ãÁ∫ø</li>
<li>Êï∞ÊçÆÊ∏ÖÁêÜ</li>
<li>Êï∞ÊçÆÈîÄÊØÅ</li>
</ol>
<h3 id="ËµÑÊ∫êË∞ÉÂ∫¶">ËµÑÊ∫êË∞ÉÂ∫¶
</h3><h4 id="label-Âíå-selector">Label Âíå Selector
</h4><h5 id="Ê†áÁ≠ælabel">Ê†áÁ≠æÔºàLabelÔºâ
</h5><p><code>deploy</code>Âíå<code>rs</code>‰πãÈó¥ÁöÑÁªëÂÆöÂÖ≥Á≥ªÔºåÂ¶ÇÊûúÈááÁî® mysql Ë°®‰∏≠<code>‰∏ÄÂØπÂ§ö</code>Êàñ<code>Â§öÂØπÂ§ö</code>Â∞±‰ºöÂΩ¢Êàê<code>Âº∫ÁªëÂÆö</code>ÂÖ≥Á≥ªÔºåk8s Âπ∂Ê≤°ÊúâÈááÁî®ËøôÁßçÊñπÂºè</p>
<h6 id="ÈÖçÁΩÆÊñá‰ª∂">ÈÖçÁΩÆÊñá‰ª∂
</h6><p>Âú®ÂêÑÁ±ªËµÑÊ∫êÁöÑ metadata.labels ‰∏≠ËøõË°åÈÖçÁΩÆ</p>
<h6 id="kubectl">kubectl
</h6><ol>
<li>
<p>‰∏¥Êó∂ÂàõÂª∫ label</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">kubectl label po &lt;ËµÑÊ∫êÂêçÁß∞&gt; <span class="nv">app</span><span class="o">=</span>hello
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ÊåáÂÆöÂëΩÂêçÁ©∫Èó¥</span>
</span></span><span class="line"><span class="cl">kubectl label po &lt;ËµÑÊ∫êÂêçÁß∞&gt; <span class="nv">app</span><span class="o">=</span>hello -n kube-public
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>‰øÆÊîπÂ∑≤ÁªèÂ≠òÂú®ÁöÑÊ†áÁ≠æ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">kubectl label po &lt;ËµÑÊ∫êÂêçÁß∞&gt; <span class="nv">app</span><span class="o">=</span>hello2 --overwrite
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>Êü•Áúã label</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># selector ÊåâÁÖß label ÂçïÂÄºÊü•ÊâæËäÇÁÇπ</span>
</span></span><span class="line"><span class="cl">kubectl get po -A -l <span class="nv">app</span><span class="o">=</span>hello
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Êü•ÁúãÊâÄÊúâËäÇÁÇπÁöÑ labels</span>
</span></span><span class="line"><span class="cl">kubectl get po --show-labels
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>‰øÆÊîπÈÖçÁΩÆÊñá‰ª∂ÁöÑÂΩ¢Âºè‰øÆÊîπ lable</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">kubectl edit po nginx-demo
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ol>
<p>Â¶ÇÊûúÂ∏åÊúõÁªô<code>deploy</code>Êâì‰∏äÊ†áÁ≠æÊúâ‰∏§ÁßçÊñπÂºè</p>
<ol>
<li>‰øÆÊîπÂØπÂ∫îÁöÑ yaml ÈÖçÁΩÆÊñá‰ª∂(spec.meta.data.labels)</li>
<li>‰ΩøÁî®ÂëΩ‰ª§ÊâìÊ†áÁ≠æ
<ol>
<li>ÂàõÂª∫‰∏¥Êó∂ label(kubectl label po pod_name app=hello)</li>
<li>‰øÆÊîπÂ∑≤ÁªèÂ≠òÂú®ÁöÑ label(kubectl label po pod_name app=hello1 &ndash;overwrite)</li>
<li>Êü•Áúã label(kubectl get po [pod_name] &ndash;show-labels)</li>
</ol>
</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="o">[</span>root@k8s-master pods<span class="o">]</span><span class="c1"># kubectl create -f nginx-po.yaml</span>
</span></span><span class="line"><span class="cl">pod/nginx-po created
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@k8s-master pods<span class="o">]</span><span class="c1"># kubectl get po</span>
</span></span><span class="line"><span class="cl">NAME       READY   STATUS    RESTARTS   AGE
</span></span><span class="line"><span class="cl">nginx-po   1/1     Running   <span class="m">0</span>          2m5s
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@k8s-master pods<span class="o">]</span><span class="c1"># kubectl get po --show-labels</span>
</span></span><span class="line"><span class="cl">NAME       READY   STATUS    RESTARTS   AGE     LABELS
</span></span><span class="line"><span class="cl">nginx-po   1/1     Running   <span class="m">0</span>          2m32s   <span class="nv">type</span><span class="o">=</span>myFirstApp,version<span class="o">=</span>0.0.1
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@k8s-master pods<span class="o">]</span><span class="c1"># kubectl get po nginx-po --show-labels</span>
</span></span><span class="line"><span class="cl">NAME       READY   STATUS    RESTARTS   AGE     LABELS
</span></span><span class="line"><span class="cl">nginx-po   1/1     Running   <span class="m">0</span>          2m40s   <span class="nv">type</span><span class="o">=</span>myFirstApp,version<span class="o">=</span>0.0.1
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@k8s-master pods<span class="o">]</span><span class="c1">#</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>
<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo03/202412222125573.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo03/202412222125573.png" alt="image-20241215192454549"  />
	</a>
</div>
</p>
<p>ËÉΩÊü•ÁúãÂà∞Ê†áÁ≠æÊòØÂõ†‰∏∫Âú®ÂéüÊù•ÁöÑ yaml ÈáåÊàë‰ª¨Â∑≤ÁªèÈÖçÁΩÆ‰∫Ü‰∏ÄÈÉ®ÂàÜ label</p>
<blockquote>
<p>Èô§Ê≠§‰πãÂ§ñÔºåÂ¶ÇÊûúÂ∏åÊúõÂú®Â∑≤ÁªèÂ≠òÂú®ÁöÑ po ‰∏ä<code>Êñ∞Âª∫/‰øÆÊîπ</code>label ÂèØ‰ª•‰ΩøÁî®Â¶Ç‰∏ãÂëΩ‰ª§</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="o">[</span>root@k8s-master pods<span class="o">]</span><span class="c1"># kubectl get po nginx-po --show-labels</span>
</span></span><span class="line"><span class="cl">NAME       READY   STATUS    RESTARTS   AGE   LABELS
</span></span><span class="line"><span class="cl">nginx-po   1/1     Running   <span class="m">0</span>          17m   <span class="nv">type</span><span class="o">=</span>app1,version<span class="o">=</span>0.0.1
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@k8s-master pods<span class="o">]</span><span class="c1"># kubectl edit po nginx-po</span>
</span></span><span class="line"><span class="cl">pod/nginx-po edited
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@k8s-master pods<span class="o">]</span><span class="c1"># kubectl get po nginx-po --show-labels</span>
</span></span><span class="line"><span class="cl">NAME       READY   STATUS    RESTARTS   AGE   LABELS
</span></span><span class="line"><span class="cl">nginx-po   1/1     Running   <span class="m">0</span>          25m   <span class="nv">type</span><span class="o">=</span>app2,version<span class="o">=</span>0.0.1
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="ÈÄâÊã©Âô®selector">ÈÄâÊã©Âô®ÔºàSelectorÔºâ
</h5><blockquote>
<p>Âú®ÂêÑÂØπË±°ÁöÑÈÖçÁΩÆ spec.selector ÊàñÂÖ∂‰ªñÂèØ‰ª•ÂÜô selector ÁöÑÂ±ûÊÄß‰∏≠ÁºñÂÜô</p>
</blockquote>
<h6 id="ÈÖçÁΩÆÊñá‰ª∂-1">ÈÖçÁΩÆÊñá‰ª∂
</h6><p>Âú®ÂêÑÂØπË±°ÁöÑÈÖçÁΩÆ spec.selector ÊàñÂÖ∂‰ªñÂèØ‰ª•ÂÜô selector ÁöÑÂ±ûÊÄß‰∏≠ÁºñÂÜô</p>
<h6 id="kubectl-1">kubectl
</h6><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># -lË°®Á§∫Ê†πÊçÆlabelËøõË°åÂåπÈÖç,ÂåπÈÖçÂçï‰∏™ÂÄºÔºåÊü•Êâæ =app2 ÁöÑ pod</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@k8s-master pods<span class="o">]</span><span class="c1"># kubectl get po -l type=app2</span>
</span></span><span class="line"><span class="cl">NAME       READY   STATUS    RESTARTS   AGE
</span></span><span class="line"><span class="cl">nginx-po   1/1     Running   <span class="m">0</span>          27m
</span></span><span class="line"><span class="cl"><span class="c1"># -AÊòæÁ§∫ÂëΩÂêçÁ©∫Èó¥</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@k8s-master pods<span class="o">]</span><span class="c1"># kubectl get po -A -l type=app2</span>
</span></span><span class="line"><span class="cl">NAMESPACE   NAME       READY   STATUS    RESTARTS   AGE
</span></span><span class="line"><span class="cl">default     nginx-po   1/1     Running   <span class="m">0</span>          29m
</span></span><span class="line"><span class="cl"><span class="c1"># ÂêåÊó∂‰ΩøÁî®--show-labels</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@k8s-master pods<span class="o">]</span><span class="c1"># kubectl get po -A -l type=app2 --show-labels</span>
</span></span><span class="line"><span class="cl">NAMESPACE   NAME       READY   STATUS    RESTARTS   AGE   LABELS
</span></span><span class="line"><span class="cl">default     nginx-po   1/1     Running   <span class="m">0</span>          85m   <span class="nv">type</span><span class="o">=</span>app2,version<span class="o">=</span>0.0.1
</span></span><span class="line"><span class="cl"><span class="c1"># in</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@k8s-master pods<span class="o">]</span><span class="c1"># kubectl get po -l &#39;version in (0.0.1, 0,0.2, 0.0.3)&#39;</span>
</span></span><span class="line"><span class="cl">NAME       READY   STATUS    RESTARTS   AGE
</span></span><span class="line"><span class="cl">nginx-po   1/1     Running   <span class="m">0</span>          88m
</span></span><span class="line"><span class="cl"><span class="c1"># ÂêåÊó∂ÂåπÈÖçÂ§ö‰∏™label</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@k8s-master pods<span class="o">]</span><span class="c1"># kubectl get po -l version!=0.0.2,type=app2</span>
</span></span><span class="line"><span class="cl">NAME       READY   STATUS    RESTARTS   AGE
</span></span><span class="line"><span class="cl">nginx-po   1/1     Running   <span class="m">0</span>          89m
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Êü•Êâæ version!=1 and app=nginx ÁöÑ pod ‰ø°ÊÅØ</span>
</span></span><span class="line"><span class="cl">kubectl get po -l version!<span class="o">=</span>1,app<span class="o">=</span>nginx
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ‰∏çÁ≠âÂÄº + ËØ≠Âè•</span>
</span></span><span class="line"><span class="cl">kubectl get po -A -l version!<span class="o">=</span>1,<span class="s1">&#39;app in (busybox, nginx)&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="deployment">Deployment
</h4><h5 id="ÂäüËÉΩ">ÂäüËÉΩ
</h5><h6 id="ÂàõÂª∫">ÂàõÂª∫
</h6><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">kubectl delete po nginx-po
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> ../
</span></span><span class="line"><span class="cl">mkdir deployments
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> deployments
</span></span><span class="line"><span class="cl"><span class="c1"># ÂàõÂª∫deploy</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@k8s-master deployments<span class="o">]</span><span class="c1"># kubectl create deploy nginx-deploy --image=nginx:latest</span>
</span></span><span class="line"><span class="cl">deployment.apps/nginx-deploy created
</span></span><span class="line"><span class="cl"><span class="c1"># ÊàñÊâßË°å kubectl create -f xxx.yaml --record</span>
</span></span><span class="line"><span class="cl"><span class="c1"># --record ‰ºöÂú® annotation ‰∏≠ËÆ∞ÂΩïÂΩìÂâçÂëΩ‰ª§ÂàõÂª∫ÊàñÂçáÁ∫ß‰∫ÜËµÑÊ∫êÔºåÂêéÁª≠ÂèØ‰ª•Êü•ÁúãÂÅöËøáÂì™‰∫õÂèòÂä®Êìç‰Ωú„ÄÇ</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Êü•ÁúãÁä∂ÊÄÅ</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@k8s-master deployments<span class="o">]</span><span class="c1"># kubectl get deploy</span>
</span></span><span class="line"><span class="cl">NAME           READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span class="line"><span class="cl">nginx-deploy   1/1     <span class="m">1</span>            <span class="m">1</span>           72s
</span></span><span class="line"><span class="cl"><span class="c1"># Â¶ÇÊûúÊ≤°ÊúâreadyÔºåÊü•Áúã‰∏ãpodÔºåÁúãÁúãÂØπÂ∫îpodÊòØÂê¶ÂêØÂä®ÊàêÂäü</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@k8s-master deployments<span class="o">]</span><span class="c1"># kubectl get po</span>
</span></span><span class="line"><span class="cl">NAME                            READY   STATUS    RESTARTS   AGE
</span></span><span class="line"><span class="cl">nginx-deploy-65bdccd7c7-rj8xw   1/1     Running   <span class="m">0</span>          70s
</span></span><span class="line"><span class="cl"><span class="c1"># Êü•Áúãrs</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@k8s-master deployments<span class="o">]</span><span class="c1"># kubectl get replicaset</span>
</span></span><span class="line"><span class="cl">NAME                      DESIRED   CURRENT   READY   AGE
</span></span><span class="line"><span class="cl">nginx-deploy-65bdccd7c7   <span class="m">1</span>         <span class="m">1</span>         <span class="m">1</span>       4m56s
</span></span><span class="line"><span class="cl"><span class="c1"># ‰πüÂèØ‰ª•‰ΩøÁî®Áº©ÂÜô</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@k8s-master deployments<span class="o">]</span><span class="c1"># kubectl get rs</span>
</span></span><span class="line"><span class="cl">NAME                      DESIRED   CURRENT   READY   AGE
</span></span><span class="line"><span class="cl">nginx-deploy-65bdccd7c7   <span class="m">1</span>         <span class="m">1</span>         <span class="m">1</span>       5m19s
</span></span><span class="line"><span class="cl"><span class="c1"># Êü•Áúã pod ‰ª•ÂèäÂ±ïÁ§∫Ê†áÁ≠æÔºåÂèØ‰ª•ÁúãÂà∞ÊòØÂÖ≥ËÅîÁöÑÈÇ£‰∏™ rs</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@k8s-master deployments<span class="o">]</span><span class="c1"># kubectl get pods --show-labels</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>‰ªîÁªÜËßÇÂØü‰Ω†ÂèØËÉΩ‰ºöÂèëÁé∞Â¶Ç‰∏ãÁâπÁÇπÔºå‰ªñ‰ª¨ÁöÑÂêçÂ≠óÈÄêÊ≠•Â¢ûÂä†‰∫Ü id</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># deploy</span>
</span></span><span class="line"><span class="cl">nginx-deploy
</span></span><span class="line"><span class="cl"><span class="c1"># replicset</span>
</span></span><span class="line"><span class="cl">nginx-deploy-65bdccd7c7
</span></span><span class="line"><span class="cl"><span class="c1"># pod</span>
</span></span><span class="line"><span class="cl">nginx-deploy-65bdccd7c7-rj8xw
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>Â¶ÇÊûúÂ∏åÊúõËá™Â∑±ÈÄöËøáÈÖçÁΩÆÊñá‰ª∂Êù•ÂàõÂª∫ deployÔºåËÄå‰∏çÊòØÁõ¥Êé•ÈÄöËøáÈïúÂÉèÊù•ÂàõÂª∫</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="o">[</span>root@k8s-master deployments<span class="o">]</span><span class="c1"># kubectl get deploy</span>
</span></span><span class="line"><span class="cl">NAME           READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span class="line"><span class="cl">nginx-deploy   1/1     <span class="m">1</span>            <span class="m">1</span>           8m6s
</span></span><span class="line"><span class="cl"><span class="c1"># ‰ª•yamlÊ†ºÂºèËæìÂá∫`nginx-deploy`ÁöÑÈÖçÁΩÆ</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@k8s-master deployments<span class="o">]</span><span class="c1"># kubectl get deploy nginx-deploy -o yaml</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">piVersion</span><span class="p">:</span><span class="w"> </span><span class="l">apps/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Deployment</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">nginx-deploy</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx-deploy</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">default</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="c"># ÊúüÊúõÁöÑÂâØÊú¨Êï∞</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">revisionHistoryLimit</span><span class="p">:</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="c"># ËøõË°åÊªöÂä®Êõ¥Êñ∞ÂêéÔºå‰øùÁïôÁöÑÂéÜÂè≤ÁâàÊú¨Êï∞</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">nginx-deploy</span><span class="w"> </span><span class="c"># ÊåâÁÖßÊ†áÁ≠æÂåπÈÖçrs„ÄÅpo</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">strategy</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">rollingUpdate</span><span class="p">:</span><span class="w"> </span><span class="c"># ÊªöÂä®Êõ¥Êñ∞Á≠ñÁï•</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">maxSurge</span><span class="p">:</span><span class="w"> </span><span class="m">25</span><span class="l">%</span><span class="w"> </span><span class="c"># ËøõË°åÊªöÂä®Êõ¥Êñ∞Êó∂ÔºåÊõ¥Êñ∞‰∏™Êï∞ÊúÄÂ§öÂèØ‰ª•Ë∂ÖËøáÊúüÊúõÂâØÊú¨Êï∞ÁöÑ‰∏™Êï∞/ÊØî‰æã</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">maxUnavailable</span><span class="p">:</span><span class="w"> </span><span class="m">25</span><span class="l">%</span><span class="w"> </span><span class="c"># Êõ¥Êñ∞Êó∂ÔºåÊúÄÂ§ß‰∏çÂèØÁî®Êõ¥Êñ∞ÊØî‰æãÔºåË°®Á§∫ÊâÄÊúâÂâØÊú¨‰∏≠ÔºåÊúâÂ§öÂ∞ë‰∏™/ÊØî‰æãÊõ¥Êñ∞‰∏çÊàêÂäü</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">RollingUpdate</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">template</span><span class="p">:</span><span class="w"> </span><span class="c"># podÊ®°Êùø</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">nginx-deploy</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">spec</span><span class="p">:</span><span class="w"> </span><span class="c"># ÂÖÉ‰ø°ÊÅØ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">nginx:latest</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">IfNotPresent</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w"> </span><span class="c"># ÂÆπÂô®ÂêçÁß∞</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">restartPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">Always</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">terminationGracePeriodSeconds</span><span class="p">:</span><span class="w"> </span><span class="m">30</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><code>deploy</code>„ÄÅ<code>rs</code>„ÄÅ<code>pod</code>ÈÄöËøá<code>app=nginx-deploy</code>ÁöÑ**<code>label</code>**ËøõË°åÂÖ≥ËÅî</p>
<blockquote>
<p>‰øÆÊîπÂ∑≤ÁªèÂàõÂª∫Â•ΩÁöÑ deploy</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">kubectl edit deploy nginx-deploy
</span></span></code></pre></td></tr></table>
</div>
</div><h6 id="ÊªöÂä®Êõ¥Êñ∞">ÊªöÂä®Êõ¥Êñ∞
</h6><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># Âè™Êúâ‰øÆÊîπ‰∫Ü deployment ÈÖçÁΩÆÊñá‰ª∂‰∏≠ÁöÑ template ‰∏≠ÁöÑÂ±ûÊÄßÂêéÔºåÊâç‰ºöËß¶ÂèëÊõ¥Êñ∞Êìç‰Ωú</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ‰øÆÊîπ nginx ÁâàÊú¨Âè∑</span>
</span></span><span class="line"><span class="cl">kubectl <span class="nb">set</span> image deployment/nginx-deployment <span class="nv">nginx</span><span class="o">=</span>nginx:1.9.1
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ÊàñËÄÖÈÄöËøá kubectl edit deployment/nginx-deployment ËøõË°å‰øÆÊîπ</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Êü•ÁúãÊªöÂä®Êõ¥Êñ∞ÁöÑËøáÁ®ã</span>
</span></span><span class="line"><span class="cl">kubectl rollout status deploy &lt;deployment_name&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Êü•ÁúãÈÉ®ÁΩ≤ÊèèËø∞ÔºåÊúÄÂêéÂ±ïÁ§∫ÂèëÁîüÁöÑ‰∫ã‰ª∂ÂàóË°®‰πüÂèØ‰ª•ÁúãÂà∞ÊªöÂä®Êõ¥Êñ∞ËøáÁ®ã</span>
</span></span><span class="line"><span class="cl">kubectl describe deploy &lt;deployment_name&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ÈÄöËøá kubectl get deployments Ëé∑ÂèñÈÉ®ÁΩ≤‰ø°ÊÅØÔºåUP-TO-DATE Ë°®Á§∫Â∑≤ÁªèÊúâÂ§öÂ∞ëÂâØÊú¨ËææÂà∞‰∫ÜÈÖçÁΩÆ‰∏≠Ë¶ÅÊ±ÇÁöÑÊï∞ÁõÆ</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ÈÄöËøá kubectl get rs ÂèØ‰ª•ÁúãÂà∞Â¢ûÂä†‰∫Ü‰∏Ä‰∏™Êñ∞ÁöÑ rs</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ÈÄöËøá kubectl get pods ÂèØ‰ª•ÁúãÂà∞ÊâÄÊúâ pod ÂÖ≥ËÅîÁöÑ rs ÂèòÊàê‰∫ÜÊñ∞ÁöÑ</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>ËøòÂèØ‰ª•ÈÄöËøá‰øÆÊîπ yaml ÁöÑ<code>replicas</code>Êù•Â¢ûÂä†ÂâØÊú¨Êï∞</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">apps/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Deployment</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">annotations</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">deployment.kubernetes.io/revision</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;1&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">creationTimestamp</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;2024-12-15T13:37:52Z&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">generation</span><span class="p">:</span><span class="w"> </span><span class="m">4</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">nginx-deploy</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">test</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;123&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx-deploy</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">default</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">resourceVersion</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;110810&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">uid</span><span class="p">:</span><span class="w"> </span><span class="l">55fcd95d-2217-4c6e-91c4-e112e88edb2e</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">progressDeadlineSeconds</span><span class="p">:</span><span class="w"> </span><span class="m">600</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="c"># ÂâØÊú¨Êï∞</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="o">[</span>root@k8s-master k8s<span class="o">]</span><span class="c1"># kubectl get deploy</span>
</span></span><span class="line"><span class="cl">NAME           READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span class="line"><span class="cl">nginx-deploy   3/3     <span class="m">3</span>            <span class="m">3</span>           23h
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>Âú®‰øÆÊîπ template ÁöÑÊó∂ÂÄôÂ∞±‰ºöËß¶ÂèëÊªöÂä®Êõ¥Êñ∞</p>
<p>ÊØîÂ¶ÇËøôÈáå nginx ÁöÑÁâàÊú¨ÊòØ<code>latest</code>Ôºå‰øÆÊîπ image ÁöÑÁâàÊú¨Â∞±‰ºöËß¶ÂèëÊªöÂä®Êõ¥Êñ∞</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">template</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">creationTimestamp</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">nginx-deploy</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">nginx:latest</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">Always</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">resources</span><span class="p">:</span><span class="w"> </span>{}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">terminationMessagePath</span><span class="p">:</span><span class="w"> </span><span class="l">/dev/termination-log</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">terminationMessagePolicy</span><span class="p">:</span><span class="w"> </span><span class="l">File</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">dnsPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">ClusterFirst</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">restartPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">Always</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">schedulerName</span><span class="p">:</span><span class="w"> </span><span class="l">default-scheduler</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">securityContext</span><span class="p">:</span><span class="w"> </span>{}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">terminationGracePeriodSeconds</span><span class="p">:</span><span class="w"> </span><span class="m">30</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Êü•ÁúãÊªöÂä®Êõ¥Êñ∞ÁöÑËøáÁ®ã
<code>kubectl rollout status deploy &lt;deployment_name&gt;</code></p>
<p>Êü•ÁúãÈÉ®ÁΩ≤ÊèèËø∞ÔºåÊúÄÂêéÂ±ïÁ§∫ÂèëÁîüÁöÑ‰∫ã‰ª∂ÂàóË°®‰πüÂèØ‰ª•ÁúãÂà∞ÊªöÂä®Êõ¥Êñ∞ËøáÁ®ã
<code>kubectl describe deploy &lt;deployment_name&gt;</code></p>
<p>ÈÄöËøá kubectl get deployments Ëé∑ÂèñÈÉ®ÁΩ≤‰ø°ÊÅØÔºåUP-TO-DATE Ë°®Á§∫Â∑≤ÁªèÊúâÂ§öÂ∞ëÂâØÊú¨ËææÂà∞‰∫ÜÈÖçÁΩÆ‰∏≠Ë¶ÅÊ±ÇÁöÑÊï∞ÁõÆ</p>
<p>ÈÄöËøá kubectl get rs ÂèØ‰ª•ÁúãÂà∞Â¢ûÂä†‰∫Ü‰∏Ä‰∏™Êñ∞ÁöÑ rs</p>
<p>ÈÄöËøá kubectl get pods ÂèØ‰ª•ÁúãÂà∞ÊâÄÊúâ pod ÂÖ≥ËÅîÁöÑ rs ÂèòÊàê‰∫ÜÊñ∞ÁöÑ</p>
<blockquote>
<p>ÂÅáËÆæÂΩìÂâçÊúâ 5 ‰∏™ nginx:1.7.9 ÁâàÊú¨Ôºå‰Ω†ÊÉ≥Â∞ÜÁâàÊú¨Êõ¥Êñ∞‰∏∫ 1.9.1ÔºåÂΩìÊõ¥Êñ∞ÊàêÂäüÁ¨¨‰∏â‰∏™‰ª•ÂêéÔºå‰Ω†È©¨‰∏äÂèàÂ∞ÜÊúüÊúõÊõ¥Êñ∞ÁöÑÁâàÊú¨Êîπ‰∏∫ 1.9.2ÔºåÈÇ£‰πàÊ≠§Êó∂‰ºöÁ´ãÈ©¨Âà†Èô§‰πãÂâçÁöÑ‰∏â‰∏™ÔºåÂπ∂‰∏îÁ´ãÈ©¨ÂºÄÂêØÊõ¥Êñ∞ 1.9.2 ÁöÑ‰ªªÂä°(k8s Âà§Êñ≠‰πãÂâçÁöÑÊõ¥Êñ∞Ê≤°ÊúâÊÑè‰πâÔºåÊâÄ‰ª•‰ºö‰ªéÂàùÂßãÁâàÊú¨ÂºÄÂßãÊõ¥Êñ∞ÔºåÂøΩÁï•Êéâ‰∏ä‰∏ÄÊ¨°Ê≤°ÊúâÊÑè‰πâÁöÑÊõ¥Êñ∞)</p>
<p>Â¶Ç‰∏ãÔºåÊàëÂ∞Ü image ÁâàÊú¨‰ªé<code>latest</code>Êõ¥Êñ∞‰∏∫<code>1.7.9</code></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="o">[</span>root@k8s-master k8s<span class="o">]</span><span class="c1"># kubectl get deploy</span>
</span></span><span class="line"><span class="cl">NAME           READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span class="line"><span class="cl">nginx-deploy   3/3     <span class="m">3</span>            <span class="m">3</span>           23h
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@k8s-master k8s<span class="o">]</span><span class="c1"># kubectl describe deploy nginx-deploy</span>
</span></span><span class="line"><span class="cl">Name:                   nginx-deploy
</span></span><span class="line"><span class="cl">Namespace:              default
</span></span><span class="line"><span class="cl">CreationTimestamp:      Sun, <span class="m">15</span> Dec <span class="m">2024</span> 21:37:52 +0800
</span></span><span class="line"><span class="cl">Labels:                 <span class="nv">app</span><span class="o">=</span>nginx-deploy
</span></span><span class="line"><span class="cl">                        <span class="nv">test</span><span class="o">=</span><span class="m">123</span>
</span></span><span class="line"><span class="cl">Annotations:            deployment.kubernetes.io/revision: <span class="m">2</span>
</span></span><span class="line"><span class="cl">Selector:               <span class="nv">app</span><span class="o">=</span>nginx-deploy
</span></span><span class="line"><span class="cl">Replicas:               <span class="m">3</span> desired <span class="p">|</span> <span class="m">3</span> updated <span class="p">|</span> <span class="m">3</span> total <span class="p">|</span> <span class="m">3</span> available <span class="p">|</span> <span class="m">0</span> unavailable
</span></span><span class="line"><span class="cl">StrategyType:           RollingUpdate
</span></span><span class="line"><span class="cl">MinReadySeconds:        <span class="m">0</span>
</span></span><span class="line"><span class="cl">RollingUpdateStrategy:  25% max unavailable, 25% max surge
</span></span><span class="line"><span class="cl">Pod Template:
</span></span><span class="line"><span class="cl">  Labels:  <span class="nv">app</span><span class="o">=</span>nginx-deploy
</span></span><span class="line"><span class="cl">  Containers:
</span></span><span class="line"><span class="cl">   nginx:
</span></span><span class="line"><span class="cl">    Image:        nginx:1.7.9
</span></span><span class="line"><span class="cl">    Port:         &lt;none&gt;
</span></span><span class="line"><span class="cl">    Host Port:    &lt;none&gt;
</span></span><span class="line"><span class="cl">    Environment:  &lt;none&gt;
</span></span><span class="line"><span class="cl">    Mounts:       &lt;none&gt;
</span></span><span class="line"><span class="cl">  Volumes:        &lt;none&gt;
</span></span><span class="line"><span class="cl">Conditions:
</span></span><span class="line"><span class="cl">  Type           Status  Reason
</span></span><span class="line"><span class="cl">  ----           ------  ------
</span></span><span class="line"><span class="cl">  Available      True    MinimumReplicasAvailable
</span></span><span class="line"><span class="cl">  Progressing    True    NewReplicaSetAvailable
</span></span><span class="line"><span class="cl">OldReplicaSets:  &lt;none&gt;
</span></span><span class="line"><span class="cl">NewReplicaSet:   nginx-deploy-65976b546f <span class="o">(</span>3/3 replicas created<span class="o">)</span>
</span></span><span class="line"><span class="cl">Events:
</span></span><span class="line"><span class="cl">  Type    Reason             Age    From                   Message
</span></span><span class="line"><span class="cl">  ----    ------             ----   ----                   -------
</span></span><span class="line"><span class="cl">  Normal  ScalingReplicaSet  23h    deployment-controller  Scaled up replica <span class="nb">set</span> nginx-deploy-65bdccd7c7 to <span class="m">1</span>
</span></span><span class="line"><span class="cl">  Normal  ScalingReplicaSet  20m    deployment-controller  Scaled up replica <span class="nb">set</span> nginx-deploy-65bdccd7c7 to <span class="m">3</span>
</span></span><span class="line"><span class="cl">  Normal  ScalingReplicaSet  18m    deployment-controller  Scaled down replica <span class="nb">set</span> nginx-deploy-65bdccd7c7 to <span class="m">1</span>
</span></span><span class="line"><span class="cl">  Normal  ScalingReplicaSet  12m    deployment-controller  Scaled up replica <span class="nb">set</span> nginx-deploy-65bdccd7c7 to <span class="m">3</span>
</span></span><span class="line"><span class="cl">  Normal  ScalingReplicaSet  2m16s  deployment-controller  Scaled up replica <span class="nb">set</span> nginx-deploy-65976b546f to <span class="m">1</span>
</span></span><span class="line"><span class="cl">  Normal  ScalingReplicaSet  115s   deployment-controller  Scaled down replica <span class="nb">set</span> nginx-deploy-65bdccd7c7 to <span class="m">2</span>
</span></span><span class="line"><span class="cl">  Normal  ScalingReplicaSet  115s   deployment-controller  Scaled up replica <span class="nb">set</span> nginx-deploy-65976b546f to <span class="m">2</span>
</span></span><span class="line"><span class="cl">  Normal  ScalingReplicaSet  94s    deployment-controller  Scaled down replica <span class="nb">set</span> nginx-deploy-65bdccd7c7 to <span class="m">1</span>
</span></span><span class="line"><span class="cl">  Normal  ScalingReplicaSet  94s    deployment-controller  Scaled up replica <span class="nb">set</span> nginx-deploy-65976b546f to <span class="m">3</span>
</span></span><span class="line"><span class="cl">  Normal  ScalingReplicaSet  73s    deployment-controller  Scaled down replica <span class="nb">set</span> nginx-deploy-65bdccd7c7 to <span class="m">0</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h6 id="Â§ö‰∏™ÊªöÂä®Êõ¥Êñ∞Âπ∂Ë°å">Â§ö‰∏™ÊªöÂä®Êõ¥Êñ∞Âπ∂Ë°å
</h6><p>ÂÅáËÆæÂΩìÂâçÊúâ 5 ‰∏™ nginx:1.7.9 ÁâàÊú¨Ôºå‰Ω†ÊÉ≥Â∞ÜÁâàÊú¨Êõ¥Êñ∞‰∏∫ 1.9.1ÔºåÂΩìÊõ¥Êñ∞ÊàêÂäüÁ¨¨‰∏â‰∏™‰ª•ÂêéÔºå‰Ω†È©¨‰∏äÂèàÂ∞ÜÊúüÊúõÊõ¥Êñ∞ÁöÑÁâàÊú¨Êîπ‰∏∫ 1.9.2ÔºåÈÇ£‰πàÊ≠§Êó∂‰ºöÁ´ãÈ©¨Âà†Èô§‰πãÂâçÁöÑ‰∏â‰∏™ÔºåÂπ∂‰∏îÁ´ãÈ©¨ÂºÄÂêØÊõ¥Êñ∞ 1.9.2 ÁöÑ‰ªªÂä°</p>
<h6 id="ÂõûÊªö">ÂõûÊªö
</h6><p>ÊúâÊó∂ÂÄô‰Ω†ÂèØËÉΩÊÉ≥ÂõûÈÄÄ‰∏Ä‰∏™ DeploymentÔºå‰æãÂ¶ÇÔºåÂΩì Deployment ‰∏çÁ®≥ÂÆöÊó∂ÔºåÊØîÂ¶Ç‰∏ÄÁõ¥ crash looping„ÄÇ</p>
<p>ÈªòËÆ§ÊÉÖÂÜµ‰∏ãÔºåkubernetes ‰ºöÂú®Á≥ªÁªü‰∏≠‰øùÂ≠òÂâç‰∏§Ê¨°ÁöÑ Deployment ÁöÑ rollout ÂéÜÂè≤ËÆ∞ÂΩïÔºå‰ª•‰æø‰Ω†ÂèØ‰ª•ÈöèÊó∂‰ºöÈÄÄÔºà‰Ω†ÂèØ‰ª•‰øÆÊîπ revision history limit Êù•Êõ¥Êîπ‰øùÂ≠òÁöÑ revision Êï∞Ôºâ„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># Ê°à‰æãÔºö</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Êõ¥Êñ∞ deployment Êó∂ÂèÇÊï∞‰∏çÂ∞èÂøÉÂÜôÈîôÔºåÂ¶Ç nginx:1.9.1 ÂÜôÊàê‰∫Ü nginx:1.91</span>
</span></span><span class="line"><span class="cl">kubectl <span class="nb">set</span> image deployment/nginx-deploy <span class="nv">nginx</span><span class="o">=</span>nginx:1.91
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ÁõëÊéßÊªöÂä®ÂçáÁ∫ßÁä∂ÊÄÅÔºåÁî±‰∫éÈïúÂÉèÂêçÁß∞ÈîôËØØÔºå‰∏ãËΩΩÈïúÂÉèÂ§±Ë¥•ÔºåÂõ†Ê≠§Êõ¥Êñ∞ËøáÁ®ã‰ºöÂç°‰Ωè</span>
</span></span><span class="line"><span class="cl">kubectl rollout status deployments nginx-deploy
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ÁªìÊùüÁõëÂê¨ÂêéÔºåËé∑Âèñ rs ‰ø°ÊÅØÔºåÊàë‰ª¨ÂèØ‰ª•ÁúãÂà∞Êñ∞Â¢ûÁöÑ rs ÂâØÊú¨Êï∞ÊòØ 2 ‰∏™</span>
</span></span><span class="line"><span class="cl">kubectl get rs
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ÈÄöËøá kubectl get pods Ëé∑Âèñ pods ‰ø°ÊÅØÔºåÊàë‰ª¨ÂèØ‰ª•ÁúãÂà∞ÂÖ≥ËÅîÂà∞Êñ∞ÁöÑ rs ÁöÑ podÔºåÁä∂ÊÄÅÂ§Ñ‰∫é ImagePullBackOff Áä∂ÊÄÅ</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ‰∏∫‰∫Ü‰øÆÂ§çËøô‰∏™ÈóÆÈ¢òÔºåÊàë‰ª¨ÈúÄË¶ÅÊâæÂà∞ÈúÄË¶ÅÂõûÈÄÄÁöÑ revision ËøõË°åÂõûÈÄÄ</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ÈÄöËøá ‰ª•‰∏ãÂëΩ‰ª§ ÂèØ‰ª•Ëé∑Âèñ revison ÁöÑÂàóË°®</span>
</span></span><span class="line"><span class="cl">kubectl rollout <span class="nb">history</span> deployment/nginx-deploy
</span></span><span class="line"><span class="cl"><span class="c1"># deployment.apps/nginx-deploy</span>
</span></span><span class="line"><span class="cl"><span class="c1"># REVISION  CHANGE-CAUSE</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 1         &lt;none&gt;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 2         &lt;none&gt;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ËøôÈáåÊòØnoneÁöÑÂéüÂõ†ÊòØÂõ†‰∏∫Êõ¥Êñ∞ÁöÑÊó∂ÂÄôÊ≤°ÊúâÂÜôÊòéÂéüÂõ†ÔºåÊØîÂ¶Ç</span>
</span></span><span class="line"><span class="cl"><span class="c1"># kubectl set image deployment/nginx-deploy nginx=nginx:1.7.9 --record</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ÂõûÈÄÄÂà∞‰∏ä‰∏Ä‰∏™ÁâàÊú¨ÔºåÂç≥1ÔºåÂÖàÊü•Áúã‰∏Ä‰∏ãËØ•ÁâàÊú¨ÁöÑ‰ø°ÊÅØ</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ÈÄöËøá ‰ª•‰∏ãÂëΩ‰ª§ ÂèØ‰ª•Êü•ÁúãÊåáÂÆöÁâàÊú¨ÁöÑËØ¶ÁªÜ‰ø°ÊÅØ</span>
</span></span><span class="line"><span class="cl">kubectl rollout <span class="nb">history</span> deployment/nginx-deploy --revision<span class="o">=</span><span class="m">1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Á°ÆËÆ§Ë¶ÅÂõûÈÄÄÁöÑÁâàÊú¨ÂêéÔºåÂèØ‰ª•ÈÄöËøá ‰ª•‰∏ãÂëΩ‰ª§ ÂèØ‰ª•ÂõûÈÄÄÂà∞‰∏ä‰∏Ä‰∏™ÁâàÊú¨</span>
</span></span><span class="line"><span class="cl">kubectl rollout undo deployment/nginx-deploy
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ‰πüÂèØ‰ª•ÂõûÈÄÄÂà∞ÊåáÂÆöÁöÑ revision</span>
</span></span><span class="line"><span class="cl">kubectl rollout undo deployment/nginx-deploy --to-revision<span class="o">=</span><span class="m">1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ÂÜçÊ¨°ÈÄöËøá ‰ª•‰∏ãÂëΩ‰ª§ ÂèØ‰ª•ÁúãÂà∞ÔºåÊàë‰ª¨ÁöÑÁâàÊú¨Â∑≤ÁªèÂõûÈÄÄÂà∞ÂØπÂ∫îÁöÑ revison ‰∏ä‰∫Ü</span>
</span></span><span class="line"><span class="cl">kubectl get deployment
</span></span><span class="line"><span class="cl">kubectl describe deployment
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Êàë‰ª¨ÂèØ‰ª•ÂõûÈÄÄÁâàÊú¨ÊòØÂõ†‰∏∫Âú®yamlÈáåËÆæÁΩÆ‰∫Ü`revisionHistoryLimit`</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ÂèØ‰ª•ÈÄöËøáËÆæÁΩÆ .spec.revisonHistoryLimit Êù•ÊåáÂÆö deployment ‰øùÁïôÂ§öÂ∞ë revisonÔºåÂ¶ÇÊûúËÆæÁΩÆ‰∏∫ 0ÔºåÂàô‰∏çÂÖÅËÆ∏ deployment ÂõûÈÄÄ‰∫Ü„ÄÇ</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h6 id="Êâ©ÂÆπÁº©ÂÆπ">Êâ©ÂÆπÁº©ÂÆπ
</h6><p>ÈÄöËøá kube scale ÂëΩ‰ª§ÂèØ‰ª•ËøõË°åËá™Âä®Êâ©ÂÆπ/Áº©ÂÆπÔºå‰ª•ÂèäÈÄöËøá kube edit ÁºñËæë replcas ‰πüÂèØ‰ª•ÂÆûÁé∞Êâ©ÂÆπ/Áº©ÂÆπ</p>
<p>Êâ©ÂÆπ‰∏éÁº©ÂÆπÂè™ÊòØÁõ¥Êé•ÂàõÂª∫ÂâØÊú¨Êï∞ÔºåÊ≤°ÊúâÊõ¥Êñ∞ pod template Âõ†Ê≠§‰∏ç‰ºöÂàõÂª∫Êñ∞ÁöÑ rs</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">kubectl scale --replicas<span class="o">=</span><span class="m">6</span> deployment nginx-deploy
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Êü•ÁúãÂ∏ÆÂä©ÊñáÊ°£</span>
</span></span><span class="line"><span class="cl">kubectl scale --help
</span></span></code></pre></td></tr></table>
</div>
</div><h6 id="ÊöÇÂÅú‰∏éÊÅ¢Â§ç">ÊöÇÂÅú‰∏éÊÅ¢Â§ç
</h6><p>Áî±‰∫éÊØèÊ¨°ÂØπ pod template ‰∏≠ÁöÑ‰ø°ÊÅØÂèëÁîü‰øÆÊîπÂêéÔºåÈÉΩ‰ºöËß¶ÂèëÊõ¥Êñ∞ deployment Êìç‰ΩúÔºåÈÇ£‰πàÊ≠§Êó∂Â¶ÇÊûúÈ¢ëÁπÅ‰øÆÊîπ‰ø°ÊÅØÔºåÂ∞±‰ºö‰∫ßÁîüÂ§öÊ¨°Êõ¥Êñ∞ÔºåËÄåÂÆûÈôÖ‰∏äÂè™ÈúÄË¶ÅÊâßË°åÊúÄÂêé‰∏ÄÊ¨°Êõ¥Êñ∞Âç≥ÂèØÔºåÂΩìÂá∫Áé∞Ê≠§Á±ªÊÉÖÂÜµÊó∂Êàë‰ª¨Â∞±ÂèØ‰ª•ÊöÇÂÅú deployment ÁöÑ rollout</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># ÈÄöËøá kubectl rollout pause deployment &lt;name&gt; Â∞±ÂèØ‰ª•ÂÆûÁé∞ÊöÇÂÅúÔºåÁõ¥Âà∞‰Ω†‰∏ãÊ¨°ÊÅ¢Â§çÂêéÊâç‰ºöÁªßÁª≠ËøõË°åÊªöÂä®Êõ¥Êñ∞</span>
</span></span><span class="line"><span class="cl">kubectl rollout pause deployment nginx-deploy
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Â∞ùËØïÂØπÂÆπÂô®ËøõË°å‰øÆÊîπÔºåÁÑ∂ÂêéÊü•ÁúãÊòØÂê¶ÂèëÁîüÊõ¥Êñ∞Êìç‰Ωú‰∫Ü</span>
</span></span><span class="line"><span class="cl">kubectl <span class="nb">set</span> image deploy &lt;name&gt; <span class="nv">nginx</span><span class="o">=</span>nginx:1.17.9
</span></span><span class="line"><span class="cl">kubectl get po
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÈÄöËøá‰ª•‰∏äÊìç‰ΩúÂèØ‰ª•ÁúãÂà∞ÂÆûÈôÖÂπ∂Ê≤°ÊúâÂèëÁîü‰øÆÊîπÔºåÊ≠§Êó∂Êàë‰ª¨ÂÜçÊ¨°ËøõË°å‰øÆÊîπ‰∏Ä‰∫õÂ±ûÊÄßÔºåÂ¶ÇÈôêÂà∂ nginx ÂÆπÂô®ÁöÑÊúÄÂ§ß cpu ‰∏∫ 0.2 Ê†∏ÔºåÊúÄÂ§ßÂÜÖÂ≠ò‰∏∫ 128MÔºåÊúÄÂ∞èÂÜÖÂ≠ò‰∏∫ 64MÔºåÊúÄÂ∞è cpu ‰∏∫ 0.1 Ê†∏</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">kubectl <span class="nb">set</span> resources deploy &lt;deploy_name&gt; -c &lt;container_name&gt; --limits<span class="o">=</span><span class="nv">cpu</span><span class="o">=</span>200m,memory<span class="o">=</span>128Mi --requests<span class="o">=</span>cpu100m,memory<span class="o">=</span>64Mi
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ÈÄöËøáÊ†ºÂºèÂåñËæìÂá∫ kubectl get deploy &lt;name&gt; -oyamlÔºåÂèØ‰ª•ÁúãÂà∞ÈÖçÁΩÆÁ°ÆÂÆûÂèëÁîü‰∫Ü‰øÆÊîπÔºåÂÜçÈÄöËøá kubectl get po ÂèØ‰ª•ÁúãÂà∞ pod Ê≤°ÊúâË¢´Êõ¥Êñ∞</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ÈÇ£‰πàÊ≠§Êó∂Êàë‰ª¨ÂÜçÊÅ¢Â§ç rolloutÔºåÈÄöËøáÂëΩ‰ª§ kubectl rollout resume deploy &lt;name&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">kubectl rollout resume deploy nginx-deploy
</span></span><span class="line"><span class="cl"><span class="c1"># ÊÅ¢Â§çÂêéÔºåÊàë‰ª¨ÂÜçÊ¨°Êü•Áúã rs Âíå po ‰ø°ÊÅØÔºåÊàë‰ª¨ÂèØ‰ª•ÁúãÂà∞Â∞±ÂºÄÂßãËøõË°åÊªöÂä®Êõ¥Êñ∞Êìç‰Ωú‰∫Ü</span>
</span></span><span class="line"><span class="cl">kubectl get rs
</span></span><span class="line"><span class="cl">kubectl get po
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ÊöÇÂÅú</span>
</span></span><span class="line"><span class="cl">kubectl rollout pause deploy &lt;name&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ÊÅ¢Â§ç</span>
</span></span><span class="line"><span class="cl">kubectl rollout resume deploy &lt;name&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="ÈÖçÁΩÆÊñá‰ª∂-2">ÈÖçÁΩÆÊñá‰ª∂
</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">apps/v1</span><span class="w"> </span><span class="c"># deployment api ÁâàÊú¨</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Deployment</span><span class="w"> </span><span class="c"># ËµÑÊ∫êÁ±ªÂûã‰∏∫ deployment</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w"> </span><span class="c"># ÂÖÉ‰ø°ÊÅØ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w"> </span><span class="c"># Ê†áÁ≠æ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app: nginx-deploy # ÂÖ∑‰ΩìÁöÑ key</span><span class="p">:</span><span class="w"> </span><span class="l">value ÈÖçÁΩÆÂΩ¢Âºè</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx-deploy</span><span class="w"> </span><span class="c"># deployment ÁöÑÂêçÂ≠ó</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">default</span><span class="w"> </span><span class="c"># ÊâÄÂú®ÁöÑÂëΩÂêçÁ©∫Èó¥</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="c"># ÊúüÊúõÂâØÊú¨Êï∞</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">revisionHistoryLimit</span><span class="p">:</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="c"># ËøõË°åÊªöÂä®Êõ¥Êñ∞ÂêéÔºå‰øùÁïôÁöÑÂéÜÂè≤ÁâàÊú¨Êï∞</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w"> </span><span class="c"># ÈÄâÊã©Âô®ÔºåÁî®‰∫éÊâæÂà∞ÂåπÈÖçÁöÑ RS</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span><span class="w"> </span><span class="c"># ÊåâÁÖßÊ†áÁ≠æÂåπÈÖç</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">nginx-deploy</span><span class="w"> </span><span class="c"># ÂåπÈÖçÁöÑÊ†áÁ≠ækey/value</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">strategy</span><span class="p">:</span><span class="w"> </span><span class="c"># Êõ¥Êñ∞Á≠ñÁï•</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">rollingUpdate</span><span class="p">:</span><span class="w"> </span><span class="c"># ÊªöÂä®Êõ¥Êñ∞ÈÖçÁΩÆ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">maxSurge</span><span class="p">:</span><span class="w"> </span><span class="m">25</span><span class="l">%</span><span class="w"> </span><span class="c"># ËøõË°åÊªöÂä®Êõ¥Êñ∞Êó∂ÔºåÊõ¥Êñ∞ÁöÑ‰∏™Êï∞ÊúÄÂ§öÂèØ‰ª•Ë∂ÖËøáÊúüÊúõÂâØÊú¨Êï∞ÁöÑ‰∏™Êï∞/ÊØî‰æã</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">maxUnavailable</span><span class="p">:</span><span class="w"> </span><span class="m">25</span><span class="l">%</span><span class="w"> </span><span class="c"># ËøõË°åÊªöÂä®Êõ¥Êñ∞Êó∂ÔºåÊúÄÂ§ß‰∏çÂèØÁî®ÊØî‰æãÊõ¥Êñ∞ÊØî‰æãÔºåË°®Á§∫Âú®ÊâÄÊúâÂâØÊú¨Êï∞‰∏≠ÔºåÊúÄÂ§öÂèØ‰ª•ÊúâÂ§öÂ∞ë‰∏™‰∏çÊõ¥Êñ∞ÊàêÂäü</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">RollingUpdate</span><span class="w"> </span><span class="c"># Êõ¥Êñ∞Á±ªÂûãÔºåÈááÁî®ÊªöÂä®Êõ¥Êñ∞</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">template</span><span class="p">:</span><span class="w"> </span><span class="c"># pod Ê®°Êùø</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span><span class="w"> </span><span class="c"># pod ÁöÑÂÖÉ‰ø°ÊÅØ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">labels</span><span class="p">:</span><span class="w"> </span><span class="c"># pod ÁöÑÊ†áÁ≠æ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">nginx-deploy</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">spec</span><span class="p">:</span><span class="w"> </span><span class="c"># pod ÊúüÊúõ‰ø°ÊÅØ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">containers</span><span class="p">:</span><span class="w"> </span><span class="c"># pod ÁöÑÂÆπÂô®</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">nginx:1.7.9</span><span class="w"> </span><span class="c"># ÈïúÂÉè</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">IfNotPresent</span><span class="w"> </span><span class="c"># ÊãâÂèñÁ≠ñÁï•</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w"> </span><span class="c"># ÂÆπÂô®ÂêçÁß∞</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">restartPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">Always</span><span class="w"> </span><span class="c"># ÈáçÂêØÁ≠ñÁï•</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">terminationGracePeriodSeconds</span><span class="p">:</span><span class="w"> </span><span class="m">30</span><span class="w"> </span><span class="c"># Âà†Èô§Êìç‰ΩúÊúÄÂ§öÂÆΩÈôêÂ§öÈïøÊó∂Èó¥</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="statefulset-1">StatefulSet
</h4><blockquote>
<p>‰ª•‰∏äÊòØÂÖ≥‰∫éÊó†Áä∂ÊÄÅÂ∫îÁî®ÁöÑÂÜÖÂÆπÔºåÂ¢ûÂä†Âà†Èô§ÁÆÄÂçïÊâßË°åÂëΩ‰ª§Âç≥ÂèØ
‰ΩÜÊòØÊúâÁä∂ÊÄÅÂ∫îÁî®Âç¥‰∏ç‰∏ÄÊ†∑ÔºåÂèØËÉΩ‰ºö‰æùËµñÊú¨Âú∞ÁöÑÊñá‰ª∂„ÄÅÁΩëÁªú</p>
</blockquote>
<h5 id="ÂäüËÉΩ-1">ÂäüËÉΩ
</h5><h6 id="ÂàõÂª∫-1">ÂàõÂª∫
</h6><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">kubectl create -f web.yaml
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Êü•Áúã service Âíå statefulset =&gt; sts</span>
</span></span><span class="line"><span class="cl">kubectl get service nginx
</span></span><span class="line"><span class="cl">kubectl get statefulset web
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Êü•Áúãservice(ÁÆÄÂÜô)</span>
</span></span><span class="line"><span class="cl">kubectl get svc
</span></span><span class="line"><span class="cl"><span class="c1"># Êü•Áúãstatefulset(ÁÆÄÂÜô)</span>
</span></span><span class="line"><span class="cl">kubectl get sts
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Êü•Áúã PVC ‰ø°ÊÅØ</span>
</span></span><span class="line"><span class="cl">kubectl get pvc
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Êü•ÁúãÂàõÂª∫ÁöÑ podÔºåËøô‰∫õ pod ÊòØÊúâÂ∫èÁöÑ</span>
</span></span><span class="line"><span class="cl">kubectl get pods -l <span class="nv">app</span><span class="o">=</span>nginx
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Êü•ÁúãËøô‰∫õ pod ÁöÑ dns</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ËøêË°å‰∏Ä‰∏™ podÔºåÂü∫Á°ÄÈïúÂÉè‰∏∫ busybox Â∑•ÂÖ∑ÂåÖÔºåÂà©Áî®ÈáåÈù¢ÁöÑ nslookup ÂèØ‰ª•ÁúãÂà∞ dns ‰ø°ÊÅØ</span>
</span></span><span class="line"><span class="cl">kubectl run -i --tty --image busybox dns-test --restart<span class="o">=</span>Never --rm /bin/sh
</span></span><span class="line"><span class="cl">nslookup web-0.nginx
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ÂàõÂª∫sts</span>
</span></span><span class="line"><span class="cl">kubectl create -f web.yaml
</span></span><span class="line"><span class="cl"><span class="c1"># service/nginx created</span>
</span></span><span class="line"><span class="cl"><span class="c1"># statefulset.apps/web created</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ÂÜçÊ¨°Êü•ÁúãÊÉÖÂÜµ</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ËøôÈáåÊ≤°ÊúâÁªëÂÆöipÔºåÊâÄ‰ª•ipÊòæÁ§∫none</span>
</span></span><span class="line"><span class="cl">kubectl get svc
</span></span><span class="line"><span class="cl"><span class="c1"># NAME         TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE</span>
</span></span><span class="line"><span class="cl"><span class="c1"># kubernetes   ClusterIP   10.96.0.1    &lt;none&gt;        443/TCP   69d</span>
</span></span><span class="line"><span class="cl"><span class="c1"># nginx        ClusterIP   None         &lt;none&gt;        80/TCP    47s</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">kubectl get sts
</span></span><span class="line"><span class="cl"><span class="c1"># NAME   READY   AGE</span>
</span></span><span class="line"><span class="cl"><span class="c1"># web    0/2     51s</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Êü•ÁúãÊåÅ‰πÖÂç∑(Êï∞ÊçÆÂç∑)</span>
</span></span><span class="line"><span class="cl">kubectl get pvc
</span></span><span class="line"><span class="cl"><span class="c1"># NAME        STATUS    VOLUME   CAPACITY   ACCESS MODES   STORAGECLASS   AGE</span>
</span></span><span class="line"><span class="cl"><span class="c1"># www-web-0   Pending                                                     2m4s</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Êü•ÁúãËØ¶ÁªÜ‰ø°ÊÅØÔºåÂèëÁé∞ÊúâÈóÆÈ¢ò</span>
</span></span><span class="line"><span class="cl">kubectl describe pvc www-web-0
</span></span><span class="line"><span class="cl"><span class="c1"># Name:          www-web-0</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Namespace:     default</span>
</span></span><span class="line"><span class="cl"><span class="c1"># StorageClass:</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Status:        Pending</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Volume:</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Labels:        app=nginx</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Annotations:   volume.alpha.kubernetes.io/storage-class: anything</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Finalizers:    [kubernetes.io/pvc-protection]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Capacity:</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Access Modes:</span>
</span></span><span class="line"><span class="cl"><span class="c1"># VolumeMode:    Filesystem</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Used By:       web-0</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Events:</span>
</span></span><span class="line"><span class="cl"><span class="c1">#   Type    Reason         Age                  From                         Message</span>
</span></span><span class="line"><span class="cl"><span class="c1">#   ----    ------         ----                 ----                         -------</span>
</span></span><span class="line"><span class="cl"><span class="c1">#   Normal  FailedBinding  8s (x15 over 3m34s)  persistentvolume-controller  no persistent volumes available for this claim and no storage class is set</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Áî±‰∫éÊ≤°ÊúâÂèØÁî®ÁöÑÊåÅ‰πÖÂç∑ËÄå‰∏îÊ≤°ÊúâËÆæÁΩÆÂ≠òÂÇ®Á±ªÔºåÊâÄ‰ª•sts‰æùÊóßÊ≤°Êúâready</span>
</span></span><span class="line"><span class="cl">kubectl get sts
</span></span><span class="line"><span class="cl"><span class="c1"># NAME   READY   AGE</span>
</span></span><span class="line"><span class="cl"><span class="c1"># web    0/2     4m18s</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">web</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">clusterIP</span><span class="p">:</span><span class="w"> </span><span class="l">None</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">apps/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">StatefulSet</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">web</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">serviceName</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;nginx&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="m">2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">template</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">nginx:latest</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">web</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">volumeMounts</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">www</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/usr/share/nginx/html</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">volumeClaimTemplates</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">www</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">annotations</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">volume.alpha.kubernetes.io/storage-class</span><span class="p">:</span><span class="w"> </span><span class="l">anything</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">accessModes</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;ReadWriteOnce&#39;</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">resources</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">requests</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l">1Gi</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>Áî±‰∫éÂ≠òÂÇ®Âç∑ÁöÑÈóÆÈ¢òÔºåÁé∞Âú®‰øÆÊîπ‰∏Ä‰∏ã yamlÔºåÊöÇÊó∂‰∏çÊ∑ªÂä†Â≠òÂÇ®Âç∑</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">web</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">clusterIP</span><span class="p">:</span><span class="w"> </span><span class="l">None</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">apps/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">StatefulSet</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">web</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">serviceName</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;nginx&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="m">2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">template</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">nginx:latest</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">web</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># Áõ¥Êé•ÊõøÊç¢ÊéâstsÁöÑyaml</span>
</span></span><span class="line"><span class="cl">kubectl replace -f web.yaml sts web
</span></span><span class="line"><span class="cl"><span class="c1"># service/nginx replaced</span>
</span></span><span class="line"><span class="cl"><span class="c1"># The StatefulSet &#34;web&#34; is invalid: spec: Forbidden: updates to statefulset spec for fields other than &#39;replicas&#39;, &#39;template&#39;, &#39;updateStrategy&#39;, &#39;persistentVolumeClaimRetentionPolicy&#39; and &#39;minReadySeconds&#39; are forbidden</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Ëøô‰∏™ÊèêÁ§∫ÁöÑÂéüÂõ†ÊòØÊúâ‰∫õÂèÇÊï∞ÊòØ‰∏çËÉΩÊõøÊç¢ÁöÑÔºåÊâÄ‰ª•ËøòÊòØÂà†Èô§ÈáçÂª∫Âêß</span>
</span></span><span class="line"><span class="cl">kubectl delete sts web
</span></span><span class="line"><span class="cl"><span class="c1"># statefulset.apps &#34;web&#34; deleted</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">kubectl delete svc nginx
</span></span><span class="line"><span class="cl"><span class="c1"># service &#34;nginx&#34; deleted</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">kubectl delete pvc www-web-0
</span></span><span class="line"><span class="cl"><span class="c1"># persistentvolumeclaim &#34;www-web-0&#34; deleted</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">kubectl create -f web.yaml
</span></span><span class="line"><span class="cl"><span class="c1"># service/nginx created</span>
</span></span><span class="line"><span class="cl"><span class="c1"># statefulset.apps/web created</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Êü•Áúã‰ø°ÊÅØ</span>
</span></span><span class="line"><span class="cl">kubectl get sts
</span></span><span class="line"><span class="cl"><span class="c1"># NAME   READY   AGE</span>
</span></span><span class="line"><span class="cl"><span class="c1"># web    2/2     39s</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">kubectl get svc
</span></span><span class="line"><span class="cl"><span class="c1"># NAME         TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE</span>
</span></span><span class="line"><span class="cl"><span class="c1"># kubernetes   ClusterIP   10.96.0.1    &lt;none&gt;        443/TCP   69d</span>
</span></span><span class="line"><span class="cl"><span class="c1"># nginx        ClusterIP   None         &lt;none&gt;        80/TCP    42s</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">kubectl get pvc
</span></span><span class="line"><span class="cl"><span class="c1"># No resources found in default namespace.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Êü•Áúãpo</span>
</span></span><span class="line"><span class="cl">kubectl get po
</span></span><span class="line"><span class="cl"><span class="c1"># NAME    READY   STATUS    RESTARTS   AGE</span>
</span></span><span class="line"><span class="cl"><span class="c1"># web-0   1/1     Running   0          65s</span>
</span></span><span class="line"><span class="cl"><span class="c1"># web-1   1/1     Running   0          58s</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Êñ∞Âª∫‰∏Ä‰∏™poÔºåÂéªpingËøô‰∏§‰∏™poÔºåËßÇÂØüÊòØÂê¶ÂèØ‰ª•pingÈÄö</span>
</span></span><span class="line"><span class="cl"><span class="c1"># busyboxÊòØlinuxÈáåÁöÑ‰∏Ä‰∏™Â∑•ÂÖ∑ÈïúÂÉè</span>
</span></span><span class="line"><span class="cl">kubectl run -it --image busybox:1.28.4 dns-test /bin/sh
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">kubectl get po
</span></span><span class="line"><span class="cl"><span class="c1"># NAME       READY   STATUS    RESTARTS   AGE</span>
</span></span><span class="line"><span class="cl"><span class="c1"># dns-test   1/1     Running   0          77s</span>
</span></span><span class="line"><span class="cl"><span class="c1"># web-0      1/1     Running   1          13h</span>
</span></span><span class="line"><span class="cl"><span class="c1"># web-1      1/1     Running   1          13h</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ÊàëËøôÈáåÊâßË°åÂÆåÂëΩ‰ª§‰πãÂêéÊ≤°ÊúâËá™Âä®ËøõÂÖ•poÂÜÖÈÉ®ÔºåÊü•ÁúãÂèëÁé∞Â∑≤Áªèready‰∫Ü</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ÊâßË°å‰ª•‰∏ãÂëΩ‰ª§ËøõÂÖ•poÂÜÖÈÉ®</span>
</span></span><span class="line"><span class="cl">kubectl <span class="nb">exec</span> -it dns-test -- /bin/sh
</span></span><span class="line"><span class="cl"><span class="c1">#statefulset‰∏≠ÊØè‰∏™podÁöÑdnsÊ†ºÂºè‰∏∫statefulsetName-{0,1...n}.serviceName.namespace.svc.cluster.local</span>
</span></span><span class="line"><span class="cl">/ <span class="c1"># nslookup web-0.nginx</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Server:    10.96.0.10</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Address 1: 10.96.0.10 kube-dns.kube-system.svc.cluster.local</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Name:      web-0.nginx</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Address 1: 10.244.36.74 web-0.nginx.default.svc.cluster.local</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h6 id="Êâ©ÂÆπÁº©ÂÆπ-1">Êâ©ÂÆπÁº©ÂÆπ
</h6><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># Êâ©ÂÆπ</span>
</span></span><span class="line"><span class="cl">kubectl scale statefulset web --replicas<span class="o">=</span><span class="m">5</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ÊàñËÄÖÂ¶Ç‰∏ã</span>
</span></span><span class="line"><span class="cl">kubectl patch statefulset web -p <span class="s1">&#39;{&#34;spec&#34;:{&#34;replicas&#34;:5}}&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Áº©ÂÆπ</span>
</span></span><span class="line"><span class="cl">kubectl patch statefulset web -p <span class="s1">&#39;{&#34;spec&#34;:{&#34;replicas&#34;:3}}&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h6 id="ÈïúÂÉèÊõ¥Êñ∞">ÈïúÂÉèÊõ¥Êñ∞
</h6><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># ÈïúÂÉèÊõ¥Êñ∞ÔºàÁõÆÂâç‰∏çÊîØÊåÅÁõ¥Êé•‰ΩøÁî®`edit`ÂëΩ‰ª§‰ª•ÂèäÂèÇÊï∞`-o yaml`Êù•‰øÆÊîπyamlÈáåÁöÑimageÔºåÈúÄË¶Å patch Êù•Èó¥Êé•ÂÆûÁé∞Ôºâ</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">kubectl patch sts web --type<span class="o">=</span><span class="s1">&#39;json&#39;</span> -p<span class="o">=</span><span class="s1">&#39;[{&#34;op&#34;: &#34;replace&#34;, &#34;path&#34;: &#34;/spec/template/spec/containers/0/image&#34;, &#34;value&#34;:&#34;nginx:1.9.1&#34;}]&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ‰ΩøÁî®Â¶Ç‰∏ã</span>
</span></span><span class="line"><span class="cl"><span class="c1"># webÊòØstsÁöÑÂêçÂ≠óÔºåÁ±ªÂûãÊòØjsonÊï∞ÊçÆÔºåÊìç‰ΩúÊòØreplaceÔºåÂ∞Ü/spec/.../imageÊõøÊç¢Êàênginx:1.9.1</span>
</span></span><span class="line"><span class="cl">kubectl patch sts web --type<span class="o">=</span><span class="s1">&#39;json&#39;</span> -p<span class="o">=</span><span class="s1">&#39;[{&#34;op&#34;:&#34;replace&#34;,&#34;path&#34;:&#34;/spec/template/spec/containers/0/image&#34;,&#34;value&#34;:&#34;nginx:1.9.1&#34;}]&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ‰ΩøÁî®</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@k8s-master ~<span class="o">]</span><span class="c1"># kubectl patch sts web --type=&#39;json&#39; -p=&#39;[{&#34;op&#34;:&#34;replace&#34;,&#34;path&#34;:&#34;/spec/template/spec/containers/0/image&#34;,&#34;value&#34;:&#34;nginx:1.9.1&#34;}]&#39;</span>
</span></span><span class="line"><span class="cl">statefulset.apps/web patched
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@k8s-master ~<span class="o">]</span><span class="c1"># kubectl get sts</span>
</span></span><span class="line"><span class="cl">NAME   READY   AGE
</span></span><span class="line"><span class="cl">web    1/2     24h
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@k8s-master ~<span class="o">]</span><span class="c1"># kubectl get po</span>
</span></span><span class="line"><span class="cl">NAME       READY   STATUS              RESTARTS   AGE
</span></span><span class="line"><span class="cl">dns-test   1/1     Running             <span class="m">0</span>          10h
</span></span><span class="line"><span class="cl">web-0      0/1     ContainerCreating   <span class="m">0</span>          40s
</span></span><span class="line"><span class="cl">web-1      1/1     Running             <span class="m">0</span>          55s
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@k8s-master ~<span class="o">]</span><span class="c1"># kubectl describe po web-0</span>
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">  Type    Reason     Age   From               Message
</span></span><span class="line"><span class="cl">  ----    ------     ----  ----               -------
</span></span><span class="line"><span class="cl">  Normal  Scheduled  44s   default-scheduler  Successfully assigned default/web-0 to k8s-node1
</span></span><span class="line"><span class="cl">  Normal  Pulling    43s   kubelet            Pulling image <span class="s2">&#34;nginx:1.9.1&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Á≠âÂæÖpullÂÆåÊàê</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@k8s-master ~<span class="o">]</span><span class="c1"># kubectl get po</span>
</span></span><span class="line"><span class="cl">NAME       READY   STATUS    RESTARTS   AGE
</span></span><span class="line"><span class="cl">dns-test   1/1     Running   <span class="m">0</span>          10h
</span></span><span class="line"><span class="cl">web-0      1/1     Running   <span class="m">0</span>          2m7s
</span></span><span class="line"><span class="cl">web-1      1/1     Running   <span class="m">0</span>          2m22s
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@k8s-master ~<span class="o">]</span><span class="c1"># kubectl get sts</span>
</span></span><span class="line"><span class="cl">NAME   READY   AGE
</span></span><span class="line"><span class="cl">web    2/2     24h
</span></span><span class="line"><span class="cl"><span class="c1"># Êü•ÁúãÂéÜÂè≤ÁâàÊú¨</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ÂèØ‰ª•ÊòéÊòæÁúãÂà∞ÈïúÂÉè‰ªélatestÊõ¥Êñ∞Âà∞1.9.1‰∫Ü</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@k8s-master k8s<span class="o">]</span><span class="c1"># kubectl rollout history sts</span>
</span></span><span class="line"><span class="cl">statefulset.apps/web
</span></span><span class="line"><span class="cl">REVISION  CHANGE-CAUSE
</span></span><span class="line"><span class="cl"><span class="m">1</span>         &lt;none&gt;
</span></span><span class="line"><span class="cl"><span class="m">2</span>         &lt;none&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@k8s-master k8s<span class="o">]</span><span class="c1"># kubectl rollout history sts --revision=2</span>
</span></span><span class="line"><span class="cl">statefulset.apps/web with revision <span class="c1">#2</span>
</span></span><span class="line"><span class="cl">Pod Template:
</span></span><span class="line"><span class="cl">  Labels:	<span class="nv">app</span><span class="o">=</span>nginx
</span></span><span class="line"><span class="cl">  Containers:
</span></span><span class="line"><span class="cl">   nginx:
</span></span><span class="line"><span class="cl">    Image:	nginx:1.9.1
</span></span><span class="line"><span class="cl">    Port:	80/TCP
</span></span><span class="line"><span class="cl">    Host Port:	0/TCP
</span></span><span class="line"><span class="cl">    Environment:	&lt;none&gt;
</span></span><span class="line"><span class="cl">    Mounts:	&lt;none&gt;
</span></span><span class="line"><span class="cl">  Volumes:	&lt;none&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@k8s-master k8s<span class="o">]</span><span class="c1"># kubectl rollout history sts --revision=1</span>
</span></span><span class="line"><span class="cl">statefulset.apps/web with revision <span class="c1">#1</span>
</span></span><span class="line"><span class="cl">Pod Template:
</span></span><span class="line"><span class="cl">  Labels:	<span class="nv">app</span><span class="o">=</span>nginx
</span></span><span class="line"><span class="cl">  Containers:
</span></span><span class="line"><span class="cl">   nginx:
</span></span><span class="line"><span class="cl">    Image:	nginx:latest
</span></span><span class="line"><span class="cl">    Port:	80/TCP
</span></span><span class="line"><span class="cl">    Host Port:	0/TCP
</span></span><span class="line"><span class="cl">    Environment:	&lt;none&gt;
</span></span><span class="line"><span class="cl">    Mounts:	&lt;none&gt;
</span></span><span class="line"><span class="cl">  Volumes:	&lt;none&gt;
</span></span><span class="line"><span class="cl"><span class="c1"># Êü•ÁúãstsÂÜÖÂÆπÔºåÂÖàÂà†Èô§web-1ÔºåÂÜçÂàõÂª∫web-1Ôºåweb-0‰πüÊòØÂ¶ÇÊ≠§</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@k8s-master k8s<span class="o">]</span><span class="c1"># kubectl describe sts web</span>
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">  Type    Reason            Age                  From                    Message
</span></span><span class="line"><span class="cl">  ----    ------            ----                 ----                    -------
</span></span><span class="line"><span class="cl">  Normal  SuccessfulCreate  9h                   statefulset-controller  create Pod web-2 in StatefulSet web successful
</span></span><span class="line"><span class="cl">  Normal  SuccessfulCreate  9h                   statefulset-controller  create Pod web-3 in StatefulSet web successful
</span></span><span class="line"><span class="cl">  Normal  SuccessfulCreate  9h                   statefulset-controller  create Pod web-4 in StatefulSet web successful
</span></span><span class="line"><span class="cl">  Normal  SuccessfulDelete  9h                   statefulset-controller  delete Pod web-4 in StatefulSet web successful
</span></span><span class="line"><span class="cl">  Normal  SuccessfulDelete  9h                   statefulset-controller  delete Pod web-3 in StatefulSet web successful
</span></span><span class="line"><span class="cl">  Normal  SuccessfulDelete  9h                   statefulset-controller  delete Pod web-2 in StatefulSet web successful
</span></span><span class="line"><span class="cl">  Normal  SuccessfulDelete  6m38s                statefulset-controller  delete Pod web-1 in StatefulSet web successful
</span></span><span class="line"><span class="cl">  Normal  SuccessfulCreate  6m37s <span class="o">(</span>x2 over 24h<span class="o">)</span>  statefulset-controller  create Pod web-1 in StatefulSet web successful
</span></span><span class="line"><span class="cl">  Normal  SuccessfulDelete  6m23s                statefulset-controller  delete Pod web-0 in StatefulSet web successful
</span></span><span class="line"><span class="cl">  Normal  SuccessfulCreate  6m22s <span class="o">(</span>x2 over 24h<span class="o">)</span>  statefulset-controller  create Pod web-0 in StatefulSet web successful
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>RollingUpdate</p>
</blockquote>
<p>StatefulSet ‰πüÂèØ‰ª•ÈááÁî®ÊªöÂä®Êõ¥Êñ∞Á≠ñÁï•ÔºåÂêåÊ†∑ÊòØ‰øÆÊîπ pod template Â±ûÊÄßÂêé‰ºöËß¶ÂèëÊõ¥Êñ∞Ôºå‰ΩÜÊòØÁî±‰∫é pod ÊòØÊúâÂ∫èÁöÑÔºåÂú® StatefulSet ‰∏≠Êõ¥Êñ∞Êó∂ÊòØÂü∫‰∫é pod ÁöÑÈ°∫Â∫èÂÄíÂ∫èÊõ¥Êñ∞ÁöÑ</p>
<blockquote>
<p>ÁÅ∞Â∫¶ÂèëÂ∏É</p>
</blockquote>
<p>Âà©Áî®ÊªöÂä®Êõ¥Êñ∞‰∏≠ÁöÑ partition Â±ûÊÄßÔºåÂèØ‰ª•ÂÆûÁé∞ÁÆÄÊòìÁöÑÁÅ∞Â∫¶ÂèëÂ∏ÉÁöÑÊïàÊûú</p>
<p>‰æãÂ¶ÇÊàë‰ª¨Êúâ 5 ‰∏™ podÔºåÂ¶ÇÊûúÂΩìÂâç partition ËÆæÁΩÆ‰∏∫ 3ÔºåÈÇ£‰πàÊ≠§Êó∂ÊªöÂä®Êõ¥Êñ∞Êó∂ÔºåÂè™‰ºöÊõ¥Êñ∞ÈÇ£‰∫õ Â∫èÂè∑ &gt;= 3 ÁöÑ pod</p>
<p>Âà©Áî®ËØ•Êú∫Âà∂ÔºåÊàë‰ª¨ÂèØ‰ª•ÈÄöËøáÊéßÂà∂ partition ÁöÑÂÄºÔºåÊù•ÂÜ≥ÂÆöÂè™Êõ¥Êñ∞ÂÖ∂‰∏≠‰∏ÄÈÉ®ÂàÜ podÔºåÁ°ÆËÆ§Ê≤°ÊúâÈóÆÈ¢òÂêéÂÜç‰∏ªÈîÆÂ¢ûÂ§ßÊõ¥Êñ∞ÁöÑ pod Êï∞ÈáèÔºåÊúÄÁªàÂÆûÁé∞ÂÖ®ÈÉ® pod Êõ¥Êñ∞</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># ÂÆûÁé∞ÁÅ∞Â∫¶ÂèëÂ∏É(Èáë‰∏ùÈõÄÂèëÂ∏É)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Êâ©ÂÆπ</span>
</span></span><span class="line"><span class="cl">kubectl scale sts web --replicas <span class="m">6</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Êõ¥Êñ∞Â¶Ç‰∏ãÂÜÖÂÆπ</span>
</span></span><span class="line"><span class="cl">kubectl edit sts web
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">  updateStrategy:
</span></span><span class="line"><span class="cl">    rollingUpdate:
</span></span><span class="line"><span class="cl">      partition: <span class="m">3</span> <span class="c1"># Êîπ‰∏∫3</span>
</span></span><span class="line"><span class="cl">    type: RollingUpdate
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@k8s-master k8s<span class="o">]</span><span class="c1"># kubectl get po</span>
</span></span><span class="line"><span class="cl">NAME       READY   STATUS    RESTARTS   AGE
</span></span><span class="line"><span class="cl">dns-test   1/1     Running   <span class="m">0</span>          47h
</span></span><span class="line"><span class="cl">web-0      1/1     Running   <span class="m">0</span>          37h
</span></span><span class="line"><span class="cl">web-1      1/1     Running   <span class="m">0</span>          37h
</span></span><span class="line"><span class="cl">web-2      1/1     Running   <span class="m">0</span>          12h
</span></span><span class="line"><span class="cl">web-3      1/1     Running   <span class="m">0</span>          12h
</span></span><span class="line"><span class="cl">web-4      1/1     Running   <span class="m">0</span>          12h
</span></span><span class="line"><span class="cl">web-5      1/1     Running   <span class="m">0</span>          12h
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Â¶ÇÊûústsÂèëÁîüÊõ¥Êñ∞Ôºå‰ºòÂÖàÊõ¥Êñ∞web-3„ÄÅweb-4„ÄÅweb-5(‰ºòÂÖàÊõ¥Êñ∞&gt;=3ÁöÑpo)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Ê≠§Êó∂Êõ¥Êñ∞stsÁöÑimageÁâàÊú¨ÔºåÊü•ÁúãpoÁöÑÂÜÖÂÆπ</span>
</span></span><span class="line"><span class="cl"><span class="c1"># image‰ªé1.9.1Êõ¥Êñ∞‰∏∫latest</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@k8s-master k8s<span class="o">]</span><span class="c1"># kubectl describe po web-3</span>
</span></span><span class="line"><span class="cl">Name:         web-3
</span></span><span class="line"><span class="cl">Namespace:    default
</span></span><span class="line"><span class="cl">Priority:     <span class="m">0</span>
</span></span><span class="line"><span class="cl">Node:         k8s-node1/192.168.42.132
</span></span><span class="line"><span class="cl">Start Time:   Thu, <span class="m">19</span> Dec <span class="m">2024</span> 21:29:18 +0800
</span></span><span class="line"><span class="cl">Labels:       <span class="nv">app</span><span class="o">=</span>nginx
</span></span><span class="line"><span class="cl">              controller-revision-hash<span class="o">=</span>web-7974cc466
</span></span><span class="line"><span class="cl">              statefulset.kubernetes.io/pod-name<span class="o">=</span>web-3
</span></span><span class="line"><span class="cl">Annotations:  cni.projectcalico.org/containerID: 0c73e705476bd47bae66ff1b3e3763705fb433000aaf7411ad30cf4dd358bfb9
</span></span><span class="line"><span class="cl">              cni.projectcalico.org/podIP: 10.244.36.70/32
</span></span><span class="line"><span class="cl">              cni.projectcalico.org/podIPs: 10.244.36.70/32
</span></span><span class="line"><span class="cl">Status:       Running
</span></span><span class="line"><span class="cl">IP:           10.244.36.70
</span></span><span class="line"><span class="cl">IPs:
</span></span><span class="line"><span class="cl">  IP:           10.244.36.70
</span></span><span class="line"><span class="cl">Controlled By:  StatefulSet/web
</span></span><span class="line"><span class="cl">Containers:
</span></span><span class="line"><span class="cl">  nginx:
</span></span><span class="line"><span class="cl">    Container ID:   docker://873c777e9938672b070e104e0d9453d4c8caa16761c327cdaadb45a3aa078fa9
</span></span><span class="line"><span class="cl">    Image:          nginx:latest <span class="c1"># ÂèØ‰ª•ÁúãÂà∞web-3Â∑≤ÁªèÊõ¥Êñ∞‰∏∫latestÁâàÊú¨‰∫Ü</span>
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@k8s-master k8s<span class="o">]</span><span class="c1"># kubectl describe po web-2</span>
</span></span><span class="line"><span class="cl">Name:         web-2
</span></span><span class="line"><span class="cl">Namespace:    default
</span></span><span class="line"><span class="cl">Priority:     <span class="m">0</span>
</span></span><span class="line"><span class="cl">Node:         k8s-node2/192.168.42.133
</span></span><span class="line"><span class="cl">Start Time:   Thu, <span class="m">19</span> Dec <span class="m">2024</span> 08:30:21 +0800
</span></span><span class="line"><span class="cl">Labels:       <span class="nv">app</span><span class="o">=</span>nginx
</span></span><span class="line"><span class="cl">              controller-revision-hash<span class="o">=</span>web-567b56dd
</span></span><span class="line"><span class="cl">              statefulset.kubernetes.io/pod-name<span class="o">=</span>web-2
</span></span><span class="line"><span class="cl">Annotations:  cni.projectcalico.org/containerID: 737d7c5bb252479092322bfa6edceb42b6538b29e6615402f68a6767f891de85
</span></span><span class="line"><span class="cl">              cni.projectcalico.org/podIP: 10.244.169.131/32
</span></span><span class="line"><span class="cl">              cni.projectcalico.org/podIPs: 10.244.169.131/32
</span></span><span class="line"><span class="cl">Status:       Running
</span></span><span class="line"><span class="cl">IP:           10.244.169.131
</span></span><span class="line"><span class="cl">IPs:
</span></span><span class="line"><span class="cl">  IP:           10.244.169.131
</span></span><span class="line"><span class="cl">Controlled By:  StatefulSet/web
</span></span><span class="line"><span class="cl">Containers:
</span></span><span class="line"><span class="cl">  nginx:
</span></span><span class="line"><span class="cl">    Container ID:   docker://d9efaad9065e835a888499244edecd5e83b66513905ea08d3908c893782f1049
</span></span><span class="line"><span class="cl">    Image:          nginx:1.9.1 <span class="c1"># ‰ΩÜÊòØweb-2ËøòÊ≤°ÊúâÊõ¥Êñ∞</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ÊúÄÁªàÈÄêÊ≠•ÂáèÂ∞è`partition`ÁöÑÂÄºÁõ¥Ëá≥‰∏∫0ÔºåËøôÊ†∑Â∞±ÂÆûÁé∞‰∫ÜÁÅ∞Â∫¶ÂèëÂ∏É(Èáë‰∏ùÈõÄÂèëÂ∏É)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>OnDelete</p>
</blockquote>
<p>Âè™ÊúâÂú® pod Ë¢´Âà†Èô§Êó∂‰ºöËøõË°åÊõ¥Êñ∞Êìç‰Ωú</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># Â∞ÜÂ¶Ç‰∏ã‰ª£Á†ÅËøõË°åÊõ¥Êñ∞</span>
</span></span><span class="line"><span class="cl">  updateStrategy:
</span></span><span class="line"><span class="cl">    rollingUpdate:
</span></span><span class="line"><span class="cl">      partition: <span class="m">0</span>
</span></span><span class="line"><span class="cl">    type: RollingUpdate
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl"><span class="c1"># Êõ¥Êñ∞‰∏∫Â¶Ç‰∏ã‰ª£Á†Å</span>
</span></span><span class="line"><span class="cl">  updateStrategy:
</span></span><span class="line"><span class="cl">    type: OnDelete
</span></span><span class="line"><span class="cl"><span class="c1"># Ë°®Á§∫Êõ¥Êñ∞Á≠ñÁï•ËÆæÁΩÆ‰∏∫ÂΩìÂà†Èô§Êó∂ÊâçÊõ¥Êñ∞</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Ê≠§Êó∂ÂÜç‰øÆÊîπimageÁöÑÁâàÊú¨‰ªélatestÊõ¥Êñ∞‰∏∫1.9.1</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Ê≠§Êó∂poÊòØ‰∏ç‰ºöÂØπÁâàÊú¨ËøõË°åÊõ¥Êñ∞ÁöÑÔºåÂè™ÊúâÂú®Âà†Èô§ÂØπÂ∫îpoÊó∂Êâç‰ºöËøõË°åÊõ¥Êñ∞ÔºåÂà†Èô§po‰πãÂêéÂ∞±‰ºöÈáçÂª∫poÔºåÂπ∂Êõ¥Êñ∞image</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ËøôÊ†∑Â∞±ËÉΩÂÆûÁé∞ÊåáÂÆöÊõ¥Êñ∞ÁöÑpoÔºåÊØîÂ¶ÇÊàëÂè™Â∏åÊúõÊõ¥Êñ∞web-3ÔºåËÄåÂÖ∂‰ªñÁöÑpo‰∏çÂ∏åÊúõËøõË°åÊõ¥Êñ∞</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Ê≠§Êó∂Âà†Èô§web-3Ëøô‰∏™poÂç≥ÂèØ</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h6 id="Âà†Èô§">Âà†Èô§
</h6><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># Âú®Êó†Áä∂ÊÄÅÂ∫îÁî®‰∏≠ÔºåÂà†Èô§deploy‰πãÂêéÔºåÂØπÂ∫îÁöÑpo‰πü‰ºöËá™Âä®Âà†Èô§</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ËÄåÂú®ÊúâÁä∂ÊÄÅÂ∫îÁî®‰∏≠ÔºåÂà†Èô§sts‰πãÂêéÔºåÈªòËÆ§‰πü‰ºöËøõË°åÁ∫ßËÅîÂà†Èô§</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Âà†Èô§ StatefulSet Âíå Headless Service</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ÈªòËÆ§Á∫ßËÅîÂà†Èô§ÔºöÂà†Èô§ statefulset Êó∂‰ºöÂêåÊó∂Âà†Èô§ pods</span>
</span></span><span class="line"><span class="cl">kubectl delete statefulset web
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ÈùûÁ∫ßËÅîÂà†Èô§ÔºöÂà†Èô§ statefulset Êó∂‰∏ç‰ºöÂà†Èô§ podsÔºåÂà†Èô§ sts ÂêéÔºåpods Â∞±Ê≤°‰∫∫ÁÆ°‰∫ÜÔºåÊ≠§Êó∂ÂÜçÂà†Èô§ pod ‰∏ç‰ºöÈáçÂª∫ÁöÑ</span>
</span></span><span class="line"><span class="cl">kubectl deelte sts web --cascade<span class="o">=</span><span class="nb">false</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Âà†Èô§ service</span>
</span></span><span class="line"><span class="cl">kubectl delete service nginx
</span></span></code></pre></td></tr></table>
</div>
</div><h6 id="Âà†Èô§-pvc">Âà†Èô§ pvc
</h6><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># StatefulSetÂà†Èô§ÂêéPVCËøò‰ºö‰øùÁïôÁùÄÔºåÊï∞ÊçÆ‰∏çÂÜç‰ΩøÁî®ÁöÑËØù‰πüÈúÄË¶ÅÂà†Èô§</span>
</span></span><span class="line"><span class="cl">kubectl delete pvc www-web-0 www-web-1
</span></span></code></pre></td></tr></table>
</div>
</div><h6 id="ÈÖçÁΩÆÊñá‰ª∂-3">ÈÖçÁΩÆÊñá‰ª∂
</h6><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">web</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">clusterIP</span><span class="p">:</span><span class="w"> </span><span class="l">None</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">apps/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">StatefulSet</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">web</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">serviceName</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;nginx&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="m">2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">template</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">nginx:1.7.9</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">web</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">volumeMounts</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">www</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/usr/share/nginx/html</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">volumeClaimTemplates</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">www</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">annotations</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">volume.alpha.kubernetes.io/storage-class</span><span class="p">:</span><span class="w"> </span><span class="l">anything</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">accessModes</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;ReadWriteOnce&#39;</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">resources</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">requests</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l">1Gi</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="daemonset">DaemonSet
</h4><blockquote>
<p>‰∏∫ÊØè‰∏Ä‰∏™ÂåπÈÖçÂà∞ÁöÑ Node ÈÉΩÈÉ®ÁΩ≤‰∏Ä‰∏™ÂÆàÊä§ËøõÁ®ã</p>
<p>Â¶ÇÊûúÊúâ‰ª•‰∏ãÁöÑ‰∏öÂä°Âú∫ÊôØÔºå‰ª•‰∏ãÊòØÂæÆÊúçÂä°ÁöÑË∞ÉÁî®ÈìæË∑Ø</p>
</blockquote>
<p>
<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo03/202412222124413.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo03/202412222124413.png" alt="image-20241222212431460"  />
	</a>
</div>
</p>
<p>‰∏ÄËà¨‰ºöÂ≠òÂú®Á¨¨Âõõ‰∏™ËäÇÁÇπÔºåÈÉ®ÁΩ≤ÊôÆÁΩóÁ±≥‰øÆÊñØ(ÁõëÊéß)„ÄÅelasticsearch(Â≠òÊîæÊó•Âøó)</p>
<p>Âä†ÂÖ•ËøôÁßçÊ®°ÂºèÂá∫Áé∞ÈóÆÈ¢òÔºåÊàë‰ª¨‰∏Ä‰∏™‰∏™ËäÇÁÇπË∞ÉÊü•Êó•ÂøóÊú™ÂÖçÂ§™ËøáÈ∫ªÁÉ¶ÔºåÊúÄÂ•ΩÊúâ‰∏Ä‰∏™‰∏úË•øÂèØ‰ª•ÁªôÊØè‰∏™ËäÇÁÇπÁöÑ log ‰ø°ÊÅØÁªü‰∏ÄÂÜôÂÖ• es Â∞±Â•Ω‰∫Ü</p>
<p><code>DaemonSet</code>Ê≠£Â•ΩÁ¨¶ÂêàÈúÄÊ±ÇÔºåÈÄöËøá<code>nodeSelector</code>ÂåπÈÖçÂà∞ÂØπÂ∫îÁöÑ<code>pod</code>ÔºåÈÄöËøá<code>Fluentd</code>Êî∂ÈõÜÊó•ÂøóÂπ∂ÂèëÈÄÅÂà∞ es</p>
<p>
<div class="post-img-view">
	<a data-fancybox="gallery" href="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo03/202412222129683.png">
		<img src="https://raw.githubusercontent.com/IsUnderAchiever/markdown-img/master/PicGo03/202412222129683.png" alt="image-20241222212953278"  />
	</a>
</div>
</p>
<p>DaemonSet ‰ºöÂøΩÁï• Node ÁöÑ unschedulable Áä∂ÊÄÅÔºåÊúâ‰∏§ÁßçÊñπÂºèÊù•ÊåáÂÆö Pod Âè™ËøêË°åÂú®ÊåáÂÆöÁöÑ Node ËäÇÁÇπ‰∏äÔºö</p>
<ul>
<li>nodeSelectorÔºöÂè™Ë∞ÉÂ∫¶Âà∞ÂåπÈÖçÊåáÂÆö label ÁöÑ Node ‰∏ä</li>
<li>nodeAffinityÔºöÂäüËÉΩÊõ¥‰∏∞ÂØåÁöÑ Node ÈÄâÊã©Âô®ÔºåÊØîÂ¶ÇÊîØÊåÅÈõÜÂêàÊìç‰Ωú</li>
<li>podAffinityÔºöË∞ÉÂ∫¶Âà∞Êª°Ë∂≥Êù°‰ª∂ÁöÑ Pod ÊâÄÂú®ÁöÑ Node ‰∏ä</li>
</ul>
<p>ÊöÇÊó∂ÂÖàËÆ≤‰∏Ä‰∏ã<code>nodeSelector</code>ÔºåÂÖ∂‰ªñ‰∏§ÁßçÂêéÊñáÂÜçËÆ≤</p>
<h5 id="ÈÖçÁΩÆÊñá‰ª∂-4">ÈÖçÁΩÆÊñá‰ª∂
</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">apps/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">DaemonSet</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">fluentd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w"> </span><span class="c"># ÂåπÈÖçpo</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">logging</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">template</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">logging</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l">fluentd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">fluentd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">fluentd-es</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">agilestacks/fluentd-elasticsearch:v1.3.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">env</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">FLUENTD_ARGS</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span>-<span class="l">qq</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">volumeMounts</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">containers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/var/lib/docker/containers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">varlog</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/varlog</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">hostPath</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/var/lib/docker/containers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">containers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">hostPath</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/var/log</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">varlog</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># Êü•Áúãdaemonset</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@k8s-master daemonset<span class="o">]</span><span class="c1"># kubectl get ds</span>
</span></span><span class="line"><span class="cl">NAME      DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR   AGE
</span></span><span class="line"><span class="cl">fluentd   <span class="m">2</span>         <span class="m">2</span>         <span class="m">0</span>       <span class="m">2</span>            <span class="m">0</span>           &lt;none&gt;          8s
</span></span><span class="line"><span class="cl"><span class="c1"># Êü•ÁúãÂØπÂ∫îÁöÑpo</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@k8s-master k8s<span class="o">]</span><span class="c1"># kubectl get po --show-labels</span>
</span></span><span class="line"><span class="cl">NAME            READY   STATUS    RESTARTS   AGE   LABELS
</span></span><span class="line"><span class="cl">dns-test        1/1     Running   <span class="m">0</span>          12d   <span class="nv">run</span><span class="o">=</span>dns-test
</span></span><span class="line"><span class="cl">fluentd-drcr8   1/1     Running   <span class="m">0</span>          13m   <span class="nv">app</span><span class="o">=</span>logging,controller-revision-hash<span class="o">=</span>b96747bc7,id<span class="o">=</span>fluentd,pod-template-generation<span class="o">=</span><span class="m">1</span>
</span></span><span class="line"><span class="cl">fluentd-ndlcf   1/1     Running   <span class="m">0</span>          13m   <span class="nv">app</span><span class="o">=</span>logging,controller-revision-hash<span class="o">=</span>b96747bc7,id<span class="o">=</span>fluentd,pod-template-generation<span class="o">=</span><span class="m">1</span>
</span></span><span class="line"><span class="cl">web-0           1/1     Running   <span class="m">0</span>          11d   <span class="nv">app</span><span class="o">=</span>nginx,controller-revision-hash<span class="o">=</span>web-7974cc466,statefulset.kubernetes.io/pod-name<span class="o">=</span>web-0
</span></span><span class="line"><span class="cl">web-1           1/1     Running   <span class="m">0</span>          11d   <span class="nv">app</span><span class="o">=</span>nginx,controller-revision-hash<span class="o">=</span>web-7974cc466,statefulset.kubernetes.io/pod-name<span class="o">=</span>web-1
</span></span><span class="line"><span class="cl">web-2           1/1     Running   <span class="m">0</span>          11d   <span class="nv">app</span><span class="o">=</span>nginx,controller-revision-hash<span class="o">=</span>web-7974cc466,statefulset.kubernetes.io/pod-name<span class="o">=</span>web-2
</span></span><span class="line"><span class="cl">web-3           1/1     Running   <span class="m">0</span>          11d   <span class="nv">app</span><span class="o">=</span>nginx,controller-revision-hash<span class="o">=</span>web-7974cc466,statefulset.kubernetes.io/pod-name<span class="o">=</span>web-3
</span></span><span class="line"><span class="cl">web-4           1/1     Running   <span class="m">0</span>          11d   <span class="nv">app</span><span class="o">=</span>nginx,controller-revision-hash<span class="o">=</span>web-7974cc466,statefulset.kubernetes.io/pod-name<span class="o">=</span>web-4
</span></span><span class="line"><span class="cl">web-5           1/1     Running   <span class="m">0</span>          11d   <span class="nv">app</span><span class="o">=</span>nginx,controller-revision-hash<span class="o">=</span>web-7974cc466,statefulset.kubernetes.io/pod-name<span class="o">=</span>web-5
</span></span><span class="line"><span class="cl"><span class="c1"># Êü•ÁúãÊ†áÁ≠æÔºåÂõ†‰∏∫Ê≤°ÊúâÈÄâÊã©ÈúÄË¶ÅÈÉ®ÁΩ≤ÁöÑËäÇÁÇπÔºåÊâÄ‰ª•Áé∞Âú®ÂæÄÊØè‰∏Ä‰∏™ÈùûmasterËäÇÁÇπÈÉΩÈÉ®ÁΩ≤‰∫Ü‰∏Ä‰ªΩ</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@k8s-master k8s<span class="o">]</span><span class="c1"># kubectl get nodes --show-labels</span>
</span></span><span class="line"><span class="cl">NAME         STATUS   ROLES                  AGE   VERSION   LABELS
</span></span><span class="line"><span class="cl">k8s-master   Ready    control-plane,master   82d   v1.23.6   beta.kubernetes.io/arch<span class="o">=</span>amd64,beta.kubernetes.io/os<span class="o">=</span>linux,kubernetes.io/arch<span class="o">=</span>amd64,kubernetes.io/hostname<span class="o">=</span>k8s-master,kubernetes.io/os<span class="o">=</span>linux,node-role.kubernetes.io/control-plane<span class="o">=</span>,node-role.kubernetes.io/master<span class="o">=</span>,node.kubernetes.io/exclude-from-external-load-balancers<span class="o">=</span>
</span></span><span class="line"><span class="cl">k8s-node1    Ready    &lt;none&gt;                 82d   v1.23.6   beta.kubernetes.io/arch<span class="o">=</span>amd64,beta.kubernetes.io/os<span class="o">=</span>linux,kubernetes.io/arch<span class="o">=</span>amd64,kubernetes.io/hostname<span class="o">=</span>k8s-node1,kubernetes.io/os<span class="o">=</span>linux
</span></span><span class="line"><span class="cl">k8s-node2    Ready    &lt;none&gt;                 82d   v1.23.6   beta.kubernetes.io/arch<span class="o">=</span>amd64,beta.kubernetes.io/os<span class="o">=</span>linux,kubernetes.io/arch<span class="o">=</span>amd64,kubernetes.io/hostname<span class="o">=</span>k8s-node2,kubernetes.io/os<span class="o">=</span>linux
</span></span><span class="line"><span class="cl"><span class="c1"># ÈáçÊñ∞ÁºñËæëdaemonset</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@k8s-master k8s<span class="o">]</span><span class="c1"># kubectl edit ds fluentd</span>
</span></span><span class="line"><span class="cl">daemonset.apps/fluentd edited
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="c"># Please edit the object below. Lines beginning with a &#39;#&#39; will be ignored,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># and an empty file will abort the edit. If an error occurs while saving this file will be</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># reopened with the relevant failures.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">apps/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">DaemonSet</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">annotations</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">deprecated.daemonset.template.generation</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;2&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">creationTimestamp</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;2024-12-30T13:34:32Z&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">generation</span><span class="p">:</span><span class="w"> </span><span class="m">2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">fluentd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">default</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">resourceVersion</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;205641&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">uid</span><span class="p">:</span><span class="w"> </span><span class="l">022c628c-ca36-4c97-b149-f201569ed32e</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">revisionHistoryLimit</span><span class="p">:</span><span class="w"> </span><span class="m">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">logging</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">template</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">creationTimestamp</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">logging</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l">fluentd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">fluentd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">env</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">FLUENTD_ARGS</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span>-<span class="l">qq</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">agilestacks/fluentd-elasticsearch:v1.3.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">IfNotPresent</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">fluentd-es</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">resources</span><span class="p">:</span><span class="w"> </span>{}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">terminationMessagePath</span><span class="p">:</span><span class="w"> </span><span class="l">/dev/termination-log</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">terminationMessagePolicy</span><span class="p">:</span><span class="w"> </span><span class="l">File</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">volumeMounts</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/var/lib/docker/containers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">containers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/varlog</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">varlog</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">dnsPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">ClusterFirst</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">nodeSelector</span><span class="p">:</span><span class="w"> </span><span class="c">## Ê∑ªÂä†Ëøô‰∏§Ë°åÔºåÁî®Êù•ÈÄâÊã©ÂØπÂ∫îlabelÁöÑnodesËäÇÁÇπ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">microservices</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">restartPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">Always</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">schedulerName</span><span class="p">:</span><span class="w"> </span><span class="l">default-scheduler</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">securityContext</span><span class="p">:</span><span class="w"> </span>{}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">terminationGracePeriodSeconds</span><span class="p">:</span><span class="w"> </span><span class="m">30</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">hostPath</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/var/lib/docker/containers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># Êàë‰ª¨ËøôËæπnodesËäÇÁÇπÊ≤°ÊúâÂåπÈÖç`type: microservices`ÁöÑÔºåÊâÄ‰ª•‰∏ãÈù¢Ê≤°Êúâdaemonset</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@k8s-master k8s<span class="o">]</span><span class="c1"># kubectl get nodes --show-labels</span>
</span></span><span class="line"><span class="cl">NAME         STATUS   ROLES                  AGE   VERSION   LABELS
</span></span><span class="line"><span class="cl">k8s-master   Ready    control-plane,master   83d   v1.23.6   beta.kubernetes.io/arch<span class="o">=</span>amd64,beta.kubernetes.io/os<span class="o">=</span>linux,kubernetes.io/arch<span class="o">=</span>amd64,kubernetes.io/hostname<span class="o">=</span>k8s-master,kubernetes.io/os<span class="o">=</span>linux,node-role.kubernetes.io/control-plane<span class="o">=</span>,node-role.kubernetes.io/master<span class="o">=</span>,node.kubernetes.io/exclude-from-external-load-balancers<span class="o">=</span>
</span></span><span class="line"><span class="cl">k8s-node1    Ready    &lt;none&gt;                 83d   v1.23.6   beta.kubernetes.io/arch<span class="o">=</span>amd64,beta.kubernetes.io/os<span class="o">=</span>linux,kubernetes.io/arch<span class="o">=</span>amd64,kubernetes.io/hostname<span class="o">=</span>k8s-node1,kubernetes.io/os<span class="o">=</span>linux
</span></span><span class="line"><span class="cl">k8s-node2    Ready    &lt;none&gt;                 82d   v1.23.6   beta.kubernetes.io/arch<span class="o">=</span>amd64,beta.kubernetes.io/os<span class="o">=</span>linux,kubernetes.io/arch<span class="o">=</span>amd64,kubernetes.io/hostname<span class="o">=</span>k8s-node2,kubernetes.io/os<span class="o">=</span>linux
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@k8s-master k8s<span class="o">]</span><span class="c1"># kubectl get po --show-labels</span>
</span></span><span class="line"><span class="cl">NAME       READY   STATUS    RESTARTS   AGE   LABELS
</span></span><span class="line"><span class="cl">dns-test   1/1     Running   <span class="m">0</span>          12d   <span class="nv">run</span><span class="o">=</span>dns-test
</span></span><span class="line"><span class="cl">web-0      1/1     Running   <span class="m">0</span>          11d   <span class="nv">app</span><span class="o">=</span>nginx,controller-revision-hash<span class="o">=</span>web-7974cc466,statefulset.kubernetes.io/pod-name<span class="o">=</span>web-0
</span></span><span class="line"><span class="cl">web-1      1/1     Running   <span class="m">0</span>          11d   <span class="nv">app</span><span class="o">=</span>nginx,controller-revision-hash<span class="o">=</span>web-7974cc466,statefulset.kubernetes.io/pod-name<span class="o">=</span>web-1
</span></span><span class="line"><span class="cl">web-2      1/1     Running   <span class="m">0</span>          11d   <span class="nv">app</span><span class="o">=</span>nginx,controller-revision-hash<span class="o">=</span>web-7974cc466,statefulset.kubernetes.io/pod-name<span class="o">=</span>web-2
</span></span><span class="line"><span class="cl">web-3      1/1     Running   <span class="m">0</span>          11d   <span class="nv">app</span><span class="o">=</span>nginx,controller-revision-hash<span class="o">=</span>web-7974cc466,statefulset.kubernetes.io/pod-name<span class="o">=</span>web-3
</span></span><span class="line"><span class="cl">web-4      1/1     Running   <span class="m">0</span>          11d   <span class="nv">app</span><span class="o">=</span>nginx,controller-revision-hash<span class="o">=</span>web-7974cc466,statefulset.kubernetes.io/pod-name<span class="o">=</span>web-4
</span></span><span class="line"><span class="cl">web-5      1/1     Running   <span class="m">0</span>          11d   <span class="nv">app</span><span class="o">=</span>nginx,controller-revision-hash<span class="o">=</span>web-7974cc466,statefulset.kubernetes.io/pod-name<span class="o">=</span>web-5
</span></span><span class="line"><span class="cl"><span class="c1"># ÁªônodesËäÇÁÇπÂ¢ûÂä†label</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@k8s-master k8s<span class="o">]</span><span class="c1"># kubectl label nodes k8s-node1 type=microservices</span>
</span></span><span class="line"><span class="cl">node/k8s-node1 labeled
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@k8s-master k8s<span class="o">]</span><span class="c1"># kubectl get nodes --show-labels</span>
</span></span><span class="line"><span class="cl">NAME         STATUS   ROLES                  AGE   VERSION   LABELS
</span></span><span class="line"><span class="cl">k8s-master   Ready    control-plane,master   83d   v1.23.6   beta.kubernetes.io/arch<span class="o">=</span>amd64,beta.kubernetes.io/os<span class="o">=</span>linux,kubernetes.io/arch<span class="o">=</span>amd64,kubernetes.io/hostname<span class="o">=</span>k8s-master,kubernetes.io/os<span class="o">=</span>linux,node-role.kubernetes.io/control-plane<span class="o">=</span>,node-role.kubernetes.io/master<span class="o">=</span>,node.kubernetes.io/exclude-from-external-load-balancers<span class="o">=</span>
</span></span><span class="line"><span class="cl">k8s-node1    Ready    &lt;none&gt;                 83d   v1.23.6   beta.kubernetes.io/arch<span class="o">=</span>amd64,beta.kubernetes.io/os<span class="o">=</span>linux,kubernetes.io/arch<span class="o">=</span>amd64,kubernetes.io/hostname<span class="o">=</span>k8s-node1,kubernetes.io/os<span class="o">=</span>linux,type<span class="o">=</span>microservices
</span></span><span class="line"><span class="cl">k8s-node2    Ready    &lt;none&gt;                 83d   v1.23.6   beta.kubernetes.io/arch<span class="o">=</span>amd64,beta.kubernetes.io/os<span class="o">=</span>linux,kubernetes.io/arch<span class="o">=</span>amd64,kubernetes.io/hostname<span class="o">=</span>k8s-node2,kubernetes.io/os<span class="o">=</span>linux
</span></span><span class="line"><span class="cl"><span class="c1"># Ëøô‰∏™Êó∂ÂÄôÂ∞±Ëá™Âä®Â¢ûÂä†‰∫Ü‰∏Ä‰∏™ds</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@k8s-master k8s<span class="o">]</span><span class="c1"># kubectl get ds</span>
</span></span><span class="line"><span class="cl">NAME      DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR        AGE
</span></span><span class="line"><span class="cl">fluentd   <span class="m">1</span>         <span class="m">1</span>         <span class="m">1</span>       <span class="m">1</span>            <span class="m">1</span>           <span class="nv">type</span><span class="o">=</span>microservices   21m
</span></span><span class="line"><span class="cl"><span class="c1"># Êü•ÁúãÂèëÁé∞ÊûúÁÑ∂`fluentd-7rxmk`Ë¢´ÈÉ®ÁΩ≤Âà∞k8s-node1‰∏ä‰∫Ü</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@k8s-master k8s<span class="o">]</span><span class="c1"># kubectl get po --show-labels -o wide</span>
</span></span><span class="line"><span class="cl">NAME            READY   STATUS    RESTARTS   AGE   IP               NODE        NOMINATED NODE   READINESS GATES   LABELS
</span></span><span class="line"><span class="cl">dns-test        1/1     Running   <span class="m">0</span>          12d   10.244.169.129   k8s-node2   &lt;none&gt;           &lt;none&gt;            <span class="nv">run</span><span class="o">=</span>dns-test
</span></span><span class="line"><span class="cl">fluentd-7rxmk   1/1     Running   <span class="m">0</span>          73s   10.244.36.67     k8s-node1   &lt;none&gt;           &lt;none&gt;            <span class="nv">app</span><span class="o">=</span>logging,controller-revision-hash<span class="o">=</span>5b4769fc56,id<span class="o">=</span>fluentd,pod-template-generation<span class="o">=</span><span class="m">2</span>
</span></span><span class="line"><span class="cl">web-0           1/1     Running   <span class="m">0</span>          11d   10.244.36.71     k8s-node1   &lt;none&gt;           &lt;none&gt;            <span class="nv">app</span><span class="o">=</span>nginx,controller-revision-hash<span class="o">=</span>web-7974cc466,statefulset.kubernetes.io/pod-name<span class="o">=</span>web-0
</span></span><span class="line"><span class="cl">web-1           1/1     Running   <span class="m">0</span>          11d   10.244.169.136   k8s-node2   &lt;none&gt;           &lt;none&gt;            <span class="nv">app</span><span class="o">=</span>nginx,controller-revision-hash<span class="o">=</span>web-7974cc466,statefulset.kubernetes.io/pod-name<span class="o">=</span>web-1
</span></span><span class="line"><span class="cl">web-2           1/1     Running   <span class="m">0</span>          11d   10.244.169.135   k8s-node2   &lt;none&gt;           &lt;none&gt;            <span class="nv">app</span><span class="o">=</span>nginx,controller-revision-hash<span class="o">=</span>web-7974cc466,statefulset.kubernetes.io/pod-name<span class="o">=</span>web-2
</span></span><span class="line"><span class="cl">web-3           1/1     Running   <span class="m">0</span>          11d   10.244.36.70     k8s-node1   &lt;none&gt;           &lt;none&gt;            <span class="nv">app</span><span class="o">=</span>nginx,controller-revision-hash<span class="o">=</span>web-7974cc466,statefulset.kubernetes.io/pod-name<span class="o">=</span>web-3
</span></span><span class="line"><span class="cl">web-4           1/1     Running   <span class="m">0</span>          11d   10.244.36.69     k8s-node1   &lt;none&gt;           &lt;none&gt;            <span class="nv">app</span><span class="o">=</span>nginx,controller-revision-hash<span class="o">=</span>web-7974cc466,statefulset.kubernetes.io/pod-name<span class="o">=</span>web-4
</span></span><span class="line"><span class="cl">web-5           1/1     Running   <span class="m">0</span>          11d   10.244.169.134   k8s-node2   &lt;none&gt;           &lt;none&gt;            <span class="nv">app</span><span class="o">=</span>nginx,controller-revision-hash<span class="o">=</span>web-7974cc466,statefulset.kubernetes.io/pod-name<span class="o">=</span>web-5
</span></span><span class="line"><span class="cl"><span class="c1"># ÂÜçÁªôk8s-node2Âä†‰∏Ä‰∏™Ê†áÁ≠æ</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@k8s-master k8s<span class="o">]</span><span class="c1"># kubectl label no k8s-node2 type=microservices</span>
</span></span><span class="line"><span class="cl">node/k8s-node2 labeled
</span></span><span class="line"><span class="cl"><span class="c1"># ËøôËæπ‰πüËá™Âä®ÈÉ®ÁΩ≤‰∫ÜÁ¨¨‰∫å‰∏™fluentd(fluentd-zjrqp)</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@k8s-master k8s<span class="o">]</span><span class="c1"># kubectl get po --show-labels -o wide</span>
</span></span><span class="line"><span class="cl">NAME            READY   STATUS    RESTARTS   AGE     IP               NODE        NOMINATED NODE   READINESS GATES   LABELS
</span></span><span class="line"><span class="cl">dns-test        1/1     Running   <span class="m">0</span>          12d     10.244.169.129   k8s-node2   &lt;none&gt;           &lt;none&gt;            <span class="nv">run</span><span class="o">=</span>dns-test
</span></span><span class="line"><span class="cl">fluentd-7rxmk   1/1     Running   <span class="m">0</span>          2m53s   10.244.36.67     k8s-node1   &lt;none&gt;           &lt;none&gt;            <span class="nv">app</span><span class="o">=</span>logging,controller-revision-hash<span class="o">=</span>5b4769fc56,id<span class="o">=</span>fluentd,pod-template-generation<span class="o">=</span><span class="m">2</span>
</span></span><span class="line"><span class="cl">fluentd-zjrqp   1/1     Running   <span class="m">0</span>          3s      10.244.169.131   k8s-node2   &lt;none&gt;           &lt;none&gt;            <span class="nv">app</span><span class="o">=</span>logging,controller-revision-hash<span class="o">=</span>5b4769fc56,id<span class="o">=</span>fluentd,pod-template-generation<span class="o">=</span><span class="m">2</span>
</span></span><span class="line"><span class="cl">web-0           1/1     Running   <span class="m">0</span>          11d     10.244.36.71     k8s-node1   &lt;none&gt;           &lt;none&gt;            <span class="nv">app</span><span class="o">=</span>nginx,controller-revision-hash<span class="o">=</span>web-7974cc466,statefulset.kubernetes.io/pod-name<span class="o">=</span>web-0
</span></span><span class="line"><span class="cl">web-1           1/1     Running   <span class="m">0</span>          11d     10.244.169.136   k8s-node2   &lt;none&gt;           &lt;none&gt;            <span class="nv">app</span><span class="o">=</span>nginx,controller-revision-hash<span class="o">=</span>web-7974cc466,statefulset.kubernetes.io/pod-name<span class="o">=</span>web-1
</span></span><span class="line"><span class="cl">web-2           1/1     Running   <span class="m">0</span>          11d     10.244.169.135   k8s-node2   &lt;none&gt;           &lt;none&gt;            <span class="nv">app</span><span class="o">=</span>nginx,controller-revision-hash<span class="o">=</span>web-7974cc466,statefulset.kubernetes.io/pod-name<span class="o">=</span>web-2
</span></span><span class="line"><span class="cl">web-3           1/1     Running   <span class="m">0</span>          11d     10.244.36.70     k8s-node1   &lt;none&gt;           &lt;none&gt;            <span class="nv">app</span><span class="o">=</span>nginx,controller-revision-hash<span class="o">=</span>web-7974cc466,statefulset.kubernetes.io/pod-name<span class="o">=</span>web-3
</span></span><span class="line"><span class="cl">web-4           1/1     Running   <span class="m">0</span>          11d     10.244.36.69     k8s-node1   &lt;none&gt;           &lt;none&gt;            <span class="nv">app</span><span class="o">=</span>nginx,controller-revision-hash<span class="o">=</span>web-7974cc466,statefulset.kubernetes.io/pod-name<span class="o">=</span>web-4
</span></span><span class="line"><span class="cl">web-5           1/1     Running   <span class="m">0</span>          11d     10.244.169.134   k8s-node2   &lt;none&gt;           &lt;none&gt;            <span class="nv">app</span><span class="o">=</span>nginx,controller-revision-hash<span class="o">=</span>web-7974cc466,statefulset.kubernetes.io/pod-name<span class="o">=</span>web-5
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>nodeAffinity</p>
</blockquote>
<p>nodeAffinity ÁõÆÂâçÊîØÊåÅ‰∏§ÁßçÔºö<code>requiredDuringSchedulingIgnoredDuringExecution</code> Âíå <code>preferredDuringSchedulingIgnoredDuringExecution</code>ÔºåÂàÜÂà´‰ª£Ë°®ÂøÖÈ°ªÊª°Ë∂≥Êù°‰ª∂Âíå‰ºòÈÄâÊù°‰ª∂„ÄÇ</p>
<p>ÊØîÂ¶Ç‰∏ãÈù¢ÁöÑ‰æãÂ≠ê‰ª£Ë°®Ë∞ÉÂ∫¶Âà∞ÂåÖÂê´Ê†áÁ≠æ <code>wolfcode.cn/framework-name</code> Âπ∂‰∏îÂÄº‰∏∫ <code>spring</code> Êàñ <code>springboot</code> ÁöÑ Node ‰∏äÔºåÂπ∂‰∏î‰ºòÈÄâËøòÂ∏¶ÊúâÊ†áÁ≠æ <code>another-node-label-key=another-node-label-value</code> ÁöÑ Node„ÄÇ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Pod</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">with-node-affinity</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">affinity</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">nodeAffinity</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">requiredDuringSchedulingIgnoredDuringExecution</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">nodeSelectorTerms</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span>- <span class="nt">matchExpressions</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span>- <span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l">wolfcode.cn/framework-name</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="nt">operator</span><span class="p">:</span><span class="w"> </span><span class="l">In</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="nt">values</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  </span>- <span class="l">spring</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  </span>- <span class="l">springboot</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">preferredDuringSchedulingIgnoredDuringExecution</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">weight</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">preference</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">matchExpressions</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span>- <span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l">another-node-label-key</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="nt">operator</span><span class="p">:</span><span class="w"> </span><span class="l">In</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="nt">values</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  </span>- <span class="l">another-node-label-value</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">with-node-affinity</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">pauseyyf/pause</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>podAffinity</p>
</blockquote>
<p>podAffinity Âü∫‰∫é Pod ÁöÑÊ†áÁ≠æÊù•ÈÄâÊã© NodeÔºå‰ªÖË∞ÉÂ∫¶Âà∞Êª°Ë∂≥Êù°‰ª∂ Pod ÊâÄÂú®ÁöÑ Node ‰∏äÔºåÊîØÊåÅ podAffinity Âíå podAntiAffinity„ÄÇËøô‰∏™ÂäüËÉΩÊØîËæÉÁªïÔºå‰ª•‰∏ãÈù¢ÁöÑ‰æãÂ≠ê‰∏∫‰æãÔºö</p>
<ul>
<li>Â¶ÇÊûú‰∏Ä‰∏™ ‚ÄúNode ÊâÄÂú®Á©∫Èó¥‰∏≠ÂåÖÂê´Ëá≥Â∞ë‰∏Ä‰∏™Â∏¶Êúâ auth=oauth2 Ê†áÁ≠æ‰∏îËøêË°å‰∏≠ÁöÑ Pod‚ÄùÔºåÈÇ£‰πàÂèØ‰ª•Ë∞ÉÂ∫¶Âà∞ËØ• Node</li>
<li>‰∏çË∞ÉÂ∫¶Âà∞ ‚ÄúÂåÖÂê´Ëá≥Â∞ë‰∏Ä‰∏™Â∏¶Êúâ auth=jwt Ê†áÁ≠æ‰∏îËøêË°å‰∏≠ Pod‚ÄùÁöÑ Node ‰∏ä</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Pod</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">with-pod-affinity</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">affinity</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">podAffinity</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">requiredDuringSchedulingIgnoredDuringExecution</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">labelSelector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">matchExpressions</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span>- <span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l">auth</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="nt">operator</span><span class="p">:</span><span class="w"> </span><span class="l">In</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="nt">values</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  </span>- <span class="l">oauth2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">topologyKey</span><span class="p">:</span><span class="w"> </span><span class="l">failure-domain.beta.kubernetes.io/zone</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">podAntiAffinity</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">preferredDuringSchedulingIgnoredDuringExecution</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">weight</span><span class="p">:</span><span class="w"> </span><span class="m">100</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">podAffinityTerm</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">labelSelector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">matchExpressions</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span>- <span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l">auth</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  </span><span class="nt">operator</span><span class="p">:</span><span class="w"> </span><span class="l">In</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  </span><span class="nt">values</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span>- <span class="l">jwt</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">topologyKey</span><span class="p">:</span><span class="w"> </span><span class="l">kubernetes.io/hostname</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">with-pod-affinity</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">pauseyyf/pause</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h5 id="ÊªöÂä®Êõ¥Êñ∞-1">ÊªöÂä®Êõ¥Êñ∞
</h5><blockquote>
<p>‰∏çÂª∫ËÆÆ‰ΩøÁî® RollingUpdateÔºåÂª∫ËÆÆ‰ΩøÁî® OnDelete Ê®°ÂºèÔºåËøôÊ†∑ÈÅøÂÖçÈ¢ëÁπÅÊõ¥Êñ∞ ds</p>
<p>ÈªòËÆ§ daemonset ÊªöÂä®Êõ¥Êñ∞ÁöÑÊ®°ÂºèÊòØ<code>RollingUpdate</code></p>
<p>‰ΩÜÊòØ‰∏çÂª∫ËÆÆ‰ΩøÁî®<code>RollingUpdate</code>ÔºåÂª∫ËÆÆ‰ΩøÁî®<code>Ondelete</code></p>
<p>Âõ†‰∏∫Â¶ÇÊûúÊàë‰ª¨Â∏åÊúõÂØπÊüê‰∏™ËäÇÁÇπÁöÑ ds ËøõË°åÊõ¥Êñ∞ÔºåÈÇ£‰πàÊ≠§Êó∂‰ºöÂ∞ÜÊâÄÊúâÁªìÁÇπÁöÑ ds ÂÖ®ÈÉ®Êõ¥Êñ∞</p>
<p>Â¶ÇÊûú‰ΩøÁî®<code>Ondelete</code>ÔºåÊàë‰ª¨Âè™ÈúÄË¶ÅÂ∞ÜÈúÄË¶ÅÊõ¥Êñ∞ÁöÑ<code>po</code>Âà†ÊéâÂç≥ÂèØÔºå‰ºöËá™Âä®ÂàõÂª∫Âπ∂Êõ¥Êñ∞</p>
</blockquote>
<h4 id="hpa-Ëá™Âä®Êâ©Áº©ÂÆπ">HPA Ëá™Âä®Êâ©/Áº©ÂÆπ
</h4><p>ÈÄöËøáËßÇÂØü pod ÁöÑ cpu„ÄÅÂÜÖÂ≠ò‰ΩøÁî®ÁéáÊàñËá™ÂÆö‰πâ metrics ÊåáÊ†áËøõË°åËá™Âä®ÁöÑÊâ©ÂÆπÊàñÁº©ÂÆπ pod ÁöÑÊï∞Èáè„ÄÇ</p>
<p>ÈÄöÂ∏∏Áî®‰∫é DeploymentÔºå‰∏çÈÄÇÁî®‰∫éÊó†Ê≥ïÊâ©/Áº©ÂÆπÁöÑÂØπË±°ÔºåÂ¶Ç <code>DaemonSet</code></p>
<p>ÊéßÂà∂ÁÆ°ÁêÜÂô®ÊØèÈöî 30sÔºàÂèØ‰ª•ÈÄöËøá‚Äìhorizontal-pod-autoscaler-sync-period ‰øÆÊîπÔºâÊü•ËØ¢ metrics ÁöÑËµÑÊ∫ê‰ΩøÁî®ÊÉÖÂÜµ</p>
<blockquote>
<p>ËøôÈáåÊºîÁ§∫Â∞±ÂÖàÂ∞ÜÂâØÊú¨Êï∞ÊîπÊàê 1ÔºåËÆ©‰ªñËá™Âä®Êâ©ÂÆπ</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="o">[</span>root@k8s-master deployments<span class="o">]</span><span class="c1"># ll</span>
</span></span><span class="line"><span class="cl">total <span class="m">4</span>
</span></span><span class="line"><span class="cl">-rw-r--r-- <span class="m">1</span> root root <span class="m">569</span> Dec <span class="m">15</span> 21:52 nginx-deploy.yaml
</span></span><span class="line"><span class="cl"><span class="o">[</span>root@k8s-master deployments<span class="o">]</span><span class="c1"># vim nginx-deploy.yaml</span>
</span></span><span class="line"><span class="cl"><span class="c1"># spec:</span>
</span></span><span class="line"><span class="cl"><span class="c1">#   replicas: 1 # ÂâØÊú¨Êï∞</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="ÂºÄÂêØÊåáÊ†áÊúçÂä°">ÂºÄÂêØÊåáÊ†áÊúçÂä°
</h5><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># ‰∏ãËΩΩ metrics-server ÁªÑ‰ª∂ÈÖçÁΩÆÊñá‰ª∂</span>
</span></span><span class="line"><span class="cl">wget https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml -O metrics-server-components.yaml
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ‰øÆÊîπÈïúÂÉèÂú∞ÂùÄ‰∏∫ÂõΩÂÜÖÁöÑÂú∞ÂùÄ</span>
</span></span><span class="line"><span class="cl">sed -i <span class="s1">&#39;s/k8s.gcr.io\/metrics-server/registry.cn-hangzhou.aliyuncs.com\/google_containers/g&#39;</span> metrics-server-components.yaml
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ‰øÆÊîπÂÆπÂô®ÁöÑ tls ÈÖçÁΩÆÔºå‰∏çÈ™åËØÅ tlsÔºåÂú® containers ÁöÑ args ÂèÇÊï∞‰∏≠Â¢ûÂä† --kubelet-insecure-tls ÂèÇÊï∞</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ÂÆâË£ÖÁªÑ‰ª∂</span>
</span></span><span class="line"><span class="cl">kubectl apply -f metrics-server-components.yaml
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Êü•Áúã pod Áä∂ÊÄÅ</span>
</span></span><span class="line"><span class="cl">kubectl get pods --all-namespaces <span class="p">|</span> grep metrics
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="cpuÂÜÖÂ≠òÊåáÊ†áÁõëÊéß">cpu„ÄÅÂÜÖÂ≠òÊåáÊ†áÁõëÊéß
</h5><p>ÂÆûÁé∞ cpu ÊàñÂÜÖÂ≠òÁöÑÁõëÊéßÔºåÈ¶ñÂÖàÊúâ‰∏™ÂâçÊèêÊù°‰ª∂ÊòØËØ•ÂØπË±°ÂøÖÈ°ªÈÖçÁΩÆ‰∫Ü <code>resources.requests.cpu</code> Êàñ <code>resources.requests.memory</code> ÊâçÂèØ‰ª•ÔºåÂèØ‰ª•ÈÖçÁΩÆÂΩì cpu/memory ËææÂà∞‰∏äËø∞ÈÖçÁΩÆÁöÑÁôæÂàÜÊØîÂêéËøõË°åÊâ©ÂÆπÊàñÁº©ÂÆπ</p>
<p>ÂàõÂª∫‰∏Ä‰∏™ HPAÔºö</p>
<ol>
<li>
<p>ÂÖàÂáÜÂ§á‰∏Ä‰∏™Â•Ω‰∏Ä‰∏™ÊúâÂÅöËµÑÊ∫êÈôêÂà∂ÁöÑ deployment</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">apps/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Deployment</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">nginx-deploy</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx-deploy</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">default</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">revisionHistoryLimit</span><span class="p">:</span><span class="w"> </span><span class="m">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">nginx-deploy</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">strategy</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">rollingUpdate</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">maxSurge</span><span class="p">:</span><span class="w"> </span><span class="m">25</span><span class="l">%</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">maxUnavailable</span><span class="p">:</span><span class="w"> </span><span class="m">25</span><span class="l">%</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">RollingUpdate</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">template</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">nginx-deploy</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">nginx:1.7.9</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">IfNotPresent</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">resources</span><span class="p">:</span><span class="w"> </span><span class="c"># ÈÖçÁΩÆËµÑÊ∫êÈôêÂà∂ÔºåÈÖçÂ∞è‰∏ÄÁÇπÔºå‰æø‰∫éÊµãËØïËá™Âä®Êâ©ÂÆπ</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">limits</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="l">100m</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l">128Mi</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">requests</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="l">100m</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l">128Mi</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">restartPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">Always</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">terminationGracePeriodSeconds</span><span class="p">:</span><span class="w"> </span><span class="m">30</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Êàë‰ª¨‰πãÂâçÂ∑≤ÁªèÂàõÂª∫Ëøá‰∏Ä‰∏™<code>nginx-deploy</code>‰∫ÜÔºåËøôÊ¨°Áõ¥Êé•ÊõøÊç¢Â∞±Â•Ω</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">kubectl replace -f nginx-deploy.yaml
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>ÊâßË°åÂëΩ‰ª§</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">kubectl autoscale deploy nginx-deploy --cpu-percent<span class="o">=</span><span class="m">20</span> --min<span class="o">=</span><span class="m">2</span> --max<span class="o">=</span><span class="m">5</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>ÈÄöËøá <code>kubectl get hpa</code> ÂèØ‰ª•Ëé∑Âèñ HPA ‰ø°ÊÅØ</p>
</li>
</ol>
<p>ÊµãËØïÔºöÊâæÂà∞ÂØπÂ∫îÊúçÂä°ÁöÑ serviceÔºåÁºñÂÜôÂæ™ÁéØÊµãËØïËÑöÊú¨ÊèêÂçáÂÜÖÂ≠ò‰∏é cpu Ë¥üËΩΩ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="k">while</span> true<span class="p">;</span> <span class="k">do</span> wget -q -O- http://&lt;ip:port&gt; &gt; /dev/null <span class="p">;</span> <span class="k">done</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ÂèØ‰ª•ÈÄöËøáÂ§öÂè∞Êú∫Âô®ÊâßË°å‰∏äËø∞ÂëΩ‰ª§ÔºåÂ¢ûÂä†Ë¥üËΩΩÔºåÂΩìË∂ÖËøáË¥üËΩΩÂêéÂèØ‰ª•Êü•Áúã pods ÁöÑÊâ©ÂÆπÊÉÖÂÜµ <code>kubectl get pods</code></p>
<p>Êü•Áúã pods ËµÑÊ∫ê‰ΩøÁî®ÊÉÖÂÜµ
<code>kubectl top pods</code></p>
<p>Êâ©ÂÆπÊµãËØïÂÆåÊàêÂêéÔºåÂÜçÂÖ≥Èó≠Âæ™ÁéØÊâßË°åÁöÑÊåá‰ª§ÔºåËÆ© cpu Âç†Áî®ÁéáÈôç‰∏ãÊù•ÔºåÁÑ∂ÂêéËøá 5 ÂàÜÈíüÂêéÊü•ÁúãËá™Âä®Áº©ÂÆπÊÉÖÂÜµ</p>
<h5 id="Ëá™ÂÆö‰πâ-metrics">Ëá™ÂÆö‰πâ metrics
</h5><ul>
<li>ÊéßÂà∂ÁÆ°ÁêÜÂô®ÂºÄÂêØ‚Äìhorizontal-pod-autoscaler-use-rest-clients</li>
<li>ÊéßÂà∂ÁÆ°ÁêÜÂô®ÁöÑ‚Äìapiserver ÊåáÂêë<a class="link" href="https://github.com/kubernetes/kube-aggregator"  target="_blank" rel="noopener" >API Server Aggregator</a></li>
<li>Âú® API Server Aggregator ‰∏≠Ê≥®ÂÜåËá™ÂÆö‰πâÁöÑ metrics API</li>
</ul>

</section>


    <footer class="article-footer">
    

    </footer>


    
</article>

    

    

     
    
        
    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2020 - 
        
        2025 Ê∑±Êµ∑ÁÅ´ÈîÖÂ∫ó
    </section>
    
    <section class="powerby">
        ‰ΩøÁî® <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> ÊûÑÂª∫ <br />
        ‰∏ªÈ¢ò <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.29.0">Stack</a></b> Áî± <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> ËÆæËÆ°
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
